<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ko6: src/soft/hal/cpu/thread.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo55.png"/></td>
  <td id="projectalign">
   <div id="projectname">ko6
   </div>
   <div id="projectbrief">ko6 (prononce it &#39;kit-O-sys&#39; O is  the letter not the number) is a small operating system for educationnal purpose</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8785740846211ac34fd04c61a1fdd888.html">soft</a></li><li class="navelem"><a class="el" href="dir_4bc59b718064dd09f06e1584b4cdcbcb.html">hal</a></li><li class="navelem"><a class="el" href="dir_b0d46b92957f08afb3fe2fa8b756c082.html">cpu</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">thread.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a href="thread_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af63f55ab4a65c97f8effe4ff21de0b1e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread_8h.html#af63f55ab4a65c97f8effe4ff21de0b1e">thread_context_init</a> (int context[], void *bootstrap, void *stack_pointer)</td></tr>
<tr class="memdesc:af63f55ab4a65c97f8effe4ff21de0b1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the thread context at the very beginning.  <br /></td></tr>
<tr class="separator:af63f55ab4a65c97f8effe4ff21de0b1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ec481f4858f7894f48f951d1a59e868"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread_8h.html#a4ec481f4858f7894f48f951d1a59e868">thread_context_save</a> (int context[])</td></tr>
<tr class="memdesc:a4ec481f4858f7894f48f951d1a59e868"><td class="mdescLeft">&#160;</td><td class="mdescRight">kernel saves the given thread registers in the context table  <br /></td></tr>
<tr class="separator:a4ec481f4858f7894f48f951d1a59e868"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d77cc7bcdfa6b6295a8bcd74803cc4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread_8h.html#a2d77cc7bcdfa6b6295a8bcd74803cc4a">thread_context_load</a> (int context[])</td></tr>
<tr class="memdesc:a2d77cc7bcdfa6b6295a8bcd74803cc4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">kernel load the given thread registers from the context table  <br /></td></tr>
<tr class="separator:a2d77cc7bcdfa6b6295a8bcd74803cc4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a19412f68ca2922fbb153cf8107c16fce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread_8h.html#a19412f68ca2922fbb153cf8107c16fce">thread_launch</a> (int fun, int arg, int start)</td></tr>
<tr class="memdesc:a19412f68ca2922fbb153cf8107c16fce"><td class="mdescLeft">&#160;</td><td class="mdescRight">The kernel starts any thread for the very first time with this function. This function is called by the static function <a class="el" href="kthread_8c.html#ab6382c52388aa3e432787e2b9b4671bb" title="thread_bootstrap() function is the bootstrap of the thread. It means that it is the very first functi...">thread_bootstrap()</a> (in <a class="el" href="kthread_8c.html">kthread.c</a>) which is the real beginning of a thread, and <a class="el" href="kthread_8c.html#ab6382c52388aa3e432787e2b9b4671bb" title="thread_bootstrap() function is the bootstrap of the thread. It means that it is the very first functi...">thread_bootstrap()</a> is called by the first call of thread_load() for each thread (see comment of thread_bootstrat in <a class="el" href="kthread_8c.html">kthread.c</a> for more details)  <br /></td></tr>
<tr class="separator:a19412f68ca2922fbb153cf8107c16fce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="af63f55ab4a65c97f8effe4ff21de0b1e" name="af63f55ab4a65c97f8effe4ff21de0b1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af63f55ab4a65c97f8effe4ff21de0b1e">&#9670;&#160;</a></span>thread_context_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void thread_context_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>context</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>bootstrap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>stack_pointer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the thread context at the very beginning. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>thread_context table </td></tr>
    <tr><td class="paramname">bootstrap</td><td>function without any argument, used just after the 1st thread_context_load </td></tr>
    <tr><td class="paramname">stack_pointer</td><td>top stack pointer at the very beginning </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>side effect on the given thread context table </dd></dl>
<p>mstatus of a user-thread should have: mstatus.MPIE = 0 (we don't want interrupts when we go back in M-mode) mstatus.MPP = M-mode (we want to go back in m-mode) mstatus.MIE = 1 (interrupts are enabled)</p>
<div class="fragment"><div class="line"><span class="lineno">   20</span>{</div>
<div class="line"><span class="lineno">   21</span>    context[<a class="code hl_define" href="mips_2context_8h.html#a82628b11b4b2d2529fb40f9b239ffffb">TH_CONTEXT_SR</a>] = 0x413;                 <span class="comment">// UM=1 EXL=1 IE=1</span></div>
<div class="line"><span class="lineno">   22</span>    context[<a class="code hl_define" href="mips_2context_8h.html#a68ca4f685574d5124a207ed155304e72">TH_CONTEXT_RA</a>] = (int)bootstrap;        <span class="comment">// goto thread_bootstrap</span></div>
<div class="line"><span class="lineno">   23</span>    context[<a class="code hl_define" href="mips_2context_8h.html#a144a505c445f1e70afbf4ff0196bf330">TH_CONTEXT_SP</a>] = (int)stack_pointer;    <span class="comment">// stack beginning </span></div>
<div class="line"><span class="lineno">   24</span>}</div>
<div class="ttc" id="amips_2context_8h_html_a144a505c445f1e70afbf4ff0196bf330"><div class="ttname"><a href="mips_2context_8h.html#a144a505c445f1e70afbf4ff0196bf330">TH_CONTEXT_SP</a></div><div class="ttdeci">#define TH_CONTEXT_SP</div><div class="ttdef"><b>Definition:</b> context.h:40</div></div>
<div class="ttc" id="amips_2context_8h_html_a68ca4f685574d5124a207ed155304e72"><div class="ttname"><a href="mips_2context_8h.html#a68ca4f685574d5124a207ed155304e72">TH_CONTEXT_RA</a></div><div class="ttdeci">#define TH_CONTEXT_RA</div><div class="ttdef"><b>Definition:</b> context.h:39</div></div>
<div class="ttc" id="amips_2context_8h_html_a82628b11b4b2d2529fb40f9b239ffffb"><div class="ttname"><a href="mips_2context_8h.html#a82628b11b4b2d2529fb40f9b239ffffb">TH_CONTEXT_SR</a></div><div class="ttdeci">#define TH_CONTEXT_SR</div><div class="ttdef"><b>Definition:</b> context.h:37</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="riscv_2context_8h.html#a06c1946b74acc4d62029b18086e78252">TH_CONTEXT_MSTATUS</a>, <a class="el" href="mips_2context_8h.html#a68ca4f685574d5124a207ed155304e72">TH_CONTEXT_RA</a>, <a class="el" href="mips_2context_8h.html#a144a505c445f1e70afbf4ff0196bf330">TH_CONTEXT_SP</a>, and <a class="el" href="mips_2context_8h.html#a82628b11b4b2d2529fb40f9b239ffffb">TH_CONTEXT_SR</a>.</p>

<p class="reference">Referenced by <a class="el" href="kthread_8c.html#a2525e99272c4db4198bcea374d717620">thread_create()</a>.</p>

</div>
</div>
<a id="a2d77cc7bcdfa6b6295a8bcd74803cc4a" name="a2d77cc7bcdfa6b6295a8bcd74803cc4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d77cc7bcdfa6b6295a8bcd74803cc4a">&#9670;&#160;</a></span>thread_context_load()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int thread_context_load </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>context</em>[]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>kernel load the given thread registers from the context table </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>thread_context table of the thread to load (or to restore) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>returns alway 0 (false) </dd></dl>

<p class="reference">Referenced by <a class="el" href="kthread_8c.html#a79c9880ce2be11d3a2c217c383d256fb">sched_switch()</a>, and <a class="el" href="kthread_8c.html#a95c63c8faef6c13da432a94800ad2acb">thread_main_load()</a>.</p>

</div>
</div>
<a id="a4ec481f4858f7894f48f951d1a59e868" name="a4ec481f4858f7894f48f951d1a59e868"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ec481f4858f7894f48f951d1a59e868">&#9670;&#160;</a></span>thread_context_save()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int thread_context_save </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>context</em>[]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>kernel saves the given thread registers in the context table </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context</td><td>thread_context table of the thread to save </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>it returns two values depending on how this function has been called. First case, the simplest, we call thread_save () then it returns 1 (true). Secondly, we call thread_restore() (see bellow) that causes the restoration of all registers recorded by thread_save(), including $31, thus when we return from thread_load(), in reality, we return from thread_save, but with 0 (false) as return value. </dd></dl>

<p class="reference">Referenced by <a class="el" href="kthread_8c.html#a79c9880ce2be11d3a2c217c383d256fb">sched_switch()</a>.</p>

</div>
</div>
<a id="a19412f68ca2922fbb153cf8107c16fce" name="a19412f68ca2922fbb153cf8107c16fce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19412f68ca2922fbb153cf8107c16fce">&#9670;&#160;</a></span>thread_launch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int thread_launch </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The kernel starts any thread for the very first time with this function. This function is called by the static function <a class="el" href="kthread_8c.html#ab6382c52388aa3e432787e2b9b4671bb" title="thread_bootstrap() function is the bootstrap of the thread. It means that it is the very first functi...">thread_bootstrap()</a> (in <a class="el" href="kthread_8c.html">kthread.c</a>) which is the real beginning of a thread, and <a class="el" href="kthread_8c.html#ab6382c52388aa3e432787e2b9b4671bb" title="thread_bootstrap() function is the bootstrap of the thread. It means that it is the very first functi...">thread_bootstrap()</a> is called by the first call of thread_load() for each thread (see comment of thread_bootstrat in <a class="el" href="kthread_8c.html">kthread.c</a> for more details) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fun</td><td>ptr to the function of the thread, type: void*(<em>fun)(void</em>) but cast to int </td></tr>
    <tr><td class="paramname">arg</td><td>the argument given to fun(), type: void* but cast to int </td></tr>
    <tr><td class="paramname">start</td><td>ptr to the user function which calls fun(arg) for real, type is cast to int In fact, start has two possible types. If it is the main thread then it is : void (*start) (void) but if it is a standard thread then it is : void (*start) (void *(*fun) (void *), void *arg) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>never returns </dd></dl>

<p class="reference">Referenced by <a class="el" href="kthread_8c.html#ab6382c52388aa3e432787e2b9b4671bb">thread_bootstrap()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
