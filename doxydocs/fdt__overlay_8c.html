<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ko6: src/soft/external/libfdt/fdt_overlay.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo55.png"/></td>
  <td id="projectalign">
   <div id="projectname">ko6
   </div>
   <div id="projectbrief">ko6 (prononce it &#39;kit-O-sys&#39; O is  the letter not the number) is a small operating system for educationnal purpose</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8785740846211ac34fd04c61a1fdd888.html">soft</a></li><li class="navelem"><a class="el" href="dir_fc519a13014ae8743e43f59c46623498.html">external</a></li><li class="navelem"><a class="el" href="dir_bfb68bfa260d5fbf1a9b080af0449f39.html">libfdt</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">fdt_overlay.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="libfdt__env_8h_source.html">libfdt_env.h</a>&quot;</code><br />
<code>#include &lt;<a class="el" href="fdt_8h_source.html">external/libfdt/fdt.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="libfdt_8h_source.html">external/libfdt/libfdt.h</a>&gt;</code><br />
<code>#include &quot;<a class="el" href="libfdt__internal_8h_source.html">libfdt_internal.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1b77c6faf056e97fb21ed6c3b7d3ac6a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a1b77c6faf056e97fb21ed6c3b7d3ac6a">overlay_get_target_phandle</a> (const void *fdto, int fragment)</td></tr>
<tr class="separator:a1b77c6faf056e97fb21ed6c3b7d3ac6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa155e9207e65bc6c432c40e301485af5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset</a> (const void *fdt, const void *fdto, int fragment_offset, char const **pathp)</td></tr>
<tr class="separator:aa155e9207e65bc6c432c40e301485af5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">: Name of the property to modify (phandle or linux,phandle)</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>overlay_phandle_add_offset - Increases a phandle by an offset @fdt: Base device tree blob @node: Device tree overlay blob</p>
<p>@delta: offset to apply</p>
<p><a class="el" href="fdt__overlay_8c.html#a6b1ddbc5c439ce0876f35907174284d8">overlay_phandle_add_offset()</a> increments a node phandle by a given offset.</p>
<p>returns: 0 on success. Negative error code on error </p>
</div></td></tr>
<tr class="memitem:a6b1ddbc5c439ce0876f35907174284d8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a6b1ddbc5c439ce0876f35907174284d8">overlay_phandle_add_offset</a> (void *fdt, int node, const char *name, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> delta)</td></tr>
<tr class="separator:a6b1ddbc5c439ce0876f35907174284d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5256ba69a35ddc0c66148e329285a12b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles</a> (void *fdto, int node, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> delta)</td></tr>
<tr class="separator:a5256ba69a35ddc0c66148e329285a12b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cde92cc15e941275df561c47f912ba4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a8cde92cc15e941275df561c47f912ba4">overlay_adjust_local_phandles</a> (void *fdto, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> delta)</td></tr>
<tr class="separator:a8cde92cc15e941275df561c47f912ba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a385dd43636a52dc96596827f51511419"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references</a> (void *fdto, int tree_node, int fixup_node, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> delta)</td></tr>
<tr class="separator:a385dd43636a52dc96596827f51511419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c4ea38de65ffacb7708dd7641914a34"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a1c4ea38de65ffacb7708dd7641914a34">overlay_update_local_references</a> (void *fdto, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> delta)</td></tr>
<tr class="separator:a1c4ea38de65ffacb7708dd7641914a34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr><td colspan="2"><div class="groupHeader">: Name of the property holding the phandle reference in the overlay</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p>overlay_fixup_one_phandle - Set an overlay phandle to the base one @fdt: Base Device Tree blob @fdto: Device tree overlay blob @symbols_off: Node offset of the symbols node in the base device tree @path: Path to a node holding a phandle in the overlay @path_len: number of path characters to consider</p>
<p>@name_len: number of name characters to consider @poffset: Offset within the overlay property where the phandle is stored @label: Label of the node referenced by the phandle</p>
<p><a class="el" href="fdt__overlay_8c.html#ac2699eeb863f2070d20b509d0b2948f4">overlay_fixup_one_phandle()</a> resolves an overlay phandle pointing to a node in the base device tree.</p>
<p>This is part of the device tree overlay application process, when you want all the phandles in the overlay to point to the actual base dt nodes.</p>
<p>returns: 0 on success Negative error code on failure </p>
</div></td></tr>
<tr class="memitem:ac2699eeb863f2070d20b509d0b2948f4"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#ac2699eeb863f2070d20b509d0b2948f4">overlay_fixup_one_phandle</a> (void *fdt, void *fdto, int symbols_off, const char *path, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> path_len, const char *name, <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> name_len, int poffset, const char *label)</td></tr>
<tr class="separator:ac2699eeb863f2070d20b509d0b2948f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27d6c0e207237b7020d4c7bfa0eb0402"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a27d6c0e207237b7020d4c7bfa0eb0402">overlay_fixup_phandle</a> (void *fdt, void *fdto, int symbols_off, int property)</td></tr>
<tr class="separator:a27d6c0e207237b7020d4c7bfa0eb0402"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cf73a63ad60707f4c93c7de7de81357"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a5cf73a63ad60707f4c93c7de7de81357">overlay_fixup_phandles</a> (void *fdt, void *fdto)</td></tr>
<tr class="separator:a5cf73a63ad60707f4c93c7de7de81357"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cb95c9322e1e68282eda3e7fc90a314"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node</a> (void *fdt, int target, void *fdto, int node)</td></tr>
<tr class="separator:a8cb95c9322e1e68282eda3e7fc90a314"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36a905f6566751e42d0a0111b2d78a67"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge</a> (void *fdt, void *fdto)</td></tr>
<tr class="separator:a36a905f6566751e42d0a0111b2d78a67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3e9264fbe6e8ef97f2378ead11a2fd0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#ac3e9264fbe6e8ef97f2378ead11a2fd0">get_path_len</a> (const void *fdt, int nodeoffset)</td></tr>
<tr class="separator:ac3e9264fbe6e8ef97f2378ead11a2fd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add76bc4fa1b36b1c11bfd9a2cf779ac1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update</a> (void *fdt, void *fdto)</td></tr>
<tr class="separator:add76bc4fa1b36b1c11bfd9a2cf779ac1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0fcb152428382bde7f034cdadfe923e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fdt__overlay_8c.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply</a> (void *fdt, void *fdto)</td></tr>
<tr class="separator:ad0fcb152428382bde7f034cdadfe923e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad0fcb152428382bde7f034cdadfe923e" name="ad0fcb152428382bde7f034cdadfe923e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0fcb152428382bde7f034cdadfe923e">&#9670;&#160;</a></span>fdt_overlay_apply()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fdt_overlay_apply </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fdt_overlay_apply - Applies a DT overlay on a base DT @fdt: pointer to the base device tree blob @fdto: pointer to the device tree overlay blob</p>
<p><a class="el" href="libfdt_8h.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply()</a> will apply the given device tree overlay on the given base device tree.</p>
<p>Expect the base device tree to be modified, even if the function returns an error.</p>
<p>returns: 0, on success -FDT_ERR_NOSPACE, there's not enough space in the base device tree -FDT_ERR_NOTFOUND, the overlay points to some inexistant nodes or properties in the base DT -FDT_ERR_BADPHANDLE, -FDT_ERR_BADOVERLAY, -FDT_ERR_NOPHANDLES, -FDT_ERR_INTERNAL, -FDT_ERR_BADLAYOUT, -FDT_ERR_BADMAGIC, -FDT_ERR_BADOFFSET, -FDT_ERR_BADPATH, -FDT_ERR_BADVERSION, -FDT_ERR_BADSTRUCTURE, -FDT_ERR_BADSTATE, -FDT_ERR_TRUNCATED, standard meanings </p>
<div class="fragment"><div class="line"><span class="lineno">  816</span>{</div>
<div class="line"><span class="lineno">  817</span>    <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> delta;</div>
<div class="line"><span class="lineno">  818</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>    <a class="code hl_define" href="libfdt__internal_8h.html#ad6927f926180469d5c044ec5d3b2f84b">FDT_RO_PROBE</a>(fdt);</div>
<div class="line"><span class="lineno">  821</span>    <a class="code hl_define" href="libfdt__internal_8h.html#ad6927f926180469d5c044ec5d3b2f84b">FDT_RO_PROBE</a>(fdto);</div>
<div class="line"><span class="lineno">  822</span> </div>
<div class="line"><span class="lineno">  823</span>    ret = <a class="code hl_function" href="fdt__ro_8c.html#a57fbf6be8c4911e8448942b9fed97301">fdt_find_max_phandle</a>(fdt, &amp;delta);</div>
<div class="line"><span class="lineno">  824</span>    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  825</span>        <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#a8cde92cc15e941275df561c47f912ba4">overlay_adjust_local_phandles</a>(fdto, delta);</div>
<div class="line"><span class="lineno">  828</span>    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  829</span>        <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  830</span> </div>
<div class="line"><span class="lineno">  831</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#a1c4ea38de65ffacb7708dd7641914a34">overlay_update_local_references</a>(fdto, delta);</div>
<div class="line"><span class="lineno">  832</span>    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  833</span>        <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  834</span> </div>
<div class="line"><span class="lineno">  835</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#a5cf73a63ad60707f4c93c7de7de81357">overlay_fixup_phandles</a>(fdt, fdto);</div>
<div class="line"><span class="lineno">  836</span>    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  837</span>        <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  838</span> </div>
<div class="line"><span class="lineno">  839</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge</a>(fdt, fdto);</div>
<div class="line"><span class="lineno">  840</span>    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  841</span>        <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  842</span> </div>
<div class="line"><span class="lineno">  843</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update</a>(fdt, fdto);</div>
<div class="line"><span class="lineno">  844</span>    <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  845</span>        <span class="keywordflow">goto</span> err;</div>
<div class="line"><span class="lineno">  846</span> </div>
<div class="line"><span class="lineno">  847</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  848</span><span class="comment">     * The overlay has been damaged, erase its magic.</span></div>
<div class="line"><span class="lineno">  849</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  850</span>    fdt_set_magic(fdto, ~0);</div>
<div class="line"><span class="lineno">  851</span> </div>
<div class="line"><span class="lineno">  852</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  853</span> </div>
<div class="line"><span class="lineno">  854</span>err:</div>
<div class="line"><span class="lineno">  855</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  856</span><span class="comment">     * The overlay might have been damaged, erase its magic.</span></div>
<div class="line"><span class="lineno">  857</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  858</span>    fdt_set_magic(fdto, ~0);</div>
<div class="line"><span class="lineno">  859</span> </div>
<div class="line"><span class="lineno">  860</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  861</span><span class="comment">     * The base device tree might have been damaged, erase its</span></div>
<div class="line"><span class="lineno">  862</span><span class="comment">     * magic.</span></div>
<div class="line"><span class="lineno">  863</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  864</span>    fdt_set_magic(fdt, ~0);</div>
<div class="line"><span class="lineno">  865</span> </div>
<div class="line"><span class="lineno">  866</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  867</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a1c4ea38de65ffacb7708dd7641914a34"><div class="ttname"><a href="fdt__overlay_8c.html#a1c4ea38de65ffacb7708dd7641914a34">overlay_update_local_references</a></div><div class="ttdeci">static int overlay_update_local_references(void *fdto, uint32_t delta)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:310</div></div>
<div class="ttc" id="afdt__overlay_8c_html_a36a905f6566751e42d0a0111b2d78a67"><div class="ttname"><a href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge</a></div><div class="ttdeci">static int overlay_merge(void *fdt, void *fdto)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:604</div></div>
<div class="ttc" id="afdt__overlay_8c_html_a5cf73a63ad60707f4c93c7de7de81357"><div class="ttname"><a href="fdt__overlay_8c.html#a5cf73a63ad60707f4c93c7de7de81357">overlay_fixup_phandles</a></div><div class="ttdeci">static int overlay_fixup_phandles(void *fdt, void *fdto)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:495</div></div>
<div class="ttc" id="afdt__overlay_8c_html_a8cde92cc15e941275df561c47f912ba4"><div class="ttname"><a href="fdt__overlay_8c.html#a8cde92cc15e941275df561c47f912ba4">overlay_adjust_local_phandles</a></div><div class="ttdeci">static int overlay_adjust_local_phandles(void *fdto, uint32_t delta)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:178</div></div>
<div class="ttc" id="afdt__overlay_8c_html_add76bc4fa1b36b1c11bfd9a2cf779ac1"><div class="ttname"><a href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update</a></div><div class="ttdeci">static int overlay_symbol_update(void *fdt, void *fdto)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:680</div></div>
<div class="ttc" id="afdt__ro_8c_html_a57fbf6be8c4911e8448942b9fed97301"><div class="ttname"><a href="fdt__ro_8c.html#a57fbf6be8c4911e8448942b9fed97301">fdt_find_max_phandle</a></div><div class="ttdeci">int fdt_find_max_phandle(const void *fdt, uint32_t *phandle)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:114</div></div>
<div class="ttc" id="alibfdt__env_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition:</b> libfdt_env.h:22</div></div>
<div class="ttc" id="alibfdt__internal_8h_html_ad6927f926180469d5c044ec5d3b2f84b"><div class="ttname"><a href="libfdt__internal_8h.html#ad6927f926180469d5c044ec5d3b2f84b">FDT_RO_PROBE</a></div><div class="ttdeci">#define FDT_RO_PROBE(fdt)</div><div class="ttdef"><b>Definition:</b> libfdt_internal.h:14</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fdt__ro_8c.html#a57fbf6be8c4911e8448942b9fed97301">fdt_find_max_phandle()</a>, <a class="el" href="libfdt__internal_8h.html#ad6927f926180469d5c044ec5d3b2f84b">FDT_RO_PROBE</a>, <a class="el" href="fdt__overlay_8c.html#a8cde92cc15e941275df561c47f912ba4">overlay_adjust_local_phandles()</a>, <a class="el" href="fdt__overlay_8c.html#a5cf73a63ad60707f4c93c7de7de81357">overlay_fixup_phandles()</a>, <a class="el" href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge()</a>, <a class="el" href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update()</a>, and <a class="el" href="fdt__overlay_8c.html#a1c4ea38de65ffacb7708dd7641914a34">overlay_update_local_references()</a>.</p>

</div>
</div>
<a id="aa155e9207e65bc6c432c40e301485af5" name="aa155e9207e65bc6c432c40e301485af5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa155e9207e65bc6c432c40e301485af5">&#9670;&#160;</a></span>fdt_overlay_target_offset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fdt_overlay_target_offset </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fragment_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char const **&#160;</td>
          <td class="paramname"><em>pathp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>fdt_overlay_target_offset - retrieves the offset of a fragment's target @fdt: Base device tree blob @fdto: Device tree overlay blob @fragment_offset: node offset of the fragment in the overlay @pathp: pointer which receives the path of the target (or NULL)</p>
<p><a class="el" href="libfdt_8h.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset()</a> retrieves the target offset in the base device tree of a fragment, no matter how the actual targeting is done (through a phandle or a path)</p>
<p>returns: the targeted node offset in the base device tree Negative error code on error </p>
<div class="fragment"><div class="line"><span class="lineno">   45</span>{</div>
<div class="line"><span class="lineno">   46</span>    <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> phandle;</div>
<div class="line"><span class="lineno">   47</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *path = <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">   48</span>    <span class="keywordtype">int</span> path_len = 0, ret;</div>
<div class="line"><span class="lineno">   49</span> </div>
<div class="line"><span class="lineno">   50</span>    <span class="comment">/* Try first to do a phandle based lookup */</span></div>
<div class="line"><span class="lineno">   51</span>    phandle = <a class="code hl_function" href="fdt__overlay_8c.html#a1b77c6faf056e97fb21ed6c3b7d3ac6a">overlay_get_target_phandle</a>(fdto, fragment_offset);</div>
<div class="line"><span class="lineno">   52</span>    <span class="keywordflow">if</span> (phandle == (<a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)-1)</div>
<div class="line"><span class="lineno">   53</span>        <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a0f264f8ba8cc4e98852c8246bc6312bc">FDT_ERR_BADPHANDLE</a>;</div>
<div class="line"><span class="lineno">   54</span> </div>
<div class="line"><span class="lineno">   55</span>    <span class="comment">/* no phandle, try path */</span></div>
<div class="line"><span class="lineno">   56</span>    <span class="keywordflow">if</span> (!phandle) {</div>
<div class="line"><span class="lineno">   57</span>        <span class="comment">/* And then a path based lookup */</span></div>
<div class="line"><span class="lineno">   58</span>        path = <a class="code hl_function" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop</a>(fdto, fragment_offset, <span class="stringliteral">&quot;target-path&quot;</span>, &amp;path_len);</div>
<div class="line"><span class="lineno">   59</span>        <span class="keywordflow">if</span> (path)</div>
<div class="line"><span class="lineno">   60</span>            ret = <a class="code hl_function" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset</a>(fdt, path);</div>
<div class="line"><span class="lineno">   61</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   62</span>            ret = path_len;</div>
<div class="line"><span class="lineno">   63</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">   64</span>        ret = <a class="code hl_function" href="fdt__ro_8c.html#a4ff6571f3fe2fa89cfd6dc15f52eaf1e">fdt_node_offset_by_phandle</a>(fdt, phandle);</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">   67</span><span class="comment">    * If we haven&#39;t found either a target or a</span></div>
<div class="line"><span class="lineno">   68</span><span class="comment">    * target-path property in a node that contains a</span></div>
<div class="line"><span class="lineno">   69</span><span class="comment">    * __overlay__ subnode (we wouldn&#39;t be called</span></div>
<div class="line"><span class="lineno">   70</span><span class="comment">    * otherwise), consider it a improperly written</span></div>
<div class="line"><span class="lineno">   71</span><span class="comment">    * overlay</span></div>
<div class="line"><span class="lineno">   72</span><span class="comment">    */</span></div>
<div class="line"><span class="lineno">   73</span>    <span class="keywordflow">if</span> (ret &lt; 0 &amp;&amp; path_len == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">   74</span>        ret = -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="comment">/* return on error */</span></div>
<div class="line"><span class="lineno">   77</span>    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">   79</span> </div>
<div class="line"><span class="lineno">   80</span>    <span class="comment">/* return pointer to path (if available) */</span></div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordflow">if</span> (pathp)</div>
<div class="line"><span class="lineno">   82</span>        *pathp = path ? path : <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">   83</span> </div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">   85</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a1b77c6faf056e97fb21ed6c3b7d3ac6a"><div class="ttname"><a href="fdt__overlay_8c.html#a1b77c6faf056e97fb21ed6c3b7d3ac6a">overlay_get_target_phandle</a></div><div class="ttdeci">static uint32_t overlay_get_target_phandle(const void *fdto, int fragment)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:28</div></div>
<div class="ttc" id="afdt__ro_8c_html_a222c01ef0a514a4cf7586f6de8b17072"><div class="ttname"><a href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset</a></div><div class="ttdeci">int fdt_path_offset(const void *fdt, const char *path)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:295</div></div>
<div class="ttc" id="afdt__ro_8c_html_a4ff6571f3fe2fa89cfd6dc15f52eaf1e"><div class="ttname"><a href="fdt__ro_8c.html#a4ff6571f3fe2fa89cfd6dc15f52eaf1e">fdt_node_offset_by_phandle</a></div><div class="ttdeci">int fdt_node_offset_by_phandle(const void *fdt, uint32_t phandle)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:698</div></div>
<div class="ttc" id="afdt__ro_8c_html_a91753b1de7cad190da416780f4fbebc0"><div class="ttname"><a href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop</a></div><div class="ttdeci">const void * fdt_getprop(const void *fdt, int nodeoffset, const char *name, int *lenp)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:502</div></div>
<div class="ttc" id="akfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
<div class="ttc" id="alibfdt_8h_html_a0f264f8ba8cc4e98852c8246bc6312bc"><div class="ttname"><a href="libfdt_8h.html#a0f264f8ba8cc4e98852c8246bc6312bc">FDT_ERR_BADPHANDLE</a></div><div class="ttdeci">#define FDT_ERR_BADPHANDLE</div><div class="ttdef"><b>Definition:</b> libfdt.h:41</div></div>
<div class="ttc" id="alibfdt_8h_html_a93cfa052f4b28df4bfc7d336b692fa07"><div class="ttname"><a href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a></div><div class="ttdeci">#define FDT_ERR_NOTFOUND</div><div class="ttdef"><b>Definition:</b> libfdt.h:21</div></div>
<div class="ttc" id="alibfdt_8h_html_aa276d7f3088179b283530d41750ff5e4"><div class="ttname"><a href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a></div><div class="ttdeci">#define FDT_ERR_BADOVERLAY</div><div class="ttdef"><b>Definition:</b> libfdt.h:92</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>, <a class="el" href="libfdt_8h.html#a0f264f8ba8cc4e98852c8246bc6312bc">FDT_ERR_BADPHANDLE</a>, <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop()</a>, <a class="el" href="fdt__ro_8c.html#a4ff6571f3fe2fa89cfd6dc15f52eaf1e">fdt_node_offset_by_phandle()</a>, <a class="el" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset()</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, and <a class="el" href="fdt__overlay_8c.html#a1b77c6faf056e97fb21ed6c3b7d3ac6a">overlay_get_target_phandle()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge()</a>, and <a class="el" href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update()</a>.</p>

</div>
</div>
<a id="ac3e9264fbe6e8ef97f2378ead11a2fd0" name="ac3e9264fbe6e8ef97f2378ead11a2fd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3e9264fbe6e8ef97f2378ead11a2fd0">&#9670;&#160;</a></span>get_path_len()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int get_path_len </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nodeoffset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  637</span>{</div>
<div class="line"><span class="lineno">  638</span>    <span class="keywordtype">int</span> len = 0, namelen;</div>
<div class="line"><span class="lineno">  639</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div>
<div class="line"><span class="lineno">  640</span> </div>
<div class="line"><span class="lineno">  641</span>    <a class="code hl_define" href="libfdt__internal_8h.html#ad6927f926180469d5c044ec5d3b2f84b">FDT_RO_PROBE</a>(fdt);</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>    <span class="keywordflow">for</span> (;;) {</div>
<div class="line"><span class="lineno">  644</span>        name = <a class="code hl_function" href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name</a>(fdt, nodeoffset, &amp;namelen);</div>
<div class="line"><span class="lineno">  645</span>        <span class="keywordflow">if</span> (!name)</div>
<div class="line"><span class="lineno">  646</span>            <span class="keywordflow">return</span> namelen;</div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>        <span class="comment">/* root? we&#39;re done */</span></div>
<div class="line"><span class="lineno">  649</span>        <span class="keywordflow">if</span> (namelen == 0)</div>
<div class="line"><span class="lineno">  650</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  651</span> </div>
<div class="line"><span class="lineno">  652</span>        nodeoffset = <a class="code hl_function" href="fdt__ro_8c.html#a2b518dbd88cb783a9bffa1680ab297f9">fdt_parent_offset</a>(fdt, nodeoffset);</div>
<div class="line"><span class="lineno">  653</span>        <span class="keywordflow">if</span> (nodeoffset &lt; 0)</div>
<div class="line"><span class="lineno">  654</span>            <span class="keywordflow">return</span> nodeoffset;</div>
<div class="line"><span class="lineno">  655</span>        len += namelen + 1;</div>
<div class="line"><span class="lineno">  656</span>    }</div>
<div class="line"><span class="lineno">  657</span> </div>
<div class="line"><span class="lineno">  658</span>    <span class="comment">/* in case of root pretend it&#39;s &quot;/&quot; */</span></div>
<div class="line"><span class="lineno">  659</span>    <span class="keywordflow">if</span> (len == 0)</div>
<div class="line"><span class="lineno">  660</span>        len++;</div>
<div class="line"><span class="lineno">  661</span>    <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno">  662</span>}</div>
<div class="ttc" id="afdt__ro_8c_html_a2b518dbd88cb783a9bffa1680ab297f9"><div class="ttname"><a href="fdt__ro_8c.html#a2b518dbd88cb783a9bffa1680ab297f9">fdt_parent_offset</a></div><div class="ttdeci">int fdt_parent_offset(const void *fdt, int nodeoffset)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:661</div></div>
<div class="ttc" id="afdt__ro_8c_html_a43937fb226554bcff64aa7370046cd82"><div class="ttname"><a href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name</a></div><div class="ttdeci">const char * fdt_get_name(const void *fdt, int nodeoffset, int *len)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:300</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name()</a>, <a class="el" href="fdt__ro_8c.html#a2b518dbd88cb783a9bffa1680ab297f9">fdt_parent_offset()</a>, and <a class="el" href="libfdt__internal_8h.html#ad6927f926180469d5c044ec5d3b2f84b">FDT_RO_PROBE</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update()</a>.</p>

</div>
</div>
<a id="a8cde92cc15e941275df561c47f912ba4" name="a8cde92cc15e941275df561c47f912ba4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cde92cc15e941275df561c47f912ba4">&#9670;&#160;</a></span>overlay_adjust_local_phandles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_adjust_local_phandles </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_adjust_local_phandles - Adjust the phandles of a whole overlay @fdto: Device tree overlay blob @delta: Offset to shift the phandles of</p>
<p><a class="el" href="fdt__overlay_8c.html#a8cde92cc15e941275df561c47f912ba4">overlay_adjust_local_phandles()</a> adds a constant to all the phandles of an overlay. This is mainly use as part of the overlay application process, when we want to update all the overlay phandles to not conflict with the overlays of the base device tree.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  179</span>{</div>
<div class="line"><span class="lineno">  180</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  181</span><span class="comment">     * Start adjusting the phandles from the overlay root</span></div>
<div class="line"><span class="lineno">  182</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  183</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles</a>(fdto, 0, delta);</div>
<div class="line"><span class="lineno">  184</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a5256ba69a35ddc0c66148e329285a12b"><div class="ttname"><a href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles</a></div><div class="ttdeci">static int overlay_adjust_node_phandles(void *fdto, int node, uint32_t delta)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:141</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply()</a>.</p>

</div>
</div>
<a id="a5256ba69a35ddc0c66148e329285a12b" name="a5256ba69a35ddc0c66148e329285a12b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5256ba69a35ddc0c66148e329285a12b">&#9670;&#160;</a></span>overlay_adjust_node_phandles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_adjust_node_phandles </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_adjust_node_phandles - Offsets the phandles of a node @fdto: Device tree overlay blob @node: Offset of the node we want to adjust @delta: Offset to shift the phandles of</p>
<p><a class="el" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles()</a> adds a constant to all the phandles of a given node. This is mainly use as part of the overlay application process, when we want to update all the overlay phandles to not conflict with the overlays of the base device tree.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  143</span>{</div>
<div class="line"><span class="lineno">  144</span>    <span class="keywordtype">int</span> child;</div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#a6b1ddbc5c439ce0876f35907174284d8">overlay_phandle_add_offset</a>(fdto, node, <span class="stringliteral">&quot;phandle&quot;</span>, delta);</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">if</span> (ret &amp;&amp; ret != -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>    ret = <a class="code hl_function" href="fdt__overlay_8c.html#a6b1ddbc5c439ce0876f35907174284d8">overlay_phandle_add_offset</a>(fdto, node, <span class="stringliteral">&quot;linux,phandle&quot;</span>, delta);</div>
<div class="line"><span class="lineno">  152</span>    <span class="keywordflow">if</span> (ret &amp;&amp; ret != -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  154</span> </div>
<div class="line"><span class="lineno">  155</span>    <a class="code hl_define" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>(child, fdto, node) {</div>
<div class="line"><span class="lineno">  156</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles</a>(fdto, child, delta);</div>
<div class="line"><span class="lineno">  157</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  158</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  159</span>    }</div>
<div class="line"><span class="lineno">  160</span> </div>
<div class="line"><span class="lineno">  161</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  162</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a6b1ddbc5c439ce0876f35907174284d8"><div class="ttname"><a href="fdt__overlay_8c.html#a6b1ddbc5c439ce0876f35907174284d8">overlay_phandle_add_offset</a></div><div class="ttdeci">static int overlay_phandle_add_offset(void *fdt, int node, const char *name, uint32_t delta)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:101</div></div>
<div class="ttc" id="alibfdt_8h_html_a7815aea6a1994b5fb035623a86e890a4"><div class="ttname"><a href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a></div><div class="ttdeci">#define fdt_for_each_subnode(node, fdt, parent)</div><div class="ttdef"><b>Definition:</b> libfdt.h:239</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>, <a class="el" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles()</a>, and <a class="el" href="fdt__overlay_8c.html#a6b1ddbc5c439ce0876f35907174284d8">overlay_phandle_add_offset()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a8cde92cc15e941275df561c47f912ba4">overlay_adjust_local_phandles()</a>, and <a class="el" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles()</a>.</p>

</div>
</div>
<a id="a8cb95c9322e1e68282eda3e7fc90a314" name="a8cb95c9322e1e68282eda3e7fc90a314"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cb95c9322e1e68282eda3e7fc90a314">&#9670;&#160;</a></span>overlay_apply_node()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_apply_node </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>node</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_apply_node - Merges a node into the base device tree @fdt: Base Device Tree blob @target: Node offset in the base device tree to apply the fragment to @fdto: Device tree overlay blob @node: Node offset in the overlay holding the changes to merge</p>
<p><a class="el" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node()</a> merges a node into a target base device tree node pointed.</p>
<p>This is part of the final step in the device tree overlay application process, when all the phandles have been adjusted and resolved and you just have to merge overlay into the base device tree.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  544</span>{</div>
<div class="line"><span class="lineno">  545</span>    <span class="keywordtype">int</span> property;</div>
<div class="line"><span class="lineno">  546</span>    <span class="keywordtype">int</span> subnode;</div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>    <a class="code hl_define" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>(property, fdto, node) {</div>
<div class="line"><span class="lineno">  549</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div>
<div class="line"><span class="lineno">  550</span>        <span class="keyword">const</span> <span class="keywordtype">void</span> *prop;</div>
<div class="line"><span class="lineno">  551</span>        <span class="keywordtype">int</span> prop_len;</div>
<div class="line"><span class="lineno">  552</span>        <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>        prop = <a class="code hl_function" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset</a>(fdto, property, &amp;name,</div>
<div class="line"><span class="lineno">  555</span>                         &amp;prop_len);</div>
<div class="line"><span class="lineno">  556</span>        <span class="keywordflow">if</span> (prop_len == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  557</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a02625761a47e8012c53fb389dd25fadd">FDT_ERR_INTERNAL</a>;</div>
<div class="line"><span class="lineno">  558</span>        <span class="keywordflow">if</span> (prop_len &lt; 0)</div>
<div class="line"><span class="lineno">  559</span>            <span class="keywordflow">return</span> prop_len;</div>
<div class="line"><span class="lineno">  560</span> </div>
<div class="line"><span class="lineno">  561</span>        ret = <a class="code hl_function" href="fdt__rw_8c.html#ae9e3e4d33edd50404838414b8f36d158">fdt_setprop</a>(fdt, target, name, prop, prop_len);</div>
<div class="line"><span class="lineno">  562</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  563</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  564</span>    }</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>    <a class="code hl_define" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>(subnode, fdto, node) {</div>
<div class="line"><span class="lineno">  567</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *name = <a class="code hl_function" href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name</a>(fdto, subnode, <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  568</span>        <span class="keywordtype">int</span> nnode;</div>
<div class="line"><span class="lineno">  569</span>        <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>        nnode = <a class="code hl_function" href="fdt__rw_8c.html#a006872c92462f1a3c962192df483600c">fdt_add_subnode</a>(fdt, target, name);</div>
<div class="line"><span class="lineno">  572</span>        <span class="keywordflow">if</span> (nnode == -<a class="code hl_define" href="libfdt_8h.html#a26af70ef43c09fafd5eb29f10a09278a">FDT_ERR_EXISTS</a>) {</div>
<div class="line"><span class="lineno">  573</span>            nnode = <a class="code hl_function" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a>(fdt, target, name);</div>
<div class="line"><span class="lineno">  574</span>            <span class="keywordflow">if</span> (nnode == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  575</span>                <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a02625761a47e8012c53fb389dd25fadd">FDT_ERR_INTERNAL</a>;</div>
<div class="line"><span class="lineno">  576</span>        }</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>        <span class="keywordflow">if</span> (nnode &lt; 0)</div>
<div class="line"><span class="lineno">  579</span>            <span class="keywordflow">return</span> nnode;</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node</a>(fdt, nnode, fdto, subnode);</div>
<div class="line"><span class="lineno">  582</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  583</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  584</span>    }</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  587</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a8cb95c9322e1e68282eda3e7fc90a314"><div class="ttname"><a href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node</a></div><div class="ttdeci">static int overlay_apply_node(void *fdt, int target, void *fdto, int node)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:542</div></div>
<div class="ttc" id="afdt__ro_8c_html_a22dd90f8bea25063fe0debae7683eb02"><div class="ttname"><a href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a></div><div class="ttdeci">int fdt_subnode_offset(const void *fdt, int parentoffset, const char *name)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:244</div></div>
<div class="ttc" id="afdt__ro_8c_html_ad57579c58b67adbfa3d5b8044d5317cb"><div class="ttname"><a href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset</a></div><div class="ttdeci">const void * fdt_getprop_by_offset(const void *fdt, int offset, const char **namep, int *lenp)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:469</div></div>
<div class="ttc" id="afdt__rw_8c_html_a006872c92462f1a3c962192df483600c"><div class="ttname"><a href="fdt__rw_8c.html#a006872c92462f1a3c962192df483600c">fdt_add_subnode</a></div><div class="ttdeci">int fdt_add_subnode(void *fdt, int parentoffset, const char *name)</div><div class="ttdef"><b>Definition:</b> fdt_rw.c:377</div></div>
<div class="ttc" id="afdt__rw_8c_html_ae9e3e4d33edd50404838414b8f36d158"><div class="ttname"><a href="fdt__rw_8c.html#ae9e3e4d33edd50404838414b8f36d158">fdt_setprop</a></div><div class="ttdeci">int fdt_setprop(void *fdt, int nodeoffset, const char *name, const void *val, int len)</div><div class="ttdef"><b>Definition:</b> fdt_rw.c:276</div></div>
<div class="ttc" id="alibfdt_8h_html_a02625761a47e8012c53fb389dd25fadd"><div class="ttname"><a href="libfdt_8h.html#a02625761a47e8012c53fb389dd25fadd">FDT_ERR_INTERNAL</a></div><div class="ttdeci">#define FDT_ERR_INTERNAL</div><div class="ttdef"><b>Definition:</b> libfdt.h:77</div></div>
<div class="ttc" id="alibfdt_8h_html_a26af70ef43c09fafd5eb29f10a09278a"><div class="ttname"><a href="libfdt_8h.html#a26af70ef43c09fafd5eb29f10a09278a">FDT_ERR_EXISTS</a></div><div class="ttdeci">#define FDT_ERR_EXISTS</div><div class="ttdef"><b>Definition:</b> libfdt.h:23</div></div>
<div class="ttc" id="alibfdt_8h_html_ad994c33538d83be1383d449ed336803a"><div class="ttname"><a href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a></div><div class="ttdeci">#define fdt_for_each_property_offset(property, fdt, node)</div><div class="ttdef"><b>Definition:</b> libfdt.h:653</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fdt__rw_8c.html#a006872c92462f1a3c962192df483600c">fdt_add_subnode()</a>, <a class="el" href="libfdt_8h.html#a26af70ef43c09fafd5eb29f10a09278a">FDT_ERR_EXISTS</a>, <a class="el" href="libfdt_8h.html#a02625761a47e8012c53fb389dd25fadd">FDT_ERR_INTERNAL</a>, <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>, <a class="el" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>, <a class="el" href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name()</a>, <a class="el" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset()</a>, <a class="el" href="fdt__rw_8c.html#ae9e3e4d33edd50404838414b8f36d158">fdt_setprop()</a>, <a class="el" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset()</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, and <a class="el" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node()</a>, and <a class="el" href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge()</a>.</p>

</div>
</div>
<a id="ac2699eeb863f2070d20b509d0b2948f4" name="ac2699eeb863f2070d20b509d0b2948f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2699eeb863f2070d20b509d0b2948f4">&#9670;&#160;</a></span>overlay_fixup_one_phandle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_fixup_one_phandle </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>symbols_off</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>path_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>name_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>poffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>label</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  358</span>{</div>
<div class="line"><span class="lineno">  359</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *symbol_path;</div>
<div class="line"><span class="lineno">  360</span>    <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> phandle;</div>
<div class="line"><span class="lineno">  361</span>    <a class="code hl_typedef" href="libfdt__env_8h.html#a76887ac8786252752fb3f9a39b21f3af">fdt32_t</a> phandle_prop;</div>
<div class="line"><span class="lineno">  362</span>    <span class="keywordtype">int</span> symbol_off, fixup_off;</div>
<div class="line"><span class="lineno">  363</span>    <span class="keywordtype">int</span> prop_len;</div>
<div class="line"><span class="lineno">  364</span> </div>
<div class="line"><span class="lineno">  365</span>    <span class="keywordflow">if</span> (symbols_off &lt; 0)</div>
<div class="line"><span class="lineno">  366</span>        <span class="keywordflow">return</span> symbols_off;</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>    symbol_path = <a class="code hl_function" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop</a>(fdt, symbols_off, label,</div>
<div class="line"><span class="lineno">  369</span>                  &amp;prop_len);</div>
<div class="line"><span class="lineno">  370</span>    <span class="keywordflow">if</span> (!symbol_path)</div>
<div class="line"><span class="lineno">  371</span>        <span class="keywordflow">return</span> prop_len;</div>
<div class="line"><span class="lineno">  372</span> </div>
<div class="line"><span class="lineno">  373</span>    symbol_off = <a class="code hl_function" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset</a>(fdt, symbol_path);</div>
<div class="line"><span class="lineno">  374</span>    <span class="keywordflow">if</span> (symbol_off &lt; 0)</div>
<div class="line"><span class="lineno">  375</span>        <span class="keywordflow">return</span> symbol_off;</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>    phandle = <a class="code hl_function" href="fdt__ro_8c.html#a0689bb9f27bdaaa355855425b4eb7149">fdt_get_phandle</a>(fdt, symbol_off);</div>
<div class="line"><span class="lineno">  378</span>    <span class="keywordflow">if</span> (!phandle)</div>
<div class="line"><span class="lineno">  379</span>        <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>;</div>
<div class="line"><span class="lineno">  380</span> </div>
<div class="line"><span class="lineno">  381</span>    fixup_off = <a class="code hl_function" href="fdt__ro_8c.html#aa8b4d143366fc7d443f47c1c92a8f8cc">fdt_path_offset_namelen</a>(fdto, path, path_len);</div>
<div class="line"><span class="lineno">  382</span>    <span class="keywordflow">if</span> (fixup_off == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  383</span>        <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordflow">if</span> (fixup_off &lt; 0)</div>
<div class="line"><span class="lineno">  385</span>        <span class="keywordflow">return</span> fixup_off;</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>    phandle_prop = <a class="code hl_function" href="libfdt__env_8h.html#a06ce41f441b8a56710000af3c3e516e5">cpu_to_fdt32</a>(phandle);</div>
<div class="line"><span class="lineno">  388</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="fdt__wip_8c.html#ad2d3b0ed8c78b7ca920550656dca6cf9">fdt_setprop_inplace_namelen_partial</a>(fdto, fixup_off,</div>
<div class="line"><span class="lineno">  389</span>                           name, name_len, poffset,</div>
<div class="line"><span class="lineno">  390</span>                           &amp;phandle_prop,</div>
<div class="line"><span class="lineno">  391</span>                           <span class="keyword">sizeof</span>(phandle_prop));</div>
<div class="line"><span class="lineno">  392</span>};</div>
<div class="ttc" id="afdt__ro_8c_html_a0689bb9f27bdaaa355855425b4eb7149"><div class="ttname"><a href="fdt__ro_8c.html#a0689bb9f27bdaaa355855425b4eb7149">fdt_get_phandle</a></div><div class="ttdeci">uint32_t fdt_get_phandle(const void *fdt, int nodeoffset)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:508</div></div>
<div class="ttc" id="afdt__ro_8c_html_aa8b4d143366fc7d443f47c1c92a8f8cc"><div class="ttname"><a href="fdt__ro_8c.html#aa8b4d143366fc7d443f47c1c92a8f8cc">fdt_path_offset_namelen</a></div><div class="ttdeci">int fdt_path_offset_namelen(const void *fdt, const char *path, int namelen)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:250</div></div>
<div class="ttc" id="afdt__wip_8c_html_ad2d3b0ed8c78b7ca920550656dca6cf9"><div class="ttname"><a href="fdt__wip_8c.html#ad2d3b0ed8c78b7ca920550656dca6cf9">fdt_setprop_inplace_namelen_partial</a></div><div class="ttdeci">int fdt_setprop_inplace_namelen_partial(void *fdt, int nodeoffset, const char *name, int namelen, uint32_t idx, const void *val, int len)</div><div class="ttdef"><b>Definition:</b> fdt_wip.c:13</div></div>
<div class="ttc" id="alibfdt__env_8h_html_a06ce41f441b8a56710000af3c3e516e5"><div class="ttname"><a href="libfdt__env_8h.html#a06ce41f441b8a56710000af3c3e516e5">cpu_to_fdt32</a></div><div class="ttdeci">static fdt32_t cpu_to_fdt32(uint32_t x)</div><div class="ttdef"><b>Definition:</b> libfdt_env.h:67</div></div>
<div class="ttc" id="alibfdt__env_8h_html_a76887ac8786252752fb3f9a39b21f3af"><div class="ttname"><a href="libfdt__env_8h.html#a76887ac8786252752fb3f9a39b21f3af">fdt32_t</a></div><div class="ttdeci">uint32_t FDT_BITWISE fdt32_t</div><div class="ttdef"><b>Definition:</b> libfdt_env.h:42</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt__env_8h.html#a06ce41f441b8a56710000af3c3e516e5">cpu_to_fdt32()</a>, <a class="el" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>, <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="fdt__ro_8c.html#a0689bb9f27bdaaa355855425b4eb7149">fdt_get_phandle()</a>, <a class="el" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop()</a>, <a class="el" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset()</a>, <a class="el" href="fdt__ro_8c.html#aa8b4d143366fc7d443f47c1c92a8f8cc">fdt_path_offset_namelen()</a>, and <a class="el" href="fdt__wip_8c.html#ad2d3b0ed8c78b7ca920550656dca6cf9">fdt_setprop_inplace_namelen_partial()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a27d6c0e207237b7020d4c7bfa0eb0402">overlay_fixup_phandle()</a>.</p>

</div>
</div>
<a id="a27d6c0e207237b7020d4c7bfa0eb0402" name="a27d6c0e207237b7020d4c7bfa0eb0402"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27d6c0e207237b7020d4c7bfa0eb0402">&#9670;&#160;</a></span>overlay_fixup_phandle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_fixup_phandle </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>symbols_off</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>property</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  415</span>{</div>
<div class="line"><span class="lineno">  416</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *value;</div>
<div class="line"><span class="lineno">  417</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *label;</div>
<div class="line"><span class="lineno">  418</span>    <span class="keywordtype">int</span> len;</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>    value = <a class="code hl_function" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset</a>(fdto, property,</div>
<div class="line"><span class="lineno">  421</span>                      &amp;label, &amp;len);</div>
<div class="line"><span class="lineno">  422</span>    <span class="keywordflow">if</span> (!value) {</div>
<div class="line"><span class="lineno">  423</span>        <span class="keywordflow">if</span> (len == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  424</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a02625761a47e8012c53fb389dd25fadd">FDT_ERR_INTERNAL</a>;</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>        <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno">  427</span>    }</div>
<div class="line"><span class="lineno">  428</span> </div>
<div class="line"><span class="lineno">  429</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">  430</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *path, *name, *fixup_end;</div>
<div class="line"><span class="lineno">  431</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *fixup_str = value;</div>
<div class="line"><span class="lineno">  432</span>        <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> path_len, name_len;</div>
<div class="line"><span class="lineno">  433</span>        <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> fixup_len;</div>
<div class="line"><span class="lineno">  434</span>        <span class="keywordtype">char</span> *sep, *endptr;</div>
<div class="line"><span class="lineno">  435</span>        <span class="keywordtype">int</span> poffset, ret;</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>        fixup_end = <a class="code hl_function" href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr</a>(value, <span class="charliteral">&#39;\0&#39;</span>, len);</div>
<div class="line"><span class="lineno">  438</span>        <span class="keywordflow">if</span> (!fixup_end)</div>
<div class="line"><span class="lineno">  439</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  440</span>        fixup_len = fixup_end - fixup_str;</div>
<div class="line"><span class="lineno">  441</span> </div>
<div class="line"><span class="lineno">  442</span>        len -= fixup_len + 1;</div>
<div class="line"><span class="lineno">  443</span>        value += fixup_len + 1;</div>
<div class="line"><span class="lineno">  444</span> </div>
<div class="line"><span class="lineno">  445</span>        path = fixup_str;</div>
<div class="line"><span class="lineno">  446</span>        sep = <a class="code hl_function" href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr</a>(fixup_str, <span class="charliteral">&#39;:&#39;</span>, fixup_len);</div>
<div class="line"><span class="lineno">  447</span>        <span class="keywordflow">if</span> (!sep || *sep != <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line"><span class="lineno">  448</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>        path_len = sep - path;</div>
<div class="line"><span class="lineno">  451</span>        <span class="keywordflow">if</span> (path_len == (fixup_len - 1))</div>
<div class="line"><span class="lineno">  452</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>        fixup_len -= path_len + 1;</div>
<div class="line"><span class="lineno">  455</span>        name = sep + 1;</div>
<div class="line"><span class="lineno">  456</span>        sep = <a class="code hl_function" href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr</a>(name, <span class="charliteral">&#39;:&#39;</span>, fixup_len);</div>
<div class="line"><span class="lineno">  457</span>        <span class="keywordflow">if</span> (!sep || *sep != <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line"><span class="lineno">  458</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>        name_len = sep - name;</div>
<div class="line"><span class="lineno">  461</span>        <span class="keywordflow">if</span> (!name_len)</div>
<div class="line"><span class="lineno">  462</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>        poffset = <a class="code hl_function" href="cstd_8c.html#a507a276d9b76c167c63b862c7d52b1a9">strtoul</a>(sep + 1, &amp;endptr, 10);</div>
<div class="line"><span class="lineno">  465</span>        <span class="keywordflow">if</span> ((*endptr != <span class="charliteral">&#39;\0&#39;</span>) || (endptr &lt;= (sep + 1)))</div>
<div class="line"><span class="lineno">  466</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  467</span> </div>
<div class="line"><span class="lineno">  468</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#ac2699eeb863f2070d20b509d0b2948f4">overlay_fixup_one_phandle</a>(fdt, fdto, symbols_off,</div>
<div class="line"><span class="lineno">  469</span>                        path, path_len, name, name_len,</div>
<div class="line"><span class="lineno">  470</span>                        poffset, label);</div>
<div class="line"><span class="lineno">  471</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  472</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  473</span>    } <span class="keywordflow">while</span> (len &gt; 0);</div>
<div class="line"><span class="lineno">  474</span> </div>
<div class="line"><span class="lineno">  475</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  476</span>}</div>
<div class="ttc" id="acstd_8c_html_a02d89f48610ff69547e936f7ed4fd2f2"><div class="ttname"><a href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr</a></div><div class="ttdeci">void * memchr(const void *src, int c, size_t n)</div><div class="ttdoc">search byte in buffer</div><div class="ttdef"><b>Definition:</b> cstd.c:69</div></div>
<div class="ttc" id="acstd_8c_html_a507a276d9b76c167c63b862c7d52b1a9"><div class="ttname"><a href="cstd_8c.html#a507a276d9b76c167c63b862c7d52b1a9">strtoul</a></div><div class="ttdeci">unsigned long int strtoul(char *s, char **endptr, int base)</div><div class="ttdoc">convert a string into an unsigned 32bit number</div><div class="ttdef"><b>Definition:</b> cstd.c:302</div></div>
<div class="ttc" id="afdt__overlay_8c_html_ac2699eeb863f2070d20b509d0b2948f4"><div class="ttname"><a href="fdt__overlay_8c.html#ac2699eeb863f2070d20b509d0b2948f4">overlay_fixup_one_phandle</a></div><div class="ttdeci">static int overlay_fixup_one_phandle(void *fdt, void *fdto, int symbols_off, const char *path, uint32_t path_len, const char *name, uint32_t name_len, int poffset, const char *label)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:353</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>, <a class="el" href="libfdt_8h.html#a02625761a47e8012c53fb389dd25fadd">FDT_ERR_INTERNAL</a>, <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset()</a>, <a class="el" href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr()</a>, <a class="el" href="fdt__overlay_8c.html#ac2699eeb863f2070d20b509d0b2948f4">overlay_fixup_one_phandle()</a>, and <a class="el" href="cstd_8c.html#a507a276d9b76c167c63b862c7d52b1a9">strtoul()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a5cf73a63ad60707f4c93c7de7de81357">overlay_fixup_phandles()</a>.</p>

</div>
</div>
<a id="a5cf73a63ad60707f4c93c7de7de81357" name="a5cf73a63ad60707f4c93c7de7de81357"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cf73a63ad60707f4c93c7de7de81357">&#9670;&#160;</a></span>overlay_fixup_phandles()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_fixup_phandles </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_fixup_phandles - Resolve the overlay phandles to the base device tree @fdt: Base Device Tree blob @fdto: Device tree overlay blob</p>
<p><a class="el" href="fdt__overlay_8c.html#a5cf73a63ad60707f4c93c7de7de81357">overlay_fixup_phandles()</a> resolves all the overlay phandles pointing to nodes in the base device tree.</p>
<p>This is one of the steps of the device tree overlay application process, when you want all the phandles in the overlay to point to the actual base dt nodes.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  496</span>{</div>
<div class="line"><span class="lineno">  497</span>    <span class="keywordtype">int</span> fixups_off, symbols_off;</div>
<div class="line"><span class="lineno">  498</span>    <span class="keywordtype">int</span> property;</div>
<div class="line"><span class="lineno">  499</span> </div>
<div class="line"><span class="lineno">  500</span>    <span class="comment">/* We can have overlays without any fixups */</span></div>
<div class="line"><span class="lineno">  501</span>    fixups_off = <a class="code hl_function" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset</a>(fdto, <span class="stringliteral">&quot;/__fixups__&quot;</span>);</div>
<div class="line"><span class="lineno">  502</span>    <span class="keywordflow">if</span> (fixups_off == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  503</span>        <span class="keywordflow">return</span> 0; <span class="comment">/* nothing to do */</span></div>
<div class="line"><span class="lineno">  504</span>    <span class="keywordflow">if</span> (fixups_off &lt; 0)</div>
<div class="line"><span class="lineno">  505</span>        <span class="keywordflow">return</span> fixups_off;</div>
<div class="line"><span class="lineno">  506</span> </div>
<div class="line"><span class="lineno">  507</span>    <span class="comment">/* And base DTs without symbols */</span></div>
<div class="line"><span class="lineno">  508</span>    symbols_off = <a class="code hl_function" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset</a>(fdt, <span class="stringliteral">&quot;/__symbols__&quot;</span>);</div>
<div class="line"><span class="lineno">  509</span>    <span class="keywordflow">if</span> ((symbols_off &lt; 0 &amp;&amp; (symbols_off != -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)))</div>
<div class="line"><span class="lineno">  510</span>        <span class="keywordflow">return</span> symbols_off;</div>
<div class="line"><span class="lineno">  511</span> </div>
<div class="line"><span class="lineno">  512</span>    <a class="code hl_define" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>(property, fdto, fixups_off) {</div>
<div class="line"><span class="lineno">  513</span>        <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#a27d6c0e207237b7020d4c7bfa0eb0402">overlay_fixup_phandle</a>(fdt, fdto, symbols_off, property);</div>
<div class="line"><span class="lineno">  516</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  517</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  518</span>    }</div>
<div class="line"><span class="lineno">  519</span> </div>
<div class="line"><span class="lineno">  520</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  521</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a27d6c0e207237b7020d4c7bfa0eb0402"><div class="ttname"><a href="fdt__overlay_8c.html#a27d6c0e207237b7020d4c7bfa0eb0402">overlay_fixup_phandle</a></div><div class="ttdeci">static int overlay_fixup_phandle(void *fdt, void *fdto, int symbols_off, int property)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:413</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>, <a class="el" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset()</a>, and <a class="el" href="fdt__overlay_8c.html#a27d6c0e207237b7020d4c7bfa0eb0402">overlay_fixup_phandle()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply()</a>.</p>

</div>
</div>
<a id="a1b77c6faf056e97fb21ed6c3b7d3ac6a" name="a1b77c6faf056e97fb21ed6c3b7d3ac6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b77c6faf056e97fb21ed6c3b7d3ac6a">&#9670;&#160;</a></span>overlay_get_target_phandle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> overlay_get_target_phandle </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fragment</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_get_target_phandle - retrieves the target phandle of a fragment @fdto: pointer to the device tree overlay blob @fragment: node offset of the fragment in the overlay</p>
<p><a class="el" href="fdt__overlay_8c.html#a1b77c6faf056e97fb21ed6c3b7d3ac6a">overlay_get_target_phandle()</a> retrieves the target phandle of an overlay fragment when that fragment uses a phandle (target property) instead of a path (target-path property).</p>
<p>returns: the phandle pointed by the target property 0, if the phandle was not found -1, if the phandle was malformed </p>
<div class="fragment"><div class="line"><span class="lineno">   29</span>{</div>
<div class="line"><span class="lineno">   30</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="libfdt__env_8h.html#a76887ac8786252752fb3f9a39b21f3af">fdt32_t</a> *val;</div>
<div class="line"><span class="lineno">   31</span>    <span class="keywordtype">int</span> len;</div>
<div class="line"><span class="lineno">   32</span> </div>
<div class="line"><span class="lineno">   33</span>    val = <a class="code hl_function" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop</a>(fdto, fragment, <span class="stringliteral">&quot;target&quot;</span>, &amp;len);</div>
<div class="line"><span class="lineno">   34</span>    <span class="keywordflow">if</span> (!val)</div>
<div class="line"><span class="lineno">   35</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span>    <span class="keywordflow">if</span> ((len != <span class="keyword">sizeof</span>(*val)) || (<a class="code hl_function" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu</a>(*val) == (<a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)-1))</div>
<div class="line"><span class="lineno">   38</span>        <span class="keywordflow">return</span> (<a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)-1;</div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu</a>(*val);</div>
<div class="line"><span class="lineno">   41</span>}</div>
<div class="ttc" id="alibfdt__env_8h_html_a6485ea7225a1927cc5ab1a34dabe298f"><div class="ttname"><a href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu</a></div><div class="ttdeci">static uint32_t fdt32_to_cpu(fdt32_t x)</div><div class="ttdef"><b>Definition:</b> libfdt_env.h:63</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu()</a>, and <a class="el" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset()</a>.</p>

</div>
</div>
<a id="a36a905f6566751e42d0a0111b2d78a67" name="a36a905f6566751e42d0a0111b2d78a67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36a905f6566751e42d0a0111b2d78a67">&#9670;&#160;</a></span>overlay_merge()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_merge </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_merge - Merge an overlay into its base device tree @fdt: Base Device Tree blob @fdto: Device tree overlay blob</p>
<p><a class="el" href="fdt__overlay_8c.html#a36a905f6566751e42d0a0111b2d78a67">overlay_merge()</a> merges an overlay into its base device tree.</p>
<p>This is the next to last step in the device tree overlay application process, when all the phandles have been adjusted and resolved and you just have to merge overlay into the base device tree.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  605</span>{</div>
<div class="line"><span class="lineno">  606</span>    <span class="keywordtype">int</span> fragment;</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    <a class="code hl_define" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>(fragment, fdto, 0) {</div>
<div class="line"><span class="lineno">  609</span>        <span class="keywordtype">int</span> overlay;</div>
<div class="line"><span class="lineno">  610</span>        <span class="keywordtype">int</span> target;</div>
<div class="line"><span class="lineno">  611</span>        <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  612</span> </div>
<div class="line"><span class="lineno">  613</span>        <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  614</span><span class="comment">         * Each fragments will have an __overlay__ node. If</span></div>
<div class="line"><span class="lineno">  615</span><span class="comment">         * they don&#39;t, it&#39;s not supposed to be merged</span></div>
<div class="line"><span class="lineno">  616</span><span class="comment">         */</span></div>
<div class="line"><span class="lineno">  617</span>        overlay = <a class="code hl_function" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a>(fdto, fragment, <span class="stringliteral">&quot;__overlay__&quot;</span>);</div>
<div class="line"><span class="lineno">  618</span>        <span class="keywordflow">if</span> (overlay == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  619</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  620</span> </div>
<div class="line"><span class="lineno">  621</span>        <span class="keywordflow">if</span> (overlay &lt; 0)</div>
<div class="line"><span class="lineno">  622</span>            <span class="keywordflow">return</span> overlay;</div>
<div class="line"><span class="lineno">  623</span> </div>
<div class="line"><span class="lineno">  624</span>        target = <a class="code hl_function" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset</a>(fdt, fdto, fragment, <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  625</span>        <span class="keywordflow">if</span> (target &lt; 0)</div>
<div class="line"><span class="lineno">  626</span>            <span class="keywordflow">return</span> target;</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node</a>(fdt, target, fdto, overlay);</div>
<div class="line"><span class="lineno">  629</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  630</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  631</span>    }</div>
<div class="line"><span class="lineno">  632</span> </div>
<div class="line"><span class="lineno">  633</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  634</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_aa155e9207e65bc6c432c40e301485af5"><div class="ttname"><a href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset</a></div><div class="ttdeci">int fdt_overlay_target_offset(const void *fdt, const void *fdto, int fragment_offset, char const **pathp)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:43</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>, <a class="el" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset()</a>, <a class="el" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset()</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, and <a class="el" href="fdt__overlay_8c.html#a8cb95c9322e1e68282eda3e7fc90a314">overlay_apply_node()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply()</a>.</p>

</div>
</div>
<a id="a6b1ddbc5c439ce0876f35907174284d8" name="a6b1ddbc5c439ce0876f35907174284d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b1ddbc5c439ce0876f35907174284d8">&#9670;&#160;</a></span>overlay_phandle_add_offset()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_phandle_add_offset </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  103</span>{</div>
<div class="line"><span class="lineno">  104</span>    <span class="keyword">const</span> <a class="code hl_typedef" href="libfdt__env_8h.html#a76887ac8786252752fb3f9a39b21f3af">fdt32_t</a> *val;</div>
<div class="line"><span class="lineno">  105</span>    <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> adj_val;</div>
<div class="line"><span class="lineno">  106</span>    <span class="keywordtype">int</span> len;</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>    val = <a class="code hl_function" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop</a>(fdt, node, name, &amp;len);</div>
<div class="line"><span class="lineno">  109</span>    <span class="keywordflow">if</span> (!val)</div>
<div class="line"><span class="lineno">  110</span>        <span class="keywordflow">return</span> len;</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordflow">if</span> (len != <span class="keyword">sizeof</span>(*val))</div>
<div class="line"><span class="lineno">  113</span>        <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a0f264f8ba8cc4e98852c8246bc6312bc">FDT_ERR_BADPHANDLE</a>;</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    adj_val = <a class="code hl_function" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu</a>(*val);</div>
<div class="line"><span class="lineno">  116</span>    <span class="keywordflow">if</span> ((adj_val + delta) &lt; adj_val)</div>
<div class="line"><span class="lineno">  117</span>        <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a7dbda231b96112ab9cd6d2eca9b42bfb">FDT_ERR_NOPHANDLES</a>;</div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>    adj_val += delta;</div>
<div class="line"><span class="lineno">  120</span>    <span class="keywordflow">if</span> (adj_val == (<a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)-1)</div>
<div class="line"><span class="lineno">  121</span>        <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a7dbda231b96112ab9cd6d2eca9b42bfb">FDT_ERR_NOPHANDLES</a>;</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="libfdt_8h.html#aa0ff5bdd0d38a77ffe25261c971d29a3">fdt_setprop_inplace_u32</a>(fdt, node, name, adj_val);</div>
<div class="line"><span class="lineno">  124</span>}</div>
<div class="ttc" id="alibfdt_8h_html_a7dbda231b96112ab9cd6d2eca9b42bfb"><div class="ttname"><a href="libfdt_8h.html#a7dbda231b96112ab9cd6d2eca9b42bfb">FDT_ERR_NOPHANDLES</a></div><div class="ttdeci">#define FDT_ERR_NOPHANDLES</div><div class="ttdef"><b>Definition:</b> libfdt.h:97</div></div>
<div class="ttc" id="alibfdt_8h_html_aa0ff5bdd0d38a77ffe25261c971d29a3"><div class="ttname"><a href="libfdt_8h.html#aa0ff5bdd0d38a77ffe25261c971d29a3">fdt_setprop_inplace_u32</a></div><div class="ttdeci">static int fdt_setprop_inplace_u32(void *fdt, int nodeoffset, const char *name, uint32_t val)</div><div class="ttdef"><b>Definition:</b> libfdt.h:1385</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu()</a>, <a class="el" href="libfdt_8h.html#a0f264f8ba8cc4e98852c8246bc6312bc">FDT_ERR_BADPHANDLE</a>, <a class="el" href="libfdt_8h.html#a7dbda231b96112ab9cd6d2eca9b42bfb">FDT_ERR_NOPHANDLES</a>, <a class="el" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop()</a>, and <a class="el" href="libfdt_8h.html#aa0ff5bdd0d38a77ffe25261c971d29a3">fdt_setprop_inplace_u32()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a5256ba69a35ddc0c66148e329285a12b">overlay_adjust_node_phandles()</a>.</p>

</div>
</div>
<a id="add76bc4fa1b36b1c11bfd9a2cf779ac1" name="add76bc4fa1b36b1c11bfd9a2cf779ac1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add76bc4fa1b36b1c11bfd9a2cf779ac1">&#9670;&#160;</a></span>overlay_symbol_update()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_symbol_update </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_symbol_update - Update the symbols of base tree after a merge @fdt: Base Device Tree blob @fdto: Device tree overlay blob</p>
<p><a class="el" href="fdt__overlay_8c.html#add76bc4fa1b36b1c11bfd9a2cf779ac1">overlay_symbol_update()</a> updates the symbols of the base tree with the symbols of the applied overlay</p>
<p>This is the last step in the device tree overlay application process, allowing the reference of overlay symbols by subsequent overlay operations.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  681</span>{</div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordtype">int</span> root_sym, ov_sym, prop, path_len, fragment, target;</div>
<div class="line"><span class="lineno">  683</span>    <span class="keywordtype">int</span> len, frag_name_len, ret, rel_path_len;</div>
<div class="line"><span class="lineno">  684</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *s, *e;</div>
<div class="line"><span class="lineno">  685</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *path;</div>
<div class="line"><span class="lineno">  686</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div>
<div class="line"><span class="lineno">  687</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *frag_name;</div>
<div class="line"><span class="lineno">  688</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *rel_path;</div>
<div class="line"><span class="lineno">  689</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *target_path;</div>
<div class="line"><span class="lineno">  690</span>    <span class="keywordtype">char</span> *buf;</div>
<div class="line"><span class="lineno">  691</span>    <span class="keywordtype">void</span> *p;</div>
<div class="line"><span class="lineno">  692</span> </div>
<div class="line"><span class="lineno">  693</span>    ov_sym = <a class="code hl_function" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a>(fdto, 0, <span class="stringliteral">&quot;__symbols__&quot;</span>);</div>
<div class="line"><span class="lineno">  694</span> </div>
<div class="line"><span class="lineno">  695</span>    <span class="comment">/* if no overlay symbols exist no problem */</span></div>
<div class="line"><span class="lineno">  696</span>    <span class="keywordflow">if</span> (ov_sym &lt; 0)</div>
<div class="line"><span class="lineno">  697</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>    root_sym = <a class="code hl_function" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a>(fdt, 0, <span class="stringliteral">&quot;__symbols__&quot;</span>);</div>
<div class="line"><span class="lineno">  700</span> </div>
<div class="line"><span class="lineno">  701</span>    <span class="comment">/* it no root symbols exist we should create them */</span></div>
<div class="line"><span class="lineno">  702</span>    <span class="keywordflow">if</span> (root_sym == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  703</span>        root_sym = <a class="code hl_function" href="fdt__rw_8c.html#a006872c92462f1a3c962192df483600c">fdt_add_subnode</a>(fdt, 0, <span class="stringliteral">&quot;__symbols__&quot;</span>);</div>
<div class="line"><span class="lineno">  704</span> </div>
<div class="line"><span class="lineno">  705</span>    <span class="comment">/* any error is fatal now */</span></div>
<div class="line"><span class="lineno">  706</span>    <span class="keywordflow">if</span> (root_sym &lt; 0)</div>
<div class="line"><span class="lineno">  707</span>        <span class="keywordflow">return</span> root_sym;</div>
<div class="line"><span class="lineno">  708</span> </div>
<div class="line"><span class="lineno">  709</span>    <span class="comment">/* iterate over each overlay symbol */</span></div>
<div class="line"><span class="lineno">  710</span>    <a class="code hl_define" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>(prop, fdto, ov_sym) {</div>
<div class="line"><span class="lineno">  711</span>        path = <a class="code hl_function" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset</a>(fdto, prop, &amp;name, &amp;path_len);</div>
<div class="line"><span class="lineno">  712</span>        <span class="keywordflow">if</span> (!path)</div>
<div class="line"><span class="lineno">  713</span>            <span class="keywordflow">return</span> path_len;</div>
<div class="line"><span class="lineno">  714</span> </div>
<div class="line"><span class="lineno">  715</span>        <span class="comment">/* verify it&#39;s a string property (terminated by a single \0) */</span></div>
<div class="line"><span class="lineno">  716</span>        <span class="keywordflow">if</span> (path_len &lt; 1 || <a class="code hl_function" href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr</a>(path, <span class="charliteral">&#39;\0&#39;</span>, path_len) != &amp;path[path_len - 1])</div>
<div class="line"><span class="lineno">  717</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a69e818556330b83a02de930b95216aa9">FDT_ERR_BADVALUE</a>;</div>
<div class="line"><span class="lineno">  718</span> </div>
<div class="line"><span class="lineno">  719</span>        <span class="comment">/* keep end marker to avoid strlen() */</span></div>
<div class="line"><span class="lineno">  720</span>        e = path + path_len;</div>
<div class="line"><span class="lineno">  721</span> </div>
<div class="line"><span class="lineno">  722</span>        <span class="keywordflow">if</span> (*path != <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line"><span class="lineno">  723</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#a69e818556330b83a02de930b95216aa9">FDT_ERR_BADVALUE</a>;</div>
<div class="line"><span class="lineno">  724</span> </div>
<div class="line"><span class="lineno">  725</span>        <span class="comment">/* get fragment name first */</span></div>
<div class="line"><span class="lineno">  726</span>        s = <a class="code hl_function" href="cstd_8c.html#ad7c16a2447154107d5ecd28434993443">strchr</a>(path + 1, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  727</span>        <span class="keywordflow">if</span> (!s) {</div>
<div class="line"><span class="lineno">  728</span>            <span class="comment">/* Symbol refers to something that won&#39;t end</span></div>
<div class="line"><span class="lineno">  729</span><span class="comment">             * up in the target tree */</span></div>
<div class="line"><span class="lineno">  730</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  731</span>        }</div>
<div class="line"><span class="lineno">  732</span> </div>
<div class="line"><span class="lineno">  733</span>        frag_name = path + 1;</div>
<div class="line"><span class="lineno">  734</span>        frag_name_len = s - path - 1;</div>
<div class="line"><span class="lineno">  735</span> </div>
<div class="line"><span class="lineno">  736</span>        <span class="comment">/* verify format; safe since &quot;s&quot; lies in \0 terminated prop */</span></div>
<div class="line"><span class="lineno">  737</span>        len = <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;/__overlay__/&quot;</span>) - 1;</div>
<div class="line"><span class="lineno">  738</span>        <span class="keywordflow">if</span> ((e - s) &gt; len &amp;&amp; (<a class="code hl_function" href="cstd_8c.html#ace6c4869ab3af01c6f27eac47773917a">memcmp</a>(s, <span class="stringliteral">&quot;/__overlay__/&quot;</span>, len) == 0)) {</div>
<div class="line"><span class="lineno">  739</span>            <span class="comment">/* /&lt;fragment-name&gt;/__overlay__/&lt;relative-subnode-path&gt; */</span></div>
<div class="line"><span class="lineno">  740</span>            rel_path = s + len;</div>
<div class="line"><span class="lineno">  741</span>            rel_path_len = e - rel_path - 1;</div>
<div class="line"><span class="lineno">  742</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((e - s) == len</div>
<div class="line"><span class="lineno">  743</span>               &amp;&amp; (<a class="code hl_function" href="cstd_8c.html#ace6c4869ab3af01c6f27eac47773917a">memcmp</a>(s, <span class="stringliteral">&quot;/__overlay__&quot;</span>, len - 1) == 0)) {</div>
<div class="line"><span class="lineno">  744</span>            <span class="comment">/* /&lt;fragment-name&gt;/__overlay__ */</span></div>
<div class="line"><span class="lineno">  745</span>            rel_path = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno">  746</span>            rel_path_len = 0;</div>
<div class="line"><span class="lineno">  747</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  748</span>            <span class="comment">/* Symbol refers to something that won&#39;t end</span></div>
<div class="line"><span class="lineno">  749</span><span class="comment">             * up in the target tree */</span></div>
<div class="line"><span class="lineno">  750</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  751</span>        }</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>        <span class="comment">/* find the fragment index in which the symbol lies */</span></div>
<div class="line"><span class="lineno">  754</span>        ret = <a class="code hl_function" href="fdt__ro_8c.html#a515ddadab660b50e9d31c05c74f7d351">fdt_subnode_offset_namelen</a>(fdto, 0, frag_name,</div>
<div class="line"><span class="lineno">  755</span>                           frag_name_len);</div>
<div class="line"><span class="lineno">  756</span>        <span class="comment">/* not found? */</span></div>
<div class="line"><span class="lineno">  757</span>        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  758</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  759</span>        fragment = ret;</div>
<div class="line"><span class="lineno">  760</span> </div>
<div class="line"><span class="lineno">  761</span>        <span class="comment">/* an __overlay__ subnode must exist */</span></div>
<div class="line"><span class="lineno">  762</span>        ret = <a class="code hl_function" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a>(fdto, fragment, <span class="stringliteral">&quot;__overlay__&quot;</span>);</div>
<div class="line"><span class="lineno">  763</span>        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  764</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  765</span> </div>
<div class="line"><span class="lineno">  766</span>        <span class="comment">/* get the target of the fragment */</span></div>
<div class="line"><span class="lineno">  767</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset</a>(fdt, fdto, fragment, &amp;target_path);</div>
<div class="line"><span class="lineno">  768</span>        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  769</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  770</span>        target = ret;</div>
<div class="line"><span class="lineno">  771</span> </div>
<div class="line"><span class="lineno">  772</span>        <span class="comment">/* if we have a target path use */</span></div>
<div class="line"><span class="lineno">  773</span>        <span class="keywordflow">if</span> (!target_path) {</div>
<div class="line"><span class="lineno">  774</span>            ret = <a class="code hl_function" href="fdt__overlay_8c.html#ac3e9264fbe6e8ef97f2378ead11a2fd0">get_path_len</a>(fdt, target);</div>
<div class="line"><span class="lineno">  775</span>            <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  776</span>                <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  777</span>            len = ret;</div>
<div class="line"><span class="lineno">  778</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  779</span>            len = <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(target_path);</div>
<div class="line"><span class="lineno">  780</span>        }</div>
<div class="line"><span class="lineno">  781</span> </div>
<div class="line"><span class="lineno">  782</span>        ret = <a class="code hl_function" href="fdt__rw_8c.html#a77ab6d302e50d04e373b0371ac56cc9a">fdt_setprop_placeholder</a>(fdt, root_sym, name,</div>
<div class="line"><span class="lineno">  783</span>                len + (len &gt; 1) + rel_path_len + 1, &amp;p);</div>
<div class="line"><span class="lineno">  784</span>        <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  785</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  786</span> </div>
<div class="line"><span class="lineno">  787</span>        <span class="keywordflow">if</span> (!target_path) {</div>
<div class="line"><span class="lineno">  788</span>            <span class="comment">/* again in case setprop_placeholder changed it */</span></div>
<div class="line"><span class="lineno">  789</span>            ret = <a class="code hl_function" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset</a>(fdt, fdto, fragment, &amp;target_path);</div>
<div class="line"><span class="lineno">  790</span>            <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  791</span>                <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  792</span>            target = ret;</div>
<div class="line"><span class="lineno">  793</span>        }</div>
<div class="line"><span class="lineno">  794</span> </div>
<div class="line"><span class="lineno">  795</span>        buf = p;</div>
<div class="line"><span class="lineno">  796</span>        <span class="keywordflow">if</span> (len &gt; 1) { <span class="comment">/* target is not root */</span></div>
<div class="line"><span class="lineno">  797</span>            <span class="keywordflow">if</span> (!target_path) {</div>
<div class="line"><span class="lineno">  798</span>                ret = <a class="code hl_function" href="fdt__ro_8c.html#a7b25d4bc3dd83403a39ef84b8a362bd5">fdt_get_path</a>(fdt, target, buf, len + 1);</div>
<div class="line"><span class="lineno">  799</span>                <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line"><span class="lineno">  800</span>                    <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  801</span>            } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  802</span>                <a class="code hl_function" href="cstd_8c.html#ad38ffc2285db68db3635cd35e9d53140">memcpy</a>(buf, target_path, len + 1);</div>
<div class="line"><span class="lineno">  803</span> </div>
<div class="line"><span class="lineno">  804</span>        } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  805</span>            len--;</div>
<div class="line"><span class="lineno">  806</span> </div>
<div class="line"><span class="lineno">  807</span>        buf[len] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">  808</span>        <a class="code hl_function" href="cstd_8c.html#ad38ffc2285db68db3635cd35e9d53140">memcpy</a>(buf + len + 1, rel_path, rel_path_len);</div>
<div class="line"><span class="lineno">  809</span>        buf[len + 1 + rel_path_len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  810</span>    }</div>
<div class="line"><span class="lineno">  811</span> </div>
<div class="line"><span class="lineno">  812</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  813</span>}</div>
<div class="ttc" id="acstd_8c_html_a54684bded3e61e2d78d490650f9b706a"><div class="ttname"><a href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a></div><div class="ttdeci">int strlen(const char *buf)</div><div class="ttdoc">calculates the length of the string s, excluding the terminating null byte</div><div class="ttdef"><b>Definition:</b> cstd.c:82</div></div>
<div class="ttc" id="acstd_8c_html_ace6c4869ab3af01c6f27eac47773917a"><div class="ttname"><a href="cstd_8c.html#ace6c4869ab3af01c6f27eac47773917a">memcmp</a></div><div class="ttdeci">int memcmp(const void *str1, const void *str2, size_t n)</div><div class="ttdoc">compare two buffers byte per byte</div><div class="ttdef"><b>Definition:</b> cstd.c:39</div></div>
<div class="ttc" id="acstd_8c_html_ad38ffc2285db68db3635cd35e9d53140"><div class="ttname"><a href="cstd_8c.html#ad38ffc2285db68db3635cd35e9d53140">memcpy</a></div><div class="ttdeci">void * memcpy(char *dest, const char *src, unsigned n)</div><div class="ttdoc">copies buffer src to the buffer dest (the buffers must be disjoints)</div><div class="ttdef"><b>Definition:</b> cstd.c:31</div></div>
<div class="ttc" id="acstd_8c_html_ad7c16a2447154107d5ecd28434993443"><div class="ttname"><a href="cstd_8c.html#ad7c16a2447154107d5ecd28434993443">strchr</a></div><div class="ttdeci">char * strchr(const char *s, int c)</div><div class="ttdoc">returns a pointer to the first occurrence of a character in a null-terminated string</div><div class="ttdef"><b>Definition:</b> cstd.c:100</div></div>
<div class="ttc" id="afdt__overlay_8c_html_ac3e9264fbe6e8ef97f2378ead11a2fd0"><div class="ttname"><a href="fdt__overlay_8c.html#ac3e9264fbe6e8ef97f2378ead11a2fd0">get_path_len</a></div><div class="ttdeci">static int get_path_len(const void *fdt, int nodeoffset)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:636</div></div>
<div class="ttc" id="afdt__ro_8c_html_a515ddadab660b50e9d31c05c74f7d351"><div class="ttname"><a href="fdt__ro_8c.html#a515ddadab660b50e9d31c05c74f7d351">fdt_subnode_offset_namelen</a></div><div class="ttdeci">int fdt_subnode_offset_namelen(const void *fdt, int offset, const char *name, int namelen)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:225</div></div>
<div class="ttc" id="afdt__ro_8c_html_a7b25d4bc3dd83403a39ef84b8a362bd5"><div class="ttname"><a href="fdt__ro_8c.html#a7b25d4bc3dd83403a39ef84b8a362bd5">fdt_get_path</a></div><div class="ttdeci">int fdt_get_path(const void *fdt, int nodeoffset, char *buf, int buflen)</div><div class="ttdef"><b>Definition:</b> fdt_ro.c:559</div></div>
<div class="ttc" id="afdt__rw_8c_html_a77ab6d302e50d04e373b0371ac56cc9a"><div class="ttname"><a href="fdt__rw_8c.html#a77ab6d302e50d04e373b0371ac56cc9a">fdt_setprop_placeholder</a></div><div class="ttdeci">int fdt_setprop_placeholder(void *fdt, int nodeoffset, const char *name, int len, void **prop_data)</div><div class="ttdef"><b>Definition:</b> fdt_rw.c:258</div></div>
<div class="ttc" id="alibfdt_8h_html_a69e818556330b83a02de930b95216aa9"><div class="ttname"><a href="libfdt_8h.html#a69e818556330b83a02de930b95216aa9">FDT_ERR_BADVALUE</a></div><div class="ttdeci">#define FDT_ERR_BADVALUE</div><div class="ttdef"><b>Definition:</b> libfdt.h:87</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="fdt__rw_8c.html#a006872c92462f1a3c962192df483600c">fdt_add_subnode()</a>, <a class="el" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>, <a class="el" href="libfdt_8h.html#a69e818556330b83a02de930b95216aa9">FDT_ERR_BADVALUE</a>, <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>, <a class="el" href="fdt__ro_8c.html#a7b25d4bc3dd83403a39ef84b8a362bd5">fdt_get_path()</a>, <a class="el" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset()</a>, <a class="el" href="fdt__overlay_8c.html#aa155e9207e65bc6c432c40e301485af5">fdt_overlay_target_offset()</a>, <a class="el" href="fdt__rw_8c.html#a77ab6d302e50d04e373b0371ac56cc9a">fdt_setprop_placeholder()</a>, <a class="el" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset()</a>, <a class="el" href="fdt__ro_8c.html#a515ddadab660b50e9d31c05c74f7d351">fdt_subnode_offset_namelen()</a>, <a class="el" href="fdt__overlay_8c.html#ac3e9264fbe6e8ef97f2378ead11a2fd0">get_path_len()</a>, <a class="el" href="cstd_8c.html#a02d89f48610ff69547e936f7ed4fd2f2">memchr()</a>, <a class="el" href="cstd_8c.html#ace6c4869ab3af01c6f27eac47773917a">memcmp()</a>, <a class="el" href="cstd_8c.html#ad38ffc2285db68db3635cd35e9d53140">memcpy()</a>, <a class="el" href="cstd_8c.html#ad7c16a2447154107d5ecd28434993443">strchr()</a>, and <a class="el" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply()</a>.</p>

</div>
</div>
<a id="a385dd43636a52dc96596827f51511419" name="a385dd43636a52dc96596827f51511419"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a385dd43636a52dc96596827f51511419">&#9670;&#160;</a></span>overlay_update_local_node_references()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_update_local_node_references </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tree_node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fixup_node</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_update_local_node_references - Adjust the overlay references @fdto: Device tree overlay blob @tree_node: Node offset of the node to operate on @fixup_node: Node offset of the matching local fixups node @delta: Offset to shift the phandles of</p>
<p>overlay_update_local_nodes_references() update the phandles pointing to a node within the device tree overlay by adding a constant delta.</p>
<p>This is mainly used as part of a device tree application process, where you want the device tree overlays phandles to not conflict with the ones from the base device tree before merging them.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  209</span>{</div>
<div class="line"><span class="lineno">  210</span>    <span class="keywordtype">int</span> fixup_prop;</div>
<div class="line"><span class="lineno">  211</span>    <span class="keywordtype">int</span> fixup_child;</div>
<div class="line"><span class="lineno">  212</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  213</span> </div>
<div class="line"><span class="lineno">  214</span>    <a class="code hl_define" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>(fixup_prop, fdto, fixup_node) {</div>
<div class="line"><span class="lineno">  215</span>        <span class="keyword">const</span> <a class="code hl_typedef" href="libfdt__env_8h.html#a76887ac8786252752fb3f9a39b21f3af">fdt32_t</a> *fixup_val;</div>
<div class="line"><span class="lineno">  216</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *tree_val;</div>
<div class="line"><span class="lineno">  217</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *name;</div>
<div class="line"><span class="lineno">  218</span>        <span class="keywordtype">int</span> fixup_len;</div>
<div class="line"><span class="lineno">  219</span>        <span class="keywordtype">int</span> tree_len;</div>
<div class="line"><span class="lineno">  220</span>        <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  221</span> </div>
<div class="line"><span class="lineno">  222</span>        fixup_val = <a class="code hl_function" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset</a>(fdto, fixup_prop,</div>
<div class="line"><span class="lineno">  223</span>                          &amp;name, &amp;fixup_len);</div>
<div class="line"><span class="lineno">  224</span>        <span class="keywordflow">if</span> (!fixup_val)</div>
<div class="line"><span class="lineno">  225</span>            <span class="keywordflow">return</span> fixup_len;</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>        <span class="keywordflow">if</span> (fixup_len % <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>))</div>
<div class="line"><span class="lineno">  228</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  229</span>        fixup_len /= <span class="keyword">sizeof</span>(<a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);</div>
<div class="line"><span class="lineno">  230</span> </div>
<div class="line"><span class="lineno">  231</span>        tree_val = <a class="code hl_function" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop</a>(fdto, tree_node, name, &amp;tree_len);</div>
<div class="line"><span class="lineno">  232</span>        <span class="keywordflow">if</span> (!tree_val) {</div>
<div class="line"><span class="lineno">  233</span>            <span class="keywordflow">if</span> (tree_len == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  234</span>                <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>            <span class="keywordflow">return</span> tree_len;</div>
<div class="line"><span class="lineno">  237</span>        }</div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>        <span class="keywordflow">for</span> (i = 0; i &lt; fixup_len; i++) {</div>
<div class="line"><span class="lineno">  240</span>            <a class="code hl_typedef" href="libfdt__env_8h.html#a76887ac8786252752fb3f9a39b21f3af">fdt32_t</a> adj_val;</div>
<div class="line"><span class="lineno">  241</span>            <a class="code hl_typedef" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> poffset;</div>
<div class="line"><span class="lineno">  242</span> </div>
<div class="line"><span class="lineno">  243</span>            poffset = <a class="code hl_function" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu</a>(fixup_val[i]);</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>            <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  246</span><span class="comment">             * phandles to fixup can be unaligned.</span></div>
<div class="line"><span class="lineno">  247</span><span class="comment">             *</span></div>
<div class="line"><span class="lineno">  248</span><span class="comment">             * Use a memcpy for the architectures that do</span></div>
<div class="line"><span class="lineno">  249</span><span class="comment">             * not support unaligned accesses.</span></div>
<div class="line"><span class="lineno">  250</span><span class="comment">             */</span></div>
<div class="line"><span class="lineno">  251</span>            <a class="code hl_function" href="cstd_8c.html#ad38ffc2285db68db3635cd35e9d53140">memcpy</a>((<span class="keywordtype">char</span>*) &amp;adj_val, tree_val + poffset, <span class="keyword">sizeof</span>(adj_val));</div>
<div class="line"><span class="lineno">  252</span> </div>
<div class="line"><span class="lineno">  253</span>            adj_val = <a class="code hl_function" href="libfdt__env_8h.html#a06ce41f441b8a56710000af3c3e516e5">cpu_to_fdt32</a>(<a class="code hl_function" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu</a>(adj_val) + delta);</div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>            ret = <a class="code hl_function" href="fdt__wip_8c.html#ad2d3b0ed8c78b7ca920550656dca6cf9">fdt_setprop_inplace_namelen_partial</a>(fdto,</div>
<div class="line"><span class="lineno">  256</span>                                  tree_node,</div>
<div class="line"><span class="lineno">  257</span>                                  name,</div>
<div class="line"><span class="lineno">  258</span>                                  <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(name),</div>
<div class="line"><span class="lineno">  259</span>                                  poffset,</div>
<div class="line"><span class="lineno">  260</span>                                  &amp;adj_val,</div>
<div class="line"><span class="lineno">  261</span>                                  <span class="keyword">sizeof</span>(adj_val));</div>
<div class="line"><span class="lineno">  262</span>            <span class="keywordflow">if</span> (ret == -<a class="code hl_define" href="libfdt_8h.html#a149fb54f14ba915a78319a9570e4eae3">FDT_ERR_NOSPACE</a>)</div>
<div class="line"><span class="lineno">  263</span>                <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>            <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  266</span>                <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  267</span>        }</div>
<div class="line"><span class="lineno">  268</span>    }</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>    <a class="code hl_define" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>(fixup_child, fdto, fixup_node) {</div>
<div class="line"><span class="lineno">  271</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *fixup_child_name = <a class="code hl_function" href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name</a>(fdto, fixup_child,</div>
<div class="line"><span class="lineno">  272</span>                                <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><span class="lineno">  273</span>        <span class="keywordtype">int</span> tree_child;</div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>        tree_child = <a class="code hl_function" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset</a>(fdto, tree_node,</div>
<div class="line"><span class="lineno">  276</span>                        fixup_child_name);</div>
<div class="line"><span class="lineno">  277</span>        <span class="keywordflow">if</span> (tree_child == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  278</span>            <span class="keywordflow">return</span> -<a class="code hl_define" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>;</div>
<div class="line"><span class="lineno">  279</span>        <span class="keywordflow">if</span> (tree_child &lt; 0)</div>
<div class="line"><span class="lineno">  280</span>            <span class="keywordflow">return</span> tree_child;</div>
<div class="line"><span class="lineno">  281</span> </div>
<div class="line"><span class="lineno">  282</span>        ret = <a class="code hl_function" href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references</a>(fdto,</div>
<div class="line"><span class="lineno">  283</span>                               tree_child,</div>
<div class="line"><span class="lineno">  284</span>                               fixup_child,</div>
<div class="line"><span class="lineno">  285</span>                               delta);</div>
<div class="line"><span class="lineno">  286</span>        <span class="keywordflow">if</span> (ret)</div>
<div class="line"><span class="lineno">  287</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">  288</span>    }</div>
<div class="line"><span class="lineno">  289</span> </div>
<div class="line"><span class="lineno">  290</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  291</span>}</div>
<div class="ttc" id="afdt__overlay_8c_html_a385dd43636a52dc96596827f51511419"><div class="ttname"><a href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references</a></div><div class="ttdeci">static int overlay_update_local_node_references(void *fdto, int tree_node, int fixup_node, uint32_t delta)</div><div class="ttdef"><b>Definition:</b> fdt_overlay.c:205</div></div>
<div class="ttc" id="alibfdt_8h_html_a149fb54f14ba915a78319a9570e4eae3"><div class="ttname"><a href="libfdt_8h.html#a149fb54f14ba915a78319a9570e4eae3">FDT_ERR_NOSPACE</a></div><div class="ttdeci">#define FDT_ERR_NOSPACE</div><div class="ttdef"><b>Definition:</b> libfdt.h:26</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt__env_8h.html#a06ce41f441b8a56710000af3c3e516e5">cpu_to_fdt32()</a>, <a class="el" href="libfdt__env_8h.html#a6485ea7225a1927cc5ab1a34dabe298f">fdt32_to_cpu()</a>, <a class="el" href="libfdt_8h.html#aa276d7f3088179b283530d41750ff5e4">FDT_ERR_BADOVERLAY</a>, <a class="el" href="libfdt_8h.html#a149fb54f14ba915a78319a9570e4eae3">FDT_ERR_NOSPACE</a>, <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="libfdt_8h.html#ad994c33538d83be1383d449ed336803a">fdt_for_each_property_offset</a>, <a class="el" href="libfdt_8h.html#a7815aea6a1994b5fb035623a86e890a4">fdt_for_each_subnode</a>, <a class="el" href="fdt__ro_8c.html#a43937fb226554bcff64aa7370046cd82">fdt_get_name()</a>, <a class="el" href="fdt__ro_8c.html#a91753b1de7cad190da416780f4fbebc0">fdt_getprop()</a>, <a class="el" href="fdt__ro_8c.html#ad57579c58b67adbfa3d5b8044d5317cb">fdt_getprop_by_offset()</a>, <a class="el" href="fdt__wip_8c.html#ad2d3b0ed8c78b7ca920550656dca6cf9">fdt_setprop_inplace_namelen_partial()</a>, <a class="el" href="fdt__ro_8c.html#a22dd90f8bea25063fe0debae7683eb02">fdt_subnode_offset()</a>, <a class="el" href="cstd_8c.html#ad38ffc2285db68db3635cd35e9d53140">memcpy()</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references()</a>, and <a class="el" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references()</a>, and <a class="el" href="fdt__overlay_8c.html#a1c4ea38de65ffacb7708dd7641914a34">overlay_update_local_references()</a>.</p>

</div>
</div>
<a id="a1c4ea38de65ffacb7708dd7641914a34" name="a1c4ea38de65ffacb7708dd7641914a34"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c4ea38de65ffacb7708dd7641914a34">&#9670;&#160;</a></span>overlay_update_local_references()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int overlay_update_local_references </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fdto</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="libfdt__env_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>overlay_update_local_references - Adjust the overlay references @fdto: Device tree overlay blob @delta: Offset to shift the phandles of</p>
<p><a class="el" href="fdt__overlay_8c.html#a1c4ea38de65ffacb7708dd7641914a34">overlay_update_local_references()</a> update all the phandles pointing to a node within the device tree overlay by adding a constant delta to not conflict with the base overlay.</p>
<p>This is mainly used as part of a device tree application process, where you want the device tree overlays phandles to not conflict with the ones from the base device tree before merging them.</p>
<p>returns: 0 on success Negative error code on failure </p>
<div class="fragment"><div class="line"><span class="lineno">  311</span>{</div>
<div class="line"><span class="lineno">  312</span>    <span class="keywordtype">int</span> fixups;</div>
<div class="line"><span class="lineno">  313</span> </div>
<div class="line"><span class="lineno">  314</span>    fixups = <a class="code hl_function" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset</a>(fdto, <span class="stringliteral">&quot;/__local_fixups__&quot;</span>);</div>
<div class="line"><span class="lineno">  315</span>    <span class="keywordflow">if</span> (fixups &lt; 0) {</div>
<div class="line"><span class="lineno">  316</span>        <span class="comment">/* There&#39;s no local phandles to adjust, bail out */</span></div>
<div class="line"><span class="lineno">  317</span>        <span class="keywordflow">if</span> (fixups == -<a class="code hl_define" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>)</div>
<div class="line"><span class="lineno">  318</span>            <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  319</span> </div>
<div class="line"><span class="lineno">  320</span>        <span class="keywordflow">return</span> fixups;</div>
<div class="line"><span class="lineno">  321</span>    }</div>
<div class="line"><span class="lineno">  322</span> </div>
<div class="line"><span class="lineno">  323</span>    <span class="comment">/*</span></div>
<div class="line"><span class="lineno">  324</span><span class="comment">     * Update our local references from the root of the tree</span></div>
<div class="line"><span class="lineno">  325</span><span class="comment">     */</span></div>
<div class="line"><span class="lineno">  326</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references</a>(fdto, 0, fixups,</div>
<div class="line"><span class="lineno">  327</span>                            delta);</div>
<div class="line"><span class="lineno">  328</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="libfdt_8h.html#a93cfa052f4b28df4bfc7d336b692fa07">FDT_ERR_NOTFOUND</a>, <a class="el" href="fdt__ro_8c.html#a222c01ef0a514a4cf7586f6de8b17072">fdt_path_offset()</a>, and <a class="el" href="fdt__overlay_8c.html#a385dd43636a52dc96596827f51511419">overlay_update_local_node_references()</a>.</p>

<p class="reference">Referenced by <a class="el" href="fdt__overlay_8c.html#ad0fcb152428382bde7f034cdadfe923e">fdt_overlay_apply()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
