<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ko6: src/soft/fs/kfs/ktools.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo55.png"/></td>
  <td id="projectalign">
   <div id="projectname">ko6
   </div>
   <div id="projectbrief">ko6 (prononce it &#39;kit-O-sys&#39; O is  the letter not the number) is a small operating system for educationnal purpose</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8785740846211ac34fd04c61a1fdd888.html">soft</a></li><li class="navelem"><a class="el" href="dir_c9f83417c2b3f935a5ca497b28346c08.html">fs</a></li><li class="navelem"><a class="el" href="dir_84ebf85154e4c8e3a85777d360bfb661.html">kfs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">ktools.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;getopt.h&gt;</code><br />
<code>#include &lt;ftw.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &quot;<a class="el" href="kfs_8h_source.html">kfs.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a157a956e14c5c44b3f73ef23a4776f64"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a157a956e14c5c44b3f73ef23a4776f64">LINUX</a></td></tr>
<tr class="separator:a157a956e14c5c44b3f73ef23a4776f64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78c99ffd76a7bb3c8c74db76207e9ab4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a78c99ffd76a7bb3c8c74db76207e9ab4">_XOPEN_SOURCE</a>&#160;&#160;&#160;500</td></tr>
<tr class="separator:a78c99ffd76a7bb3c8c74db76207e9ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:adf764cbdea00d65edcd07bb9953ad2b7"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>
, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>
, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a>
, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a>
 }</td></tr>
<tr class="separator:adf764cbdea00d65edcd07bb9953ad2b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5ffaef3fc3f7ddb9856ccd4bcb79e9bc"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a> (const char *s)</td></tr>
<tr class="separator:a5ffaef3fc3f7ddb9856ccd4bcb79e9bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8563170876d354e520a737e1c358b875"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname</a> (int dentry)</td></tr>
<tr class="separator:a8563170876d354e520a737e1c358b875"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a248e1d9ae859f3b9f7933b506846c667"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry</a> (int dentry, int depth, int position)</td></tr>
<tr class="separator:a248e1d9ae859f3b9f7933b506846c667"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54c8f883a16767e5c05750fc425c525c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree</a> (char *name)</td></tr>
<tr class="separator:a54c8f883a16767e5c05750fc425c525c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ba276cff72866fb0ad856572a87ba35"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files</a> (int dentry, int depth, int position)</td></tr>
<tr class="separator:a1ba276cff72866fb0ad856572a87ba35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2acd3e2ba6581eac5ff5e2a78ffa9bd8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files</a> (char *name)</td></tr>
<tr class="separator:a2acd3e2ba6581eac5ff5e2a78ffa9bd8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7d303778c484a349f2ab87908905577"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a> (char *s)</td></tr>
<tr class="separator:aa7d303778c484a349f2ab87908905577"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b68125aeb10ab39a0981d0fa952d5f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk</a> (void)</td></tr>
<tr class="separator:a9b68125aeb10ab39a0981d0fa952d5f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39f344acada2bd8574dfb5da41938905"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file</a> (const char *host_file, int kfs_dentry)</td></tr>
<tr class="separator:a39f344acada2bd8574dfb5da41938905"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a521c1fd005bd6738b695d604843e880c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build</a> (const char *fpath, const struct stat *sb, int typeflag, struct FTW *ftwbuf)</td></tr>
<tr class="separator:a521c1fd005bd6738b695d604843e880c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16c0ecb37b34e241fab9b9be0ebf7c6f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split</a> (int dentry, int depth, int position)</td></tr>
<tr class="separator:a16c0ecb37b34e241fab9b9be0ebf7c6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8605e2b78cd4a81b6c6b5c30cb7366a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a> (void)</td></tr>
<tr class="separator:ae8605e2b78cd4a81b6c6b5c30cb7366a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78949f4960804d06e92c2b349740243f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a78949f4960804d06e92c2b349740243f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab4fad31452ea2612bd37240026dd6e44"><td class="memItemLeft" align="right" valign="top">char **&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#ab4fad31452ea2612bd37240026dd6e44">Argv</a></td></tr>
<tr class="separator:ab4fad31452ea2612bd37240026dd6e44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34296df812d7c5468ae201c7eeca5877"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a34296df812d7c5468ae201c7eeca5877">Argc</a></td></tr>
<tr class="separator:a34296df812d7c5468ae201c7eeca5877"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95f627d7054b1abbffa2c6ea19bf05db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a></td></tr>
<tr class="separator:a95f627d7054b1abbffa2c6ea19bf05db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36c5506122899541315d168541f135f6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a></td></tr>
<tr class="separator:a36c5506122899541315d168541f135f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58ccf99eba46ba1428531b6cab7fe47d"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a></td></tr>
<tr class="separator:a58ccf99eba46ba1428531b6cab7fe47d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad451cda91ce9d9c54ee261e4ec46e2c8"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a></td></tr>
<tr class="separator:ad451cda91ce9d9c54ee261e4ec46e2c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68cc4e6509205eeddea8429d2c05f2fe"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a></td></tr>
<tr class="separator:a68cc4e6509205eeddea8429d2c05f2fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af66cf6e5961e8522172d89532df9db9d"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a></td></tr>
<tr class="separator:af66cf6e5961e8522172d89532df9db9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9267a5326b000eb299265df069cdcaf7"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a></td></tr>
<tr class="separator:a9267a5326b000eb299265df069cdcaf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12af974a09824ae8357cae0737368e61"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a></td></tr>
<tr class="separator:a12af974a09824ae8357cae0737368e61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebd6c8ef38afc2cfd9a6db1ed746e28d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#aebd6c8ef38afc2cfd9a6db1ed746e28d">OptF</a> = 0</td></tr>
<tr class="separator:aebd6c8ef38afc2cfd9a6db1ed746e28d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a527b76b33fb8beec7f2df7e0c032aef6"><td class="memItemLeft" align="right" valign="top">static char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a> [1&lt;&lt; 12]</td></tr>
<tr class="separator:a527b76b33fb8beec7f2df7e0c032aef6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a78c99ffd76a7bb3c8c74db76207e9ab4" name="a78c99ffd76a7bb3c8c74db76207e9ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78c99ffd76a7bb3c8c74db76207e9ab4">&#9670;&#160;</a></span>_XOPEN_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _XOPEN_SOURCE&#160;&#160;&#160;500</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a157a956e14c5c44b3f73ef23a4776f64" name="a157a956e14c5c44b3f73ef23a4776f64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a157a956e14c5c44b3f73ef23a4776f64">&#9670;&#160;</a></span>LINUX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LINUX</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="adf764cbdea00d65edcd07bb9953ad2b7" name="adf764cbdea00d65edcd07bb9953ad2b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf764cbdea00d65edcd07bb9953ad2b7">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5" name="adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5"></a>CMD_DUMMY&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457" name="adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457"></a>CMD_TREE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5" name="adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5"></a>CMD_BUILD&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921" name="adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921"></a>CMD_SPLIT&#160;</td><td class="fielddoc"></td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">   58</span>     {</div>
<div class="line"><span class="lineno">   59</span>    <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>,</div>
<div class="line"><span class="lineno">   60</span>    <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>,</div>
<div class="line"><span class="lineno">   61</span>    <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a>,</div>
<div class="line"><span class="lineno">   62</span>    <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a></div>
<div class="line"><span class="lineno">   63</span>};</div>
<div class="ttc" id="aktools_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921"><div class="ttname"><a href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a></div><div class="ttdeci">@ CMD_SPLIT</div><div class="ttdef"><b>Definition:</b> ktools.c:62</div></div>
<div class="ttc" id="aktools_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457"><div class="ttname"><a href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a></div><div class="ttdeci">@ CMD_TREE</div><div class="ttdef"><b>Definition:</b> ktools.c:60</div></div>
<div class="ttc" id="aktools_8c_html_adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5"><div class="ttname"><a href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a></div><div class="ttdeci">@ CMD_BUILD</div><div class="ttdef"><b>Definition:</b> ktools.c:61</div></div>
<div class="ttc" id="aktools_8c_html_adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5"><div class="ttname"><a href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a></div><div class="ttdeci">@ CMD_DUMMY</div><div class="ttdef"><b>Definition:</b> ktools.c:59</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a39f344acada2bd8574dfb5da41938905" name="a39f344acada2bd8574dfb5da41938905"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39f344acada2bd8574dfb5da41938905">&#9670;&#160;</a></span>add_new_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_new_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>kfs_dentry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  273</span>{</div>
<div class="line"><span class="lineno">  274</span>    <span class="keywordtype">int</span> page_offset = 0;</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordtype">int</span> nb_bytes_read = 0;</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>    <span class="comment">/* Try to open the host&#39;s file */</span></div>
<div class="line"><span class="lineno">  278</span>    <span class="keywordtype">int</span> fd = open(host_file, O_RDONLY);</div>
<div class="line"><span class="lineno">  279</span> </div>
<div class="line"><span class="lineno">  280</span>    <span class="comment">/* Prepare buffer to receive the first page of the file */</span></div>
<div class="line"><span class="lineno">  281</span>    <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a> (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 0, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>    <span class="comment">/* Read the file, in chunks of 4kib, and write its content to the kfs pathname via the buffer */</span></div>
<div class="line"><span class="lineno">  284</span>    <span class="keywordflow">while</span> ((nb_bytes_read = <a class="code hl_function" href="libc_8c.html#aec19a0626d6167a834fa9f5b25214f7f">read</a>(fd, <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 1&lt;&lt;12)))</div>
<div class="line"><span class="lineno">  285</span>    {</div>
<div class="line"><span class="lineno">  286</span>        <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a>(kfs_dentry, page_offset, <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>);</div>
<div class="line"><span class="lineno">  287</span>        <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(kfs_dentry, nb_bytes_read + (page_offset&lt;&lt;12));</div>
<div class="line"><span class="lineno">  288</span>        page_offset++;</div>
<div class="line"><span class="lineno">  289</span>        <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a> (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 0, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  290</span>    }</div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>    <span class="comment">/* Close the file descriptor of the host&#39;s file */</span></div>
<div class="line"><span class="lineno">  293</span>    close(fd);</div>
<div class="line"><span class="lineno">  294</span>}</div>
<div class="ttc" id="acstd_8c_html_a72a7d1b36c78a71835b240833f7ed4d0"><div class="ttname"><a href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a></div><div class="ttdeci">void * memset(void *s, int c, unsigned n)</div><div class="ttdoc">set every byte in a buffer to a same value</div><div class="ttdef"><b>Definition:</b> cstd.c:22</div></div>
<div class="ttc" id="akfs_8c_html_a491e452cdf42853498249aadc91eb74b"><div class="ttname"><a href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a></div><div class="ttdeci">int kfs_set_size(int dentry, int newsize)</div><div class="ttdoc">Sets the size field of the inode associated with the dentry to newsize.</div><div class="ttdef"><b>Definition:</b> kfs.c:600</div></div>
<div class="ttc" id="akfs_8c_html_a57b5123b2f69a99505a7f3026eeefce9"><div class="ttname"><a href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a></div><div class="ttdeci">int kfs_write(int dentry, int pg_offset, void *buf)</div><div class="ttdoc">Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of ...</div><div class="ttdef"><b>Definition:</b> kfs.c:617</div></div>
<div class="ttc" id="aktools_8c_html_a527b76b33fb8beec7f2df7e0c032aef6"><div class="ttname"><a href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a></div><div class="ttdeci">static char buffer[1&lt;&lt; 12]</div><div class="ttdef"><b>Definition:</b> ktools.c:76</div></div>
<div class="ttc" id="alibc_8c_html_aec19a0626d6167a834fa9f5b25214f7f"><div class="ttname"><a href="libc_8c.html#aec19a0626d6167a834fa9f5b25214f7f">read</a></div><div class="ttdeci">int read(int fd, void *buf, int count)</div><div class="ttdoc">reads in at most count characters from fd and stores them into buf.</div><div class="ttdef"><b>Definition:</b> libc.c:37</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <a class="el" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>, <a class="el" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset()</a>, and <a class="el" href="libc_8c.html#aec19a0626d6167a834fa9f5b25214f7f">read()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a521c1fd005bd6738b695d604843e880c" name="a521c1fd005bd6738b695d604843e880c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a521c1fd005bd6738b695d604843e880c">&#9670;&#160;</a></span>build()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int build </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fpath</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct stat *&#160;</td>
          <td class="paramname"><em>sb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>typeflag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct FTW *&#160;</td>
          <td class="paramname"><em>ftwbuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  311</span>{</div>
<div class="line"><span class="lineno">  312</span>    <span class="comment">/* 1st call : if the pathname is not a directory that can be read, return 1 to stop the walk */</span></div>
<div class="line"><span class="lineno">  313</span>    <span class="keywordflow">if</span> ((ftwbuf-&gt;level == 0) &amp;&amp; (typeflag != FTW_D))</div>
<div class="line"><span class="lineno">  314</span>    {</div>
<div class="line"><span class="lineno">  315</span>        printf(<span class="stringliteral">&quot;%s is not a directory that can be read\n&quot;</span>, fpath);</div>
<div class="line"><span class="lineno">  316</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  317</span>    }</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>    <span class="comment">/* 1st call : if the pathname is a valid directory the walk can continue */</span></div>
<div class="line"><span class="lineno">  320</span>    <span class="keywordflow">if</span> ((ftwbuf-&gt;level == 0) &amp;&amp; (typeflag == FTW_D))</div>
<div class="line"><span class="lineno">  321</span>    {</div>
<div class="line"><span class="lineno">  322</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  323</span>    }</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <span class="comment">/* Subsequent calls : start with creating a new dentry in kfs  */</span></div>
<div class="line"><span class="lineno">  326</span>    <span class="keywordtype">char</span>* new_dentry_name = <a class="code hl_function" href="memory_8c.html#a9c36d0fe3ec4675cbffdc9b52f5fb399">malloc</a>(<a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(fpath) + 2);</div>
<div class="line"><span class="lineno">  327</span>    sprintf(new_dentry_name, <span class="stringliteral">&quot;/%s&quot;</span>, fpath);</div>
<div class="line"><span class="lineno">  328</span>    <span class="keywordtype">int</span> kfs_dentry = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a>(new_dentry_name);</div>
<div class="line"><span class="lineno">  329</span>    <a class="code hl_function" href="memory_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a>(new_dentry_name);</div>
<div class="line"><span class="lineno">  330</span> </div>
<div class="line"><span class="lineno">  331</span>    <span class="comment">/* If it is a regular file, write its content to kfs */</span></div>
<div class="line"><span class="lineno">  332</span>    <span class="keywordflow">if</span> (typeflag == FTW_F)</div>
<div class="line"><span class="lineno">  333</span>    {</div>
<div class="line"><span class="lineno">  334</span>        <a class="code hl_function" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file</a>(fpath, kfs_dentry);</div>
<div class="line"><span class="lineno">  335</span> </div>
<div class="line"><span class="lineno">  336</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  337</span>    }</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>    <span class="comment">/* If it is a directory, there isn&#39;t anything more to do */</span></div>
<div class="line"><span class="lineno">  340</span>    <span class="keywordflow">if</span> (typeflag == FTW_D)</div>
<div class="line"><span class="lineno">  341</span>    {</div>
<div class="line"><span class="lineno">  342</span>        <span class="comment">/* In kfs, set the dentry type to directory ??? */</span></div>
<div class="line"><span class="lineno">  343</span> </div>
<div class="line"><span class="lineno">  344</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  345</span>    }</div>
<div class="line"><span class="lineno">  346</span> </div>
<div class="line"><span class="lineno">  347</span>    <span class="comment">/* If it is not any of the above, return an error to stop the walk */</span></div>
<div class="line"><span class="lineno">  348</span>    <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">  349</span>}</div>
<div class="ttc" id="acstd_8c_html_a54684bded3e61e2d78d490650f9b706a"><div class="ttname"><a href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a></div><div class="ttdeci">int strlen(const char *buf)</div><div class="ttdoc">calculates the length of the string s, excluding the terminating null byte</div><div class="ttdef"><b>Definition:</b> cstd.c:82</div></div>
<div class="ttc" id="akfs_8c_html_ac7986c65e8710a8b55857582e62ccc78"><div class="ttname"><a href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a></div><div class="ttdeci">int kfs_open(char *pathname)</div><div class="ttdoc">opens a file or directory, if file or directory not found, all the pathname is created</div><div class="ttdef"><b>Definition:</b> kfs.c:525</div></div>
<div class="ttc" id="aktools_8c_html_a39f344acada2bd8574dfb5da41938905"><div class="ttname"><a href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file</a></div><div class="ttdeci">void add_new_file(const char *host_file, int kfs_dentry)</div><div class="ttdef"><b>Definition:</b> ktools.c:272</div></div>
<div class="ttc" id="amemory_8c_html_a9c36d0fe3ec4675cbffdc9b52f5fb399"><div class="ttname"><a href="memory_8c.html#a9c36d0fe3ec4675cbffdc9b52f5fb399">malloc</a></div><div class="ttdeci">void * malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> memory.c:97</div></div>
<div class="ttc" id="amemory_8c_html_afbedc913aa4651b3c3b4b3aecd9b4711"><div class="ttname"><a href="memory_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a></div><div class="ttdeci">void free(void *ptr)</div><div class="ttdoc">free an allocated object with malloc(), object is not erased.</div><div class="ttdef"><b>Definition:</b> memory.c:109</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, <a class="el" href="memory_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="memory_8c.html#a9c36d0fe3ec4675cbffdc9b52f5fb399">malloc()</a>, and <a class="el" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a9b68125aeb10ab39a0981d0fa952d5f1" name="a9b68125aeb10ab39a0981d0fa952d5f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b68125aeb10ab39a0981d0fa952d5f1">&#9670;&#160;</a></span>dummy_disk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dummy_disk </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  224</span>{</div>
<div class="line"><span class="lineno">  225</span>    <span class="keywordtype">int</span> fd[32];</div>
<div class="line"><span class="lineno">  226</span>    <span class="keywordtype">char</span> <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>[1&lt;&lt;12];</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>    fd[0] = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (<span class="stringliteral">&quot;/bin/app.x&quot;</span>);</div>
<div class="line"><span class="lineno">  229</span>    fd[1] = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (<span class="stringliteral">&quot;/home&quot;</span>);</div>
<div class="line"><span class="lineno">  230</span>    fd[2] = <a class="code hl_function" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (fd[1], <span class="stringliteral">&quot;angie&quot;</span>);</div>
<div class="line"><span class="lineno">  231</span>    fd[3] = <a class="code hl_function" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (fd[2], <span class="stringliteral">&quot;lena1.pgm&quot;</span>);</div>
<div class="line"><span class="lineno">  232</span>    fd[4] = <a class="code hl_function" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (fd[1], <span class="stringliteral">&quot;franck&quot;</span>);</div>
<div class="line"><span class="lineno">  233</span>    fd[5] = <a class="code hl_function" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (fd[1], <span class="stringliteral">&quot;francois&quot;</span>);</div>
<div class="line"><span class="lineno">  234</span>    fd[6] = <a class="code hl_function" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link</a> (<span class="stringliteral">&quot;/home/angie/lena1.pgm&quot;</span>, <span class="stringliteral">&quot;/home/lena2.pgm&quot;</span>);</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 0, <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour0&quot;</span>));</div>
<div class="line"><span class="lineno">  237</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], 8);</div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 3,  <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour3&quot;</span>));</div>
<div class="line"><span class="lineno">  240</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], (3&lt;&lt;12) + 8);</div>
<div class="line"><span class="lineno">  241</span> </div>
<div class="line"><span class="lineno">  242</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 13, <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour13&quot;</span>));</div>
<div class="line"><span class="lineno">  243</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], (13&lt;&lt;12) + 9);</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 27, <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour27&quot;</span>));</div>
<div class="line"><span class="lineno">  246</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], (27&lt;&lt;12) + 9);</div>
<div class="line"><span class="lineno">  247</span> </div>
<div class="line"><span class="lineno">  248</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 28, <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour28&quot;</span>));</div>
<div class="line"><span class="lineno">  249</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], (28&lt;&lt;12) + 9);</div>
<div class="line"><span class="lineno">  250</span> </div>
<div class="line"><span class="lineno">  251</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 29, <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour29&quot;</span>));</div>
<div class="line"><span class="lineno">  252</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], (29&lt;&lt;12) + 9);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>    <a class="code hl_function" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (fd[3], 30, <a class="code hl_function" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a>(<span class="stringliteral">&quot;Bonjour30&quot;</span>));</div>
<div class="line"><span class="lineno">  255</span>    <a class="code hl_function" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a>(fd[3], (30&lt;&lt;12) + 9);</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3],  0, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 0, buffer);</span></div>
<div class="line"><span class="lineno">  258</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3],  3, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 3, buffer);</span></div>
<div class="line"><span class="lineno">  259</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3], 13, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 13, buffer);</span></div>
<div class="line"><span class="lineno">  260</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3], 27, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 27, buffer);</span></div>
<div class="line"><span class="lineno">  261</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3], 28, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 28, buffer);</span></div>
<div class="line"><span class="lineno">  262</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3], 29, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 29, buffer);</span></div>
<div class="line"><span class="lineno">  263</span>    <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> ( fd[3], 30, (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); <span class="comment">//fprintf (stderr, &quot;%d:%s\n&quot;, 30, buffer);</span></div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>    <a class="code hl_function" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree</a> (<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  266</span>}</div>
<div class="ttc" id="akfs_8c_html_a4fa0207fb8a04e889050f380b9068e3a"><div class="ttname"><a href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link</a></div><div class="ttdeci">int kfs_link(char *src_name, char *dst_name)</div><div class="ttdoc">creates a new link (also called hard link) on an existing file.</div><div class="ttdef"><b>Definition:</b> kfs.c:632</div></div>
<div class="ttc" id="akfs_8c_html_a532e7e965bd6809645bdf682ffd509dc"><div class="ttname"><a href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a></div><div class="ttdeci">int kfs_read(int dentry, int pg_offset, int *buf)</div><div class="ttdoc">Reads a file, it reads one page from the file dentry to memory buffer. After reading,...</div><div class="ttdef"><b>Definition:</b> kfs.c:589</div></div>
<div class="ttc" id="akfs_8c_html_a5bf1c4cc42e02a99529eefc02cf53c4b"><div class="ttname"><a href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a></div><div class="ttdeci">int kfs_openat(int root, char *name)</div><div class="ttdoc">looks for name in the directory root, if the name is not found, it is created</div><div class="ttdef"><b>Definition:</b> kfs.c:541</div></div>
<div class="ttc" id="aktools_8c_html_a54c8f883a16767e5c05750fc425c525c"><div class="ttname"><a href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree</a></div><div class="ttdeci">void kfs_tree(char *name)</div><div class="ttdef"><b>Definition:</b> ktools.c:180</div></div>
<div class="ttc" id="aktools_8c_html_aa7d303778c484a349f2ab87908905577"><div class="ttname"><a href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess</a></div><div class="ttdeci">char * mess(char *s)</div><div class="ttdef"><b>Definition:</b> ktools.c:216</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <a class="el" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>, <a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read()</a>, <a class="el" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, <a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree()</a>, <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>, and <a class="el" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a78949f4960804d06e92c2b349740243f" name="a78949f4960804d06e92c2b349740243f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78949f4960804d06e92c2b349740243f">&#9670;&#160;</a></span>getoption()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void getoption </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  431</span>{</div>
<div class="line"><span class="lineno">  432</span>    <span class="keywordtype">char</span> option;</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>    <a class="code hl_variable" href="ktools_8c.html#a34296df812d7c5468ae201c7eeca5877">Argc</a> = argc;</div>
<div class="line"><span class="lineno">  435</span>    <a class="code hl_variable" href="ktools_8c.html#ab4fad31452ea2612bd37240026dd6e44">Argv</a> = argv;</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>    <span class="comment">// optional arguments</span></div>
<div class="line"><span class="lineno">  438</span>    <span class="comment">// ------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">  439</span>    <span class="keywordflow">while</span> ((option = getopt (argc, argv, <span class="stringliteral">&quot;hv:m:b:c:f&quot;</span>)) != EOF) {</div>
<div class="line"><span class="lineno">  440</span>        <span class="keywordflow">switch</span> (option) {</div>
<div class="line"><span class="lineno">  441</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div>
<div class="line"><span class="lineno">  442</span>            <a class="code hl_variable" href="ktools_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a> = <a class="code hl_function" href="cstd_8c.html#ad4e7081d9e427a55fedef2ceab5f6244">atoi</a>(optarg);</div>
<div class="line"><span class="lineno">  443</span>            <span class="keywordflow">if</span> ((<a class="code hl_variable" href="ktools_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a> &lt; 0) || (<a class="code hl_variable" href="ktools_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a> &gt; 2))</div>
<div class="line"><span class="lineno">  444</span>                <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a> ();</div>
<div class="line"><span class="lineno">  445</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  446</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line"><span class="lineno">  447</span>            <a class="code hl_variable" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a> = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a> (optarg);</div>
<div class="line"><span class="lineno">  448</span>            <span class="comment">// FIXME verfier exension et type</span></div>
<div class="line"><span class="lineno">  449</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  450</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;b&#39;</span>:</div>
<div class="line"><span class="lineno">  451</span>            <a class="code hl_variable" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a> = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a> (optarg);</div>
<div class="line"><span class="lineno">  452</span>            <span class="comment">// FIXME verfier exension et type</span></div>
<div class="line"><span class="lineno">  453</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  454</span><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="lineno">  455</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:</div>
<div class="line"><span class="lineno">  456</span>            <span class="comment">/* FIXME Ajouter les vérifications */</span></div>
<div class="line"><span class="lineno">  457</span>            <span class="keywordtype">char</span> * optCArg = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a>(optarg);</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>            <a class="code hl_variable" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a> = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a>(strtok(optCArg, <span class="stringliteral">&quot;:&quot;</span>));</div>
<div class="line"><span class="lineno">  460</span>            <a class="code hl_variable" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a> = strtok(<a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a>)</div>
<div class="line"><span class="lineno">  463</span>                <a class="code hl_variable" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a> = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a>(<a class="code hl_variable" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a>);</div>
<div class="line"><span class="lineno">  464</span> </div>
<div class="line"><span class="lineno">  465</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  466</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  467</span>        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div>
<div class="line"><span class="lineno">  468</span>            <a class="code hl_variable" href="ktools_8c.html#aebd6c8ef38afc2cfd9a6db1ed746e28d">OptF</a> = 1;</div>
<div class="line"><span class="lineno">  469</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  470</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  471</span>            <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a> ();</div>
<div class="line"><span class="lineno">  472</span>        }</div>
<div class="line"><span class="lineno">  473</span>    }</div>
<div class="line"><span class="lineno">  474</span> </div>
<div class="line"><span class="lineno">  475</span>    <span class="comment">// mandatory arguments</span></div>
<div class="line"><span class="lineno">  476</span>    <span class="comment">// ------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordflow">if</span> (optind &lt; argc) {</div>
<div class="line"><span class="lineno">  478</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="cstd_8c.html#a11bd144d7d44914099a3aeddf1c8567d">strcmp</a> (argv[optind], <span class="stringliteral">&quot;dummy&quot;</span>)==0)  <a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a> = <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>; <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  479</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="cstd_8c.html#a11bd144d7d44914099a3aeddf1c8567d">strcmp</a> (argv[optind], <span class="stringliteral">&quot;build&quot;</span>)==0)  <a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a> = <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a>; <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  480</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="cstd_8c.html#a11bd144d7d44914099a3aeddf1c8567d">strcmp</a> (argv[optind], <span class="stringliteral">&quot;split&quot;</span>)==0)  <a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a> = <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a>; <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  481</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="cstd_8c.html#a11bd144d7d44914099a3aeddf1c8567d">strcmp</a> (argv[optind], <span class="stringliteral">&quot;tree&quot;</span>)==0)   <a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a> = <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>;  <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  482</span>        <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a>();</div>
<div class="line"><span class="lineno">  483</span>        optind++;</div>
<div class="line"><span class="lineno">  484</span>    } <span class="keywordflow">else</span> <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a>();</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span>    <span class="keywordflow">if</span> (optind &lt; argc) {</div>
<div class="line"><span class="lineno">  487</span>        <span class="comment">// FIXME verfier exension et type</span></div>
<div class="line"><span class="lineno">  488</span>        <a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a> = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a> (argv[optind]);</div>
<div class="line"><span class="lineno">  489</span>        optind++;</div>
<div class="line"><span class="lineno">  490</span>    } <span class="keywordflow">else</span> <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a>();</div>
<div class="line"><span class="lineno">  491</span> </div>
<div class="line"><span class="lineno">  492</span>    <span class="comment">// optional arguments that depend on command</span></div>
<div class="line"><span class="lineno">  493</span>    <span class="comment">// ------------------------------------------------------------------</span></div>
<div class="line"><span class="lineno">  494</span>    <span class="comment">/* if a DirName needs to be retrieved */</span></div>
<div class="line"><span class="lineno">  495</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a> != <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>)&amp;&amp;(<a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a> != <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>) \</div>
<div class="line"><span class="lineno">  496</span>        &amp;&amp;(!<a class="code hl_variable" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a>)&amp;&amp;(!<a class="code hl_variable" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a>)&amp;&amp;(!<a class="code hl_variable" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a>)) {</div>
<div class="line"><span class="lineno">  497</span>        <span class="keywordflow">if</span> (optind &lt; argc) {</div>
<div class="line"><span class="lineno">  498</span>            <a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a> = <a class="code hl_function" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a> (argv[optind]);</div>
<div class="line"><span class="lineno">  499</span>            <span class="comment">// FIXME verfier exension et type</span></div>
<div class="line"><span class="lineno">  500</span>            optind++;</div>
<div class="line"><span class="lineno">  501</span>        }</div>
<div class="line"><span class="lineno">  502</span>        <span class="keywordflow">else</span> <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a>();</div>
<div class="line"><span class="lineno">  503</span>    }</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>    <span class="comment">/* There should not be any more arguments at this point */</span></div>
<div class="line"><span class="lineno">  506</span>    <span class="keywordflow">if</span> (optind != argc)</div>
<div class="line"><span class="lineno">  507</span>        <a class="code hl_function" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a>();</div>
<div class="line"><span class="lineno">  508</span>}</div>
<div class="ttc" id="acstd_8c_html_a11bd144d7d44914099a3aeddf1c8567d"><div class="ttname"><a href="cstd_8c.html#a11bd144d7d44914099a3aeddf1c8567d">strcmp</a></div><div class="ttdeci">int strcmp(const char *s1, const char *s2)</div><div class="ttdoc">compare two null-terminated strings</div><div class="ttdef"><b>Definition:</b> cstd.c:133</div></div>
<div class="ttc" id="acstd_8c_html_ad4e7081d9e427a55fedef2ceab5f6244"><div class="ttname"><a href="cstd_8c.html#ad4e7081d9e427a55fedef2ceab5f6244">atoi</a></div><div class="ttdeci">int atoi(char *val)</div><div class="ttdoc">ascii to integer the number can be negative, the space at beginning are ignored</div><div class="ttdef"><b>Definition:</b> cstd.c:146</div></div>
<div class="ttc" id="akfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
<div class="ttc" id="aktools_8c_html_a12af974a09824ae8357cae0737368e61"><div class="ttname"><a href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a></div><div class="ttdeci">char * OptCNewFile</div><div class="ttdef"><b>Definition:</b> ktools.c:73</div></div>
<div class="ttc" id="aktools_8c_html_a34296df812d7c5468ae201c7eeca5877"><div class="ttname"><a href="ktools_8c.html#a34296df812d7c5468ae201c7eeca5877">Argc</a></div><div class="ttdeci">int Argc</div><div class="ttdef"><b>Definition:</b> ktools.c:65</div></div>
<div class="ttc" id="aktools_8c_html_a36c5506122899541315d168541f135f6"><div class="ttname"><a href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a></div><div class="ttdeci">int Command</div><div class="ttdef"><b>Definition:</b> ktools.c:67</div></div>
<div class="ttc" id="aktools_8c_html_a58ccf99eba46ba1428531b6cab7fe47d"><div class="ttname"><a href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a></div><div class="ttdeci">char * MbrFileName</div><div class="ttdef"><b>Definition:</b> ktools.c:68</div></div>
<div class="ttc" id="aktools_8c_html_a5ffaef3fc3f7ddb9856ccd4bcb79e9bc"><div class="ttname"><a href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup</a></div><div class="ttdeci">char * strdup(const char *s)</div></div>
<div class="ttc" id="aktools_8c_html_a68cc4e6509205eeddea8429d2c05f2fe"><div class="ttname"><a href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a></div><div class="ttdeci">char * DirName</div><div class="ttdef"><b>Definition:</b> ktools.c:70</div></div>
<div class="ttc" id="aktools_8c_html_a9267a5326b000eb299265df069cdcaf7"><div class="ttname"><a href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a></div><div class="ttdeci">char * OptCPathname</div><div class="ttdef"><b>Definition:</b> ktools.c:72</div></div>
<div class="ttc" id="aktools_8c_html_a95f627d7054b1abbffa2c6ea19bf05db"><div class="ttname"><a href="ktools_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a></div><div class="ttdeci">int Verbose</div><div class="ttdef"><b>Definition:</b> ktools.c:66</div></div>
<div class="ttc" id="aktools_8c_html_ab4fad31452ea2612bd37240026dd6e44"><div class="ttname"><a href="ktools_8c.html#ab4fad31452ea2612bd37240026dd6e44">Argv</a></div><div class="ttdeci">char ** Argv</div><div class="ttdef"><b>Definition:</b> ktools.c:64</div></div>
<div class="ttc" id="aktools_8c_html_ad451cda91ce9d9c54ee261e4ec46e2c8"><div class="ttname"><a href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a></div><div class="ttdeci">char * BootFileName</div><div class="ttdef"><b>Definition:</b> ktools.c:69</div></div>
<div class="ttc" id="aktools_8c_html_ae8605e2b78cd4a81b6c6b5c30cb7366a"><div class="ttname"><a href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage</a></div><div class="ttdeci">void usage(void)</div><div class="ttdef"><b>Definition:</b> ktools.c:414</div></div>
<div class="ttc" id="aktools_8c_html_aebd6c8ef38afc2cfd9a6db1ed746e28d"><div class="ttname"><a href="ktools_8c.html#aebd6c8ef38afc2cfd9a6db1ed746e28d">OptF</a></div><div class="ttdeci">int OptF</div><div class="ttdef"><b>Definition:</b> ktools.c:74</div></div>
<div class="ttc" id="aktools_8c_html_af66cf6e5961e8522172d89532df9db9d"><div class="ttname"><a href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a></div><div class="ttdeci">char * KfsDiskName</div><div class="ttdef"><b>Definition:</b> ktools.c:71</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a34296df812d7c5468ae201c7eeca5877">Argc</a>, <a class="el" href="ktools_8c.html#ab4fad31452ea2612bd37240026dd6e44">Argv</a>, <a class="el" href="cstd_8c.html#ad4e7081d9e427a55fedef2ceab5f6244">atoi()</a>, <a class="el" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>, <a class="el" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a>, <a class="el" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>, <a class="el" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>, <a class="el" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a>, <a class="el" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a>, <a class="el" href="ktools_8c.html#aebd6c8ef38afc2cfd9a6db1ed746e28d">OptF</a>, <a class="el" href="cstd_8c.html#a11bd144d7d44914099a3aeddf1c8567d">strcmp()</a>, <a class="el" href="ktools_8c.html#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">strdup()</a>, <a class="el" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage()</a>, and <a class="el" href="ktools_8c.html#a95f627d7054b1abbffa2c6ea19bf05db">Verbose</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a8563170876d354e520a737e1c358b875" name="a8563170876d354e520a737e1c358b875"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8563170876d354e520a737e1c358b875">&#9670;&#160;</a></span>kfs_absolute_pathname()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * kfs_absolute_pathname </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   88</span>{</div>
<div class="line"><span class="lineno">   89</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> path[256];</div>
<div class="line"><span class="lineno">   90</span>    <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a>(path, <span class="charliteral">&#39;\0&#39;</span>, 256);</div>
<div class="line"><span class="lineno">   91</span>    <span class="keywordtype">char</span>* current_name;</div>
<div class="line"><span class="lineno">   92</span>    <span class="keywordtype">int</span> current_name_length;</div>
<div class="line"><span class="lineno">   93</span>    <span class="keywordtype">int</span> current_dentry = dentry;</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    <span class="comment">/* If dentry is the root, put &#39;/&#39; in path and return */</span></div>
<div class="line"><span class="lineno">   97</span>    <span class="keywordflow">if</span> (!current_dentry)</div>
<div class="line"><span class="lineno">   98</span>    {</div>
<div class="line"><span class="lineno">   99</span>        path[0] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">  100</span>        <span class="keywordflow">return</span> path;</div>
<div class="line"><span class="lineno">  101</span>    }</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    <span class="comment">/* If not, for each dentry, add its name at the beginning of the path string */</span></div>
<div class="line"><span class="lineno">  104</span>    <span class="keywordflow">while</span>(current_dentry)</div>
<div class="line"><span class="lineno">  105</span>    {</div>
<div class="line"><span class="lineno">  106</span>        <span class="comment">/* Assuming dentry names max len is 28, no more than 8 iterations for a path of len 256 */</span></div>
<div class="line"><span class="lineno">  107</span>        <span class="keywordflow">if</span> (i &gt;= 8) <span class="keywordflow">return</span> <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>        <span class="comment">/* Get the name of the current dentry */</span></div>
<div class="line"><span class="lineno">  110</span>        current_name = <a class="code hl_function" href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name</a>(current_dentry);</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>        <span class="comment">/* Move the path to be able to copy the current name at the beginning of the path */</span></div>
<div class="line"><span class="lineno">  113</span>        current_name_length = <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(current_name);</div>
<div class="line"><span class="lineno">  114</span>        <a class="code hl_function" href="cstd_8c.html#a340d11725e5c81a874f508fbcdf1c5ef">memmove</a>(path + current_name_length, path, <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(path));</div>
<div class="line"><span class="lineno">  115</span>        <a class="code hl_function" href="cstd_8c.html#a8c530adfbb0a41bb842649393a223032">strncpy</a>(path, current_name, current_name_length);</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>        <span class="comment">/* Move the path again to add &#39;/&#39; at the very beginning */</span></div>
<div class="line"><span class="lineno">  118</span>        <a class="code hl_function" href="cstd_8c.html#a340d11725e5c81a874f508fbcdf1c5ef">memmove</a>(path + 1, path, <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(path));</div>
<div class="line"><span class="lineno">  119</span>        path[0] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>        <span class="comment">/* In the next iteration, the dentry will have to be the root of the current one */</span></div>
<div class="line"><span class="lineno">  122</span>        current_dentry = <a class="code hl_function" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root</a>(current_dentry);</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>        <span class="comment">/* Increment i which ensures that the absolute pathname cannot be longer than a given len */</span></div>
<div class="line"><span class="lineno">  125</span>        i++;</div>
<div class="line"><span class="lineno">  126</span>    }</div>
<div class="line"><span class="lineno">  127</span> </div>
<div class="line"><span class="lineno">  128</span>    <span class="comment">/* Add the null terminating character */</span></div>
<div class="line"><span class="lineno">  129</span>    path[<a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(path)] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">return</span> path;</div>
<div class="line"><span class="lineno">  132</span>}</div>
<div class="ttc" id="acstd_8c_html_a340d11725e5c81a874f508fbcdf1c5ef"><div class="ttname"><a href="cstd_8c.html#a340d11725e5c81a874f508fbcdf1c5ef">memmove</a></div><div class="ttdeci">void * memmove(void *dest, const void *src, size_t n)</div><div class="ttdoc">copies buffer src to the buffer dest (the buffers can overlap)</div><div class="ttdef"><b>Definition:</b> cstd.c:52</div></div>
<div class="ttc" id="acstd_8c_html_a8c530adfbb0a41bb842649393a223032"><div class="ttname"><a href="cstd_8c.html#a8c530adfbb0a41bb842649393a223032">strncpy</a></div><div class="ttdeci">void * strncpy(char *dest, char *src, unsigned n)</div><div class="ttdoc">copies the string src, included the ending byte '\0', to the buffer dest</div><div class="ttdef"><b>Definition:</b> cstd.c:123</div></div>
<div class="ttc" id="akfs_8c_html_a2c752ffc3e5d008879e7035508bac847"><div class="ttname"><a href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name</a></div><div class="ttdeci">char * kfs_name(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:140</div></div>
<div class="ttc" id="akfs_8c_html_ade5bf93265bc86a9ecd5019cc6e3d277"><div class="ttname"><a href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root</a></div><div class="ttdeci">int kfs_root(int dentry)</div><div class="ttdoc">read access functions to dentries</div><div class="ttdef"><b>Definition:</b> kfs.c:136</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name()</a>, <a class="el" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root()</a>, <a class="el" href="cstd_8c.html#a340d11725e5c81a874f508fbcdf1c5ef">memmove()</a>, <a class="el" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset()</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen()</a>, and <a class="el" href="cstd_8c.html#a8c530adfbb0a41bb842649393a223032">strncpy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="a2acd3e2ba6581eac5ff5e2a78ffa9bd8" name="a2acd3e2ba6581eac5ff5e2a78ffa9bd8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">&#9670;&#160;</a></span>kfs_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfs_files </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  208</span>{</div>
<div class="line"><span class="lineno">  209</span>    <a class="code hl_function" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb</a>(<a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a>(name), <a class="code hl_function" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files</a>);</div>
<div class="line"><span class="lineno">  210</span>}</div>
<div class="ttc" id="akfs_8c_html_a0c8753d9a11f6570f9c56b587fa2c48c"><div class="ttname"><a href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb</a></div><div class="ttdeci">int kfs_tree_cb(int root, void(*callback)(int dentry, int depth, int postion))</div><div class="ttdef"><b>Definition:</b> kfs.c:681</div></div>
<div class="ttc" id="aktools_8c_html_a1ba276cff72866fb0ad856572a87ba35"><div class="ttname"><a href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files</a></div><div class="ttdeci">void kfs_print_files(int dentry, int depth, int position)</div><div class="ttdef"><b>Definition:</b> ktools.c:185</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, and <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a248e1d9ae859f3b9f7933b506846c667" name="a248e1d9ae859f3b9f7933b506846c667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a248e1d9ae859f3b9f7933b506846c667">&#9670;&#160;</a></span>kfs_print_dentry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfs_print_dentry </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  139</span>{</div>
<div class="line"><span class="lineno">  140</span>    <span class="keywordtype">char</span> <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>[256];                                       <span class="comment">// formated filename</span></div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordtype">int</span> l;                                                  <span class="comment">// directory level 0=root</span></div>
<div class="line"><span class="lineno">  142</span>    <span class="keywordtype">char</span> types[4] = {<span class="charliteral">&#39;d&#39;</span>,<span class="charliteral">&#39;-&#39;</span>,<span class="charliteral">&#39;p&#39;</span>,<span class="charliteral">&#39;l&#39;</span>};                      <span class="comment">// type name</span></div>
<div class="line"><span class="lineno">  143</span>    <span class="keywordtype">char</span> * owners[] = {<span class="stringliteral">&quot;k &quot;</span>,<span class="stringliteral">&quot;u1&quot;</span>,<span class="stringliteral">&quot;u2&quot;</span>,<span class="stringliteral">&quot;u3&quot;</span>};                <span class="comment">// owner&#39;s name</span></div>
<div class="line"><span class="lineno">  144</span>    <span class="keywordtype">char</span> * name = <a class="code hl_function" href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name</a> (dentry);                        <span class="comment">// get entry name</span></div>
<div class="line"><span class="lineno">  145</span>    <span class="keywordtype">int</span> inode = <a class="code hl_function" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);                          <span class="comment">// get the associated inode</span></div>
<div class="line"><span class="lineno">  146</span>    <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>[0]=0;                                            <span class="comment">// clear the buffer</span></div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordflow">for</span> (l = depth; l; l--) strcat (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <span class="stringliteral">&quot;  &quot;</span>);          <span class="comment">// indent the name</span></div>
<div class="line"><span class="lineno">  148</span>    strcat (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, name);                                  <span class="comment">// put the name</span></div>
<div class="line"><span class="lineno">  149</span>    strcat (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, (<a class="code hl_function" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a>(inode)==<a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>)?<span class="stringliteral">&quot;/&quot;</span>:<span class="stringliteral">&quot; &quot;</span>);    <span class="comment">// add  / for a diectory</span></div>
<div class="line"><span class="lineno">  150</span>    <span class="keywordflow">for</span> (l = <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>); l&lt;30; l++) <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>[l]=<span class="charliteral">&#39; &#39;</span>;      <span class="comment">// complete until 30 character</span></div>
<div class="line"><span class="lineno">  151</span>    <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>[l]=0;                                            <span class="comment">// end the buffer</span></div>
<div class="line"><span class="lineno">  152</span>    printf (<span class="stringliteral">&quot;d%-2x&gt;i%-2x &quot;</span>                                  <span class="comment">// dentry -&gt; inode</span></div>
<div class="line"><span class="lineno">  153</span>            <span class="stringliteral">&quot;%c%c%c%c%c%c%c %3d %s %7d %d &quot;</span>                 <span class="comment">// inode data</span></div>
<div class="line"><span class="lineno">  154</span>            <span class="stringliteral">&quot;&lt;%-2xv%-2x&gt;%-2x %s&quot;</span>,                           <span class="comment">// dentry tree structure</span></div>
<div class="line"><span class="lineno">  155</span>            dentry, inode,                                  <span class="comment">//</span></div>
<div class="line"><span class="lineno">  156</span>            types[<a class="code hl_function" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a>(inode)],                         <span class="comment">// inode type</span></div>
<div class="line"><span class="lineno">  157</span>            (<a class="code hl_function" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a>(inode) &amp; 0b100000)  ? <span class="charliteral">&#39;r&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,      <span class="comment">// inode permission mode</span></div>
<div class="line"><span class="lineno">  158</span>            (<a class="code hl_function" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a>(inode) &amp; 0b010000)  ? <span class="charliteral">&#39;w&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><span class="lineno">  159</span>            (<a class="code hl_function" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a>(inode) &amp; 0b001000)  ? <span class="charliteral">&#39;x&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><span class="lineno">  160</span>            (<a class="code hl_function" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a>(inode) &amp; 0b000100)  ? <span class="charliteral">&#39;r&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><span class="lineno">  161</span>            (<a class="code hl_function" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a>(inode) &amp; 0b000010)  ? <span class="charliteral">&#39;w&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><span class="lineno">  162</span>            (<a class="code hl_function" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a>(inode) &amp; 0b000001)  ? <span class="charliteral">&#39;x&#39;</span> : <span class="charliteral">&#39;-&#39;</span>,</div>
<div class="line"><span class="lineno">  163</span>            <a class="code hl_function" href="kfs_8c.html#aaa0d81604e0d3d23f31b3beb7dcb163c">kfs_count</a>(inode),                               <span class="comment">// inode references counter</span></div>
<div class="line"><span class="lineno">  164</span>            owners[<a class="code hl_function" href="kfs_8c.html#a2f522cb4edeecd6cbcebcca31d90bc75">kfs_owner</a>(inode)],                       <span class="comment">// inode owner</span></div>
<div class="line"><span class="lineno">  165</span>            <a class="code hl_function" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode),                                <span class="comment">// inode size</span></div>
<div class="line"><span class="lineno">  166</span>            <a class="code hl_function" href="kfs_8c.html#a9b41dd15430924703df46a579ff05b2e">kfs_mtime</a>(inode),                               <span class="comment">// inode relative modification time</span></div>
<div class="line"><span class="lineno">  167</span>            <a class="code hl_function" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root</a>(dentry),                               <span class="comment">// dentry structure</span></div>
<div class="line"><span class="lineno">  168</span>            <a class="code hl_function" href="kfs_8c.html#a3be0d586ff3044979a3c381137d77d47">kfs_next</a>(dentry),</div>
<div class="line"><span class="lineno">  169</span>            <a class="code hl_function" href="kfs_8c.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf</a>(dentry),</div>
<div class="line"><span class="lineno">  170</span>            <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>);                                        <span class="comment">// entry name</span></div>
<div class="line"><span class="lineno">  171</span>    <span class="keywordtype">int</span> offset = 0;                                         <span class="comment">// offset in file</span></div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordtype">int</span> page = <a class="code hl_function" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a> (inode, offset++);                  <span class="comment">// first page number (-1 if ended)</span></div>
<div class="line"><span class="lineno">  173</span>    <span class="keywordflow">while</span> (page &gt;= 0) {                                     <span class="comment">// while there are pages</span></div>
<div class="line"><span class="lineno">  174</span>        printf (<span class="stringliteral">&quot;%3d&quot;</span>, page);                               <span class="comment">// print page number in disk</span></div>
<div class="line"><span class="lineno">  175</span>        page = <a class="code hl_function" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a> (inode, offset++);                  <span class="comment">// find the next</span></div>
<div class="line"><span class="lineno">  176</span>    }</div>
<div class="line"><span class="lineno">  177</span>    printf (<span class="stringliteral">&quot;\n&quot;</span>);                                          <span class="comment">// at last change the line</span></div>
<div class="line"><span class="lineno">  178</span>}</div>
<div class="ttc" id="akfs_8c_html_a135f3848117282c89e3be09b930eb9de"><div class="ttname"><a href="kfs_8c.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf</a></div><div class="ttdeci">int kfs_leaf(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:138</div></div>
<div class="ttc" id="akfs_8c_html_a2e7cb7a15052f57bdff8a2c1146bc072"><div class="ttname"><a href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a></div><div class="ttdeci">int kfs_size(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:147</div></div>
<div class="ttc" id="akfs_8c_html_a2f522cb4edeecd6cbcebcca31d90bc75"><div class="ttname"><a href="kfs_8c.html#a2f522cb4edeecd6cbcebcca31d90bc75">kfs_owner</a></div><div class="ttdeci">int kfs_owner(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:148</div></div>
<div class="ttc" id="akfs_8c_html_a3be0d586ff3044979a3c381137d77d47"><div class="ttname"><a href="kfs_8c.html#a3be0d586ff3044979a3c381137d77d47">kfs_next</a></div><div class="ttdeci">int kfs_next(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:137</div></div>
<div class="ttc" id="akfs_8c_html_a8d546cf291d26ab01a150b74cc206ae1"><div class="ttname"><a href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a></div><div class="ttdeci">int kfs_type(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:145</div></div>
<div class="ttc" id="akfs_8c_html_a9b41dd15430924703df46a579ff05b2e"><div class="ttname"><a href="kfs_8c.html#a9b41dd15430924703df46a579ff05b2e">kfs_mtime</a></div><div class="ttdeci">int kfs_mtime(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:149</div></div>
<div class="ttc" id="akfs_8c_html_aaa0d81604e0d3d23f31b3beb7dcb163c"><div class="ttname"><a href="kfs_8c.html#aaa0d81604e0d3d23f31b3beb7dcb163c">kfs_count</a></div><div class="ttdeci">int kfs_count(int inode)</div><div class="ttdoc">read access functions to inodes</div><div class="ttdef"><b>Definition:</b> kfs.c:144</div></div>
<div class="ttc" id="akfs_8c_html_aae206d59d8bc4514d34dafdff1198ede"><div class="ttname"><a href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a></div><div class="ttdeci">int kfs_inode(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:139</div></div>
<div class="ttc" id="akfs_8c_html_ac9581ae711d5f79aff1ed39c9739e80c"><div class="ttname"><a href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a></div><div class="ttdeci">int kfs_mode(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:146</div></div>
<div class="ttc" id="akfs_8c_html_afdc75626536d311fb2fe47baef24ef55"><div class="ttname"><a href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a></div><div class="ttdeci">int kfs_page(int inode, int pg_offset)</div><div class="ttdef"><b>Definition:</b> kfs.c:376</div></div>
<div class="ttc" id="akfs_8h_html_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a></div><div class="ttdeci">@ KFS_DIR</div><div class="ttdoc">type of files for the real disk (less than vfs)</div><div class="ttdef"><b>Definition:</b> kfs.h:46</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <a class="el" href="kfs_8c.html#aaa0d81604e0d3d23f31b3beb7dcb163c">kfs_count()</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf()</a>, <a class="el" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode()</a>, <a class="el" href="kfs_8c.html#a9b41dd15430924703df46a579ff05b2e">kfs_mtime()</a>, <a class="el" href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name()</a>, <a class="el" href="kfs_8c.html#a3be0d586ff3044979a3c381137d77d47">kfs_next()</a>, <a class="el" href="kfs_8c.html#a2f522cb4edeecd6cbcebcca31d90bc75">kfs_owner()</a>, <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, <a class="el" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type()</a>, and <a class="el" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree()</a>.</p>

</div>
</div>
<a id="a1ba276cff72866fb0ad856572a87ba35" name="a1ba276cff72866fb0ad856572a87ba35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ba276cff72866fb0ad856572a87ba35">&#9670;&#160;</a></span>kfs_print_files()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfs_print_files </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  186</span>{</div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordtype">int</span> inode = <a class="code hl_function" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);</div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordtype">int</span> size = <a class="code hl_function" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode);</div>
<div class="line"><span class="lineno">  189</span>    <span class="keywordtype">int</span> pg_offset = 0;</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>    printf(<span class="stringliteral">&quot;\n%s\n&quot;</span>, <a class="code hl_function" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname</a>(dentry));</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>    <span class="keywordflow">if</span> (size == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  194</span> </div>
<div class="line"><span class="lineno">  195</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a>(inode) == <a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>) {</div>
<div class="line"><span class="lineno">  196</span>        <span class="keywordflow">while</span> (pg_offset&lt;&lt;12 &lt; size)</div>
<div class="line"><span class="lineno">  197</span>        {</div>
<div class="line"><span class="lineno">  198</span>            <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a> (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 0, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  199</span>            <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a>(dentry, pg_offset, (<span class="keywordtype">void</span> *) <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>);</div>
<div class="line"><span class="lineno">  200</span>            <a class="code hl_function" href="libc_8c.html#a18e0c7fef99a23c9dcf7269da9e6bfc7">write</a>(STDOUT_FILENO, <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  201</span>            pg_offset++;</div>
<div class="line"><span class="lineno">  202</span>        }</div>
<div class="line"><span class="lineno">  203</span>        printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  204</span>    }</div>
<div class="line"><span class="lineno">  205</span>}</div>
<div class="ttc" id="akfs_8h_html_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a></div><div class="ttdeci">@ KFS_FILE</div><div class="ttdoc">regular file</div><div class="ttdef"><b>Definition:</b> kfs.h:47</div></div>
<div class="ttc" id="aktools_8c_html_a8563170876d354e520a737e1c358b875"><div class="ttname"><a href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname</a></div><div class="ttdeci">char * kfs_absolute_pathname(int dentry)</div><div class="ttdef"><b>Definition:</b> ktools.c:87</div></div>
<div class="ttc" id="alibc_8c_html_a18e0c7fef99a23c9dcf7269da9e6bfc7"><div class="ttname"><a href="libc_8c.html#a18e0c7fef99a23c9dcf7269da9e6bfc7">write</a></div><div class="ttdeci">int write(int fd, void *buf, int count)</div><div class="ttdoc">write in at most count characters from buf to fd.</div><div class="ttdef"><b>Definition:</b> libc.c:42</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <a class="el" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname()</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>, <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type()</a>, <a class="el" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset()</a>, and <a class="el" href="libc_8c.html#a18e0c7fef99a23c9dcf7269da9e6bfc7">write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files()</a>.</p>

</div>
</div>
<a id="a54c8f883a16767e5c05750fc425c525c" name="a54c8f883a16767e5c05750fc425c525c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54c8f883a16767e5c05750fc425c525c">&#9670;&#160;</a></span>kfs_tree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfs_tree </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  181</span>{</div>
<div class="line"><span class="lineno">  182</span>    <a class="code hl_function" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb</a> (<a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a>(name), <a class="code hl_function" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry</a>);         <span class="comment">// call kfs_print_dentry for all entry</span></div>
<div class="line"><span class="lineno">  183</span>}</div>
<div class="ttc" id="aktools_8c_html_a248e1d9ae859f3b9f7933b506846c667"><div class="ttname"><a href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry</a></div><div class="ttdeci">void kfs_print_dentry(int dentry, int depth, int position)</div><div class="ttdef"><b>Definition:</b> ktools.c:138</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, and <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a0ddf1224851353fc92bfbff6f499fa97" name="a0ddf1224851353fc92bfbff6f499fa97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ddf1224851353fc92bfbff6f499fa97">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  511</span>{</div>
<div class="line"><span class="lineno">  512</span>    <a class="code hl_function" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption</a> (argc, argv);</div>
<div class="line"><span class="lineno">  513</span> </div>
<div class="line"><span class="lineno">  514</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a>) {</div>
<div class="line"><span class="lineno">  515</span> </div>
<div class="line"><span class="lineno">  516</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>:</div>
<div class="line"><span class="lineno">  517</span>            <a class="code hl_function" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk</a>();</div>
<div class="line"><span class="lineno">  518</span>            <a class="code hl_function" href="kfs_8h.html#a3037ba33f12f2c2c99e099f9cc4a71e6">kfs_disk_save</a> (<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  519</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  520</span> </div>
<div class="line"><span class="lineno">  521</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>:</div>
<div class="line"><span class="lineno">  522</span>            <a class="code hl_function" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a> (<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  523</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#aebd6c8ef38afc2cfd9a6db1ed746e28d">OptF</a>) {</div>
<div class="line"><span class="lineno">  524</span>                <a class="code hl_function" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files</a>(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  525</span>            }</div>
<div class="line"><span class="lineno">  526</span>            <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  527</span>                <a class="code hl_function" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree</a>(<span class="stringliteral">&quot;/&quot;</span>);</div>
<div class="line"><span class="lineno">  528</span>            }</div>
<div class="line"><span class="lineno">  529</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  530</span> </div>
<div class="line"><span class="lineno">  531</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a>:</div>
<div class="line"><span class="lineno">  532</span>            <span class="comment">/* Add an MBR if one was provided */</span></div>
<div class="line"><span class="lineno">  533</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a>)</div>
<div class="line"><span class="lineno">  534</span>            {</div>
<div class="line"><span class="lineno">  535</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>) {</div>
<div class="line"><span class="lineno">  536</span>                    <a class="code hl_function" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a> (<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  537</span>                }</div>
<div class="line"><span class="lineno">  538</span>                <a class="code hl_function" href="kfs_8h.html#af88c339569eb51ffc1d94ee2324202f5">kfs_add_mbr</a>(<a class="code hl_variable" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a>);</div>
<div class="line"><span class="lineno">  539</span>            }</div>
<div class="line"><span class="lineno">  540</span> </div>
<div class="line"><span class="lineno">  541</span>            <span class="comment">/* Add a kernel bootloader if one was provided */</span></div>
<div class="line"><span class="lineno">  542</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a>)</div>
<div class="line"><span class="lineno">  543</span>            {</div>
<div class="line"><span class="lineno">  544</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>) {</div>
<div class="line"><span class="lineno">  545</span>                    <a class="code hl_function" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a> (<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  546</span>                }</div>
<div class="line"><span class="lineno">  547</span>                <a class="code hl_function" href="kfs_8h.html#a13b2ba4b6ae24b6b49ce962a44e4e5fa">kfs_add_vbr</a>(<a class="code hl_variable" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a>);</div>
<div class="line"><span class="lineno">  548</span>            }</div>
<div class="line"><span class="lineno">  549</span> </div>
<div class="line"><span class="lineno">  550</span>            <span class="comment">/* Build without any options = build from linux directory */</span></div>
<div class="line"><span class="lineno">  551</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a>) {</div>
<div class="line"><span class="lineno">  552</span> </div>
<div class="line"><span class="lineno">  553</span>                <span class="comment">/* Walk through the linux directory and write its content in kfs */</span></div>
<div class="line"><span class="lineno">  554</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>) nftw(<a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>, <a class="code hl_function" href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build</a>, 20, 0);</div>
<div class="line"><span class="lineno">  555</span>            }</div>
<div class="line"><span class="lineno">  556</span> </div>
<div class="line"><span class="lineno">  557</span>            <span class="comment">/* Build with c option = add a file to a pathname on an existing disk */</span></div>
<div class="line"><span class="lineno">  558</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a>)</div>
<div class="line"><span class="lineno">  559</span>            {</div>
<div class="line"><span class="lineno">  560</span>                <span class="comment">/* Charge the disk to modify in kfs (if it wasn&#39;t charged before) */</span></div>
<div class="line"><span class="lineno">  561</span>                <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a> || <a class="code hl_variable" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a>)) {</div>
<div class="line"><span class="lineno">  562</span>                    <span class="keywordflow">if</span> (<a class="code hl_function" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a> (<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>) &lt;= 0) {</div>
<div class="line"><span class="lineno">  563</span>                        <a class="code hl_function" href="libc_8c.html#a4e7edf0e8df09b47566d572e19dad429">fprintf</a> (stderr, <span class="stringliteral">&quot;Could not load %s\n&quot;</span>, <a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  564</span>                        <a class="code hl_function" href="klibc_8c.html#a55e99c539cf7723ec15e856b7e0a8cee">exit</a>(1);</div>
<div class="line"><span class="lineno">  565</span>                    }</div>
<div class="line"><span class="lineno">  566</span>                }</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>                <span class="comment">/* Create (or open) the pathname in kfs */</span></div>
<div class="line"><span class="lineno">  569</span>                <span class="keywordtype">int</span> kfs_dentry = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a>(<a class="code hl_variable" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a>);</div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>                <span class="comment">/* If the user provided a filename from the host, try to write its content in kfs */</span></div>
<div class="line"><span class="lineno">  572</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a>)</div>
<div class="line"><span class="lineno">  573</span>                {</div>
<div class="line"><span class="lineno">  574</span>                    <a class="code hl_function" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file</a>(<a class="code hl_variable" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a>, kfs_dentry);</div>
<div class="line"><span class="lineno">  575</span>                }</div>
<div class="line"><span class="lineno">  576</span>            }</div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>            <span class="comment">/* Lastly, save the new (or modified) kfs disk on host */</span></div>
<div class="line"><span class="lineno">  579</span>            <a class="code hl_function" href="kfs_8h.html#a3037ba33f12f2c2c99e099f9cc4a71e6">kfs_disk_save</a>(<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  582</span> </div>
<div class="line"><span class="lineno">  583</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a>:</div>
<div class="line"><span class="lineno">  584</span>            <span class="comment">/* First, load the kfs disk from host */</span></div>
<div class="line"><span class="lineno">  585</span>            <a class="code hl_function" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a> (<a class="code hl_variable" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>);</div>
<div class="line"><span class="lineno">  586</span> </div>
<div class="line"><span class="lineno">  587</span>            <span class="comment">/* Create the host directory where the kfs disk will be split */</span></div>
<div class="line"><span class="lineno">  588</span>            <span class="comment">//mkdir(DirName, 0777);</span></div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>            <span class="comment">/* Now we can walk through this kfs disk and write its content to the host directory */</span></div>
<div class="line"><span class="lineno">  591</span>            <a class="code hl_function" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb</a>(0, <a class="code hl_function" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split</a>);</div>
<div class="line"><span class="lineno">  592</span> </div>
<div class="line"><span class="lineno">  593</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  594</span>    }</div>
<div class="line"><span class="lineno">  595</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  596</span>}</div>
<div class="ttc" id="akfs_8h_html_a10f5dc158b1a0b3d2971a045df73aba4"><div class="ttname"><a href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a></div><div class="ttdeci">int kfs_disk_load(char *pathname)</div><div class="ttdoc">Loads the disk from an external support. On HOST It means from the host disk in file whose name is gi...</div></div>
<div class="ttc" id="akfs_8h_html_a13b2ba4b6ae24b6b49ce962a44e4e5fa"><div class="ttname"><a href="kfs_8h.html#a13b2ba4b6ae24b6b49ce962a44e4e5fa">kfs_add_vbr</a></div><div class="ttdeci">int kfs_add_vbr(char *pathname)</div><div class="ttdoc">Loads a VBR in kfs. Meant to be used exclusively on Linux.</div></div>
<div class="ttc" id="akfs_8h_html_a3037ba33f12f2c2c99e099f9cc4a71e6"><div class="ttname"><a href="kfs_8h.html#a3037ba33f12f2c2c99e099f9cc4a71e6">kfs_disk_save</a></div><div class="ttdeci">int kfs_disk_save(char *pathname)</div><div class="ttdoc">Saves the disk to an external support. On HOST It means to the host disk in a file whose name is give...</div></div>
<div class="ttc" id="akfs_8h_html_af88c339569eb51ffc1d94ee2324202f5"><div class="ttname"><a href="kfs_8h.html#af88c339569eb51ffc1d94ee2324202f5">kfs_add_mbr</a></div><div class="ttdeci">int kfs_add_mbr(char *pathname)</div><div class="ttdoc">Loads a 512 bytes sized MBR in kfs. Meant to be used exclusively on Linux.</div></div>
<div class="ttc" id="aklibc_8c_html_a55e99c539cf7723ec15e856b7e0a8cee"><div class="ttname"><a href="klibc_8c.html#a55e99c539cf7723ec15e856b7e0a8cee">exit</a></div><div class="ttdeci">void exit(int status)</div><div class="ttdoc">exit the application, thus never returns</div><div class="ttdef"><b>Definition:</b> klibc.c:48</div></div>
<div class="ttc" id="aktools_8c_html_a16c0ecb37b34e241fab9b9be0ebf7c6f"><div class="ttname"><a href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split</a></div><div class="ttdeci">void split(int dentry, int depth, int position)</div><div class="ttdef"><b>Definition:</b> ktools.c:364</div></div>
<div class="ttc" id="aktools_8c_html_a2acd3e2ba6581eac5ff5e2a78ffa9bd8"><div class="ttname"><a href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files</a></div><div class="ttdeci">void kfs_files(char *name)</div><div class="ttdef"><b>Definition:</b> ktools.c:207</div></div>
<div class="ttc" id="aktools_8c_html_a521c1fd005bd6738b695d604843e880c"><div class="ttname"><a href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build</a></div><div class="ttdeci">int build(const char *fpath, const struct stat *sb, int typeflag, struct FTW *ftwbuf)</div><div class="ttdef"><b>Definition:</b> ktools.c:310</div></div>
<div class="ttc" id="aktools_8c_html_a78949f4960804d06e92c2b349740243f"><div class="ttname"><a href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption</a></div><div class="ttdeci">void getoption(int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> ktools.c:430</div></div>
<div class="ttc" id="aktools_8c_html_a9b68125aeb10ab39a0981d0fa952d5f1"><div class="ttname"><a href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk</a></div><div class="ttdeci">void dummy_disk(void)</div><div class="ttdef"><b>Definition:</b> ktools.c:223</div></div>
<div class="ttc" id="alibc_8c_html_a4e7edf0e8df09b47566d572e19dad429"><div class="ttname"><a href="libc_8c.html#a4e7edf0e8df09b47566d572e19dad429">fprintf</a></div><div class="ttdeci">int fprintf(int tty, char *fmt,...)</div><div class="ttdoc">this a simplified version which handles only: c, s, $d, x and p</div><div class="ttdef"><b>Definition:</b> libc.c:137</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, <a class="el" href="ktools_8c.html#ad451cda91ce9d9c54ee261e4ec46e2c8">BootFileName</a>, <a class="el" href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build()</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7abe5042abe8925c9b3380ecf640e0dbb5">CMD_BUILD</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7acc2f3b19c5bbec83097b74381140e7b5">CMD_DUMMY</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a278084d57649cc0a06ae05c78b386921">CMD_SPLIT</a>, <a class="el" href="ktools_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4b6f12944d559bcc2af5d9d1f92c8457">CMD_TREE</a>, <a class="el" href="ktools_8c.html#a36c5506122899541315d168541f135f6">Command</a>, <a class="el" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>, <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, <a class="el" href="klibc_8c.html#a55e99c539cf7723ec15e856b7e0a8cee">exit()</a>, <a class="el" href="libc_8c.html#a4e7edf0e8df09b47566d572e19dad429">fprintf()</a>, <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, <a class="el" href="kfs_8h.html#af88c339569eb51ffc1d94ee2324202f5">kfs_add_mbr()</a>, <a class="el" href="kfs_8h.html#a13b2ba4b6ae24b6b49ce962a44e4e5fa">kfs_add_vbr()</a>, <a class="el" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load()</a>, <a class="el" href="kfs_8h.html#a3037ba33f12f2c2c99e099f9cc4a71e6">kfs_disk_save()</a>, <a class="el" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree()</a>, <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>, <a class="el" href="ktools_8c.html#af66cf6e5961e8522172d89532df9db9d">KfsDiskName</a>, <a class="el" href="ktools_8c.html#a58ccf99eba46ba1428531b6cab7fe47d">MbrFileName</a>, <a class="el" href="ktools_8c.html#a12af974a09824ae8357cae0737368e61">OptCNewFile</a>, <a class="el" href="ktools_8c.html#a9267a5326b000eb299265df069cdcaf7">OptCPathname</a>, <a class="el" href="ktools_8c.html#aebd6c8ef38afc2cfd9a6db1ed746e28d">OptF</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="aa7d303778c484a349f2ab87908905577" name="aa7d303778c484a349f2ab87908905577"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7d303778c484a349f2ab87908905577">&#9670;&#160;</a></span>mess()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * mess </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  217</span>{</div>
<div class="line"><span class="lineno">  218</span>    <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a> (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 0, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  219</span>    sprintf (<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <span class="stringliteral">&quot;%s&quot;</span>, s);</div>
<div class="line"><span class="lineno">  220</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>;</div>
<div class="line"><span class="lineno">  221</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, and <a class="el" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>

</div>
</div>
<a id="a16c0ecb37b34e241fab9b9be0ebf7c6f" name="a16c0ecb37b34e241fab9b9be0ebf7c6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16c0ecb37b34e241fab9b9be0ebf7c6f">&#9670;&#160;</a></span>split()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void split </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>position</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  365</span>{</div>
<div class="line"><span class="lineno">  366</span>    <span class="comment">/* If this is the root, nothing needs to be done */</span></div>
<div class="line"><span class="lineno">  367</span>    <span class="keywordflow">if</span> (!dentry) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  368</span> </div>
<div class="line"><span class="lineno">  369</span>    <span class="comment">/* Get inode information about this dentry and create the string for the new pathname on host */</span></div>
<div class="line"><span class="lineno">  370</span>    <span class="keywordtype">int</span> inode = <a class="code hl_function" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);</div>
<div class="line"><span class="lineno">  371</span>    <span class="keywordtype">int</span> size = <a class="code hl_function" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode);</div>
<div class="line"><span class="lineno">  372</span>    <span class="keywordtype">char</span>* absolute = <a class="code hl_function" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname</a>(dentry);</div>
<div class="line"><span class="lineno">  373</span>    <span class="keywordtype">char</span>* new_path = <a class="code hl_function" href="memory_8c.html#a9c36d0fe3ec4675cbffdc9b52f5fb399">malloc</a>(<a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(absolute) + <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(<a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>) + 1);</div>
<div class="line"><span class="lineno">  374</span>    <a class="code hl_function" href="cstd_8c.html#a8c530adfbb0a41bb842649393a223032">strncpy</a>(new_path, <a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>, <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(<a class="code hl_variable" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>));</div>
<div class="line"><span class="lineno">  375</span>    strcat(new_path, absolute);</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>    printf(<span class="stringliteral">&quot;%s\n&quot;</span>, new_path);</div>
<div class="line"><span class="lineno">  378</span> </div>
<div class="line"><span class="lineno">  379</span>    <span class="comment">/* If it is a directory, create it on host */</span></div>
<div class="line"><span class="lineno">  380</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a>(inode) == <a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>)</div>
<div class="line"><span class="lineno">  381</span>    {</div>
<div class="line"><span class="lineno">  382</span>        mkdir(new_path, 0777);</div>
<div class="line"><span class="lineno">  383</span>        <a class="code hl_function" href="memory_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a>(new_path);</div>
<div class="line"><span class="lineno">  384</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  385</span>    }</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>    <span class="comment">/* If it is a file, create it and write its content on host */</span></div>
<div class="line"><span class="lineno">  388</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a>(inode) == <a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>)</div>
<div class="line"><span class="lineno">  389</span>    {</div>
<div class="line"><span class="lineno">  390</span>        <span class="keywordtype">int</span> fd = open(new_path, O_RDWR | O_CREAT | O_TRUNC, 0666);</div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordtype">int</span> page_offset = 0;</div>
<div class="line"><span class="lineno">  392</span>        <span class="comment">/* Write every page but the last */</span></div>
<div class="line"><span class="lineno">  393</span>        <span class="keywordflow">while</span>(((page_offset&lt;&lt;12) + (1&lt;&lt;12)) &lt;= size)</div>
<div class="line"><span class="lineno">  394</span>        {</div>
<div class="line"><span class="lineno">  395</span>            <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a>(<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 0, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  396</span>            <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a>(dentry, page_offset, (<span class="keywordtype">void</span>*) <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>);</div>
<div class="line"><span class="lineno">  397</span>            <a class="code hl_function" href="libc_8c.html#a18e0c7fef99a23c9dcf7269da9e6bfc7">write</a>(fd, <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  398</span>            page_offset++;</div>
<div class="line"><span class="lineno">  399</span>        }</div>
<div class="line"><span class="lineno">  400</span>        <span class="comment">/* Write the last page */</span></div>
<div class="line"><span class="lineno">  401</span>        <a class="code hl_function" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset</a>(<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, 0, 1&lt;&lt;12);</div>
<div class="line"><span class="lineno">  402</span>        <a class="code hl_function" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a>(dentry, page_offset, (<span class="keywordtype">void</span>*) <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>);</div>
<div class="line"><span class="lineno">  403</span>        <a class="code hl_function" href="libc_8c.html#a18e0c7fef99a23c9dcf7269da9e6bfc7">write</a>(fd, <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <a class="code hl_function" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen</a>(<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>));</div>
<div class="line"><span class="lineno">  404</span> </div>
<div class="line"><span class="lineno">  405</span>        <a class="code hl_function" href="memory_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a>(new_path);</div>
<div class="line"><span class="lineno">  406</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  407</span>    }</div>
<div class="line"><span class="lineno">  408</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, <a class="el" href="ktools_8c.html#a68cc4e6509205eeddea8429d2c05f2fe">DirName</a>, <a class="el" href="memory_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free()</a>, <a class="el" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname()</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>, <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type()</a>, <a class="el" href="memory_8c.html#a9c36d0fe3ec4675cbffdc9b52f5fb399">malloc()</a>, <a class="el" href="cstd_8c.html#a72a7d1b36c78a71835b240833f7ed4d0">memset()</a>, <a class="el" href="cstd_8c.html#a54684bded3e61e2d78d490650f9b706a">strlen()</a>, <a class="el" href="cstd_8c.html#a8c530adfbb0a41bb842649393a223032">strncpy()</a>, and <a class="el" href="libc_8c.html#a18e0c7fef99a23c9dcf7269da9e6bfc7">write()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a5ffaef3fc3f7ddb9856ccd4bcb79e9bc" name="a5ffaef3fc3f7ddb9856ccd4bcb79e9bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ffaef3fc3f7ddb9856ccd4bcb79e9bc">&#9670;&#160;</a></span>strdup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * strdup </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>.</p>

</div>
</div>
<a id="ae8605e2b78cd4a81b6c6b5c30cb7366a" name="ae8605e2b78cd4a81b6c6b5c30cb7366a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8605e2b78cd4a81b6c6b5c30cb7366a">&#9670;&#160;</a></span>usage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void usage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  415</span>{</div>
<div class="line"><span class="lineno">  416</span>    printf (<span class="stringliteral">&quot;\nUsage : %s [-h] [-v level] [-m mbr] [-b boot] [-c pathname]\n&quot;</span>, <a class="code hl_variable" href="ktools_8c.html#ab4fad31452ea2612bd37240026dd6e44">Argv</a>[0]);</div>
<div class="line"><span class="lineno">  417</span>    printf (<span class="stringliteral">&quot;                  &lt;command&gt; &lt;kfsd&gt; [dir]\n\n&quot;</span>);</div>
<div class="line"><span class="lineno">  418</span>    printf (<span class="stringliteral">&quot;         -h  this help\n&quot;</span>);</div>
<div class="line"><span class="lineno">  419</span>    printf (<span class="stringliteral">&quot;         -v  verbose mode level (0, 1, 2)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  420</span>    printf (<span class="stringliteral">&quot;     -m mbr  mbr executable file\n&quot;</span>);</div>
<div class="line"><span class="lineno">  421</span>    printf (<span class="stringliteral">&quot;    -b boot  bootloader executable file\n&quot;</span>);</div>
<div class="line"><span class="lineno">  422</span>    <span class="comment">//printf (&quot; -c pathname copy file pathname\n&quot;);</span></div>
<div class="line"><span class="lineno">  423</span>    printf (<span class="stringliteral">&quot;    command  &lt; tree | build | split | dummy &gt;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  424</span>    printf (<span class="stringliteral">&quot;       kfsd  kfs disk name (with .kfs extension) \n&quot;</span>);</div>
<div class="line"><span class="lineno">  425</span>    printf (<span class="stringliteral">&quot;        dir  Linux directory\n&quot;</span>);</div>
<div class="line"><span class="lineno">  426</span>    printf (<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"><span class="lineno">  427</span>    <a class="code hl_function" href="klibc_8c.html#a55e99c539cf7723ec15e856b7e0a8cee">exit</a> (1);</div>
<div class="line"><span class="lineno">  428</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#ab4fad31452ea2612bd37240026dd6e44">Argv</a>, and <a class="el" href="klibc_8c.html#a55e99c539cf7723ec15e856b7e0a8cee">exit()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a34296df812d7c5468ae201c7eeca5877" name="a34296df812d7c5468ae201c7eeca5877"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34296df812d7c5468ae201c7eeca5877">&#9670;&#160;</a></span>Argc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Argc</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>.</p>

</div>
</div>
<a id="ab4fad31452ea2612bd37240026dd6e44" name="ab4fad31452ea2612bd37240026dd6e44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4fad31452ea2612bd37240026dd6e44">&#9670;&#160;</a></span>Argv</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** Argv</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#ae8605e2b78cd4a81b6c6b5c30cb7366a">usage()</a>.</p>

</div>
</div>
<a id="ad451cda91ce9d9c54ee261e4ec46e2c8" name="ad451cda91ce9d9c54ee261e4ec46e2c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad451cda91ce9d9c54ee261e4ec46e2c8">&#9670;&#160;</a></span>BootFileName</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* BootFileName</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a527b76b33fb8beec7f2df7e0c032aef6" name="a527b76b33fb8beec7f2df7e0c032aef6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a527b76b33fb8beec7f2df7e0c032aef6">&#9670;&#160;</a></span>buffer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">char buffer[1&lt;&lt; 12]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, <a class="el" href="libc_8c.html#a4e7edf0e8df09b47566d572e19dad429">fprintf()</a>, <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, <a class="el" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page()</a>, <a class="el" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf()</a>, <a class="el" href="ktools_8c.html#aa7d303778c484a349f2ab87908905577">mess()</a>, <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>, and <a class="el" href="cstd_8c.html#ab56fe2f857808faedb93ce52c7010181">vsnprintf()</a>.</p>

</div>
</div>
<a id="a36c5506122899541315d168541f135f6" name="a36c5506122899541315d168541f135f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36c5506122899541315d168541f135f6">&#9670;&#160;</a></span>Command</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Command</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a68cc4e6509205eeddea8429d2c05f2fe" name="a68cc4e6509205eeddea8429d2c05f2fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68cc4e6509205eeddea8429d2c05f2fe">&#9670;&#160;</a></span>DirName</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* DirName</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="af66cf6e5961e8522172d89532df9db9d" name="af66cf6e5961e8522172d89532df9db9d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af66cf6e5961e8522172d89532df9db9d">&#9670;&#160;</a></span>KfsDiskName</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* KfsDiskName</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a58ccf99eba46ba1428531b6cab7fe47d" name="a58ccf99eba46ba1428531b6cab7fe47d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58ccf99eba46ba1428531b6cab7fe47d">&#9670;&#160;</a></span>MbrFileName</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* MbrFileName</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a12af974a09824ae8357cae0737368e61" name="a12af974a09824ae8357cae0737368e61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12af974a09824ae8357cae0737368e61">&#9670;&#160;</a></span>OptCNewFile</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* OptCNewFile</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a9267a5326b000eb299265df069cdcaf7" name="a9267a5326b000eb299265df069cdcaf7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9267a5326b000eb299265df069cdcaf7">&#9670;&#160;</a></span>OptCPathname</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* OptCPathname</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="aebd6c8ef38afc2cfd9a6db1ed746e28d" name="aebd6c8ef38afc2cfd9a6db1ed746e28d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebd6c8ef38afc2cfd9a6db1ed746e28d">&#9670;&#160;</a></span>OptF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int OptF = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a95f627d7054b1abbffa2c6ea19bf05db" name="a95f627d7054b1abbffa2c6ea19bf05db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95f627d7054b1abbffa2c6ea19bf05db">&#9670;&#160;</a></span>Verbose</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Verbose</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a78949f4960804d06e92c2b349740243f">getoption()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
