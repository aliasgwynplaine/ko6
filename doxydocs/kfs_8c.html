<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ko6: src/soft/fs/kfs/kfs.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo55.png"/></td>
  <td id="projectalign">
   <div id="projectname">ko6
   </div>
   <div id="projectbrief">ko6 (prononce it &#39;kit-O-sys&#39; O is  the letter not the number) is a small operating system for educationnal purpose</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8785740846211ac34fd04c61a1fdd888.html">soft</a></li><li class="navelem"><a class="el" href="dir_c9f83417c2b3f935a5ca497b28346c08.html">fs</a></li><li class="navelem"><a class="el" href="dir_84ebf85154e4c8e3a85777d360bfb661.html">kfs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">kfs.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="kfs_8h_source.html">kfs.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkfs__dentry__s.html">kfs_dentry_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkfs__inode__s.html">kfs_inode_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkfs__mbr__s.html">kfs_mbr_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkfs__sblock__s.html">kfs_sblock_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a070d2ce7b6bb7e5c05602aa8c308d0c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>&#160;&#160;&#160;(void *)0</td></tr>
<tr class="separator:a070d2ce7b6bb7e5c05602aa8c308d0c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0b389bdf68187ccb1610271d36edb33"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ae0b389bdf68187ccb1610271d36edb33">KFS_MAX_NAME</a>&#160;&#160;&#160;28      /* dentry name length */</td></tr>
<tr class="separator:ae0b389bdf68187ccb1610271d36edb33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92ab7d744c9853bdebee5c81ac2b422f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a92ab7d744c9853bdebee5c81ac2b422f">KFS_MAX_DENTRY</a>&#160;&#160;&#160;((<a class="el" href="kfs_8h.html#a012e85f2bb85ec2d5bdff1d298929018">KFS_NPG_DENTRY</a>&lt;&lt;12)/sizeof(<a class="el" href="kfs_8c.html#ae4356b2f3be21f839915b3bae8530b06">kfs_dentry_t</a>)) /* number of dentries */</td></tr>
<tr class="separator:a92ab7d744c9853bdebee5c81ac2b422f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac084ea319e447d4af876044655fc46ec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a>&#160;&#160;&#160;((<a class="el" href="kfs_8h.html#a93b1915cf843dbd16b8d274ee4751acb">KFS_NPG_INODE</a> &lt;&lt;12)/sizeof(<a class="el" href="kfs_8c.html#abac7f4a360f61a2ce1f34b6e6b6028ff">kfs_inode_t</a>))  /* number of inodes */</td></tr>
<tr class="separator:ac084ea319e447d4af876044655fc46ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75563572783e6a8183fe1fa127b6453d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a75563572783e6a8183fe1fa127b6453d">KFS_MAX_FMAP</a>&#160;&#160;&#160;((<a class="el" href="kfs_8h.html#ae070eb53d573680911159a7cbb4b90e2">KFS_NPG_FMAP</a>  &lt;&lt;12)/sizeof(<a class="el" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a>))   /* number of file maps */</td></tr>
<tr class="separator:a75563572783e6a8183fe1fa127b6453d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0ae18eb635e6562531a287fb89dd996"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#af0ae18eb635e6562531a287fb89dd996">NPGU</a>&#160;&#160;&#160;(<a class="el" href="kfs_8h.html#a75d29f6159278cfe6da1ae6fefb40c46">KFS_NPG_BOOT</a>+<a class="el" href="kfs_8h.html#a2fc604f5c0a4a2971369642c96f07abf">KFS_NPG_META</a>)            /* number of pages used by BOOT and META */</td></tr>
<tr class="separator:af0ae18eb635e6562531a287fb89dd996"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a0c0a490ab7fa397be6c764a935cc5ea4"><td class="memItemLeft" align="right" valign="top">typedef unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a></td></tr>
<tr class="separator:a0c0a490ab7fa397be6c764a935cc5ea4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc6499c1f28697aa3bfc2804d496fd11"><td class="memItemLeft" align="right" valign="top">typedef unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></td></tr>
<tr class="separator:afc6499c1f28697aa3bfc2804d496fd11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae081489b4906f65a3cb18e9fbe9f8d23"><td class="memItemLeft" align="right" valign="top">typedef unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a></td></tr>
<tr class="separator:ae081489b4906f65a3cb18e9fbe9f8d23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d27dc3b3d920629ee0d10b6f7bbe427"><td class="memItemLeft" align="right" valign="top">typedef signed int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a2d27dc3b3d920629ee0d10b6f7bbe427">i32_t</a></td></tr>
<tr class="separator:a2d27dc3b3d920629ee0d10b6f7bbe427"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cf7c777695c7e20328dc1bcd41914eb"><td class="memItemLeft" align="right" valign="top">typedef signed short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a8cf7c777695c7e20328dc1bcd41914eb">i16_t</a></td></tr>
<tr class="separator:a8cf7c777695c7e20328dc1bcd41914eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0202ec8eca2f399b9a57c31194a5f28"><td class="memItemLeft" align="right" valign="top">typedef signed char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ae0202ec8eca2f399b9a57c31194a5f28">i8_t</a></td></tr>
<tr class="separator:ae0202ec8eca2f399b9a57c31194a5f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4356b2f3be21f839915b3bae8530b06"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structkfs__dentry__s.html">kfs_dentry_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ae4356b2f3be21f839915b3bae8530b06">kfs_dentry_t</a></td></tr>
<tr class="separator:ae4356b2f3be21f839915b3bae8530b06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abac7f4a360f61a2ce1f34b6e6b6028ff"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structkfs__inode__s.html">kfs_inode_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#abac7f4a360f61a2ce1f34b6e6b6028ff">kfs_inode_t</a></td></tr>
<tr class="separator:abac7f4a360f61a2ce1f34b6e6b6028ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7db204b3134ab7e4824022eec748871c"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a>[16]</td></tr>
<tr class="memdesc:a7db204b3134ab7e4824022eec748871c"><td class="mdescLeft">&#160;</td><td class="mdescRight">fmap as inode extension, maps until 16 pages or 16 other fmaps  <br /></td></tr>
<tr class="separator:a7db204b3134ab7e4824022eec748871c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dd7d67d3275b2a85f607922acdfbc28"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structkfs__mbr__s.html">kfs_mbr_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a2dd7d67d3275b2a85f607922acdfbc28">kfs_mbr_t</a></td></tr>
<tr class="separator:a2dd7d67d3275b2a85f607922acdfbc28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39d79370e49d3416fb6e2e05d4c40881"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structkfs__sblock__s.html">kfs_sblock_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a39d79370e49d3416fb6e2e05d4c40881">kfs_sblock_t</a></td></tr>
<tr class="separator:a39d79370e49d3416fb6e2e05d4c40881"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a202fc39d0ae25edf80b1c54902014eb1"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a202fc39d0ae25edf80b1c54902014eb1">kfs_page_t</a>[1024]</td></tr>
<tr class="memdesc:a202fc39d0ae25edf80b1c54902014eb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">atomic data segment exchanged with the disk  <br /></td></tr>
<tr class="separator:a202fc39d0ae25edf80b1c54902014eb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ade5bf93265bc86a9ecd5019cc6e3d277"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root</a> (int dentry)</td></tr>
<tr class="memdesc:ade5bf93265bc86a9ecd5019cc6e3d277"><td class="mdescLeft">&#160;</td><td class="mdescRight">read access functions to dentries  <br /></td></tr>
<tr class="separator:ade5bf93265bc86a9ecd5019cc6e3d277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3be0d586ff3044979a3c381137d77d47"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a3be0d586ff3044979a3c381137d77d47">kfs_next</a> (int dentry)</td></tr>
<tr class="separator:a3be0d586ff3044979a3c381137d77d47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a135f3848117282c89e3be09b930eb9de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf</a> (int dentry)</td></tr>
<tr class="separator:a135f3848117282c89e3be09b930eb9de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae206d59d8bc4514d34dafdff1198ede"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a> (int dentry)</td></tr>
<tr class="separator:aae206d59d8bc4514d34dafdff1198ede"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c752ffc3e5d008879e7035508bac847"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name</a> (int dentry)</td></tr>
<tr class="separator:a2c752ffc3e5d008879e7035508bac847"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2308b1a426032672fbacdde9ee5ac81"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a> (int dentry)</td></tr>
<tr class="memdesc:ac2308b1a426032672fbacdde9ee5ac81"><td class="mdescLeft">&#160;</td><td class="mdescRight">boolean functions for dentries or inode  <br /></td></tr>
<tr class="separator:ac2308b1a426032672fbacdde9ee5ac81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa0d81604e0d3d23f31b3beb7dcb163c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#aaa0d81604e0d3d23f31b3beb7dcb163c">kfs_count</a> (int inode)</td></tr>
<tr class="memdesc:aaa0d81604e0d3d23f31b3beb7dcb163c"><td class="mdescLeft">&#160;</td><td class="mdescRight">read access functions to inodes  <br /></td></tr>
<tr class="separator:aaa0d81604e0d3d23f31b3beb7dcb163c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d546cf291d26ab01a150b74cc206ae1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a> (int inode)</td></tr>
<tr class="separator:a8d546cf291d26ab01a150b74cc206ae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9581ae711d5f79aff1ed39c9739e80c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a> (int inode)</td></tr>
<tr class="separator:ac9581ae711d5f79aff1ed39c9739e80c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e7cb7a15052f57bdff8a2c1146bc072"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a> (int inode)</td></tr>
<tr class="separator:a2e7cb7a15052f57bdff8a2c1146bc072"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f522cb4edeecd6cbcebcca31d90bc75"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a2f522cb4edeecd6cbcebcca31d90bc75">kfs_owner</a> (int inode)</td></tr>
<tr class="separator:a2f522cb4edeecd6cbcebcca31d90bc75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b41dd15430924703df46a579ff05b2e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a9b41dd15430924703df46a579ff05b2e">kfs_mtime</a> (int inode)</td></tr>
<tr class="separator:a9b41dd15430924703df46a579ff05b2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30d4e1ffe8c1ea75120811fcf3055c05"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a30d4e1ffe8c1ea75120811fcf3055c05">kfs_chmode</a> (int inode, int mode)</td></tr>
<tr class="memdesc:a30d4e1ffe8c1ea75120811fcf3055c05"><td class="mdescLeft">&#160;</td><td class="mdescRight">write access functions to inode's properties  <br /></td></tr>
<tr class="separator:a30d4e1ffe8c1ea75120811fcf3055c05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e380775665de4ff6cbc01555444cb64"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a3e380775665de4ff6cbc01555444cb64">kfs_chowner</a> (int inode, int owner)</td></tr>
<tr class="separator:a3e380775665de4ff6cbc01555444cb64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68786a19dcb587fe18b45ae76effa1c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a68786a19dcb587fe18b45ae76effa1c5">kfs_chmtime</a> (int inode, int mtime)</td></tr>
<tr class="separator:a68786a19dcb587fe18b45ae76effa1c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07490daa1f981c16ba1a77314a95a639"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a07490daa1f981c16ba1a77314a95a639">kfs_getname</a> (char *pathname)</td></tr>
<tr class="memdesc:a07490daa1f981c16ba1a77314a95a639"><td class="mdescLeft">&#160;</td><td class="mdescRight">get name from pathname up to character '/' pathname argument is not destroyed. Function NON-reentrant  <br /></td></tr>
<tr class="separator:a07490daa1f981c16ba1a77314a95a639"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aceb626dd864e7f2ccd7901d0506dbaf4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy</a> (char *dest, char *src)</td></tr>
<tr class="memdesc:aceb626dd864e7f2ccd7901d0506dbaf4"><td class="mdescLeft">&#160;</td><td class="mdescRight">copy a string of characters  <br /></td></tr>
<tr class="separator:aceb626dd864e7f2ccd7901d0506dbaf4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09fba9a0bb78a0f1f159c01046c7e006"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a> (const char *s1, const char *s2)</td></tr>
<tr class="memdesc:a09fba9a0bb78a0f1f159c01046c7e006"><td class="mdescLeft">&#160;</td><td class="mdescRight">compare two strings of characters  <br /></td></tr>
<tr class="separator:a09fba9a0bb78a0f1f159c01046c7e006"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac54d7e40a14d08ab189631215fb3a4cc"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap</a> (<a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a> bitmap[], <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *start, <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> max)</td></tr>
<tr class="memdesc:ac54d7e40a14d08ab189631215fb3a4cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">bitmap allocator  <br /></td></tr>
<tr class="separator:ac54d7e40a14d08ab189631215fb3a4cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a664e5f5072f4e5d09eb7f328b39bcec3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap</a> (<a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a> bitmap[], <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *start, <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> bit)</td></tr>
<tr class="memdesc:a664e5f5072f4e5d09eb7f328b39bcec3"><td class="mdescLeft">&#160;</td><td class="mdescRight">releases one bit of a bitmap  <br /></td></tr>
<tr class="separator:a664e5f5072f4e5d09eb7f328b39bcec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66ffc964d30c5258826714ac181af25a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry</a> (char *name)</td></tr>
<tr class="memdesc:a66ffc964d30c5258826714ac181af25a"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocates a new dentry, dentry 0 is for '/' thus it is never free  <br /></td></tr>
<tr class="separator:a66ffc964d30c5258826714ac181af25a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d172bef33b255bfe7ec0375abac988e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry</a> (<a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dentry)</td></tr>
<tr class="memdesc:a5d172bef33b255bfe7ec0375abac988e"><td class="mdescLeft">&#160;</td><td class="mdescRight">frees a dentry (it is not necessary to erase its content, it will be done in allocation)  <br /></td></tr>
<tr class="separator:a5d172bef33b255bfe7ec0375abac988e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7d3799e6e7b1822350af7f957f63db1"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode</a> (<a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a> type)</td></tr>
<tr class="memdesc:ad7d3799e6e7b1822350af7f957f63db1"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocates a new inode, inode 0 is for '/' thus it is never free  <br /></td></tr>
<tr class="separator:ad7d3799e6e7b1822350af7f957f63db1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadbe9ab58b58e9826dd4da1384c80798"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a> (int inode)</td></tr>
<tr class="memdesc:aadbe9ab58b58e9826dd4da1384c80798"><td class="mdescLeft">&#160;</td><td class="mdescRight">frees an inode (it is not necessary to erase it, it will be done in allocation)  <br /></td></tr>
<tr class="separator:aadbe9ab58b58e9826dd4da1384c80798"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4899d84042ad3892c13dc7a360f65d86"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap</a> (void)</td></tr>
<tr class="memdesc:a4899d84042ad3892c13dc7a360f65d86"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocates a new map, map 0 is never free  <br /></td></tr>
<tr class="separator:a4899d84042ad3892c13dc7a360f65d86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b773f0350f13077e1479fe36941da52"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a> (<a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> fmap)</td></tr>
<tr class="memdesc:a2b773f0350f13077e1479fe36941da52"><td class="mdescLeft">&#160;</td><td class="mdescRight">frees a map  <br /></td></tr>
<tr class="separator:a2b773f0350f13077e1479fe36941da52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53fd0386d2feed317c9d6bdc536e4540"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page</a> (void)</td></tr>
<tr class="memdesc:a53fd0386d2feed317c9d6bdc536e4540"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocates a new page of the disk  <br /></td></tr>
<tr class="separator:a53fd0386d2feed317c9d6bdc536e4540"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac364ca8f5189a2eaf2f7cbeef0a27698"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a> (<a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> page)</td></tr>
<tr class="memdesc:ac364ca8f5189a2eaf2f7cbeef0a27698"><td class="mdescLeft">&#160;</td><td class="mdescRight">frees a page of the disk  <br /></td></tr>
<tr class="separator:ac364ca8f5189a2eaf2f7cbeef0a27698"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af148b22d686f5b43341249ba9d03eb54"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap</a> (int inode)</td></tr>
<tr class="separator:af148b22d686f5b43341249ba9d03eb54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdc75626536d311fb2fe47baef24ef55"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a> (int inode, int pg_offset)</td></tr>
<tr class="separator:afdc75626536d311fb2fe47baef24ef55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f523fed1e918f807739ab6ee760d270"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage</a> (<a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> inode, <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> pg_offset)</td></tr>
<tr class="separator:a6f523fed1e918f807739ab6ee760d270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23a78b350153b3b7ae5ca00a1de7484a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page</a> (int *buf, <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> page)</td></tr>
<tr class="memdesc:a23a78b350153b3b7ae5ca00a1de7484a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads from the disk to the memory buffer. There are two cases : 1) if kfs runs on Linux 2) if kfs runs on ko6 1) Linux: the kfs disk has been loaded in an array, so that's where we have to read it 2) ko6: the kfs disk is behind the disk device, so we need to ask the disk driver.  <br /></td></tr>
<tr class="separator:a23a78b350153b3b7ae5ca00a1de7484a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82cd5257064f4d5b995d6951b9f054b3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page</a> (void *buf, int page)</td></tr>
<tr class="memdesc:a82cd5257064f4d5b995d6951b9f054b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">writes to the disk from the memory buffer  <br /></td></tr>
<tr class="separator:a82cd5257064f4d5b995d6951b9f054b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af01886bc6c6c809f5f46eda025ef5ec3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r</a> (int root, int depth, void(*callback)(int dentry, int depth, int pos))</td></tr>
<tr class="memdesc:af01886bc6c6c809f5f46eda025ef5ec3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recursively executes the callback() function for all entries in a directory. This is a deep-first walk. The callback() function is not executed on the root. _cb_r means "call back recursive" This function must not be used directly, it is used by <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>  <br /></td></tr>
<tr class="separator:af01886bc6c6c809f5f46eda025ef5ec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7986c65e8710a8b55857582e62ccc78"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (char *pathname)</td></tr>
<tr class="memdesc:ac7986c65e8710a8b55857582e62ccc78"><td class="mdescLeft">&#160;</td><td class="mdescRight">opens a file or directory, if file or directory not found, all the pathname is created  <br /></td></tr>
<tr class="separator:ac7986c65e8710a8b55857582e62ccc78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bf1c4cc42e02a99529eefc02cf53c4b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (int root, char *name)</td></tr>
<tr class="memdesc:a5bf1c4cc42e02a99529eefc02cf53c4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">looks for name in the directory root, if the name is not found, it is created  <br /></td></tr>
<tr class="separator:a5bf1c4cc42e02a99529eefc02cf53c4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee8d1799ae389468763ccfbe157c42ec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir</a> (int root, int leaf, void *buf)</td></tr>
<tr class="memdesc:aee8d1799ae389468763ccfbe157c42ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading, buffer will contain the name of the directory or item.  <br /></td></tr>
<tr class="separator:aee8d1799ae389468763ccfbe157c42ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a532e7e965bd6809645bdf682ffd509dc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read</a> (int dentry, int pg_offset, int *buf)</td></tr>
<tr class="memdesc:a532e7e965bd6809645bdf682ffd509dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a file, it reads one page from the file dentry to memory buffer. After reading, buffer will contain the entire page of which the offset belongs.  <br /></td></tr>
<tr class="separator:a532e7e965bd6809645bdf682ffd509dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a491e452cdf42853498249aadc91eb74b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a> (int dentry, int newsize)</td></tr>
<tr class="memdesc:a491e452cdf42853498249aadc91eb74b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the size field of the inode associated with the dentry to newsize.  <br /></td></tr>
<tr class="separator:a491e452cdf42853498249aadc91eb74b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57b5123b2f69a99505a7f3026eeefce9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write</a> (int dentry, int pg_offset, void *buf)</td></tr>
<tr class="memdesc:a57b5123b2f69a99505a7f3026eeefce9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of which the offset belongs.  <br /></td></tr>
<tr class="separator:a57b5123b2f69a99505a7f3026eeefce9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fa0207fb8a04e889050f380b9068e3a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link</a> (char *src_name, char *dst_name)</td></tr>
<tr class="memdesc:a4fa0207fb8a04e889050f380b9068e3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">creates a new link (also called hard link) on an existing file.  <br /></td></tr>
<tr class="separator:a4fa0207fb8a04e889050f380b9068e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46783800e799435356d388150e2a5cec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink</a> (char *name)</td></tr>
<tr class="separator:a46783800e799435356d388150e2a5cec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c8753d9a11f6570f9c56b587fa2c48c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb</a> (int root, void(*callback)(int dentry, int depth, int postion))</td></tr>
<tr class="separator:a0c8753d9a11f6570f9c56b587fa2c48c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:accc11417a4eed24097de41cf088d420b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#a39d79370e49d3416fb6e2e05d4c40881">kfs_sblock_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a></td></tr>
<tr class="separator:accc11417a4eed24097de41cf088d420b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c9c9ecc30db3a783a700f4e79f9561e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#ae4356b2f3be21f839915b3bae8530b06">kfs_dentry_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a> [<a class="el" href="kfs_8c.html#a92ab7d744c9853bdebee5c81ac2b422f">KFS_MAX_DENTRY</a>]</td></tr>
<tr class="memdesc:a4c9c9ecc30db3a783a700f4e79f9561e"><td class="mdescLeft">&#160;</td><td class="mdescRight">up to MAX_DENTRY files  <br /></td></tr>
<tr class="separator:a4c9c9ecc30db3a783a700f4e79f9561e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace1088077311b5b6a4d2fa6d330f4ccf"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#abac7f4a360f61a2ce1f34b6e6b6028ff">kfs_inode_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a> [<a class="el" href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a>]</td></tr>
<tr class="separator:ace1088077311b5b6a4d2fa6d330f4ccf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfe2302bd3dfd42413c478b8a32174cb"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a> [<a class="el" href="kfs_8c.html#a75563572783e6a8183fe1fa127b6453d">KFS_MAX_FMAP</a>]</td></tr>
<tr class="memdesc:adfe2302bd3dfd42413c478b8a32174cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">up to MAX_FMAP inode extensions  <br /></td></tr>
<tr class="separator:adfe2302bd3dfd42413c478b8a32174cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4418baf5eb3028d32758a1ccd600be44"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a> [<a class="el" href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a>]</td></tr>
<tr class="memdesc:a4418baf5eb3028d32758a1ccd600be44"><td class="mdescLeft">&#160;</td><td class="mdescRight">last offset used for inode by read write  <br /></td></tr>
<tr class="separator:a4418baf5eb3028d32758a1ccd600be44"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a92ab7d744c9853bdebee5c81ac2b422f" name="a92ab7d744c9853bdebee5c81ac2b422f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92ab7d744c9853bdebee5c81ac2b422f">&#9670;&#160;</a></span>KFS_MAX_DENTRY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_MAX_DENTRY&#160;&#160;&#160;((<a class="el" href="kfs_8h.html#a012e85f2bb85ec2d5bdff1d298929018">KFS_NPG_DENTRY</a>&lt;&lt;12)/sizeof(<a class="el" href="kfs_8c.html#ae4356b2f3be21f839915b3bae8530b06">kfs_dentry_t</a>)) /* number of dentries */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a75563572783e6a8183fe1fa127b6453d" name="a75563572783e6a8183fe1fa127b6453d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75563572783e6a8183fe1fa127b6453d">&#9670;&#160;</a></span>KFS_MAX_FMAP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_MAX_FMAP&#160;&#160;&#160;((<a class="el" href="kfs_8h.html#ae070eb53d573680911159a7cbb4b90e2">KFS_NPG_FMAP</a>  &lt;&lt;12)/sizeof(<a class="el" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a>))   /* number of file maps */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac084ea319e447d4af876044655fc46ec" name="ac084ea319e447d4af876044655fc46ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac084ea319e447d4af876044655fc46ec">&#9670;&#160;</a></span>KFS_MAX_INODE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_MAX_INODE&#160;&#160;&#160;((<a class="el" href="kfs_8h.html#a93b1915cf843dbd16b8d274ee4751acb">KFS_NPG_INODE</a> &lt;&lt;12)/sizeof(<a class="el" href="kfs_8c.html#abac7f4a360f61a2ce1f34b6e6b6028ff">kfs_inode_t</a>))  /* number of inodes */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae0b389bdf68187ccb1610271d36edb33" name="ae0b389bdf68187ccb1610271d36edb33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0b389bdf68187ccb1610271d36edb33">&#9670;&#160;</a></span>KFS_MAX_NAME</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_MAX_NAME&#160;&#160;&#160;28      /* dentry name length */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="af0ae18eb635e6562531a287fb89dd996" name="af0ae18eb635e6562531a287fb89dd996"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0ae18eb635e6562531a287fb89dd996">&#9670;&#160;</a></span>NPGU</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NPGU&#160;&#160;&#160;(<a class="el" href="kfs_8h.html#a75d29f6159278cfe6da1ae6fefb40c46">KFS_NPG_BOOT</a>+<a class="el" href="kfs_8h.html#a2fc604f5c0a4a2971369642c96f07abf">KFS_NPG_META</a>)            /* number of pages used by BOOT and META */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a070d2ce7b6bb7e5c05602aa8c308d0c4" name="a070d2ce7b6bb7e5c05602aa8c308d0c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a070d2ce7b6bb7e5c05602aa8c308d0c4">&#9670;&#160;</a></span>NULL</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NULL&#160;&#160;&#160;(void *)0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a8cf7c777695c7e20328dc1bcd41914eb" name="a8cf7c777695c7e20328dc1bcd41914eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cf7c777695c7e20328dc1bcd41914eb">&#9670;&#160;</a></span>i16_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef signed short <a class="el" href="kfs_8c.html#a8cf7c777695c7e20328dc1bcd41914eb">i16_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2d27dc3b3d920629ee0d10b6f7bbe427" name="a2d27dc3b3d920629ee0d10b6f7bbe427"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d27dc3b3d920629ee0d10b6f7bbe427">&#9670;&#160;</a></span>i32_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef signed int <a class="el" href="kfs_8c.html#a2d27dc3b3d920629ee0d10b6f7bbe427">i32_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae0202ec8eca2f399b9a57c31194a5f28" name="ae0202ec8eca2f399b9a57c31194a5f28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0202ec8eca2f399b9a57c31194a5f28">&#9670;&#160;</a></span>i8_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef signed char <a class="el" href="kfs_8c.html#ae0202ec8eca2f399b9a57c31194a5f28">i8_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae4356b2f3be21f839915b3bae8530b06" name="ae4356b2f3be21f839915b3bae8530b06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4356b2f3be21f839915b3bae8530b06">&#9670;&#160;</a></span>kfs_dentry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structkfs__dentry__s.html">kfs_dentry_s</a> <a class="el" href="kfs_8c.html#ae4356b2f3be21f839915b3bae8530b06">kfs_dentry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7db204b3134ab7e4824022eec748871c" name="a7db204b3134ab7e4824022eec748871c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7db204b3134ab7e4824022eec748871c">&#9670;&#160;</a></span>kfs_fmap_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> kfs_fmap_t[16]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>fmap as inode extension, maps until 16 pages or 16 other fmaps </p>

</div>
</div>
<a id="abac7f4a360f61a2ce1f34b6e6b6028ff" name="abac7f4a360f61a2ce1f34b6e6b6028ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abac7f4a360f61a2ce1f34b6e6b6028ff">&#9670;&#160;</a></span>kfs_inode_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structkfs__inode__s.html">kfs_inode_s</a> <a class="el" href="kfs_8c.html#abac7f4a360f61a2ce1f34b6e6b6028ff">kfs_inode_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a2dd7d67d3275b2a85f607922acdfbc28" name="a2dd7d67d3275b2a85f607922acdfbc28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dd7d67d3275b2a85f607922acdfbc28">&#9670;&#160;</a></span>kfs_mbr_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structkfs__mbr__s.html">kfs_mbr_s</a> <a class="el" href="kfs_8c.html#a2dd7d67d3275b2a85f607922acdfbc28">kfs_mbr_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a202fc39d0ae25edf80b1c54902014eb1" name="a202fc39d0ae25edf80b1c54902014eb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a202fc39d0ae25edf80b1c54902014eb1">&#9670;&#160;</a></span>kfs_page_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> kfs_page_t[1024]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>atomic data segment exchanged with the disk </p>

</div>
</div>
<a id="a39d79370e49d3416fb6e2e05d4c40881" name="a39d79370e49d3416fb6e2e05d4c40881"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39d79370e49d3416fb6e2e05d4c40881">&#9670;&#160;</a></span>kfs_sblock_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structkfs__sblock__s.html">kfs_sblock_s</a> <a class="el" href="kfs_8c.html#a39d79370e49d3416fb6e2e05d4c40881">kfs_sblock_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afc6499c1f28697aa3bfc2804d496fd11" name="afc6499c1f28697aa3bfc2804d496fd11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc6499c1f28697aa3bfc2804d496fd11">&#9670;&#160;</a></span>u16_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned short <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a0c0a490ab7fa397be6c764a935cc5ea4" name="a0c0a490ab7fa397be6c764a935cc5ea4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c0a490ab7fa397be6c764a935cc5ea4">&#9670;&#160;</a></span>u32_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned int <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae081489b4906f65a3cb18e9fbe9f8d23" name="ae081489b4906f65a3cb18e9fbe9f8d23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae081489b4906f65a3cb18e9fbe9f8d23">&#9670;&#160;</a></span>u8_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned char <a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac54d7e40a14d08ab189631215fb3a4cc" name="ac54d7e40a14d08ab189631215fb3a4cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac54d7e40a14d08ab189631215fb3a4cc">&#9670;&#160;</a></span>kfs_alloc_bitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> kfs_alloc_bitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a>&#160;</td>
          <td class="paramname"><em>bitmap</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a>&#160;</td>
          <td class="paramname"><em>max</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>bitmap allocator </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bitmap</td><td>is a bit array, but it is accessed by byte </td></tr>
    <tr><td class="paramname">start</td><td>is a pointer to position of last allocated or released bit (from 0 to max-1) </td></tr>
    <tr><td class="paramname">max</td><td>is the number of bits in the bitmap </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the position of the bit found or 0 if not found, there are 2 side effects, the bit bitmap[] at the returned position is cleared and start is updated for the next search </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  235</span>{</div>
<div class="line"><span class="lineno">  236</span>    <span class="keywordflow">for</span> (;*start != max ; *start += 1)                      <span class="comment">// search from the last allocated</span></div>
<div class="line"><span class="lineno">  237</span>        <span class="keywordflow">if</span> ((bitmap[*start/8] &amp; (1 &lt;&lt; (*start%8))) == 0) {  <span class="comment">// if this bit is 0 (then usable)</span></div>
<div class="line"><span class="lineno">  238</span>            bitmap[*start/8] |= (1 &lt;&lt; (*start%8));          <span class="comment">// set it</span></div>
<div class="line"><span class="lineno">  239</span>            <span class="keywordflow">return</span> *start;                                  <span class="comment">// and return its postion</span></div>
<div class="line"><span class="lineno">  240</span>        }</div>
<div class="line"><span class="lineno">  241</span>    <span class="keywordflow">return</span> 0;                                               <span class="comment">// whenever no bit found</span></div>
<div class="line"><span class="lineno">  242</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry()</a>, <a class="el" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap()</a>, <a class="el" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode()</a>, and <a class="el" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page()</a>.</p>

</div>
</div>
<a id="a66ffc964d30c5258826714ac181af25a" name="a66ffc964d30c5258826714ac181af25a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66ffc964d30c5258826714ac181af25a">&#9670;&#160;</a></span>kfs_alloc_dentry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> kfs_alloc_dentry </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>allocates a new dentry, dentry 0 is for '/' thus it is never free </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>of the new dentry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, the new dentry, on failure, 0 (because dentry 0 is always allocated) </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  266</span>{</div>
<div class="line"><span class="lineno">  267</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> <span class="keyword">new</span>= <a class="code hl_function" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a7aa2f7b977d0648b2cbe5b1cdb3234fd">bmp_dentry</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#ab9a8e05095ae32b5274f22f0c937b0bd">cur_dentry</a>, <a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a8821a5865dacd4eea0bcae64e23b3aa5">max_dentry</a>);</div>
<div class="line"><span class="lineno">  268</span>    <span class="keywordflow">if</span> (<span class="keyword">new</span> == 0) <span class="keywordflow">return</span> 0;                                 <span class="comment">// no more dentries available</span></div>
<div class="line"><span class="lineno">  269</span>    <a class="code hl_function" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy</a> (<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[<span class="keyword">new</span>].name, name);                 <span class="comment">// copy name</span></div>
<div class="line"><span class="lineno">  270</span>    <span class="keywordflow">return</span> <span class="keyword">new</span>;                                             <span class="comment">// all other fields are not initialized</span></div>
<div class="line"><span class="lineno">  271</span>}</div>
<div class="ttc" id="akfs_8c_html_a0c0a490ab7fa397be6c764a935cc5ea4"><div class="ttname"><a href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a></div><div class="ttdeci">unsigned int u32_t</div><div class="ttdef"><b>Definition:</b> kfs.c:26</div></div>
<div class="ttc" id="akfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files</div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
<div class="ttc" id="akfs_8c_html_ac54d7e40a14d08ab189631215fb3a4cc"><div class="ttname"><a href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap</a></div><div class="ttdeci">static u32_t kfs_alloc_bitmap(u8_t bitmap[], u32_t *start, u32_t max)</div><div class="ttdoc">bitmap allocator</div><div class="ttdef"><b>Definition:</b> kfs.c:234</div></div>
<div class="ttc" id="akfs_8c_html_accc11417a4eed24097de41cf088d420b"><div class="ttname"><a href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a></div><div class="ttdeci">static kfs_sblock_t KfsSblock</div><div class="ttdef"><b>Definition:</b> kfs.c:104</div></div>
<div class="ttc" id="akfs_8c_html_aceb626dd864e7f2ccd7901d0506dbaf4"><div class="ttname"><a href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy</a></div><div class="ttdeci">static void kfs_strcpy(char *dest, char *src)</div><div class="ttdoc">copy a string of characters</div><div class="ttdef"><b>Definition:</b> kfs.c:199</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a7aa2f7b977d0648b2cbe5b1cdb3234fd"><div class="ttname"><a href="structkfs__sblock__s.html#a7aa2f7b977d0648b2cbe5b1cdb3234fd">kfs_sblock_s::bmp_dentry</a></div><div class="ttdeci">u8_t bmp_dentry[KFS_MAX_DENTRY/8]</div><div class="ttdoc">bitmap of dentries</div><div class="ttdef"><b>Definition:</b> kfs.c:74</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a8821a5865dacd4eea0bcae64e23b3aa5"><div class="ttname"><a href="structkfs__sblock__s.html#a8821a5865dacd4eea0bcae64e23b3aa5">kfs_sblock_s::max_dentry</a></div><div class="ttdeci">u32_t max_dentry</div><div class="ttdoc">&lt; size: KFS_NPG_SBLOCK&lt;&lt;12 bytes</div><div class="ttdef"><b>Definition:</b> kfs.c:72</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_ab9a8e05095ae32b5274f22f0c937b0bd"><div class="ttname"><a href="structkfs__sblock__s.html#ab9a8e05095ae32b5274f22f0c937b0bd">kfs_sblock_s::cur_dentry</a></div><div class="ttdeci">u32_t cur_dentry</div><div class="ttdoc">last dentry allocated/freed, all before it are occupied</div><div class="ttdef"><b>Definition:</b> kfs.c:73</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a7aa2f7b977d0648b2cbe5b1cdb3234fd">kfs_sblock_s::bmp_dentry</a>, <a class="el" href="structkfs__sblock__s.html#ab9a8e05095ae32b5274f22f0c937b0bd">kfs_sblock_s::cur_dentry</a>, <a class="el" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap()</a>, <a class="el" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>, and <a class="el" href="structkfs__sblock__s.html#a8821a5865dacd4eea0bcae64e23b3aa5">kfs_sblock_s::max_dentry</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>.</p>

</div>
</div>
<a id="a4899d84042ad3892c13dc7a360f65d86" name="a4899d84042ad3892c13dc7a360f65d86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4899d84042ad3892c13dc7a360f65d86">&#9670;&#160;</a></span>kfs_alloc_fmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kfs_alloc_fmap </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>allocates a new map, map 0 is never free </p>
<dl class="section return"><dt>Returns</dt><dd>On success, the new map, on failure, 0 (because fmap 0 is always allocated) </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  330</span>{</div>
<div class="line"><span class="lineno">  331</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a2f9dba6f80a4fc818bbe8ca84c2d1309">bmp_fmap</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#acb1111b4f37733c412fb8eb4788c3c83">cur_fmap</a>, <a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a5254da868c0d1d63a4aba34d19ff9b04">max_fmap</a>);</div>
<div class="line"><span class="lineno">  332</span>}</div>
<div class="ttc" id="astructkfs__sblock__s_html_a2f9dba6f80a4fc818bbe8ca84c2d1309"><div class="ttname"><a href="structkfs__sblock__s.html#a2f9dba6f80a4fc818bbe8ca84c2d1309">kfs_sblock_s::bmp_fmap</a></div><div class="ttdeci">u8_t bmp_fmap[KFS_MAX_FMAP/8]</div><div class="ttdoc">bitmap of fmaps</div><div class="ttdef"><b>Definition:</b> kfs.c:80</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a5254da868c0d1d63a4aba34d19ff9b04"><div class="ttname"><a href="structkfs__sblock__s.html#a5254da868c0d1d63a4aba34d19ff9b04">kfs_sblock_s::max_fmap</a></div><div class="ttdeci">u32_t max_fmap</div><div class="ttdoc">total fmaps number</div><div class="ttdef"><b>Definition:</b> kfs.c:78</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_acb1111b4f37733c412fb8eb4788c3c83"><div class="ttname"><a href="structkfs__sblock__s.html#acb1111b4f37733c412fb8eb4788c3c83">kfs_sblock_s::cur_fmap</a></div><div class="ttdeci">u32_t cur_fmap</div><div class="ttdoc">last fmap allocated/freed, all before it are occupied</div><div class="ttdef"><b>Definition:</b> kfs.c:79</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a2f9dba6f80a4fc818bbe8ca84c2d1309">kfs_sblock_s::bmp_fmap</a>, <a class="el" href="structkfs__sblock__s.html#acb1111b4f37733c412fb8eb4788c3c83">kfs_sblock_s::cur_fmap</a>, <a class="el" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap()</a>, <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>, and <a class="el" href="structkfs__sblock__s.html#a5254da868c0d1d63a4aba34d19ff9b04">kfs_sblock_s::max_fmap</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage()</a>.</p>

</div>
</div>
<a id="ad7d3799e6e7b1822350af7f957f63db1" name="ad7d3799e6e7b1822350af7f957f63db1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7d3799e6e7b1822350af7f957f63db1">&#9670;&#160;</a></span>kfs_alloc_inode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> kfs_alloc_inode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a>&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>allocates a new inode, inode 0 is for '/' thus it is never free </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">type</td><td>of the new inode </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>On success, the new inode, on failure, 0 (because inode 0 is always allocated) </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  304</span>{</div>
<div class="line"><span class="lineno">  305</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> <span class="keyword">new</span> = <a class="code hl_function" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a4320a5d34fc85b90d0422ae8ff024d7f">bmp_inode</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a299344e23b26aaf0f60f1f94a0faf966">cur_inode</a>, <a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a50bd71d628473a6b77c6b2512f6742da">max_inode</a>);</div>
<div class="line"><span class="lineno">  306</span>    <span class="keywordflow">if</span> (<span class="keyword">new</span> == 0) <span class="keywordflow">return</span> 0;                                 <span class="comment">// no more dentries available</span></div>
<div class="line"><span class="lineno">  307</span>    <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<span class="keyword">new</span>].<a class="code hl_variable" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a> = type;                              <span class="comment">// type could be chosen</span></div>
<div class="line"><span class="lineno">  308</span>    <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<span class="keyword">new</span>].<a class="code hl_variable" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">mode</a> = 077;                               <span class="comment">// 077 == RWXRWX</span></div>
<div class="line"><span class="lineno">  309</span>    <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<span class="keyword">new</span>].<a class="code hl_variable" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">count</a> = 1;                                <span class="comment">// new inode means only one reference</span></div>
<div class="line"><span class="lineno">  310</span>    <span class="keywordflow">return</span> <span class="keyword">new</span>;                                             <span class="comment">// at last, return the new inode</span></div>
<div class="line"><span class="lineno">  311</span>}</div>
<div class="ttc" id="akfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="astructkfs__inode__s_html_ac894cd2c4c9d7e6409c3302d1edec307"><div class="ttname"><a href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a></div><div class="ttdeci">u32_t type</div><div class="ttdoc">&lt; 32 bytes long</div><div class="ttdef"><b>Definition:</b> kfs.c:48</div></div>
<div class="ttc" id="astructkfs__inode__s_html_ae5ea15e9504973dc519f2ceca209a3d8"><div class="ttname"><a href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a></div><div class="ttdeci">u16_t count</div><div class="ttdoc">nb of inode references</div><div class="ttdef"><b>Definition:</b> kfs.c:51</div></div>
<div class="ttc" id="astructkfs__inode__s_html_af0dd6151a1aba841d36f2d005e77aef4"><div class="ttname"><a href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a></div><div class="ttdeci">u32_t mode</div><div class="ttdoc">rwxrwx for owner and others</div><div class="ttdef"><b>Definition:</b> kfs.c:49</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a299344e23b26aaf0f60f1f94a0faf966"><div class="ttname"><a href="structkfs__sblock__s.html#a299344e23b26aaf0f60f1f94a0faf966">kfs_sblock_s::cur_inode</a></div><div class="ttdeci">u32_t cur_inode</div><div class="ttdoc">last inode allocated/freed, all before it are occupied</div><div class="ttdef"><b>Definition:</b> kfs.c:76</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a4320a5d34fc85b90d0422ae8ff024d7f"><div class="ttname"><a href="structkfs__sblock__s.html#a4320a5d34fc85b90d0422ae8ff024d7f">kfs_sblock_s::bmp_inode</a></div><div class="ttdeci">u8_t bmp_inode[KFS_MAX_INODE/8]</div><div class="ttdoc">bitmap of inodes</div><div class="ttdef"><b>Definition:</b> kfs.c:77</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a50bd71d628473a6b77c6b2512f6742da"><div class="ttname"><a href="structkfs__sblock__s.html#a50bd71d628473a6b77c6b2512f6742da">kfs_sblock_s::max_inode</a></div><div class="ttdeci">u32_t max_inode</div><div class="ttdoc">total inodes number</div><div class="ttdef"><b>Definition:</b> kfs.c:75</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a4320a5d34fc85b90d0422ae8ff024d7f">kfs_sblock_s::bmp_inode</a>, <a class="el" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a>, <a class="el" href="structkfs__sblock__s.html#a299344e23b26aaf0f60f1f94a0faf966">kfs_sblock_s::cur_inode</a>, <a class="el" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap()</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>, <a class="el" href="structkfs__sblock__s.html#a50bd71d628473a6b77c6b2512f6742da">kfs_sblock_s::max_inode</a>, <a class="el" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a>, and <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>.</p>

</div>
</div>
<a id="a53fd0386d2feed317c9d6bdc536e4540" name="a53fd0386d2feed317c9d6bdc536e4540"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53fd0386d2feed317c9d6bdc536e4540">&#9670;&#160;</a></span>kfs_alloc_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> kfs_alloc_page </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>allocates a new page of the disk </p>
<dl class="section return"><dt>Returns</dt><dd>On success, the new page, on failure, 0 (because page 0 is always allocated) </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  350</span>{</div>
<div class="line"><span class="lineno">  351</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a163e19c03f2551155f6b94c304103da3">bmp_page</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#aa52c224196e86427970e3c4a0830190f">cur_page</a>, <a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a097af9f6c4329c629453634d52d2a8b0">max_page</a>);</div>
<div class="line"><span class="lineno">  352</span>}</div>
<div class="ttc" id="astructkfs__sblock__s_html_a097af9f6c4329c629453634d52d2a8b0"><div class="ttname"><a href="structkfs__sblock__s.html#a097af9f6c4329c629453634d52d2a8b0">kfs_sblock_s::max_page</a></div><div class="ttdeci">u32_t max_page</div><div class="ttdoc">total pages number</div><div class="ttdef"><b>Definition:</b> kfs.c:81</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_a163e19c03f2551155f6b94c304103da3"><div class="ttname"><a href="structkfs__sblock__s.html#a163e19c03f2551155f6b94c304103da3">kfs_sblock_s::bmp_page</a></div><div class="ttdeci">u8_t bmp_page[KFS_NPG_DISK/8]</div><div class="ttdoc">bitmap of pages</div><div class="ttdef"><b>Definition:</b> kfs.c:83</div></div>
<div class="ttc" id="astructkfs__sblock__s_html_aa52c224196e86427970e3c4a0830190f"><div class="ttname"><a href="structkfs__sblock__s.html#aa52c224196e86427970e3c4a0830190f">kfs_sblock_s::cur_page</a></div><div class="ttdeci">u32_t cur_page</div><div class="ttdoc">last page allocated/freed, all before it are occupied</div><div class="ttdef"><b>Definition:</b> kfs.c:82</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a163e19c03f2551155f6b94c304103da3">kfs_sblock_s::bmp_page</a>, <a class="el" href="structkfs__sblock__s.html#aa52c224196e86427970e3c4a0830190f">kfs_sblock_s::cur_page</a>, <a class="el" href="kfs_8c.html#ac54d7e40a14d08ab189631215fb3a4cc">kfs_alloc_bitmap()</a>, <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>, and <a class="el" href="structkfs__sblock__s.html#a097af9f6c4329c629453634d52d2a8b0">kfs_sblock_s::max_page</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>.</p>

</div>
</div>
<a id="a30d4e1ffe8c1ea75120811fcf3055c05" name="a30d4e1ffe8c1ea75120811fcf3055c05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30d4e1ffe8c1ea75120811fcf3055c05">&#9670;&#160;</a></span>kfs_chmode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_chmode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>write access functions to inode's properties </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of an inode </td></tr>
    <tr><td class="paramname">mode,owner</td><td>&amp; mtime are the new property value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the new property or -1 if failure </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  153</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">mode</a> = mode; }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a>.</p>

</div>
</div>
<a id="a68786a19dcb587fe18b45ae76effa1c5" name="a68786a19dcb587fe18b45ae76effa1c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68786a19dcb587fe18b45ae76effa1c5">&#9670;&#160;</a></span>kfs_chmtime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_chmtime </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mtime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  155</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">mtime</a>= mtime;}</div>
<div class="ttc" id="astructkfs__inode__s_html_a575e296191f8d2444a26f90d58e155e6"><div class="ttname"><a href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a></div><div class="ttdeci">u16_t mtime</div><div class="ttdoc">relative modification/creation time</div><div class="ttdef"><b>Definition:</b> kfs.c:53</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a>.</p>

</div>
</div>
<a id="a3e380775665de4ff6cbc01555444cb64" name="a3e380775665de4ff6cbc01555444cb64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e380775665de4ff6cbc01555444cb64">&#9670;&#160;</a></span>kfs_chowner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_chowner </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>owner</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  154</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">owner</a>= owner;}</div>
<div class="ttc" id="astructkfs__inode__s_html_adecb12117172ae213c9d659ffbcd809b"><div class="ttname"><a href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a></div><div class="ttdeci">u16_t owner</div><div class="ttdoc">owner : kernel, user1, user2, user3</div><div class="ttdef"><b>Definition:</b> kfs.c:52</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a>.</p>

</div>
</div>
<a id="aaa0d81604e0d3d23f31b3beb7dcb163c" name="aaa0d81604e0d3d23f31b3beb7dcb163c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa0d81604e0d3d23f31b3beb7dcb163c">&#9670;&#160;</a></span>kfs_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_count </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>read access functions to inodes </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of an inode </td></tr>
    <tr><td class="paramname">offset</td><td>is the page number in the file (start at 0 to filesize / sizeof(page)) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- kfs_count : number of dentry pointing to this inode<ul>
<li>kfs_type : type defined in kfs_enum_e</li>
<li>kfs_mode : permission modes rwxrwx for the owner and others (there are no groups)</li>
<li>kfs_size : file size</li>
<li>kfs_owner : file or directory owner</li>
<li>kfs_mtime : modification / creation relative time</li>
<li>kfs_page : index of page of data on the disk </li>
</ul>
</dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  144</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">count</a>;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a>, and <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="af148b22d686f5b43341249ba9d03eb54" name="af148b22d686f5b43341249ba9d03eb54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af148b22d686f5b43341249ba9d03eb54">&#9670;&#160;</a></span>kfs_fmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kfs_fmap </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  365</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a>; }</div>
<div class="ttc" id="astructkfs__inode__s_html_a6a491f8ad9c0ea78d30421be44931e9b"><div class="ttname"><a href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">kfs_inode_s::fmap</a></div><div class="ttdeci">u16_t fmap</div><div class="ttdoc">page above the first 12 pages</div><div class="ttdef"><b>Definition:</b> kfs.c:56</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">kfs_inode_s::fmap</a>, and <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>.</p>

</div>
</div>
<a id="a664e5f5072f4e5d09eb7f328b39bcec3" name="a664e5f5072f4e5d09eb7f328b39bcec3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a664e5f5072f4e5d09eb7f328b39bcec3">&#9670;&#160;</a></span>kfs_free_bitmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kfs_free_bitmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a>&#160;</td>
          <td class="paramname"><em>bitmap</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a>&#160;</td>
          <td class="paramname"><em>bit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>releases one bit of a bitmap </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bitmap</td><td>is a bit array, but it is accessed by byte </td></tr>
    <tr><td class="paramname">start</td><td>is a pointer to position of last allocated or released bit (from 0 to max-1) </td></tr>
    <tr><td class="paramname">bit</td><td>is the bit position to realease </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>there are 2 side effects, the bit bitmap[] at the start position is set and start is updated for the next search </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  253</span>{</div>
<div class="line"><span class="lineno">  254</span>    bitmap [bit/8] &amp;= ~(1&lt;&lt;bit%8);                          <span class="comment">// clear bit in bitmap</span></div>
<div class="line"><span class="lineno">  255</span>    <span class="keywordflow">if</span> (bit &lt; *start) *start = bit;                         <span class="comment">// change position to start next time</span></div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry()</a>, <a class="el" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap()</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, and <a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page()</a>.</p>

</div>
</div>
<a id="a5d172bef33b255bfe7ec0375abac988e" name="a5d172bef33b255bfe7ec0375abac988e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d172bef33b255bfe7ec0375abac988e">&#9670;&#160;</a></span>kfs_free_dentry()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kfs_free_dentry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>frees a dentry (it is not necessary to erase its content, it will be done in allocation) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>to free </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  278</span>{</div>
<div class="line"><span class="lineno">  279</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> root = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">root</a>;                    <span class="comment">// get the directory where dentry is</span></div>
<div class="line"><span class="lineno">  280</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> curr = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;                      <span class="comment">// get the 1st entry of this directory</span></div>
<div class="line"><span class="lineno">  281</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> prev = 0;                                         <span class="comment">// initiate previous</span></div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>    <span class="keywordflow">while</span> (curr != dentry) {                                <span class="comment">// while the current entry isn&#39;t dentry</span></div>
<div class="line"><span class="lineno">  284</span>        prev = curr;                                        <span class="comment">// previous dentry becomes current</span></div>
<div class="line"><span class="lineno">  285</span>        curr = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[curr].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;                        <span class="comment">// get the next current</span></div>
<div class="line"><span class="lineno">  286</span>    }</div>
<div class="line"><span class="lineno">  287</span>    <span class="keywordflow">if</span> (prev == 0)                                          <span class="comment">// if previous==0, dentry was the 1st</span></div>
<div class="line"><span class="lineno">  288</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;      <span class="comment">// new 1st is the one just after dentry</span></div>
<div class="line"><span class="lineno">  289</span>    <span class="keywordflow">else</span>                                                    <span class="comment">// else</span></div>
<div class="line"><span class="lineno">  290</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[prev].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a> = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;      <span class="comment">// skip the dentry prev.next=dentry.next</span></div>
<div class="line"><span class="lineno">  291</span> </div>
<div class="line"><span class="lineno">  292</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> * pi = (<a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *)&amp;(<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry]);             <span class="comment">// erase data inside dentry</span></div>
<div class="line"><span class="lineno">  293</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++, *pi++=0)</div>
<div class="line"><span class="lineno">  294</span>    <a class="code hl_function" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a7aa2f7b977d0648b2cbe5b1cdb3234fd">bmp_dentry</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#ab9a8e05095ae32b5274f22f0c937b0bd">cur_dentry</a>, dentry);  <span class="comment">// free the bit</span></div>
<div class="line"><span class="lineno">  295</span>}</div>
<div class="ttc" id="akfs_8c_html_a664e5f5072f4e5d09eb7f328b39bcec3"><div class="ttname"><a href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap</a></div><div class="ttdeci">static void kfs_free_bitmap(u8_t bitmap[], u32_t *start, u32_t bit)</div><div class="ttdoc">releases one bit of a bitmap</div><div class="ttdef"><b>Definition:</b> kfs.c:252</div></div>
<div class="ttc" id="akfs_8c_html_afc6499c1f28697aa3bfc2804d496fd11"><div class="ttname"><a href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></div><div class="ttdeci">unsigned short u16_t</div><div class="ttdef"><b>Definition:</b> kfs.c:27</div></div>
<div class="ttc" id="astructkfs__dentry__s_html_a17c6495def8c6564de45ab64cbc49066"><div class="ttname"><a href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a></div><div class="ttdeci">u8_t next</div><div class="ttdoc">index of one of the dentries at the same level</div><div class="ttdef"><b>Definition:</b> kfs.c:41</div></div>
<div class="ttc" id="astructkfs__dentry__s_html_a79fd3c8764d633fdb895b77856f61d61"><div class="ttname"><a href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a></div><div class="ttdeci">u8_t leaf</div><div class="ttdoc">index of one of the leaf dentries (0 if no leaf)</div><div class="ttdef"><b>Definition:</b> kfs.c:42</div></div>
<div class="ttc" id="astructkfs__dentry__s_html_aed21f3f5ab2de70ab3416afe6dd9e4d4"><div class="ttname"><a href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a></div><div class="ttdeci">u8_t root</div><div class="ttdoc">&lt; 32 bytes long</div><div class="ttdef"><b>Definition:</b> kfs.c:40</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a7aa2f7b977d0648b2cbe5b1cdb3234fd">kfs_sblock_s::bmp_dentry</a>, <a class="el" href="structkfs__sblock__s.html#ab9a8e05095ae32b5274f22f0c937b0bd">kfs_sblock_s::cur_dentry</a>, <a class="el" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>, <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>, <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>, and <a class="el" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>.</p>

</div>
</div>
<a id="a2b773f0350f13077e1479fe36941da52" name="a2b773f0350f13077e1479fe36941da52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b773f0350f13077e1479fe36941da52">&#9670;&#160;</a></span>kfs_free_fmap()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kfs_free_fmap </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td>
          <td class="paramname"><em>fmap</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>frees a map </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">map</td><td>to free </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  339</span>{</div>
<div class="line"><span class="lineno">  340</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> * pi = (<a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *)(<a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap]);</div>
<div class="line"><span class="lineno">  341</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++, *pi++=0);</div>
<div class="line"><span class="lineno">  342</span>    <a class="code hl_function" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a2f9dba6f80a4fc818bbe8ca84c2d1309">bmp_fmap</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#acb1111b4f37733c412fb8eb4788c3c83">cur_fmap</a>, fmap);</div>
<div class="line"><span class="lineno">  343</span>}</div>
<div class="ttc" id="akfs_8c_html_adfe2302bd3dfd42413c478b8a32174cb"><div class="ttname"><a href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a></div><div class="ttdeci">static kfs_fmap_t KfsFmap[KFS_MAX_FMAP]</div><div class="ttdoc">up to MAX_FMAP inode extensions</div><div class="ttdef"><b>Definition:</b> kfs.c:124</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a2f9dba6f80a4fc818bbe8ca84c2d1309">kfs_sblock_s::bmp_fmap</a>, <a class="el" href="structkfs__sblock__s.html#acb1111b4f37733c412fb8eb4788c3c83">kfs_sblock_s::cur_fmap</a>, <a class="el" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap()</a>, <a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>, and <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>.</p>

</div>
</div>
<a id="aadbe9ab58b58e9826dd4da1384c80798" name="aadbe9ab58b58e9826dd4da1384c80798"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadbe9ab58b58e9826dd4da1384c80798">&#9670;&#160;</a></span>kfs_free_inode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kfs_free_inode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>frees an inode (it is not necessary to erase it, it will be done in allocation) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">inode</td><td>to free </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  318</span>{</div>
<div class="line"><span class="lineno">  319</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> * pi = (<a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> *)&amp;(<a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode]);</div>
<div class="line"><span class="lineno">  320</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 8; i++, *pi++=0);</div>
<div class="line"><span class="lineno">  321</span>    <a class="code hl_function" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a4320a5d34fc85b90d0422ae8ff024d7f">bmp_inode</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a299344e23b26aaf0f60f1f94a0faf966">cur_inode</a>, inode);</div>
<div class="line"><span class="lineno">  322</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a4320a5d34fc85b90d0422ae8ff024d7f">kfs_sblock_s::bmp_inode</a>, <a class="el" href="structkfs__sblock__s.html#a299344e23b26aaf0f60f1f94a0faf966">kfs_sblock_s::cur_inode</a>, <a class="el" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap()</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link()</a>, and <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>.</p>

</div>
</div>
<a id="ac364ca8f5189a2eaf2f7cbeef0a27698" name="ac364ca8f5189a2eaf2f7cbeef0a27698"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac364ca8f5189a2eaf2f7cbeef0a27698">&#9670;&#160;</a></span>kfs_free_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kfs_free_page </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td>
          <td class="paramname"><em>page</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>frees a page of the disk </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">page</td><td>to free </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  359</span>{</div>
<div class="line"><span class="lineno">  360</span>    <a class="code hl_function" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap</a> (<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#a163e19c03f2551155f6b94c304103da3">bmp_page</a>, &amp;<a class="code hl_variable" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.<a class="code hl_variable" href="structkfs__sblock__s.html#aa52c224196e86427970e3c4a0830190f">cur_page</a>, page);</div>
<div class="line"><span class="lineno">  361</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__sblock__s.html#a163e19c03f2551155f6b94c304103da3">kfs_sblock_s::bmp_page</a>, <a class="el" href="structkfs__sblock__s.html#aa52c224196e86427970e3c4a0830190f">kfs_sblock_s::cur_page</a>, <a class="el" href="kfs_8c.html#a664e5f5072f4e5d09eb7f328b39bcec3">kfs_free_bitmap()</a>, and <a class="el" href="kfs_8c.html#accc11417a4eed24097de41cf088d420b">KfsSblock</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>, and <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>.</p>

</div>
</div>
<a id="a07490daa1f981c16ba1a77314a95a639" name="a07490daa1f981c16ba1a77314a95a639"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07490daa1f981c16ba1a77314a95a639">&#9670;&#160;</a></span>kfs_getname()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * kfs_getname </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>get name from pathname up to character '/' pathname argument is not destroyed. Function NON-reentrant </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pathname</td><td>has to be an absolute pathname, thus it must start with '/' kfs_getname ignores the last '/' at the end of pathname if pathname is NULL, then kfs_getname gives the next name in the previous pathname </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to the current name or NULL on failure </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  172</span>{</div>
<div class="line"><span class="lineno">  173</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> name[32] = <span class="stringliteral">&quot;&quot;</span>;                              <span class="comment">// buffer for the extracted name</span></div>
<div class="line"><span class="lineno">  174</span>    <span class="keyword">static</span> <span class="keywordtype">char</span> *next = name;                               <span class="comment">// next name, default empty name</span></div>
<div class="line"><span class="lineno">  175</span>    <span class="keywordtype">char</span> * current = name;                                  <span class="comment">// pointer used to fill the buffer</span></div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="keywordflow">if</span> (pathname) {                                         <span class="comment">// only true at first call</span></div>
<div class="line"><span class="lineno">  178</span>        <span class="keywordflow">if</span> (*pathname != <span class="charliteral">&#39;/&#39;</span>)                               <span class="comment">// pathname must start with &#39;/&#39;</span></div>
<div class="line"><span class="lineno">  179</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;                                    <span class="comment">// failure</span></div>
<div class="line"><span class="lineno">  180</span>        next = pathname;                                    <span class="comment">// the next name is all pathname</span></div>
<div class="line"><span class="lineno">  181</span>    }</div>
<div class="line"><span class="lineno">  182</span>    <span class="keywordflow">if</span> (*next == 0) <span class="keywordflow">return</span> <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;                            <span class="comment">// no more name in pathname</span></div>
<div class="line"><span class="lineno">  183</span> </div>
<div class="line"><span class="lineno">  184</span>    <span class="keywordflow">for</span> (;*next &amp;&amp; *next != <span class="charliteral">&#39;/&#39;</span>; *current++=*next++);       <span class="comment">// strcpy till &#39;/&#39; excluded</span></div>
<div class="line"><span class="lineno">  185</span>    *current = 0;                                           <span class="comment">// end of the name</span></div>
<div class="line"><span class="lineno">  186</span> </div>
<div class="line"><span class="lineno">  187</span>    <span class="keywordflow">if</span> (*next) next++;                                      <span class="comment">// if *next == &#39;/&#39; go to next char</span></div>
<div class="line"><span class="lineno">  188</span>    <span class="keywordflow">while</span> (*next == <span class="charliteral">&#39;/&#39;</span>) next++;                            <span class="comment">// several &#39;/&#39; are considered as single</span></div>
<div class="line"><span class="lineno">  189</span> </div>
<div class="line"><span class="lineno">  190</span>    <span class="keywordflow">return</span> name;                                            <span class="comment">// at last return extracted name</span></div>
<div class="line"><span class="lineno">  191</span>}</div>
<div class="ttc" id="akfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>.</p>

</div>
</div>
<a id="aae206d59d8bc4514d34dafdff1198ede" name="aae206d59d8bc4514d34dafdff1198ede"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae206d59d8bc4514d34dafdff1198ede">&#9670;&#160;</a></span>kfs_inode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_inode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  139</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;}</div>
<div class="ttc" id="astructkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode</div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, and <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, <a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read()</a>, <a class="el" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="ac2308b1a426032672fbacdde9ee5ac81" name="ac2308b1a426032672fbacdde9ee5ac81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2308b1a426032672fbacdde9ee5ac81">&#9670;&#160;</a></span>kfs_isdir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_isdir </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>boolean functions for dentries or inode </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of a dentry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- 0 if false, not 0 if true </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  142</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>].<a class="code hl_variable" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a> == <a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>;}</div>
<div class="ttc" id="akfs_8h_html_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a></div><div class="ttdeci">@ KFS_DIR</div><div class="ttdoc">type of files for the real disk (less than vfs)</div><div class="ttdef"><b>Definition:</b> kfs.h:46</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir()</a>, <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>, and <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>.</p>

</div>
</div>
<a id="a135f3848117282c89e3be09b930eb9de" name="a135f3848117282c89e3be09b930eb9de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a135f3848117282c89e3be09b930eb9de">&#9670;&#160;</a></span>kfs_leaf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_leaf </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  138</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> ;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, and <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="a4fa0207fb8a04e889050f380b9068e3a" name="a4fa0207fb8a04e889050f380b9068e3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fa0207fb8a04e889050f380b9068e3a">&#9670;&#160;</a></span>kfs_link()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_link </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>old_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>new_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>creates a new link (also called hard link) on an existing file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">old_name</td><td>is an existing file name </td></tr>
    <tr><td class="paramname">new_name</td><td>is the new name of the same file as old_name if new_name already exists it is not created, and it's a failure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if success, -1 if failure </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  633</span>{</div>
<div class="line"><span class="lineno">  634</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> src_dentry = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (src_name);</div>
<div class="line"><span class="lineno">  635</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dst_dentry = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (dst_name);</div>
<div class="line"><span class="lineno">  636</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> src_inode  = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[src_dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;</div>
<div class="line"><span class="lineno">  637</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dst_inode  = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dst_dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;</div>
<div class="line"><span class="lineno">  638</span>    <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dst_dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a> = src_inode;</div>
<div class="line"><span class="lineno">  639</span>    <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[src_inode].<a class="code hl_variable" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">count</a>++;</div>
<div class="line"><span class="lineno">  640</span>    <a class="code hl_function" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a> (dst_inode);</div>
<div class="line"><span class="lineno">  641</span>    <span class="keywordflow">return</span> dst_dentry;</div>
<div class="line"><span class="lineno">  642</span>}</div>
<div class="ttc" id="akfs_8c_html_aadbe9ab58b58e9826dd4da1384c80798"><div class="ttname"><a href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a></div><div class="ttdeci">static void kfs_free_inode(int inode)</div><div class="ttdoc">frees an inode (it is not necessary to erase it, it will be done in allocation)</div><div class="ttdef"><b>Definition:</b> kfs.c:317</div></div>
<div class="ttc" id="akfs_8c_html_ac7986c65e8710a8b55857582e62ccc78"><div class="ttname"><a href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a></div><div class="ttdeci">int kfs_open(char *pathname)</div><div class="ttdoc">opens a file or directory, if file or directory not found, all the pathname is created</div><div class="ttdef"><b>Definition:</b> kfs.c:525</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a>, <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, and <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>

</div>
</div>
<a id="ac9581ae711d5f79aff1ed39c9739e80c" name="ac9581ae711d5f79aff1ed39c9739e80c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9581ae711d5f79aff1ed39c9739e80c">&#9670;&#160;</a></span>kfs_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_mode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  146</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">mode</a>; }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="a9b41dd15430924703df46a579ff05b2e" name="a9b41dd15430924703df46a579ff05b2e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b41dd15430924703df46a579ff05b2e">&#9670;&#160;</a></span>kfs_mtime()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_mtime </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  149</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">mtime</a>;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="a2c752ffc3e5d008879e7035508bac847" name="a2c752ffc3e5d008879e7035508bac847"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c752ffc3e5d008879e7035508bac847">&#9670;&#160;</a></span>kfs_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * kfs_name </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  140</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a9e5a536f0b9b95dc094c58c66c61ddcc">name</a> ;}</div>
<div class="ttc" id="astructkfs__dentry__s_html_a9e5a536f0b9b95dc094c58c66c61ddcc"><div class="ttname"><a href="structkfs__dentry__s.html#a9e5a536f0b9b95dc094c58c66c61ddcc">kfs_dentry_s::name</a></div><div class="ttdeci">char name[KFS_MAX_NAME]</div><div class="ttdoc">max size of a file or folder name</div><div class="ttdef"><b>Definition:</b> kfs.c:44</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, and <a class="el" href="structkfs__dentry__s.html#a9e5a536f0b9b95dc094c58c66c61ddcc">kfs_dentry_s::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname()</a>, and <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="a3be0d586ff3044979a3c381137d77d47" name="a3be0d586ff3044979a3c381137d77d47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3be0d586ff3044979a3c381137d77d47">&#9670;&#160;</a></span>kfs_next()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_next </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  137</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a> ;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, and <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="ac7986c65e8710a8b55857582e62ccc78" name="ac7986c65e8710a8b55857582e62ccc78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7986c65e8710a8b55857582e62ccc78">&#9670;&#160;</a></span>kfs_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_open </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>opens a file or directory, if file or directory not found, all the pathname is created </p>
<p>"deep-first walk" of the name tree to find or create the file defined by its absolute name </p>
<div class="fragment"><div class="line"><span class="lineno">  526</span>{</div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordtype">char</span> * name = <a class="code hl_function" href="kfs_8c.html#a07490daa1f981c16ba1a77314a95a639">kfs_getname</a> (pathname);                   <span class="comment">// get first name up to character &#39;/&#39;</span></div>
<div class="line"><span class="lineno">  528</span>    <span class="keywordflow">if</span> (name == <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> -1;                            <span class="comment">// pathname not correct, failure</span></div>
<div class="line"><span class="lineno">  529</span> </div>
<div class="line"><span class="lineno">  530</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> dentry = 0;                                       <span class="comment">// search from root fs</span></div>
<div class="line"><span class="lineno">  531</span>    <span class="keywordflow">while</span> ((name = <a class="code hl_function" href="kfs_8c.html#a07490daa1f981c16ba1a77314a95a639">kfs_getname</a> (<a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)))                     <span class="comment">// get the next name in pathname</span></div>
<div class="line"><span class="lineno">  532</span>        dentry = <a class="code hl_function" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (dentry, name);                 <span class="comment">// look for it in current directory</span></div>
<div class="line"><span class="lineno">  533</span> </div>
<div class="line"><span class="lineno">  534</span>    <a class="code hl_variable" href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a>[<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>] = 0;                 <span class="comment">// by defaut, set offset to firstpage</span></div>
<div class="line"><span class="lineno">  535</span>    <span class="keywordflow">return</span> dentry;                                          <span class="comment">// finally, the last dentry found</span></div>
<div class="line"><span class="lineno">  536</span>}</div>
<div class="ttc" id="akfs_8c_html_a07490daa1f981c16ba1a77314a95a639"><div class="ttname"><a href="kfs_8c.html#a07490daa1f981c16ba1a77314a95a639">kfs_getname</a></div><div class="ttdeci">static char * kfs_getname(char *pathname)</div><div class="ttdoc">get name from pathname up to character '/' pathname argument is not destroyed. Function NON-reentrant</div><div class="ttdef"><b>Definition:</b> kfs.c:171</div></div>
<div class="ttc" id="akfs_8c_html_a4418baf5eb3028d32758a1ccd600be44"><div class="ttname"><a href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a></div><div class="ttdeci">static u16_t KfsOffset[KFS_MAX_INODE]</div><div class="ttdoc">last offset used for inode by read write</div><div class="ttdef"><b>Definition:</b> kfs.c:130</div></div>
<div class="ttc" id="akfs_8c_html_a5bf1c4cc42e02a99529eefc02cf53c4b"><div class="ttname"><a href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a></div><div class="ttdeci">int kfs_openat(int root, char *name)</div><div class="ttdoc">looks for name in the directory root, if the name is not found, it is created</div><div class="ttdef"><b>Definition:</b> kfs.c:541</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#a07490daa1f981c16ba1a77314a95a639">kfs_getname()</a>, <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a>, and <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build()</a>, <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, <a class="el" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files()</a>, <a class="el" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link()</a>, <a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree()</a>, <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="a5bf1c4cc42e02a99529eefc02cf53c4b" name="a5bf1c4cc42e02a99529eefc02cf53c4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bf1c4cc42e02a99529eefc02cf53c4b">&#9670;&#160;</a></span>kfs_openat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_openat </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>looks for name in the directory root, if the name is not found, it is created </p>
<p>find or create the file defined by its relative name into the directory defined by its dentry </p>
<div class="fragment"><div class="line"><span class="lineno">  542</span>{</div>
<div class="line"><span class="lineno">  543</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> leaf = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;                      <span class="comment">// get first leaf of current root</span></div>
<div class="line"><span class="lineno">  544</span>    <span class="keywordtype">int</span> notfound = 1;                                       <span class="comment">// by default, suppose name not found</span></div>
<div class="line"><span class="lineno">  545</span> </div>
<div class="line"><span class="lineno">  546</span>    <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>].<a class="code hl_variable" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a> = <a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>;         <span class="comment">// root is necessarily a directory</span></div>
<div class="line"><span class="lineno">  547</span> </div>
<div class="line"><span class="lineno">  548</span>    <span class="keywordflow">if</span> (leaf) {                                             <span class="comment">// if there are leafs</span></div>
<div class="line"><span class="lineno">  549</span>        <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> leaf_next = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;             <span class="comment">// get next leaf</span></div>
<div class="line"><span class="lineno">  550</span>        notfound = <a class="code hl_function" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a>(<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].name, name);  <span class="comment">// !=0 if different</span></div>
<div class="line"><span class="lineno">  551</span> </div>
<div class="line"><span class="lineno">  552</span>        <span class="keywordflow">while</span> (notfound &amp;&amp; leaf_next) {                     <span class="comment">// while not good leaf and there is more</span></div>
<div class="line"><span class="lineno">  553</span>            leaf = leaf_next;                               <span class="comment">// change the leaf to the next leaf</span></div>
<div class="line"><span class="lineno">  554</span>            leaf_next = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;               <span class="comment">// get next leaf</span></div>
<div class="line"><span class="lineno">  555</span>            notfound= <a class="code hl_function" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a>(<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].name,name);<span class="comment">// compare current leaf</span></div>
<div class="line"><span class="lineno">  556</span>        }</div>
<div class="line"><span class="lineno">  557</span>    }</div>
<div class="line"><span class="lineno">  558</span> </div>
<div class="line"><span class="lineno">  559</span>    <span class="keywordflow">if</span> (notfound) {</div>
<div class="line"><span class="lineno">  560</span>        leaf = <a class="code hl_function" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry</a> (name);                     <span class="comment">// create a new dentry for the file</span></div>
<div class="line"><span class="lineno">  561</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a> = <a class="code hl_function" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode</a> (<a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>); <span class="comment">// create an empty inode (default FILE)</span></div>
<div class="line"><span class="lineno">  562</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> = 0;                           <span class="comment">// if new leaf is FILE, thus no leaf</span></div>
<div class="line"><span class="lineno">  563</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">root</a> = root;                        <span class="comment">// set the root of the new leaf</span></div>
<div class="line"><span class="lineno">  564</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a> = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;        <span class="comment">// put new leaf in same level nodes list</span></div>
<div class="line"><span class="lineno">  565</span>        <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> = leaf;                        <span class="comment">// the beginning of the list of leafs</span></div>
<div class="line"><span class="lineno">  566</span>    }</div>
<div class="line"><span class="lineno">  567</span> </div>
<div class="line"><span class="lineno">  568</span>    <span class="keywordflow">return</span> leaf;                                            <span class="comment">// return the found or created leaf</span></div>
<div class="line"><span class="lineno">  569</span>}</div>
<div class="ttc" id="akfs_8c_html_a09fba9a0bb78a0f1f159c01046c7e006"><div class="ttname"><a href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a></div><div class="ttdeci">static int kfs_strcmp(const char *s1, const char *s2)</div><div class="ttdoc">compare two strings of characters</div><div class="ttdef"><b>Definition:</b> kfs.c:212</div></div>
<div class="ttc" id="akfs_8c_html_a66ffc964d30c5258826714ac181af25a"><div class="ttname"><a href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry</a></div><div class="ttdeci">static u32_t kfs_alloc_dentry(char *name)</div><div class="ttdoc">allocates a new dentry, dentry 0 is for '/' thus it is never free</div><div class="ttdef"><b>Definition:</b> kfs.c:265</div></div>
<div class="ttc" id="akfs_8c_html_ad7d3799e6e7b1822350af7f957f63db1"><div class="ttname"><a href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode</a></div><div class="ttdeci">static u16_t kfs_alloc_inode(u8_t type)</div><div class="ttdoc">allocates a new inode, inode 0 is for '/' thus it is never free</div><div class="ttdef"><b>Definition:</b> kfs.c:303</div></div>
<div class="ttc" id="akfs_8h_html_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a></div><div class="ttdeci">@ KFS_FILE</div><div class="ttdoc">regular file</div><div class="ttdef"><b>Definition:</b> kfs.h:47</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry()</a>, <a class="el" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode()</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>, <a class="el" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>, <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>, <a class="el" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a>, and <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, and <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>.</p>

</div>
</div>
<a id="a2f522cb4edeecd6cbcebcca31d90bc75" name="a2f522cb4edeecd6cbcebcca31d90bc75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f522cb4edeecd6cbcebcca31d90bc75">&#9670;&#160;</a></span>kfs_owner()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_owner </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  148</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">owner</a>;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="afdc75626536d311fb2fe47baef24ef55" name="afdc75626536d311fb2fe47baef24ef55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdc75626536d311fb2fe47baef24ef55">&#9670;&#160;</a></span>kfs_page()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_page </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pg_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  377</span>{</div>
<div class="line"><span class="lineno">  378</span>    <span class="keywordtype">int</span> size = <a class="code hl_function" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode);                             <span class="comment">// real size of file</span></div>
<div class="line"><span class="lineno">  379</span>    <span class="keywordflow">if</span> ((size==0) || (pg_offset &gt; size&gt;&gt;12)) <span class="keywordflow">return</span> -1;     <span class="comment">// if pg_offset is &gt; than the nb of page</span></div>
<div class="line"><span class="lineno">  380</span>    <span class="keywordflow">if</span> (pg_offset &lt; 12) <span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">page</a>[pg_offset];<span class="comment">// page is referenced by inode</span></div>
<div class="line"><span class="lineno">  381</span>    pg_offset -= 12;                                        <span class="comment">// all others are in fmaps</span></div>
<div class="line"><span class="lineno">  382</span>    <span class="keywordtype">int</span> map1 = <a class="code hl_function" href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap</a>(inode);                             <span class="comment">// get the first level</span></div>
<div class="line"><span class="lineno">  383</span>    <span class="keywordflow">if</span> (size &lt;= 28&lt;&lt;12) <span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[map1][pg_offset];    <span class="comment">// if size is &lt;= 28 pages, then 1 level</span></div>
<div class="line"><span class="lineno">  384</span>    <span class="keywordtype">int</span> map2 = <a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[map1][pg_offset/16];                 <span class="comment">// else get the second  level</span></div>
<div class="line"><span class="lineno">  385</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[map2][pg_offset%16];                     <span class="comment">// then get the page</span></div>
<div class="line"><span class="lineno">  386</span>}</div>
<div class="ttc" id="akfs_8c_html_a2e7cb7a15052f57bdff8a2c1146bc072"><div class="ttname"><a href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a></div><div class="ttdeci">int kfs_size(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:147</div></div>
<div class="ttc" id="akfs_8c_html_af148b22d686f5b43341249ba9d03eb54"><div class="ttname"><a href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap</a></div><div class="ttdeci">static int kfs_fmap(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:365</div></div>
<div class="ttc" id="astructkfs__inode__s_html_aea74f0e1495f40cf25e36f8963b84e8b"><div class="ttname"><a href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a></div><div class="ttdeci">u16_t page[12]</div><div class="ttdoc">first 12 pages of a file (12*4kib=48kb)</div><div class="ttdef"><b>Definition:</b> kfs.c:55</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, and <a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read()</a>.</p>

</div>
</div>
<a id="a6f523fed1e918f807739ab6ee760d270" name="a6f523fed1e918f807739ab6ee760d270"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f523fed1e918f807739ab6ee760d270">&#9670;&#160;</a></span>kfs_ppage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> * kfs_ppage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td>
          <td class="paramname"><em>pg_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>returns the pointer to the box containing the page number of the disk corresponding to the page npg_offset of a file. This box is in the inode or in the fmaps.</p><ul>
<li>The 12 first pages are directly referenced by the inode, thus if file is smaller than 48kiB we have just to look in the inode (case [A])</li>
<li>The following 16 are referenced in a fmap pointed by the inode, but olny if file size is smaller than 28 (12+16) pages (112kiB) (case [B])</li>
<li>if the file is greater than 28 pages then the 1st level of map references a 2nd level of fmap and this 2nd level of fmap references pages, thus 16 x 16 pages (1MiB) (case [C])</li>
<li>if fmaps are not yet allocated, the function will do it We may have to create up to 2 maps (1st and 2nd level) and a page. There are many sub-cases depending on the current file size and the future size. </li>
</ul>
<div class="fragment"><div class="line"><span class="lineno">  402</span>{</div>
<div class="line"><span class="lineno">  403</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> size = <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a>;              <span class="comment">// previous size of file</span></div>
<div class="line"><span class="lineno">  404</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> * pfmap2in1;                              <span class="comment">// address of 2nd lev fmap in 1st lev fmap</span></div>
<div class="line"><span class="lineno">  405</span>    <a class="code hl_typedef" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a> * pfmap1;                            <span class="comment">// 1st level of fmap address</span></div>
<div class="line"><span class="lineno">  406</span>    <a class="code hl_typedef" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a> * pfmap2;                            <span class="comment">// 2nd level of fmap address</span></div>
<div class="line"><span class="lineno">  407</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> fmap;                                     <span class="comment">// 2nd level of fmap</span></div>
<div class="line"><span class="lineno">  408</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> old_pg_size = size &gt;&gt; 12;                 <span class="comment">// old last page offset of the file</span></div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>    <span class="keywordflow">if</span> (pg_offset &lt; 12)                             <span class="comment">// if inside 12 pages mapped by inode</span></div>
<div class="line"><span class="lineno">  411</span>        <span class="keywordflow">return</span> &amp;(<a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">page</a>[pg_offset]);  <span class="comment">// -- get the address of page number</span></div>
<div class="line"><span class="lineno">  412</span> </div>
<div class="line"><span class="lineno">  413</span>    <span class="keywordflow">if</span> (old_pg_size &lt; 12) {                         <span class="comment">// if old size is &lt;= 12 pages</span></div>
<div class="line"><span class="lineno">  414</span>        fmap = <a class="code hl_function" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap</a>();                    <span class="comment">// -- alloc a new fmap</span></div>
<div class="line"><span class="lineno">  415</span>        <span class="keywordflow">if</span> (fmap == 0) <span class="keywordflow">return</span> <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;                 <span class="comment">// -- no more fmap</span></div>
<div class="line"><span class="lineno">  416</span>        <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a> = fmap;                <span class="comment">// -- connect inode to the 1st level fmap</span></div>
<div class="line"><span class="lineno">  417</span>    }</div>
<div class="line"><span class="lineno">  418</span>    pg_offset -= 12;                                <span class="comment">// shift of 12 for the pg_offset</span></div>
<div class="line"><span class="lineno">  419</span>    pfmap1 = &amp;(<a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[<a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a>]);      <span class="comment">// get the address of 1st level of fmap</span></div>
<div class="line"><span class="lineno">  420</span>    <span class="keywordflow">if</span> (pg_offset &lt; 16)                             <span class="comment">// if new page offset is &lt; 28</span></div>
<div class="line"><span class="lineno">  421</span>        <span class="keywordflow">return</span> &amp;((*pfmap1)[pg_offset]);             <span class="comment">// -- get addr of page nbr in 1st level fmap</span></div>
<div class="line"><span class="lineno">  422</span> </div>
<div class="line"><span class="lineno">  423</span>    <span class="keywordflow">if</span> (old_pg_size &lt; 28) {                         <span class="comment">// if need to change from a 1 to 2 level fmap</span></div>
<div class="line"><span class="lineno">  424</span>        fmap = <a class="code hl_function" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap</a>();                    <span class="comment">// -- new 1st level fmap</span></div>
<div class="line"><span class="lineno">  425</span>        <span class="keywordflow">if</span> (fmap == 0) <span class="keywordflow">return</span> <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;                 <span class="comment">// -- no more fmap</span></div>
<div class="line"><span class="lineno">  426</span>        <a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap][0] = <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a>;    <span class="comment">// -- the old fmap that becomes 2nd level</span></div>
<div class="line"><span class="lineno">  427</span>        <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a> = fmap;                <span class="comment">// -- connect inode to the 1st level fmap</span></div>
<div class="line"><span class="lineno">  428</span>        pfmap1 = &amp;(<a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[<a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a>]);  <span class="comment">// -- get the new addr of 1st level of fmap</span></div>
<div class="line"><span class="lineno">  429</span>    }</div>
<div class="line"><span class="lineno">  430</span>    pfmap2in1 = &amp;((*pfmap1)[pg_offset/16]);         <span class="comment">// get addr of 2nd fmap in 1st fmap</span></div>
<div class="line"><span class="lineno">  431</span>    <span class="keywordflow">if</span> (*pfmap2in1 == 0) {                          <span class="comment">// if 2nd level does not exit</span></div>
<div class="line"><span class="lineno">  432</span>        fmap = <a class="code hl_function" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap</a>();                    <span class="comment">// -- new 2nd level of fmap</span></div>
<div class="line"><span class="lineno">  433</span>        <span class="keywordflow">if</span> (fmap == 0) <span class="keywordflow">return</span> <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;                 <span class="comment">// -- no more fmap</span></div>
<div class="line"><span class="lineno">  434</span>        *pfmap2in1 = fmap;                          <span class="comment">// -- update le 1st level of fmap</span></div>
<div class="line"><span class="lineno">  435</span>    }</div>
<div class="line"><span class="lineno">  436</span>    pfmap2 = &amp;(<a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[*pfmap2in1]);                <span class="comment">// get the address of 2nd level of fmap</span></div>
<div class="line"><span class="lineno">  437</span>    <span class="keywordflow">return</span> &amp;((*pfmap2)[pg_offset%16]);              <span class="comment">// get addr of page nbr in 2nd level fmap</span></div>
<div class="line"><span class="lineno">  438</span>}</div>
<div class="ttc" id="akfs_8c_html_a4899d84042ad3892c13dc7a360f65d86"><div class="ttname"><a href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap</a></div><div class="ttdeci">static int kfs_alloc_fmap(void)</div><div class="ttdoc">allocates a new map, map 0 is never free</div><div class="ttdef"><b>Definition:</b> kfs.c:329</div></div>
<div class="ttc" id="akfs_8c_html_a7db204b3134ab7e4824022eec748871c"><div class="ttname"><a href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a></div><div class="ttdeci">u16_t kfs_fmap_t[16]</div><div class="ttdoc">fmap as inode extension, maps until 16 pages or 16 other fmaps</div><div class="ttdef"><b>Definition:</b> kfs.c:59</div></div>
<div class="ttc" id="astructkfs__inode__s_html_ae4c3aa6d76cc8e92a9b29c2b3707f473"><div class="ttname"><a href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a></div><div class="ttdeci">u32_t size</div><div class="ttdoc">file size is 16mib max</div><div class="ttdef"><b>Definition:</b> kfs.c:50</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">kfs_inode_s::fmap</a>, <a class="el" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap()</a>, <a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a>, and <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>.</p>

</div>
</div>
<a id="a532e7e965bd6809645bdf682ffd509dc" name="a532e7e965bd6809645bdf682ffd509dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a532e7e965bd6809645bdf682ffd509dc">&#9670;&#160;</a></span>kfs_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_read </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pg_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a file, it reads one page from the file dentry to memory buffer. After reading, buffer will contain the entire page of which the offset belongs. </p>
<p>Try to read an entire page (4kiB) from file dentry </p>
<div class="fragment"><div class="line"><span class="lineno">  590</span>{</div>
<div class="line"><span class="lineno">  591</span>    <span class="keywordtype">int</span> page = <a class="code hl_function" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a> (<a class="code hl_function" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a> (dentry), pg_offset);     <span class="comment">// get the page number in the disk</span></div>
<div class="line"><span class="lineno">  592</span>    <span class="keywordflow">if</span> (page == -1) <span class="keywordflow">return</span> 0;                               <span class="comment">// if outside of the file</span></div>
<div class="line"><span class="lineno">  593</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page</a> (buf, page);                       <span class="comment">// at last read disk page to buf</span></div>
<div class="line"><span class="lineno">  594</span>}</div>
<div class="ttc" id="akfs_8c_html_a23a78b350153b3b7ae5ca00a1de7484a"><div class="ttname"><a href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page</a></div><div class="ttdeci">static int kfs_read_page(int *buf, u16_t page)</div><div class="ttdoc">Reads from the disk to the memory buffer. There are two cases : 1) if kfs runs on Linux 2) if kfs run...</div><div class="ttdef"><b>Definition:</b> kfs.c:450</div></div>
<div class="ttc" id="akfs_8c_html_aae206d59d8bc4514d34dafdff1198ede"><div class="ttname"><a href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a></div><div class="ttdeci">int kfs_inode(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:139</div></div>
<div class="ttc" id="akfs_8c_html_afdc75626536d311fb2fe47baef24ef55"><div class="ttname"><a href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a></div><div class="ttdeci">int kfs_page(int inode, int pg_offset)</div><div class="ttdef"><b>Definition:</b> kfs.c:376</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, and <a class="el" href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="a23a78b350153b3b7ae5ca00a1de7484a" name="a23a78b350153b3b7ae5ca00a1de7484a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23a78b350153b3b7ae5ca00a1de7484a">&#9670;&#160;</a></span>kfs_read_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kfs_read_page </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a>&#160;</td>
          <td class="paramname"><em>page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reads from the disk to the memory buffer. There are two cases : 1) if kfs runs on Linux 2) if kfs runs on ko6 1) Linux: the kfs disk has been loaded in an array, so that's where we have to read it 2) ko6: the kfs disk is behind the disk device, so we need to ask the disk driver. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>is a buffer address in memory </td></tr>
    <tr><td class="paramname">page</td><td>is a page number on disk, if page == 0 then the page is considered as full of 0 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if buf is filled with 0, 1 if the page read is not empty or -1 in case of failure If page read on disk in empty, but we return 1 it is not a problem </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  451</span>{</div>
<div class="line"><span class="lineno">  452</span>    <span class="keywordtype">int</span> a = 0;                                              <span class="comment">// counter of words</span></div>
<div class="line"><span class="lineno">  453</span>    <span class="keywordflow">if</span> (page == 0) {                                        <span class="comment">// the page 0 is full of 0</span></div>
<div class="line"><span class="lineno">  454</span>        <span class="keywordflow">for</span> (; a != 1024; a++, *(<span class="keywordtype">int</span> *)buf++ = 0);          <span class="comment">// fill buffer with 0</span></div>
<div class="line"><span class="lineno">  455</span>        <span class="keywordflow">return</span> 0;                                           <span class="comment">// success</span></div>
<div class="line"><span class="lineno">  456</span>    }</div>
<div class="line"><span class="lineno">  457</span><span class="preprocessor">#ifdef HOST</span></div>
<div class="line"><span class="lineno">  458</span>    <span class="keywordtype">int</span> * ppage = (<span class="keywordtype">int</span> *)KfsDisk[page];               <span class="comment">// ppage points to the first int of page</span></div>
<div class="line"><span class="lineno">  459</span>    <span class="keywordflow">for</span> (; a != 1024; a++, *buf++ = *ppage++);</div>
<div class="line"><span class="lineno">  460</span>    <span class="keywordflow">return</span> 1;                                               <span class="comment">// success</span></div>
<div class="line"><span class="lineno">  461</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  462</span>    <span class="keywordflow">return</span> -1;                                              <span class="comment">// FIXME  Real disk not yet handled</span></div>
<div class="line"><span class="lineno">  463</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  464</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a532e7e965bd6809645bdf682ffd509dc">kfs_read()</a>.</p>

</div>
</div>
<a id="aee8d1799ae389468763ccfbe157c42ec" name="aee8d1799ae389468763ccfbe157c42ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee8d1799ae389468763ccfbe157c42ec">&#9670;&#160;</a></span>kfs_readdir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_readdir </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>leaf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading, buffer will contain the name of the directory or item. </p>
<p>readdir reads all entries in a directory </p>
<div class="fragment"><div class="line"><span class="lineno">  575</span>{</div>
<div class="line"><span class="lineno">  576</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a>(root)) <span class="keywordflow">return</span> -1;                        <span class="comment">// root dentry must be a directory</span></div>
<div class="line"><span class="lineno">  577</span> </div>
<div class="line"><span class="lineno">  578</span>    <span class="keywordflow">if</span> (buf) <a class="code hl_function" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy</a> (buf, <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].name);        <span class="comment">// if asked, get this leaf dentry name</span></div>
<div class="line"><span class="lineno">  579</span>    <span class="keywordflow">if</span> (leaf == root)                                       <span class="comment">// at first, leaf is the root</span></div>
<div class="line"><span class="lineno">  580</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code hl_variable" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;                        <span class="comment">// get the first leaf thus 0 if empty</span></div>
<div class="line"><span class="lineno">  581</span> </div>
<div class="line"><span class="lineno">  582</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].root != root) <span class="keywordflow">return</span> -1;            <span class="comment">// leaf must be in root directory</span></div>
<div class="line"><span class="lineno">  583</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code hl_variable" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;                            <span class="comment">// find and return next leaf (0 if last)</span></div>
<div class="line"><span class="lineno">  584</span>}</div>
<div class="ttc" id="akfs_8c_html_ac2308b1a426032672fbacdde9ee5ac81"><div class="ttname"><a href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a></div><div class="ttdeci">int kfs_isdir(int dentry)</div><div class="ttdoc">boolean functions for dentries or inode</div><div class="ttdef"><b>Definition:</b> kfs.c:142</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir()</a>, <a class="el" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>, and <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>.</p>

</div>
</div>
<a id="ade5bf93265bc86a9ecd5019cc6e3d277" name="ade5bf93265bc86a9ecd5019cc6e3d277"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade5bf93265bc86a9ecd5019cc6e3d277">&#9670;&#160;</a></span>kfs_root()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_root </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>read access functions to dentries </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of a dentry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- a dentry number for <a class="el" href="kfs_8h.html#ade5bf93265bc86a9ecd5019cc6e3d277" title="read access functions to dentries">kfs_root()</a>, <a class="el" href="kfs_8h.html#a3be0d586ff3044979a3c381137d77d47">kfs_next()</a>, <a class="el" href="kfs_8h.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf()</a>. For these three functions, 0 means either file system root '/' or last leaf<ul>
<li>the inode number for <a class="el" href="kfs_8h.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, there is always one</li>
<li>the pointer to the entry name for <a class="el" href="kfs_8h.html#a2c752ffc3e5d008879e7035508bac847">kfs_name()</a> </li>
</ul>
</dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  136</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">root</a> ;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, and <a class="el" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a8563170876d354e520a737e1c358b875">kfs_absolute_pathname()</a>, and <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>

</div>
</div>
<a id="a491e452cdf42853498249aadc91eb74b" name="a491e452cdf42853498249aadc91eb74b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a491e452cdf42853498249aadc91eb74b">&#9670;&#160;</a></span>kfs_set_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_set_size </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the size field of the inode associated with the dentry to newsize. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>given by open or openat </td></tr>
    <tr><td class="paramname">newsize</td><td>new size of the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int : the size of the file after modification </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  601</span>{</div>
<div class="line"><span class="lineno">  602</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> inode = <a class="code hl_function" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);                <span class="comment">// get inode associated with the dentry</span></div>
<div class="line"><span class="lineno">  603</span>    <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a> = newsize;                 <span class="comment">// set the new size</span></div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode);</div>
<div class="line"><span class="lineno">  606</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, and <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>

</div>
</div>
<a id="a2e7cb7a15052f57bdff8a2c1146bc072" name="a2e7cb7a15052f57bdff8a2c1146bc072"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e7cb7a15052f57bdff8a2c1146bc072">&#9670;&#160;</a></span>kfs_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_size </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  147</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a>; }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, <a class="el" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="a09fba9a0bb78a0f1f159c01046c7e006" name="a09fba9a0bb78a0f1f159c01046c7e006"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09fba9a0bb78a0f1f159c01046c7e006">&#9670;&#160;</a></span>kfs_strcmp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kfs_strcmp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>compare two strings of characters </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s1</td><td>is the first string </td></tr>
    <tr><td class="paramname">s2</td><td>is the second string </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if s1 == s2 or the difference between s1 and s2 on the first character that differs </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  213</span>{</div>
<div class="line"><span class="lineno">  214</span>    <a class="code hl_typedef" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a> c1, c2;</div>
<div class="line"><span class="lineno">  215</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">  216</span>        c1 = (<a class="code hl_typedef" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a>) *s1++;</div>
<div class="line"><span class="lineno">  217</span>        c2 = (<a class="code hl_typedef" href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a>) *s2++;</div>
<div class="line"><span class="lineno">  218</span>    }</div>
<div class="line"><span class="lineno">  219</span>    <span class="keywordflow">while</span> (c1 &amp;&amp; (c1 == c2));</div>
<div class="line"><span class="lineno">  220</span>    <span class="keywordflow">return</span> c1 - c2;</div>
<div class="line"><span class="lineno">  221</span>}</div>
<div class="ttc" id="akfs_8c_html_ae081489b4906f65a3cb18e9fbe9f8d23"><div class="ttname"><a href="kfs_8c.html#ae081489b4906f65a3cb18e9fbe9f8d23">u8_t</a></div><div class="ttdeci">unsigned char u8_t</div><div class="ttdef"><b>Definition:</b> kfs.c:28</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>.</p>

</div>
</div>
<a id="aceb626dd864e7f2ccd7901d0506dbaf4" name="aceb626dd864e7f2ccd7901d0506dbaf4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aceb626dd864e7f2ccd7901d0506dbaf4">&#9670;&#160;</a></span>kfs_strcpy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void kfs_strcpy </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>copy a string of characters </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dest</td><td>is the address of the destination buffer </td></tr>
    <tr><td class="paramname">src</td><td>is the address of the source buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>nothing but the side effect on destination buffer </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  200</span>{</div>
<div class="line"><span class="lineno">  201</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; (i &lt; <a class="code hl_define" href="kfs_8c.html#ae0b389bdf68187ccb1610271d36edb33">KFS_MAX_NAME</a>) &amp;&amp; (*src); i++)</div>
<div class="line"><span class="lineno">  202</span>        *dest++ = *src++;</div>
<div class="line"><span class="lineno">  203</span>    *dest = 0;</div>
<div class="line"><span class="lineno">  204</span>}</div>
<div class="ttc" id="akfs_8c_html_ae0b389bdf68187ccb1610271d36edb33"><div class="ttname"><a href="kfs_8c.html#ae0b389bdf68187ccb1610271d36edb33">KFS_MAX_NAME</a></div><div class="ttdeci">#define KFS_MAX_NAME</div><div class="ttdef"><b>Definition:</b> kfs.c:37</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ae0b389bdf68187ccb1610271d36edb33">KFS_MAX_NAME</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry()</a>, and <a class="el" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir()</a>.</p>

</div>
</div>
<a id="a0c8753d9a11f6570f9c56b587fa2c48c" name="a0c8753d9a11f6570f9c56b587fa2c48c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c8753d9a11f6570f9c56b587fa2c48c">&#9670;&#160;</a></span>kfs_tree_cb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_tree_cb </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(int dentry, int depth, int postion)&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  682</span>{</div>
<div class="line"><span class="lineno">  683</span>    callback (root, 0, 0);                                  <span class="comment">// callback function execution on root</span></div>
<div class="line"><span class="lineno">  684</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a>(root)) <span class="keywordflow">return</span> 1;                         <span class="comment">// if not a directory, it is finished</span></div>
<div class="line"><span class="lineno">  685</span>    <span class="keywordflow">return</span> 1+<a class="code hl_function" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r</a> (root, 1, callback);             <span class="comment">// else start the recursion</span></div>
<div class="line"><span class="lineno">  686</span>}</div>
<div class="ttc" id="akfs_8c_html_af01886bc6c6c809f5f46eda025ef5ec3"><div class="ttname"><a href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r</a></div><div class="ttdeci">static int kfs_tree_cb_r(int root, int depth, void(*callback)(int dentry, int depth, int pos))</div><div class="ttdoc">Recursively executes the callback() function for all entries in a directory. This is a deep-first wal...</div><div class="ttdef"><b>Definition:</b> kfs.c:502</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir()</a>, and <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files()</a>, <a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a id="af01886bc6c6c809f5f46eda025ef5ec3" name="af01886bc6c6c809f5f46eda025ef5ec3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af01886bc6c6c809f5f46eda025ef5ec3">&#9670;&#160;</a></span>kfs_tree_cb_r()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kfs_tree_cb_r </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>depth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(int dentry, int depth, int pos)&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Recursively executes the callback() function for all entries in a directory. This is a deep-first walk. The callback() function is not executed on the root. _cb_r means "call back recursive" This function must not be used directly, it is used by <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">root</td><td>has to be a dentry of a directory </td></tr>
    <tr><td class="paramname">depth</td><td>is the current depth of the walk </td></tr>
    <tr><td class="paramname">callback</td><td>is the callback function exectuted on each entry the call back function receives 3 arguments<ul>
<li>dentry is the current entry in this directory which can be of any type</li>
<li>depth is the current depth of the walk (necessarily &gt;= 1)</li>
<li>pos is the current position in the current direcrory </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of calls of callback() </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  503</span>{</div>
<div class="line"><span class="lineno">  504</span>    <span class="keywordtype">int</span> calls = 0;                                          <span class="comment">// nb of calls at this depth</span></div>
<div class="line"><span class="lineno">  505</span>    <span class="keywordtype">int</span> pos = 0;                                            <span class="comment">// leaf position in current directory</span></div>
<div class="line"><span class="lineno">  506</span>    <span class="keywordtype">int</span> leaf = <a class="code hl_function" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir</a> (root, root, <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);              <span class="comment">// root dentry has to be a directory</span></div>
<div class="line"><span class="lineno">  507</span>    <span class="keywordflow">if</span> (leaf == -1) <span class="keywordflow">return</span> 0;                               <span class="comment">// if root is not a directory do nothing</span></div>
<div class="line"><span class="lineno">  508</span>    <span class="keywordflow">while</span> (leaf) {                                          <span class="comment">// while a leaf has been found</span></div>
<div class="line"><span class="lineno">  509</span>        callback (leaf, depth, pos++);                      <span class="comment">// callback function execution</span></div>
<div class="line"><span class="lineno">  510</span>        calls++;                                            <span class="comment">// increment the number of calls</span></div>
<div class="line"><span class="lineno">  511</span>        <span class="keywordflow">if</span> (leaf &amp;&amp; <a class="code hl_function" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a>(leaf))                        <span class="comment">// if current leaf is a directory</span></div>
<div class="line"><span class="lineno">  512</span>            calls += <a class="code hl_function" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r</a> (leaf, depth+1,callback);<span class="comment">// recursive call to kfs_tree_cb_r()</span></div>
<div class="line"><span class="lineno">  513</span>        leaf = <a class="code hl_function" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir</a> (root, leaf, <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);              <span class="comment">// get the next leaf in current root</span></div>
<div class="line"><span class="lineno">  514</span>    }</div>
<div class="line"><span class="lineno">  515</span>    <span class="keywordflow">return</span> calls;</div>
<div class="line"><span class="lineno">  516</span>}</div>
<div class="ttc" id="akfs_8c_html_aee8d1799ae389468763ccfbe157c42ec"><div class="ttname"><a href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir</a></div><div class="ttdeci">int kfs_readdir(int root, int leaf, void *buf)</div><div class="ttdoc">Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading,...</div><div class="ttdef"><b>Definition:</b> kfs.c:574</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir()</a>, <a class="el" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir()</a>, <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>, and <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>, and <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>.</p>

</div>
</div>
<a id="a8d546cf291d26ab01a150b74cc206ae1" name="a8d546cf291d26ab01a150b74cc206ae1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d546cf291d26ab01a150b74cc206ae1">&#9670;&#160;</a></span>kfs_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_type </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  145</span>{<span class="keywordflow">return</span> <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a>; }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, and <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>

</div>
</div>
<a id="a46783800e799435356d388150e2a5cec" name="a46783800e799435356d388150e2a5cec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46783800e799435356d388150e2a5cec">&#9670;&#160;</a></span>kfs_unlink()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_unlink </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  648</span>{</div>
<div class="line"><span class="lineno">  649</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dentry = <a class="code hl_function" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (name);</div>
<div class="line"><span class="lineno">  650</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> inode = <a class="code hl_variable" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code hl_variable" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;</div>
<div class="line"><span class="lineno">  651</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> size = <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a>;</div>
<div class="line"><span class="lineno">  652</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> fmap1 = <a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a>;</div>
<div class="line"><span class="lineno">  653</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> fmap2 = 0;</div>
<div class="line"><span class="lineno">  654</span>    <a class="code hl_typedef" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> freemap=0;</div>
<div class="line"><span class="lineno">  655</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> * ppage;</div>
<div class="line"><span class="lineno">  656</span> </div>
<div class="line"><span class="lineno">  657</span>    <a class="code hl_function" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry</a> (dentry);</div>
<div class="line"><span class="lineno">  658</span> </div>
<div class="line"><span class="lineno">  659</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].count-- == 0) {</div>
<div class="line"><span class="lineno">  660</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = size, p = 0; s &gt; 0; s -= 1&lt;&lt;12, p++){</div>
<div class="line"><span class="lineno">  661</span>            <span class="keywordflow">if</span> (p &lt; 12) {</div>
<div class="line"><span class="lineno">  662</span>                ppage = &amp;(<a class="code hl_variable" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code hl_variable" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">page</a>[p]);</div>
<div class="line"><span class="lineno">  663</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &lt;= (28&lt;&lt;12)) {</div>
<div class="line"><span class="lineno">  664</span>                ppage = &amp;(<a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap1][p-12]);</div>
<div class="line"><span class="lineno">  665</span>                <span class="keywordflow">if</span> (p == size&gt;&gt;12) freemap=1;</div>
<div class="line"><span class="lineno">  666</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  667</span>                fmap2 = <a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap1][(p-12)/16];</div>
<div class="line"><span class="lineno">  668</span>                ppage = &amp;(<a class="code hl_variable" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap2][(p-12)%16]);</div>
<div class="line"><span class="lineno">  669</span>                <span class="keywordflow">if</span> ((p-12)%16 == 15) freemap=2;</div>
<div class="line"><span class="lineno">  670</span>                <span class="keywordflow">if</span> (p == size&gt;&gt;12) freemap=3;</div>
<div class="line"><span class="lineno">  671</span>            }</div>
<div class="line"><span class="lineno">  672</span>            <a class="code hl_function" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a> (*ppage);</div>
<div class="line"><span class="lineno">  673</span>            <span class="keywordflow">if</span> (freemap &amp; 1) <a class="code hl_function" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a>(fmap1);</div>
<div class="line"><span class="lineno">  674</span>            <span class="keywordflow">if</span> (freemap &amp; 2) <a class="code hl_function" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a>(fmap2);</div>
<div class="line"><span class="lineno">  675</span>        }</div>
<div class="line"><span class="lineno">  676</span>        <a class="code hl_function" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a> (inode);</div>
<div class="line"><span class="lineno">  677</span>    }</div>
<div class="line"><span class="lineno">  678</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  679</span>}</div>
<div class="ttc" id="akfs_8c_html_a2b773f0350f13077e1479fe36941da52"><div class="ttname"><a href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a></div><div class="ttdeci">static void kfs_free_fmap(u16_t fmap)</div><div class="ttdoc">frees a map</div><div class="ttdef"><b>Definition:</b> kfs.c:338</div></div>
<div class="ttc" id="akfs_8c_html_a5d172bef33b255bfe7ec0375abac988e"><div class="ttname"><a href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry</a></div><div class="ttdeci">static void kfs_free_dentry(u16_t dentry)</div><div class="ttdoc">frees a dentry (it is not necessary to erase its content, it will be done in allocation)</div><div class="ttdef"><b>Definition:</b> kfs.c:277</div></div>
<div class="ttc" id="akfs_8c_html_ac364ca8f5189a2eaf2f7cbeef0a27698"><div class="ttname"><a href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a></div><div class="ttdeci">static void kfs_free_page(u16_t page)</div><div class="ttdoc">frees a page of the disk</div><div class="ttdef"><b>Definition:</b> kfs.c:358</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">kfs_inode_s::fmap</a>, <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry()</a>, <a class="el" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap()</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, <a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>, <a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>, <a class="el" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>, <a class="el" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a>, and <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>

</div>
</div>
<a id="a57b5123b2f69a99505a7f3026eeefce9" name="a57b5123b2f69a99505a7f3026eeefce9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57b5123b2f69a99505a7f3026eeefce9">&#9670;&#160;</a></span>kfs_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_write </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pg_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of which the offset belongs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>given by open or openat </td></tr>
    <tr><td class="paramname">pg_offset</td><td>is the number of the page that will be written </td></tr>
    <tr><td class="paramname">buffer</td><td>contains the page to write (at least one page length) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of pages written 1 if success with page in disk as a side effect, 0 if success but buffer was full of 0, thus no page needs to be allocated -1 if something is wrong </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  618</span>{</div>
<div class="line"><span class="lineno">  619</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> inode = <a class="code hl_function" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);                <span class="comment">// get inode associated with the dentry</span></div>
<div class="line"><span class="lineno">  620</span>    <a class="code hl_typedef" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> *ppage = <a class="code hl_function" href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage</a> (inode, pg_offset);    <span class="comment">// get addr in fmaps of page number (alloc fmap)</span></div>
<div class="line"><span class="lineno">  621</span>    <span class="keywordflow">if</span> (ppage == <a class="code hl_define" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> -1;                   <span class="comment">// NULL means no more space in fmaps</span></div>
<div class="line"><span class="lineno">  622</span>    <span class="keywordflow">if</span> (*ppage == 0) *ppage = <a class="code hl_function" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page</a>();     <span class="comment">// if page absent, allocate a new page</span></div>
<div class="line"><span class="lineno">  623</span>    <span class="keywordflow">if</span> (*ppage == 0) <span class="keywordflow">return</span> -1;                     <span class="comment">// 0 means no more space on the disk</span></div>
<div class="line"><span class="lineno">  624</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page</a> (buf, *ppage)) <span class="keywordflow">return</span> 1;     <span class="comment">// at last write disk page from buf</span></div>
<div class="line"><span class="lineno">  625</span>    <a class="code hl_function" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a> (*ppage);                         <span class="comment">// if returns 0, it means page full of 0</span></div>
<div class="line"><span class="lineno">  626</span>    <span class="keywordflow">return</span> *ppage = 0;                              <span class="comment">// erase page number in fmap;</span></div>
<div class="line"><span class="lineno">  627</span>}</div>
<div class="ttc" id="akfs_8c_html_a53fd0386d2feed317c9d6bdc536e4540"><div class="ttname"><a href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page</a></div><div class="ttdeci">static u16_t kfs_alloc_page(void)</div><div class="ttdoc">allocates a new page of the disk</div><div class="ttdef"><b>Definition:</b> kfs.c:349</div></div>
<div class="ttc" id="akfs_8c_html_a6f523fed1e918f807739ab6ee760d270"><div class="ttname"><a href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage</a></div><div class="ttdeci">static u16_t * kfs_ppage(u16_t inode, u16_t pg_offset)</div><div class="ttdef"><b>Definition:</b> kfs.c:401</div></div>
<div class="ttc" id="akfs_8c_html_a82cd5257064f4d5b995d6951b9f054b3"><div class="ttname"><a href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page</a></div><div class="ttdeci">static int kfs_write_page(void *buf, int page)</div><div class="ttdoc">writes to the disk from the memory buffer</div><div class="ttdef"><b>Definition:</b> kfs.c:473</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page()</a>, <a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page()</a>, <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage()</a>, <a class="el" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page()</a>, and <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, and <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>

</div>
</div>
<a id="a82cd5257064f4d5b995d6951b9f054b3" name="a82cd5257064f4d5b995d6951b9f054b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82cd5257064f4d5b995d6951b9f054b3">&#9670;&#160;</a></span>kfs_write_page()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kfs_write_page </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>writes to the disk from the memory buffer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">buf</td><td>is a buffer address in memory </td></tr>
    <tr><td class="paramname">page</td><td>is a page number on disk </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if new page is full of 0, 1 if the page written is not empty or -1 in case of failure. If page written on disk in empty, but we return 1 it is not a problem </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  474</span>{</div>
<div class="line"><span class="lineno">  475</span><span class="preprocessor">#ifdef HOST</span></div>
<div class="line"><span class="lineno">  476</span>    <span class="keywordtype">int</span> res = 0;                                            <span class="comment">// return value</span></div>
<div class="line"><span class="lineno">  477</span>    <span class="keywordtype">int</span> a = 0;                                              <span class="comment">// counter of words</span></div>
<div class="line"><span class="lineno">  478</span>    <span class="keywordtype">int</span> * <a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a> = (<span class="keywordtype">int</span> *)buf;                              <span class="comment">// cast buf to int</span></div>
<div class="line"><span class="lineno">  479</span>    <span class="keywordtype">int</span> * ppage = (<span class="keywordtype">int</span> *)KfsDisk[page];                     <span class="comment">// ppage points to the first int of page</span></div>
<div class="line"><span class="lineno">  480</span>    <span class="keywordflow">if</span> ((page == 0) || (page &gt;= <a class="code hl_define" href="kfs_8h.html#a7c0f2945d18d92bc9b2e754b377335b3">KFS_NPG_DISK</a>)) <span class="keywordflow">return</span> -1;   <span class="comment">// condition : 0 &lt; page &lt; KFS_NBPAGES</span></div>
<div class="line"><span class="lineno">  481</span>    <span class="keywordflow">for</span>(;a != 1024; a++, res |= (*ppage++ = *<a class="code hl_variable" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>++));    <span class="comment">// memory buf to disk page, compute res</span></div>
<div class="line"><span class="lineno">  482</span>    <span class="keywordflow">return</span> (res) ? 1 : 0;                                   <span class="comment">// if res remains 0 return 0 else 1</span></div>
<div class="line"><span class="lineno">  483</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  484</span>    <span class="keywordflow">return</span> -1;                                              <span class="comment">// FIXME Real disk not yet handled</span></div>
<div class="line"><span class="lineno">  485</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  486</span>}</div>
<div class="ttc" id="akfs_8h_html_a7c0f2945d18d92bc9b2e754b377335b3"><div class="ttname"><a href="kfs_8h.html#a7c0f2945d18d92bc9b2e754b377335b3">KFS_NPG_DISK</a></div><div class="ttdeci">#define KFS_NPG_DISK</div><div class="ttdef"><b>Definition:</b> kfs.h:33</div></div>
<div class="ttc" id="aktools_8c_html_a527b76b33fb8beec7f2df7e0c032aef6"><div class="ttname"><a href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a></div><div class="ttdeci">static char buffer[1&lt;&lt; 12]</div><div class="ttdef"><b>Definition:</b> ktools.c:76</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>, and <a class="el" href="kfs_8h.html#a7c0f2945d18d92bc9b2e754b377335b3">KFS_NPG_DISK</a>.</p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a57b5123b2f69a99505a7f3026eeefce9">kfs_write()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a4c9c9ecc30db3a783a700f4e79f9561e" name="a4c9c9ecc30db3a783a700f4e79f9561e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c9c9ecc30db3a783a700f4e79f9561e">&#9670;&#160;</a></span>KfsDentry</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kfs_8c.html#ae4356b2f3be21f839915b3bae8530b06">kfs_dentry_t</a> KfsDentry[<a class="el" href="kfs_8c.html#a92ab7d744c9853bdebee5c81ac2b422f">KFS_MAX_DENTRY</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>up to MAX_DENTRY files </p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry()</a>, <a class="el" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry()</a>, <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir()</a>, <a class="el" href="kfs_8c.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf()</a>, <a class="el" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link()</a>, <a class="el" href="kfs_8c.html#a2c752ffc3e5d008879e7035508bac847">kfs_name()</a>, <a class="el" href="kfs_8c.html#a3be0d586ff3044979a3c381137d77d47">kfs_next()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>, <a class="el" href="kfs_8c.html#aee8d1799ae389468763ccfbe157c42ec">kfs_readdir()</a>, <a class="el" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root()</a>, and <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>.</p>

</div>
</div>
<a id="adfe2302bd3dfd42413c478b8a32174cb" name="adfe2302bd3dfd42413c478b8a32174cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfe2302bd3dfd42413c478b8a32174cb">&#9670;&#160;</a></span>KfsFmap</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kfs_8c.html#a7db204b3134ab7e4824022eec748871c">kfs_fmap_t</a> KfsFmap[<a class="el" href="kfs_8c.html#a75563572783e6a8183fe1fa127b6453d">KFS_MAX_FMAP</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>up to MAX_FMAP inode extensions </p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap()</a>, <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, <a class="el" href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage()</a>, and <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>.</p>

</div>
</div>
<a id="ace1088077311b5b6a4d2fa6d330f4ccf" name="ace1088077311b5b6a4d2fa6d330f4ccf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace1088077311b5b6a4d2fa6d330f4ccf">&#9670;&#160;</a></span>KfsInode</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kfs_8c.html#abac7f4a360f61a2ce1f34b6e6b6028ff">kfs_inode_t</a> KfsInode[<a class="el" href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {    </div>
<div class="line">    [0] = {.type=<a class="code hl_enumvalue" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, .mode=077}</div>
<div class="line">}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode()</a>, <a class="el" href="kfs_8c.html#a30d4e1ffe8c1ea75120811fcf3055c05">kfs_chmode()</a>, <a class="el" href="kfs_8c.html#a68786a19dcb587fe18b45ae76effa1c5">kfs_chmtime()</a>, <a class="el" href="kfs_8c.html#a3e380775665de4ff6cbc01555444cb64">kfs_chowner()</a>, <a class="el" href="kfs_8c.html#aaa0d81604e0d3d23f31b3beb7dcb163c">kfs_count()</a>, <a class="el" href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap()</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, <a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir()</a>, <a class="el" href="kfs_8c.html#a4fa0207fb8a04e889050f380b9068e3a">kfs_link()</a>, <a class="el" href="kfs_8c.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode()</a>, <a class="el" href="kfs_8c.html#a9b41dd15430924703df46a579ff05b2e">kfs_mtime()</a>, <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>, <a class="el" href="kfs_8c.html#a2f522cb4edeecd6cbcebcca31d90bc75">kfs_owner()</a>, <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, <a class="el" href="kfs_8c.html#a6f523fed1e918f807739ab6ee760d270">kfs_ppage()</a>, <a class="el" href="kfs_8c.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type()</a>, and <a class="el" href="kfs_8c.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>.</p>

</div>
</div>
<a id="a4418baf5eb3028d32758a1ccd600be44" name="a4418baf5eb3028d32758a1ccd600be44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4418baf5eb3028d32758a1ccd600be44">&#9670;&#160;</a></span>KfsOffset</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> KfsOffset[<a class="el" href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a>]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>last offset used for inode by read write </p>

<p class="reference">Referenced by <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>.</p>

</div>
</div>
<a id="accc11417a4eed24097de41cf088d420b" name="accc11417a4eed24097de41cf088d420b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#accc11417a4eed24097de41cf088d420b">&#9670;&#160;</a></span>KfsSblock</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kfs_8c.html#a39d79370e49d3416fb6e2e05d4c40881">kfs_sblock_t</a> KfsSblock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {                   </div>
<div class="line">    .max_dentry = <a class="code hl_define" href="kfs_8c.html#a92ab7d744c9853bdebee5c81ac2b422f">KFS_MAX_DENTRY</a>,                   </div>
<div class="line">    .max_inode  = <a class="code hl_define" href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a>,</div>
<div class="line">    .max_fmap   = <a class="code hl_define" href="kfs_8c.html#a75563572783e6a8183fe1fa127b6453d">KFS_MAX_FMAP</a>,</div>
<div class="line">    .max_page   = <a class="code hl_define" href="kfs_8h.html#a7c0f2945d18d92bc9b2e754b377335b3">KFS_NPG_DISK</a>,</div>
<div class="line">    .cur_dentry = 1,                                </div>
<div class="line">    .cur_inode  = 1,                                </div>
<div class="line">    .cur_fmap   = 1,                                </div>
<div class="line">    .cur_page   = <a class="code hl_define" href="kfs_8c.html#af0ae18eb635e6562531a287fb89dd996">NPGU</a>,                             </div>
<div class="line">    .bmp_dentry = { [0] = 1 },                      </div>
<div class="line">    .bmp_inode  = { [0] = 1 },                      </div>
<div class="line">    .bmp_fmap   = { [0] = 1 },                      </div>
<div class="line">    .bmp_page   = {                                 </div>
<div class="line">        [0 ... ((<a class="code hl_define" href="kfs_8c.html#af0ae18eb635e6562531a287fb89dd996">NPGU</a>-1)/8)-1] = 0xFF,              </div>
<div class="line">        [((<a class="code hl_define" href="kfs_8c.html#af0ae18eb635e6562531a287fb89dd996">NPGU</a>+7)/8)-1] = (1&lt;&lt;(1+((<a class="code hl_define" href="kfs_8c.html#af0ae18eb635e6562531a287fb89dd996">NPGU</a>+7)%8)))-1} </div>
<div class="line">}</div>
<div class="ttc" id="akfs_8c_html_a75563572783e6a8183fe1fa127b6453d"><div class="ttname"><a href="kfs_8c.html#a75563572783e6a8183fe1fa127b6453d">KFS_MAX_FMAP</a></div><div class="ttdeci">#define KFS_MAX_FMAP</div><div class="ttdef"><b>Definition:</b> kfs.c:63</div></div>
<div class="ttc" id="akfs_8c_html_a92ab7d744c9853bdebee5c81ac2b422f"><div class="ttname"><a href="kfs_8c.html#a92ab7d744c9853bdebee5c81ac2b422f">KFS_MAX_DENTRY</a></div><div class="ttdeci">#define KFS_MAX_DENTRY</div><div class="ttdef"><b>Definition:</b> kfs.c:61</div></div>
<div class="ttc" id="akfs_8c_html_ac084ea319e447d4af876044655fc46ec"><div class="ttname"><a href="kfs_8c.html#ac084ea319e447d4af876044655fc46ec">KFS_MAX_INODE</a></div><div class="ttdeci">#define KFS_MAX_INODE</div><div class="ttdef"><b>Definition:</b> kfs.c:62</div></div>
<div class="ttc" id="akfs_8c_html_af0ae18eb635e6562531a287fb89dd996"><div class="ttname"><a href="kfs_8c.html#af0ae18eb635e6562531a287fb89dd996">NPGU</a></div><div class="ttdeci">#define NPGU</div><div class="ttdef"><b>Definition:</b> kfs.c:103</div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry()</a>, <a class="el" href="kfs_8c.html#a4899d84042ad3892c13dc7a360f65d86">kfs_alloc_fmap()</a>, <a class="el" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode()</a>, <a class="el" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page()</a>, <a class="el" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry()</a>, <a class="el" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap()</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, and <a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
