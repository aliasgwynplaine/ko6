\hypertarget{fdt__rw_8c}{\section{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-rw.c File Reference}
\label{fdt__rw_8c}\index{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-rw.\-c@{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-rw.\-c}}
}
{\ttfamily \#include \char`\"{}libfdt\-\_\-env.\-h\char`\"{}}\\*
{\ttfamily \#include $<$external/libfdt/fdt.\-h$>$}\\*
{\ttfamily \#include $<$external/libfdt/libfdt.\-h$>$}\\*
{\ttfamily \#include \char`\"{}libfdt\-\_\-internal.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E}(fdt)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{fdt__rw_8c_a85dfbfdc83212c333265fe389a585fb4}{fdt\-\_\-blocks\-\_\-misordered\-\_\-} (const void $\ast$fdt, int mem\-\_\-rsv\-\_\-size, int struct\-\_\-size)
\item 
static int \hyperlink{fdt__rw_8c_a996728565f541defbf59c09f7a44bbcd}{fdt\-\_\-rw\-\_\-probe\-\_\-} (void $\ast$fdt)
\item 
static unsigned int \hyperlink{fdt__rw_8c_a5cd5558f8cac0e8f3c4239b8c2b4a991}{fdt\-\_\-data\-\_\-size\-\_\-} (void $\ast$fdt)
\item 
static int \hyperlink{fdt__rw_8c_a55836c2792fa4ba577260df5fad7aa1f}{fdt\-\_\-splice\-\_\-} (void $\ast$fdt, void $\ast$splicepoint, int oldlen, int newlen)
\item 
static int \hyperlink{fdt__rw_8c_a7b79e435b2a13401208cc45a79a9128b}{fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-} (void $\ast$fdt, struct \hyperlink{structfdt__reserve__entry}{fdt\-\_\-reserve\-\_\-entry} $\ast$p, int oldn, int newn)
\item 
static int \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\-\_\-splice\-\_\-struct\-\_\-} (void $\ast$fdt, void $\ast$p, int oldlen, int newlen)
\item 
static void \hyperlink{fdt__rw_8c_ae0c4748fe7902285d3151c1860bcc22e}{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-} (void $\ast$fdt, const char $\ast$s)
\item 
static int \hyperlink{fdt__rw_8c_ae5030660a27405c9be4712372e7f0b82}{fdt\-\_\-splice\-\_\-string\-\_\-} (void $\ast$fdt, int newlen)
\item 
static int \hyperlink{fdt__rw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-} (void $\ast$fdt, const char $\ast$s, int $\ast$allocated)
\item 
int \hyperlink{fdt__rw_8c_a3c35dbaf4263ec1947046c1259f14cbb}{fdt\-\_\-add\-\_\-mem\-\_\-rsv} (void $\ast$fdt, \hyperlink{libfdt__env_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\-\_\-t} address, \hyperlink{libfdt__env_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\-\_\-t} size)
\item 
int \hyperlink{fdt__rw_8c_a409d3f83af0304a896b32d8552c8669d}{fdt\-\_\-del\-\_\-mem\-\_\-rsv} (void $\ast$fdt, int n)
\item 
static int \hyperlink{fdt__rw_8c_ac1fc2d2442da3be56670b70354149abb}{fdt\-\_\-resize\-\_\-property\-\_\-} (void $\ast$fdt, int nodeoffset, const char $\ast$name, int len, struct \hyperlink{structfdt__property}{fdt\-\_\-property} $\ast$$\ast$prop)
\item 
static int \hyperlink{fdt__rw_8c_a56be49519a7a62e6da99ed9e7b8ee9f9}{fdt\-\_\-add\-\_\-property\-\_\-} (void $\ast$fdt, int nodeoffset, const char $\ast$name, int len, struct \hyperlink{structfdt__property}{fdt\-\_\-property} $\ast$$\ast$prop)
\item 
int \hyperlink{fdt__rw_8c_ada21790bc118086b5bfadd815379ecd9}{fdt\-\_\-set\-\_\-name} (void $\ast$fdt, int nodeoffset, const char $\ast$name)
\item 
int \hyperlink{fdt__rw_8c_a77ab6d302e50d04e373b0371ac56cc9a}{fdt\-\_\-setprop\-\_\-placeholder} (void $\ast$fdt, int nodeoffset, const char $\ast$name, int len, void $\ast$$\ast$prop\-\_\-data)
\item 
int \hyperlink{fdt__rw_8c_ae9e3e4d33edd50404838414b8f36d158}{fdt\-\_\-setprop} (void $\ast$fdt, int nodeoffset, const char $\ast$name, const void $\ast$val, int len)
\item 
int \hyperlink{fdt__rw_8c_a26f2518e2c64f013069c613bee7a83a3}{fdt\-\_\-appendprop} (void $\ast$fdt, int nodeoffset, const char $\ast$name, const void $\ast$val, int len)
\item 
int \hyperlink{fdt__rw_8c_a60669f12d277c4c0cc25bba7b9c2d5c4}{fdt\-\_\-delprop} (void $\ast$fdt, int nodeoffset, const char $\ast$name)
\item 
int \hyperlink{fdt__rw_8c_a9ec78ea0fd08982a50310216ff295747}{fdt\-\_\-add\-\_\-subnode\-\_\-namelen} (void $\ast$fdt, int parentoffset, const char $\ast$name, int namelen)
\item 
int \hyperlink{fdt__rw_8c_a006872c92462f1a3c962192df483600c}{fdt\-\_\-add\-\_\-subnode} (void $\ast$fdt, int parentoffset, const char $\ast$name)
\item 
int \hyperlink{fdt__rw_8c_ad67005f5936eebeb182e55d5f36e9f85}{fdt\-\_\-del\-\_\-node} (void $\ast$fdt, int nodeoffset)
\item 
static void \hyperlink{fdt__rw_8c_a58527f85a06ab2aa9564e07396acfade}{fdt\-\_\-packblocks\-\_\-} (const char $\ast$old, char $\ast$new, int mem\-\_\-rsv\-\_\-size, int struct\-\_\-size, int strings\-\_\-size)
\item 
int \hyperlink{fdt__rw_8c_aa493ca8c4e02dbfdc415e74115c794bb}{fdt\-\_\-open\-\_\-into} (const void $\ast$fdt, void $\ast$buf, int bufsize)
\item 
int \hyperlink{fdt__rw_8c_a994a93e82b34bfdaeeb8288551e6fa98}{fdt\-\_\-pack} (void $\ast$fdt)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E@{F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E}}
\index{F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E@{F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E(
\begin{DoxyParamCaption}
\item[{}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}
{\bfseries Value\-:}
\begin{DoxyCode}
\{ \(\backslash\)
        int err\_; \(\backslash\)
        if ((err\_ = \hyperlink{fdt__rw_8c_a996728565f541defbf59c09f7a44bbcd}{fdt\_rw\_probe\_}(fdt)) != 0) \(\backslash\)
            return err\_; \(\backslash\)
    \}
\end{DoxyCode}


Referenced by fdt\-\_\-add\-\_\-mem\-\_\-rsv(), fdt\-\_\-add\-\_\-subnode\-\_\-namelen(), fdt\-\_\-appendprop(), fdt\-\_\-del\-\_\-mem\-\_\-rsv(), fdt\-\_\-del\-\_\-node(), fdt\-\_\-delprop(), fdt\-\_\-pack(), fdt\-\_\-set\-\_\-name(), and fdt\-\_\-setprop\-\_\-placeholder().



\subsection{Function Documentation}
\hypertarget{fdt__rw_8c_a3c35dbaf4263ec1947046c1259f14cbb}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-add\-\_\-mem\-\_\-rsv@{fdt\-\_\-add\-\_\-mem\-\_\-rsv}}
\index{fdt\-\_\-add\-\_\-mem\-\_\-rsv@{fdt\-\_\-add\-\_\-mem\-\_\-rsv}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-add\-\_\-mem\-\_\-rsv}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-add\-\_\-mem\-\_\-rsv (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{{\bf uint64\-\_\-t}}]{address, }
\item[{{\bf uint64\-\_\-t}}]{size}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a3c35dbaf4263ec1947046c1259f14cbb}
fdt\-\_\-add\-\_\-mem\-\_\-rsv -\/ add one memory reserve map entry \-: pointer to the device tree blob \-: 64-\/bit start address of the reserve map entry \-: 64-\/bit size of the reserved region

Adds a reserve map entry to the given blob reserving a region at address address of length size.

This function will insert data into the reserve map and will therefore change the indexes of some entries in the table.

returns\-: 0, on success -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, there is insufficient free space in the blob to contain the new reservation entry -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-M\-A\-G\-I\-C, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-V\-E\-R\-S\-I\-O\-N, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-R\-U\-C\-T\-U\-R\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-L\-A\-Y\-O\-U\-T, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-T\-R\-U\-N\-C\-A\-T\-E\-D, standard meanings 

References fdt\-\_\-reserve\-\_\-entry\-::address, cpu\-\_\-to\-\_\-fdt64(), fdt\-\_\-mem\-\_\-rsv\-\_\-w\-\_\-(), fdt\-\_\-num\-\_\-mem\-\_\-rsv(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-(), and fdt\-\_\-reserve\-\_\-entry\-::size.


\begin{DoxyCode}
156 \{
157     \textcolor{keyword}{struct }\hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry} *re;
158     \textcolor{keywordtype}{int} err;
159 
160     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
161 
162     re = \hyperlink{libfdt__internal_8h_a8ca1c0f897d5cfa497cd9f4c52f8f5e9}{fdt\_mem\_rsv\_w\_}(fdt, \hyperlink{fdt__ro_8c_a79fa5b76564c75c9fb00fe8ca3ba3eee}{fdt\_num\_mem\_rsv}(fdt));
163     err = \hyperlink{fdt__rw_8c_a7b79e435b2a13401208cc45a79a9128b}{fdt\_splice\_mem\_rsv\_}(fdt, re, 0, 1);
164     \textcolor{keywordflow}{if} (err)
165         \textcolor{keywordflow}{return} err;
166 
167     re->\hyperlink{structfdt__reserve__entry_a1453319ff97e2d7c2ec0762cee56e98e}{address} = \hyperlink{libfdt__env_8h_a516d5270419a4000d9617b3df5e6f665}{cpu\_to\_fdt64}(\hyperlink{structfdt__reserve__entry_a1453319ff97e2d7c2ec0762cee56e98e}{address});
168     re->\hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size} = \hyperlink{libfdt__env_8h_a516d5270419a4000d9617b3df5e6f665}{cpu\_to\_fdt64}(\hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size});
169     \textcolor{keywordflow}{return} 0;
170 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a56be49519a7a62e6da99ed9e7b8ee9f9}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-add\-\_\-property\-\_\-@{fdt\-\_\-add\-\_\-property\-\_\-}}
\index{fdt\-\_\-add\-\_\-property\-\_\-@{fdt\-\_\-add\-\_\-property\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-add\-\_\-property\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-add\-\_\-property\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{int}]{len, }
\item[{struct {\bf fdt\-\_\-property} $\ast$$\ast$}]{prop}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a56be49519a7a62e6da99ed9e7b8ee9f9}


References can\-\_\-assume, cpu\-\_\-to\-\_\-fdt32(), fdt\-\_\-check\-\_\-node\-\_\-offset\-\_\-(), fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-(), fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-(), fdt\-\_\-offset\-\_\-ptr\-\_\-w\-\_\-(), F\-D\-T\-\_\-\-P\-R\-O\-P, fdt\-\_\-splice\-\_\-struct\-\_\-(), and F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N.



Referenced by fdt\-\_\-appendprop(), and fdt\-\_\-setprop\-\_\-placeholder().


\begin{DoxyCode}
204 \{
205     \textcolor{keywordtype}{int} proplen;
206     \textcolor{keywordtype}{int} nextoffset;
207     \textcolor{keywordtype}{int} namestroff;
208     \textcolor{keywordtype}{int} err;
209     \textcolor{keywordtype}{int} allocated;
210 
211     \textcolor{keywordflow}{if} ((nextoffset = \hyperlink{fdt_8c_a8f4832389aff9d7c0663b6b70cdd42dd}{fdt\_check\_node\_offset\_}(fdt, nodeoffset)) < 0)
212         \textcolor{keywordflow}{return} nextoffset;
213 
214     namestroff = \hyperlink{fdt__rw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{fdt\_find\_add\_string\_}(fdt, name, &allocated);
215     \textcolor{keywordflow}{if} (namestroff < 0)
216         \textcolor{keywordflow}{return} namestroff;
217 
218     *prop = \hyperlink{libfdt__internal_8h_ae42dc2243a1db6dc0c0eee8771367315}{fdt\_offset\_ptr\_w\_}(fdt, nextoffset);
219     proplen = \textcolor{keyword}{sizeof}(**prop) + \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(len);
220 
221     err = \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, *prop, 0, proplen);
222     \textcolor{keywordflow}{if} (err) \{
223         \textcolor{comment}{/* Delete the string if we failed to add it */}
224         \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(NO\_ROLLBACK) && allocated)
225             \hyperlink{fdt__rw_8c_ae0c4748fe7902285d3151c1860bcc22e}{fdt\_del\_last\_string\_}(fdt, name);
226         \textcolor{keywordflow}{return} err;
227     \}
228 
229     (*prop)->tag = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a3304a9313cbf7ecced77f89ff5f25dde}{FDT\_PROP});
230     (*prop)->nameoff = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(namestroff);
231     (*prop)->len = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(len);
232     \textcolor{keywordflow}{return} 0;
233 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a006872c92462f1a3c962192df483600c}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-add\-\_\-subnode@{fdt\-\_\-add\-\_\-subnode}}
\index{fdt\-\_\-add\-\_\-subnode@{fdt\-\_\-add\-\_\-subnode}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-add\-\_\-subnode}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-add\-\_\-subnode (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{parentoffset, }
\item[{const char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a006872c92462f1a3c962192df483600c}


References fdt\-\_\-add\-\_\-subnode\-\_\-namelen(), and strlen().



Referenced by overlay\-\_\-apply\-\_\-node(), and overlay\-\_\-symbol\-\_\-update().


\begin{DoxyCode}
378 \{
379     \textcolor{keywordflow}{return} \hyperlink{fdt__rw_8c_a9ec78ea0fd08982a50310216ff295747}{fdt\_add\_subnode\_namelen}(fdt, parentoffset, name, 
      \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(name));
380 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a9ec78ea0fd08982a50310216ff295747}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-add\-\_\-subnode\-\_\-namelen@{fdt\-\_\-add\-\_\-subnode\-\_\-namelen}}
\index{fdt\-\_\-add\-\_\-subnode\-\_\-namelen@{fdt\-\_\-add\-\_\-subnode\-\_\-namelen}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-add\-\_\-subnode\-\_\-namelen}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-add\-\_\-subnode\-\_\-namelen (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{parentoffset, }
\item[{const char $\ast$}]{name, }
\item[{int}]{namelen}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a9ec78ea0fd08982a50310216ff295747}


References can\-\_\-assume, cpu\-\_\-to\-\_\-fdt32(), F\-D\-T\-\_\-\-B\-E\-G\-I\-N\-\_\-\-N\-O\-D\-E, F\-D\-T\-\_\-\-E\-N\-D\-\_\-\-N\-O\-D\-E, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-E\-X\-I\-S\-T\-S, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-I\-N\-T\-E\-R\-N\-A\-L, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D, fdt\-\_\-next\-\_\-tag(), F\-D\-T\-\_\-\-N\-O\-P, fdt\-\_\-offset\-\_\-ptr\-\_\-w\-\_\-(), F\-D\-T\-\_\-\-P\-R\-O\-P, F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-splice\-\_\-struct\-\_\-(), fdt\-\_\-subnode\-\_\-offset\-\_\-namelen(), F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N, F\-D\-T\-\_\-\-T\-A\-G\-S\-I\-Z\-E, memcpy(), memset(), fdt\-\_\-node\-\_\-header\-::name, and fdt\-\_\-node\-\_\-header\-::tag.



Referenced by fdt\-\_\-add\-\_\-subnode().


\begin{DoxyCode}
335 \{
336     \textcolor{keyword}{struct }\hyperlink{structfdt__node__header}{fdt\_node\_header} *nh;
337     \textcolor{keywordtype}{int} offset, nextoffset;
338     \textcolor{keywordtype}{int} nodelen;
339     \textcolor{keywordtype}{int} err;
340     \hyperlink{libfdt__env_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{structfdt__node__header_a073164a8ce430c15d2147ccba6bc7340}{tag};
341     \hyperlink{libfdt__env_8h_a76887ac8786252752fb3f9a39b21f3af}{fdt32\_t} *endtag;
342 
343     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
344 
345     offset = \hyperlink{fdt__ro_8c_a515ddadab660b50e9d31c05c74f7d351}{fdt\_subnode\_offset\_namelen}(fdt, parentoffset, 
      \hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}, namelen);
346     \textcolor{keywordflow}{if} (offset >= 0)
347         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a26af70ef43c09fafd5eb29f10a09278a}{FDT\_ERR\_EXISTS};
348     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (offset != -\hyperlink{libfdt_8h_a93cfa052f4b28df4bfc7d336b692fa07}{FDT\_ERR\_NOTFOUND})
349         \textcolor{keywordflow}{return} offset;
350 
351     \textcolor{comment}{/* Try to place the new node after the parent's properties */}
352     tag = \hyperlink{fdt_8c_ae1b4b34a1b1fa1230d3ccacf14446b61}{fdt\_next\_tag}(fdt, parentoffset, &nextoffset);
353     \textcolor{comment}{/* the fdt\_subnode\_offset\_namelen() should ensure this never hits */}
354     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(LIBFDT\_FLAWLESS) && (tag != \hyperlink{fdt_8h_a84974b092f97d4f2588c8efb4f6fdd67}{FDT\_BEGIN\_NODE}))
355         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a02625761a47e8012c53fb389dd25fadd}{FDT\_ERR\_INTERNAL};
356     \textcolor{keywordflow}{do} \{
357         offset = nextoffset;
358         tag = \hyperlink{fdt_8c_ae1b4b34a1b1fa1230d3ccacf14446b61}{fdt\_next\_tag}(fdt, offset, &nextoffset);
359     \} \textcolor{keywordflow}{while} ((tag == \hyperlink{fdt_8h_a3304a9313cbf7ecced77f89ff5f25dde}{FDT\_PROP}) || (tag == \hyperlink{fdt_8h_a95f6ec2ae047c13339f80ca6adeafc21}{FDT\_NOP}));
360 
361     nh = \hyperlink{libfdt__internal_8h_ae42dc2243a1db6dc0c0eee8771367315}{fdt\_offset\_ptr\_w\_}(fdt, offset);
362     nodelen = \textcolor{keyword}{sizeof}(*nh) + \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(namelen+1) + \hyperlink{fdt_8h_ada36dac7d767aceec040a00307dba77b}{FDT\_TAGSIZE};
363 
364     err = \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, nh, 0, nodelen);
365     \textcolor{keywordflow}{if} (err)
366         \textcolor{keywordflow}{return} err;
367 
368     nh->\hyperlink{structfdt__node__header_a073164a8ce430c15d2147ccba6bc7340}{tag} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a84974b092f97d4f2588c8efb4f6fdd67}{FDT\_BEGIN\_NODE});
369     \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset}(nh->\hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}, 0, \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(namelen+1));
370     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(nh->\hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}, \hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}, namelen);
371     endtag = (\hyperlink{libfdt__env_8h_a76887ac8786252752fb3f9a39b21f3af}{fdt32\_t} *)((\textcolor{keywordtype}{char} *)nh + nodelen - \hyperlink{fdt_8h_ada36dac7d767aceec040a00307dba77b}{FDT\_TAGSIZE});
372     *endtag = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a97c9b3b1971681a8183442ddd0a8009c}{FDT\_END\_NODE});
373 
374     \textcolor{keywordflow}{return} offset;
375 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a26f2518e2c64f013069c613bee7a83a3}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-appendprop@{fdt\-\_\-appendprop}}
\index{fdt\-\_\-appendprop@{fdt\-\_\-appendprop}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-appendprop}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-appendprop (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{const void $\ast$}]{val, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a26f2518e2c64f013069c613bee7a83a3}


References cpu\-\_\-to\-\_\-fdt32(), fdt\-\_\-property\-::data, fdt\-\_\-add\-\_\-property\-\_\-(), fdt\-\_\-get\-\_\-property\-\_\-w(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-splice\-\_\-struct\-\_\-(), F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N, fdt\-\_\-property\-::len, and memcpy().



Referenced by fdt\-\_\-appendprop\-\_\-addrrange(), fdt\-\_\-appendprop\-\_\-u32(), and fdt\-\_\-appendprop\-\_\-u64().


\begin{DoxyCode}
293 \{
294     \textcolor{keyword}{struct }\hyperlink{structfdt__property}{fdt\_property} *prop;
295     \textcolor{keywordtype}{int} err, oldlen, newlen;
296 
297     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
298 
299     prop = \hyperlink{libfdt_8h_a3ef3cd199863ded58e473a71ebdd478c}{fdt\_get\_property\_w}(fdt, nodeoffset, name, &oldlen);
300     \textcolor{keywordflow}{if} (prop) \{
301         newlen = \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} + oldlen;
302         err = \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, prop->\hyperlink{structfdt__property_abb52f21622f86ed9b268f49b76f23aef}{data},
303                      \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(oldlen),
304                      \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(newlen));
305         \textcolor{keywordflow}{if} (err)
306             \textcolor{keywordflow}{return} err;
307         prop->\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(newlen);
308         \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(prop->\hyperlink{structfdt__property_abb52f21622f86ed9b268f49b76f23aef}{data} + oldlen, val, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
309     \} \textcolor{keywordflow}{else} \{
310         err = \hyperlink{fdt__rw_8c_a56be49519a7a62e6da99ed9e7b8ee9f9}{fdt\_add\_property\_}(fdt, nodeoffset, name, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}, &prop);
311         \textcolor{keywordflow}{if} (err)
312             \textcolor{keywordflow}{return} err;
313         \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(prop->\hyperlink{structfdt__property_abb52f21622f86ed9b268f49b76f23aef}{data}, val, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
314     \}
315     \textcolor{keywordflow}{return} 0;
316 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a85dfbfdc83212c333265fe389a585fb4}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-blocks\-\_\-misordered\-\_\-@{fdt\-\_\-blocks\-\_\-misordered\-\_\-}}
\index{fdt\-\_\-blocks\-\_\-misordered\-\_\-@{fdt\-\_\-blocks\-\_\-misordered\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-blocks\-\_\-misordered\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-blocks\-\_\-misordered\-\_\- (
\begin{DoxyParamCaption}
\item[{const void $\ast$}]{fdt, }
\item[{int}]{mem\-\_\-rsv\-\_\-size, }
\item[{int}]{struct\-\_\-size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a85dfbfdc83212c333265fe389a585fb4}


References F\-D\-T\-\_\-\-A\-L\-I\-G\-N, fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-off\-\_\-dt\-\_\-struct, fdt\-\_\-off\-\_\-mem\-\_\-rsvmap, fdt\-\_\-size\-\_\-dt\-\_\-strings, and fdt\-\_\-totalsize.



Referenced by fdt\-\_\-open\-\_\-into(), and fdt\-\_\-rw\-\_\-probe\-\_\-().


\begin{DoxyCode}
15 \{
16     \textcolor{keywordflow}{return} (\hyperlink{libfdt_8h_ad34e2939365df0a17061d177356b4e39}{fdt\_off\_mem\_rsvmap}(fdt) < \hyperlink{libfdt__internal_8h_a47d522a4cadae635e3549c08f4032c3b}{FDT\_ALIGN}(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structfdt__header}{fdt\_header}), 8))
17         || (\hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt) <
18             (\hyperlink{libfdt_8h_ad34e2939365df0a17061d177356b4e39}{fdt\_off\_mem\_rsvmap}(fdt) + mem\_rsv\_size))
19         || (\hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) <
20             (\hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt) + struct\_size))
21         || (\hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt) <
22             (\hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) + \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt)));
23 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a5cd5558f8cac0e8f3c4239b8c2b4a991}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-data\-\_\-size\-\_\-@{fdt\-\_\-data\-\_\-size\-\_\-}}
\index{fdt\-\_\-data\-\_\-size\-\_\-@{fdt\-\_\-data\-\_\-size\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-data\-\_\-size\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static unsigned int fdt\-\_\-data\-\_\-size\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}}\label{fdt__rw_8c_a5cd5558f8cac0e8f3c4239b8c2b4a991}


References fdt\-\_\-off\-\_\-dt\-\_\-strings, and fdt\-\_\-size\-\_\-dt\-\_\-strings.



Referenced by fdt\-\_\-pack(), and fdt\-\_\-splice\-\_\-().


\begin{DoxyCode}
50 \{
51     \textcolor{keywordflow}{return} \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) + \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
52 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_ae0c4748fe7902285d3151c1860bcc22e}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-@{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-}}
\index{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-@{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static void fdt\-\_\-del\-\_\-last\-\_\-string\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{s}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_ae0c4748fe7902285d3151c1860bcc22e}


References fdt\-\_\-size\-\_\-dt\-\_\-strings, and strlen().



Referenced by fdt\-\_\-add\-\_\-property\-\_\-().


\begin{DoxyCode}
99 \{
100     \textcolor{keywordtype}{int} newlen = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(s) + 1;
101 
102     fdt\_set\_size\_dt\_strings(fdt, \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt) - newlen);
103 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a409d3f83af0304a896b32d8552c8669d}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-del\-\_\-mem\-\_\-rsv@{fdt\-\_\-del\-\_\-mem\-\_\-rsv}}
\index{fdt\-\_\-del\-\_\-mem\-\_\-rsv@{fdt\-\_\-del\-\_\-mem\-\_\-rsv}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-del\-\_\-mem\-\_\-rsv}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-del\-\_\-mem\-\_\-rsv (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{n}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a409d3f83af0304a896b32d8552c8669d}
fdt\-\_\-del\-\_\-mem\-\_\-rsv -\/ remove a memory reserve map entry \-: pointer to the device tree blob \par
\-: entry to remove

\hyperlink{fdt__rw_8c_a409d3f83af0304a896b32d8552c8669d}{fdt\-\_\-del\-\_\-mem\-\_\-rsv()} removes the n-\/th memory reserve map entry from the blob.

This function will delete data from the reservation table and will therefore change the indexes of some entries in the table.

returns\-: 0, on success -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D, there is no entry of the given index (i.\-e. there are less than n+1 reserve map entries) -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-M\-A\-G\-I\-C, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-V\-E\-R\-S\-I\-O\-N, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-R\-U\-C\-T\-U\-R\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-L\-A\-Y\-O\-U\-T, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-T\-R\-U\-N\-C\-A\-T\-E\-D, standard meanings 

References F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D, fdt\-\_\-mem\-\_\-rsv\-\_\-w\-\_\-(), fdt\-\_\-num\-\_\-mem\-\_\-rsv(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, and fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-().


\begin{DoxyCode}
173 \{
174     \textcolor{keyword}{struct }\hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry} *re = \hyperlink{libfdt__internal_8h_a8ca1c0f897d5cfa497cd9f4c52f8f5e9}{fdt\_mem\_rsv\_w\_}(fdt, n);
175 
176     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
177 
178     \textcolor{keywordflow}{if} (n >= \hyperlink{fdt__ro_8c_a79fa5b76564c75c9fb00fe8ca3ba3eee}{fdt\_num\_mem\_rsv}(fdt))
179         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a93cfa052f4b28df4bfc7d336b692fa07}{FDT\_ERR\_NOTFOUND};
180 
181     \textcolor{keywordflow}{return} \hyperlink{fdt__rw_8c_a7b79e435b2a13401208cc45a79a9128b}{fdt\_splice\_mem\_rsv\_}(fdt, re, 1, 0);
182 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_ad67005f5936eebeb182e55d5f36e9f85}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-del\-\_\-node@{fdt\-\_\-del\-\_\-node}}
\index{fdt\-\_\-del\-\_\-node@{fdt\-\_\-del\-\_\-node}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-del\-\_\-node}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-del\-\_\-node (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_ad67005f5936eebeb182e55d5f36e9f85}
fdt\-\_\-del\-\_\-node -\/ delete a node (subtree) \-: pointer to the device tree blob \-: offset of the node to nop

\hyperlink{fdt__rw_8c_ad67005f5936eebeb182e55d5f36e9f85}{fdt\-\_\-del\-\_\-node()} will remove the given node, including all its subnodes if any, from the blob.

This function will delete data from the blob, and will therefore change the offsets of some existing nodes.

returns\-: 0, on success -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-O\-F\-F\-S\-E\-T, nodeoffset did not point to F\-D\-T\-\_\-\-B\-E\-G\-I\-N\-\_\-\-N\-O\-D\-E tag -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-L\-A\-Y\-O\-U\-T, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-M\-A\-G\-I\-C, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-V\-E\-R\-S\-I\-O\-N, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-R\-U\-C\-T\-U\-R\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-T\-R\-U\-N\-C\-A\-T\-E\-D, standard meanings 

References fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-(), fdt\-\_\-offset\-\_\-ptr\-\_\-w\-\_\-(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, and fdt\-\_\-splice\-\_\-struct\-\_\-().


\begin{DoxyCode}
383 \{
384     \textcolor{keywordtype}{int} endoffset;
385 
386     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
387 
388     endoffset = \hyperlink{fdt__wip_8c_a45210c5c83d2fc1bed7cb7161e471fad}{fdt\_node\_end\_offset\_}(fdt, nodeoffset);
389     \textcolor{keywordflow}{if} (endoffset < 0)
390         \textcolor{keywordflow}{return} endoffset;
391 
392     \textcolor{keywordflow}{return} \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, \hyperlink{libfdt__internal_8h_ae42dc2243a1db6dc0c0eee8771367315}{fdt\_offset\_ptr\_w\_}(fdt, nodeoffset),
393                   endoffset - nodeoffset, 0);
394 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a60669f12d277c4c0cc25bba7b9c2d5c4}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-delprop@{fdt\-\_\-delprop}}
\index{fdt\-\_\-delprop@{fdt\-\_\-delprop}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-delprop}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-delprop (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a60669f12d277c4c0cc25bba7b9c2d5c4}


References fdt\-\_\-get\-\_\-property\-\_\-w(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-splice\-\_\-struct\-\_\-(), F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N, and fdt\-\_\-property\-::len.


\begin{DoxyCode}
319 \{
320     \textcolor{keyword}{struct }\hyperlink{structfdt__property}{fdt\_property} *prop;
321     \textcolor{keywordtype}{int} \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}, proplen;
322 
323     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
324 
325     prop = \hyperlink{libfdt_8h_a3ef3cd199863ded58e473a71ebdd478c}{fdt\_get\_property\_w}(fdt, nodeoffset, name, &len);
326     \textcolor{keywordflow}{if} (!prop)
327         \textcolor{keywordflow}{return} \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len};
328 
329     proplen = \textcolor{keyword}{sizeof}(*prop) + \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(len);
330     \textcolor{keywordflow}{return} \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, prop, proplen, 0);
331 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-@{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-}}
\index{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-@{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-find\-\_\-add\-\_\-string\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{s, }
\item[{int $\ast$}]{allocated}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a39cb8b1f38cfd53050f7089314f23c7f}
\hyperlink{fdt__rw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-()} -\/ Find or allocate a string

\-: pointer to the device tree to check/adjust \-: string to find/add \-: Set to 0 if the string was found, 1 if not found and so allocated. Ignored if \hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\-\_\-assume(\-N\-O\-\_\-\-R\-O\-L\-L\-B\-A\-C\-K)} \begin{DoxyReturn}{Returns}
offset of string in the string table (whether found or added) 
\end{DoxyReturn}


References can\-\_\-assume, fdt\-\_\-find\-\_\-string\-\_\-(), fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-strings, fdt\-\_\-splice\-\_\-string\-\_\-(), fdt\-\_\-property\-::len, memcpy(), and strlen().



Referenced by fdt\-\_\-add\-\_\-property\-\_\-().


\begin{DoxyCode}
128 \{
129     \textcolor{keywordtype}{char} *strtab = (\textcolor{keywordtype}{char} *)fdt + \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt);
130     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *p;
131     \textcolor{keywordtype}{char} *\textcolor{keyword}{new};
132     \textcolor{keywordtype}{int} \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(s) + 1;
133     \textcolor{keywordtype}{int} err;
134 
135     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(NO\_ROLLBACK))
136         *allocated = 0;
137 
138     p = \hyperlink{fdt_8c_af68faaab7e7f2c691bfb1679da262bf5}{fdt\_find\_string\_}(strtab, \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt), s);
139     \textcolor{keywordflow}{if} (p)
140         \textcolor{comment}{/* found it */}
141         \textcolor{keywordflow}{return} (p - strtab);
142 
143     \textcolor{keyword}{new} = strtab + \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
144     err = \hyperlink{fdt__rw_8c_ae5030660a27405c9be4712372e7f0b82}{fdt\_splice\_string\_}(fdt, len);
145     \textcolor{keywordflow}{if} (err)
146         \textcolor{keywordflow}{return} err;
147 
148     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(NO\_ROLLBACK))
149         *allocated = 1;
150 
151     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(\textcolor{keyword}{new}, s, len);
152     \textcolor{keywordflow}{return} (\textcolor{keyword}{new} - strtab);
153 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_aa493ca8c4e02dbfdc415e74115c794bb}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-open\-\_\-into@{fdt\-\_\-open\-\_\-into}}
\index{fdt\-\_\-open\-\_\-into@{fdt\-\_\-open\-\_\-into}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-open\-\_\-into}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-open\-\_\-into (
\begin{DoxyParamCaption}
\item[{const void $\ast$}]{fdt, }
\item[{void $\ast$}]{buf, }
\item[{int}]{bufsize}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_aa493ca8c4e02dbfdc415e74115c794bb}


References can\-\_\-assume, F\-D\-T\-\_\-\-A\-L\-I\-G\-N, fdt\-\_\-blocks\-\_\-misordered\-\_\-(), fdt\-\_\-boot\-\_\-cpuid\-\_\-phys, F\-D\-T\-\_\-\-E\-N\-D, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-V\-E\-R\-S\-I\-O\-N, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, F\-D\-T\-\_\-\-M\-A\-G\-I\-C, fdt\-\_\-move(), fdt\-\_\-next\-\_\-tag(), fdt\-\_\-num\-\_\-mem\-\_\-rsv(), fdt\-\_\-packblocks\-\_\-(), F\-D\-T\-\_\-\-R\-O\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-size\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-struct, fdt\-\_\-totalsize, fdt\-\_\-version, and memmove().



Referenced by fdt\-\_\-create\-\_\-empty\-\_\-tree().


\begin{DoxyCode}
420 \{
421     \textcolor{keywordtype}{int} err;
422     \textcolor{keywordtype}{int} mem\_rsv\_size, struct\_size;
423     \textcolor{keywordtype}{int} newsize;
424     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fdtstart = fdt;
425     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *fdtend = fdtstart + \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt);
426     \textcolor{keywordtype}{char} *tmp;
427 
428     \hyperlink{libfdt__internal_8h_ad6927f926180469d5c044ec5d3b2f84b}{FDT\_RO\_PROBE}(fdt);
429 
430     mem\_rsv\_size = (\hyperlink{fdt__ro_8c_a79fa5b76564c75c9fb00fe8ca3ba3eee}{fdt\_num\_mem\_rsv}(fdt)+1)
431         * \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry});
432 
433     \textcolor{keywordflow}{if} (\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(LATEST) || \hyperlink{libfdt_8h_a13dbe2495fe8e67717bc708c523c781e}{fdt\_version}(fdt) >= 17) \{
434         struct\_size = \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt);
435     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{libfdt_8h_a13dbe2495fe8e67717bc708c523c781e}{fdt\_version}(fdt) == 16) \{
436         struct\_size = 0;
437         \textcolor{keywordflow}{while} (\hyperlink{fdt_8c_ae1b4b34a1b1fa1230d3ccacf14446b61}{fdt\_next\_tag}(fdt, struct\_size, &struct\_size) != 
      \hyperlink{fdt_8h_a53275b16340fb458df4782462f283d8c}{FDT\_END})
438             ;
439         \textcolor{keywordflow}{if} (struct\_size < 0)
440             \textcolor{keywordflow}{return} struct\_size;
441     \} \textcolor{keywordflow}{else} \{
442         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_ad2a3b277a1e6987ead001fcd2415d88d}{FDT\_ERR\_BADVERSION};
443     \}
444 
445     \textcolor{keywordflow}{if} (\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(LIBFDT\_ORDER) ||
446         !\hyperlink{fdt__rw_8c_a85dfbfdc83212c333265fe389a585fb4}{fdt\_blocks\_misordered\_}(fdt, mem\_rsv\_size, struct\_size)) \{
447         \textcolor{comment}{/* no further work necessary */}
448         err = \hyperlink{fdt_8c_a1be79096bbc68a1986e54eb4c57a8007}{fdt\_move}(fdt, buf, bufsize);
449         \textcolor{keywordflow}{if} (err)
450             \textcolor{keywordflow}{return} err;
451         fdt\_set\_version(buf, 17);
452         fdt\_set\_size\_dt\_struct(buf, struct\_size);
453         fdt\_set\_totalsize(buf, bufsize);
454         \textcolor{keywordflow}{return} 0;
455     \}
456 
457     \textcolor{comment}{/* Need to reorder */}
458     newsize = \hyperlink{libfdt__internal_8h_a47d522a4cadae635e3549c08f4032c3b}{FDT\_ALIGN}(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structfdt__header}{fdt\_header}), 8) + mem\_rsv\_size
459         + struct\_size + \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
460 
461     \textcolor{keywordflow}{if} (bufsize < newsize)
462         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
463 
464     \textcolor{comment}{/* First attempt to build converted tree at beginning of buffer */}
465     tmp = buf;
466     \textcolor{comment}{/* But if that overlaps with the old tree... */}
467     \textcolor{keywordflow}{if} (((tmp + newsize) > fdtstart) && (tmp < fdtend)) \{
468         \textcolor{comment}{/* Try right after the old tree instead */}
469         tmp = (\textcolor{keywordtype}{char} *)(\hyperlink{libfdt__env_8h_a83242de74310b4aec3fc506bc3644211}{uintptr\_t})fdtend;
470         \textcolor{keywordflow}{if} ((tmp + newsize) > ((\textcolor{keywordtype}{char} *)buf + bufsize))
471             \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
472     \}
473 
474     \hyperlink{fdt__rw_8c_a58527f85a06ab2aa9564e07396acfade}{fdt\_packblocks\_}(fdt, tmp, mem\_rsv\_size, struct\_size,
475             \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt));
476     \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(buf, tmp, newsize);
477 
478     fdt\_set\_magic(buf, \hyperlink{fdt_8h_a5d5b14eccb44e809abddd8a946ddc8a3}{FDT\_MAGIC});
479     fdt\_set\_totalsize(buf, bufsize);
480     fdt\_set\_version(buf, 17);
481     fdt\_set\_last\_comp\_version(buf, 16);
482     fdt\_set\_boot\_cpuid\_phys(buf, \hyperlink{libfdt_8h_ad5f615bb04034e144f826b3a182ff985}{fdt\_boot\_cpuid\_phys}(fdt));
483 
484     \textcolor{keywordflow}{return} 0;
485 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a994a93e82b34bfdaeeb8288551e6fa98}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-pack@{fdt\-\_\-pack}}
\index{fdt\-\_\-pack@{fdt\-\_\-pack}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-pack}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-pack (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a994a93e82b34bfdaeeb8288551e6fa98}


References fdt\-\_\-data\-\_\-size\-\_\-(), fdt\-\_\-num\-\_\-mem\-\_\-rsv(), fdt\-\_\-packblocks\-\_\-(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-size\-\_\-dt\-\_\-strings, and fdt\-\_\-size\-\_\-dt\-\_\-struct.


\begin{DoxyCode}
488 \{
489     \textcolor{keywordtype}{int} mem\_rsv\_size;
490 
491     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
492 
493     mem\_rsv\_size = (\hyperlink{fdt__ro_8c_a79fa5b76564c75c9fb00fe8ca3ba3eee}{fdt\_num\_mem\_rsv}(fdt)+1)
494         * \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry});
495     \hyperlink{fdt__rw_8c_a58527f85a06ab2aa9564e07396acfade}{fdt\_packblocks\_}(fdt, fdt, mem\_rsv\_size, \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt),
496             \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt));
497     fdt\_set\_totalsize(fdt, \hyperlink{fdt__rw_8c_a5cd5558f8cac0e8f3c4239b8c2b4a991}{fdt\_data\_size\_}(fdt));
498 
499     \textcolor{keywordflow}{return} 0;
500 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a58527f85a06ab2aa9564e07396acfade}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-packblocks\-\_\-@{fdt\-\_\-packblocks\-\_\-}}
\index{fdt\-\_\-packblocks\-\_\-@{fdt\-\_\-packblocks\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-packblocks\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static void fdt\-\_\-packblocks\-\_\- (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{old, }
\item[{char $\ast$}]{new, }
\item[{int}]{mem\-\_\-rsv\-\_\-size, }
\item[{int}]{struct\-\_\-size, }
\item[{int}]{strings\-\_\-size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a58527f85a06ab2aa9564e07396acfade}


References F\-D\-T\-\_\-\-A\-L\-I\-G\-N, fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-off\-\_\-dt\-\_\-struct, fdt\-\_\-off\-\_\-mem\-\_\-rsvmap, fdt\-\_\-size\-\_\-dt\-\_\-strings, and memmove().



Referenced by fdt\-\_\-open\-\_\-into(), and fdt\-\_\-pack().


\begin{DoxyCode}
400 \{
401     \textcolor{keywordtype}{int} mem\_rsv\_off, struct\_off, strings\_off;
402 
403     mem\_rsv\_off = \hyperlink{libfdt__internal_8h_a47d522a4cadae635e3549c08f4032c3b}{FDT\_ALIGN}(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structfdt__header}{fdt\_header}), 8);
404     struct\_off = mem\_rsv\_off + mem\_rsv\_size;
405     strings\_off = struct\_off + struct\_size;
406 
407     \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(\textcolor{keyword}{new} + mem\_rsv\_off, old + \hyperlink{libfdt_8h_ad34e2939365df0a17061d177356b4e39}{fdt\_off\_mem\_rsvmap}(old), mem\_rsv\_size);
408     fdt\_set\_off\_mem\_rsvmap(\textcolor{keyword}{new}, mem\_rsv\_off);
409 
410     \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(\textcolor{keyword}{new} + struct\_off, old + \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(old), struct\_size);
411     fdt\_set\_off\_dt\_struct(\textcolor{keyword}{new}, struct\_off);
412     fdt\_set\_size\_dt\_struct(\textcolor{keyword}{new}, struct\_size);
413 
414     \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(\textcolor{keyword}{new} + strings\_off, old + \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(old), strings\_size);
415     fdt\_set\_off\_dt\_strings(\textcolor{keyword}{new}, strings\_off);
416     fdt\_set\_size\_dt\_strings(\textcolor{keyword}{new}, \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(old));
417 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_ac1fc2d2442da3be56670b70354149abb}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-resize\-\_\-property\-\_\-@{fdt\-\_\-resize\-\_\-property\-\_\-}}
\index{fdt\-\_\-resize\-\_\-property\-\_\-@{fdt\-\_\-resize\-\_\-property\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-resize\-\_\-property\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-resize\-\_\-property\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{int}]{len, }
\item[{struct {\bf fdt\-\_\-property} $\ast$$\ast$}]{prop}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_ac1fc2d2442da3be56670b70354149abb}


References cpu\-\_\-to\-\_\-fdt32(), fdt\-\_\-get\-\_\-property\-\_\-w(), fdt\-\_\-splice\-\_\-struct\-\_\-(), and F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N.



Referenced by fdt\-\_\-setprop\-\_\-placeholder().


\begin{DoxyCode}
186 \{
187     \textcolor{keywordtype}{int} oldlen;
188     \textcolor{keywordtype}{int} err;
189 
190     *prop = \hyperlink{libfdt_8h_a3ef3cd199863ded58e473a71ebdd478c}{fdt\_get\_property\_w}(fdt, nodeoffset, name, &oldlen);
191     \textcolor{keywordflow}{if} (!*prop)
192         \textcolor{keywordflow}{return} oldlen;
193 
194     \textcolor{keywordflow}{if} ((err = \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, (*prop)->data, 
      \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(oldlen),
195                       \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}))))
196         \textcolor{keywordflow}{return} err;
197 
198     (*prop)->len = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
199     \textcolor{keywordflow}{return} 0;
200 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a996728565f541defbf59c09f7a44bbcd}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-rw\-\_\-probe\-\_\-@{fdt\-\_\-rw\-\_\-probe\-\_\-}}
\index{fdt\-\_\-rw\-\_\-probe\-\_\-@{fdt\-\_\-rw\-\_\-probe\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-rw\-\_\-probe\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-rw\-\_\-probe\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a996728565f541defbf59c09f7a44bbcd}


References can\-\_\-assume, fdt\-\_\-blocks\-\_\-misordered\-\_\-(), F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-L\-A\-Y\-O\-U\-T, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-V\-E\-R\-S\-I\-O\-N, F\-D\-T\-\_\-\-R\-O\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-size\-\_\-dt\-\_\-struct, and fdt\-\_\-version.


\begin{DoxyCode}
26 \{
27     \textcolor{keywordflow}{if} (\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(VALID\_DTB))
28         \textcolor{keywordflow}{return} 0;
29     \hyperlink{libfdt__internal_8h_ad6927f926180469d5c044ec5d3b2f84b}{FDT\_RO\_PROBE}(fdt);
30 
31     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(LATEST) && \hyperlink{libfdt_8h_a13dbe2495fe8e67717bc708c523c781e}{fdt\_version}(fdt) < 17)
32         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_ad2a3b277a1e6987ead001fcd2415d88d}{FDT\_ERR\_BADVERSION};
33     \textcolor{keywordflow}{if} (\hyperlink{fdt__rw_8c_a85dfbfdc83212c333265fe389a585fb4}{fdt\_blocks\_misordered\_}(fdt, \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry}),
34                    \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt)))
35         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_ad698818ae8340bbadf1cbbb49e4c968d}{FDT\_ERR\_BADLAYOUT};
36     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(LATEST) && \hyperlink{libfdt_8h_a13dbe2495fe8e67717bc708c523c781e}{fdt\_version}(fdt) > 17)
37         fdt\_set\_version(fdt, 17);
38 
39     \textcolor{keywordflow}{return} 0;
40 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_ada21790bc118086b5bfadd815379ecd9}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-set\-\_\-name@{fdt\-\_\-set\-\_\-name}}
\index{fdt\-\_\-set\-\_\-name@{fdt\-\_\-set\-\_\-name}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-set\-\_\-name}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-set\-\_\-name (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_ada21790bc118086b5bfadd815379ecd9}


References fdt\-\_\-get\-\_\-name(), F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-splice\-\_\-struct\-\_\-(), F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N, memcpy(), and strlen().


\begin{DoxyCode}
236 \{
237     \textcolor{keywordtype}{char} *namep;
238     \textcolor{keywordtype}{int} oldlen, newlen;
239     \textcolor{keywordtype}{int} err;
240 
241     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
242 
243     namep = (\textcolor{keywordtype}{char} *)(\hyperlink{libfdt__env_8h_a83242de74310b4aec3fc506bc3644211}{uintptr\_t})\hyperlink{fdt__ro_8c_a22a72941a288c00c88c36164fdc793c0}{fdt\_get\_name}(fdt, nodeoffset, &oldlen);
244     \textcolor{keywordflow}{if} (!namep)
245         \textcolor{keywordflow}{return} oldlen;
246 
247     newlen = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(name);
248 
249     err = \hyperlink{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{fdt\_splice\_struct\_}(fdt, namep, \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(oldlen+1),
250                  \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(newlen+1));
251     \textcolor{keywordflow}{if} (err)
252         \textcolor{keywordflow}{return} err;
253 
254     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(namep, name, newlen+1);
255     \textcolor{keywordflow}{return} 0;
256 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_ae9e3e4d33edd50404838414b8f36d158}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-setprop@{fdt\-\_\-setprop}}
\index{fdt\-\_\-setprop@{fdt\-\_\-setprop}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-setprop}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-setprop (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{const void $\ast$}]{val, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_ae9e3e4d33edd50404838414b8f36d158}


References fdt\-\_\-setprop\-\_\-placeholder(), and memcpy().



Referenced by fdt\-\_\-setprop\-\_\-u32(), fdt\-\_\-setprop\-\_\-u64(), and overlay\-\_\-apply\-\_\-node().


\begin{DoxyCode}
278 \{
279     \textcolor{keywordtype}{void} *prop\_data;
280     \textcolor{keywordtype}{int} err;
281 
282     err = \hyperlink{fdt__rw_8c_a77ab6d302e50d04e373b0371ac56cc9a}{fdt\_setprop\_placeholder}(fdt, nodeoffset, name, 
      \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}, &prop\_data);
283     \textcolor{keywordflow}{if} (err)
284         \textcolor{keywordflow}{return} err;
285 
286     \textcolor{keywordflow}{if} (\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len})
287         \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(prop\_data, val, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
288     \textcolor{keywordflow}{return} 0;
289 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a77ab6d302e50d04e373b0371ac56cc9a}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-setprop\-\_\-placeholder@{fdt\-\_\-setprop\-\_\-placeholder}}
\index{fdt\-\_\-setprop\-\_\-placeholder@{fdt\-\_\-setprop\-\_\-placeholder}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-setprop\-\_\-placeholder}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-setprop\-\_\-placeholder (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{int}]{len, }
\item[{void $\ast$$\ast$}]{prop\-\_\-data}
\end{DoxyParamCaption}
)}}\label{fdt__rw_8c_a77ab6d302e50d04e373b0371ac56cc9a}


References fdt\-\_\-property\-::data, fdt\-\_\-add\-\_\-property\-\_\-(), F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-T\-F\-O\-U\-N\-D, fdt\-\_\-resize\-\_\-property\-\_\-(), and F\-D\-T\-\_\-\-R\-W\-\_\-\-P\-R\-O\-B\-E.



Referenced by fdt\-\_\-setprop(), and overlay\-\_\-symbol\-\_\-update().


\begin{DoxyCode}
260 \{
261     \textcolor{keyword}{struct }\hyperlink{structfdt__property}{fdt\_property} *prop;
262     \textcolor{keywordtype}{int} err;
263 
264     \hyperlink{fdt__rw_8c_a8a087a089359a4a7a0ac78608ab6b2b9}{FDT\_RW\_PROBE}(fdt);
265 
266     err = \hyperlink{fdt__rw_8c_ac1fc2d2442da3be56670b70354149abb}{fdt\_resize\_property\_}(fdt, nodeoffset, name, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}, &prop);
267     \textcolor{keywordflow}{if} (err == -\hyperlink{libfdt_8h_a93cfa052f4b28df4bfc7d336b692fa07}{FDT\_ERR\_NOTFOUND})
268         err = \hyperlink{fdt__rw_8c_a56be49519a7a62e6da99ed9e7b8ee9f9}{fdt\_add\_property\_}(fdt, nodeoffset, name, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}, &prop);
269     \textcolor{keywordflow}{if} (err)
270         \textcolor{keywordflow}{return} err;
271 
272     *prop\_data = prop->\hyperlink{structfdt__property_abb52f21622f86ed9b268f49b76f23aef}{data};
273     \textcolor{keywordflow}{return} 0;
274 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a55836c2792fa4ba577260df5fad7aa1f}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-splice\-\_\-@{fdt\-\_\-splice\-\_\-}}
\index{fdt\-\_\-splice\-\_\-@{fdt\-\_\-splice\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-splice\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-splice\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{void $\ast$}]{splicepoint, }
\item[{int}]{oldlen, }
\item[{int}]{newlen}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a55836c2792fa4ba577260df5fad7aa1f}


References fdt\-\_\-data\-\_\-size\-\_\-(), F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-O\-F\-F\-S\-E\-T, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-totalsize, and memmove().



Referenced by fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-(), fdt\-\_\-splice\-\_\-string\-\_\-(), and fdt\-\_\-splice\-\_\-struct\-\_\-().


\begin{DoxyCode}
55 \{
56     \textcolor{keywordtype}{char} *p = splicepoint;
57     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} dsize = \hyperlink{fdt__rw_8c_a5cd5558f8cac0e8f3c4239b8c2b4a991}{fdt\_data\_size\_}(fdt);
58     \textcolor{keywordtype}{size\_t} soff = p - (\textcolor{keywordtype}{char} *)fdt;
59 
60     \textcolor{keywordflow}{if} ((oldlen < 0) || (soff + oldlen < soff) || (soff + oldlen > dsize))
61         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a5025b6b09a009bd2b516e6a831d7ce72}{FDT\_ERR\_BADOFFSET};
62     \textcolor{keywordflow}{if} ((p < (\textcolor{keywordtype}{char} *)fdt) || (dsize + newlen < (\textcolor{keywordtype}{unsigned})oldlen))
63         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a5025b6b09a009bd2b516e6a831d7ce72}{FDT\_ERR\_BADOFFSET};
64     \textcolor{keywordflow}{if} (dsize - oldlen + newlen > \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt))
65         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
66     \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(p + newlen, p + oldlen, ((\textcolor{keywordtype}{char} *)fdt + dsize) - (p + oldlen));
67     \textcolor{keywordflow}{return} 0;
68 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a7b79e435b2a13401208cc45a79a9128b}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-@{fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-}}
\index{fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-@{fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-splice\-\_\-mem\-\_\-rsv\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{struct {\bf fdt\-\_\-reserve\-\_\-entry} $\ast$}]{p, }
\item[{int}]{oldn, }
\item[{int}]{newn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a7b79e435b2a13401208cc45a79a9128b}


References fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-off\-\_\-dt\-\_\-struct, and fdt\-\_\-splice\-\_\-().



Referenced by fdt\-\_\-add\-\_\-mem\-\_\-rsv(), and fdt\-\_\-del\-\_\-mem\-\_\-rsv().


\begin{DoxyCode}
72 \{
73     \textcolor{keywordtype}{int} delta = (newn - oldn) * \textcolor{keyword}{sizeof}(*p);
74     \textcolor{keywordtype}{int} err;
75     err = \hyperlink{fdt__rw_8c_a55836c2792fa4ba577260df5fad7aa1f}{fdt\_splice\_}(fdt, p, oldn * \textcolor{keyword}{sizeof}(*p), newn * \textcolor{keyword}{sizeof}(*p));
76     \textcolor{keywordflow}{if} (err)
77         \textcolor{keywordflow}{return} err;
78     fdt\_set\_off\_dt\_struct(fdt, \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt) + delta);
79     fdt\_set\_off\_dt\_strings(fdt, \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) + delta);
80     \textcolor{keywordflow}{return} 0;
81 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_ae5030660a27405c9be4712372e7f0b82}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-splice\-\_\-string\-\_\-@{fdt\-\_\-splice\-\_\-string\-\_\-}}
\index{fdt\-\_\-splice\-\_\-string\-\_\-@{fdt\-\_\-splice\-\_\-string\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-splice\-\_\-string\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-splice\-\_\-string\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{newlen}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_ae5030660a27405c9be4712372e7f0b82}


References fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-strings, and fdt\-\_\-splice\-\_\-().



Referenced by fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-().


\begin{DoxyCode}
106 \{
107     \textcolor{keywordtype}{void} *p = (\textcolor{keywordtype}{char} *)fdt
108         + \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) + \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
109     \textcolor{keywordtype}{int} err;
110 
111     \textcolor{keywordflow}{if} ((err = \hyperlink{fdt__rw_8c_a55836c2792fa4ba577260df5fad7aa1f}{fdt\_splice\_}(fdt, p, 0, newlen)))
112         \textcolor{keywordflow}{return} err;
113 
114     fdt\_set\_size\_dt\_strings(fdt, \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt) + newlen);
115     \textcolor{keywordflow}{return} 0;
116 \}
\end{DoxyCode}
\hypertarget{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}{\index{fdt\-\_\-rw.\-c@{fdt\-\_\-rw.\-c}!fdt\-\_\-splice\-\_\-struct\-\_\-@{fdt\-\_\-splice\-\_\-struct\-\_\-}}
\index{fdt\-\_\-splice\-\_\-struct\-\_\-@{fdt\-\_\-splice\-\_\-struct\-\_\-}!fdt_rw.c@{fdt\-\_\-rw.\-c}}
\subsubsection[{fdt\-\_\-splice\-\_\-struct\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-splice\-\_\-struct\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{void $\ast$}]{p, }
\item[{int}]{oldlen, }
\item[{int}]{newlen}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__rw_8c_a81016864afd7abbca6d2f35389f6809f}


References fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-struct, and fdt\-\_\-splice\-\_\-().



Referenced by fdt\-\_\-add\-\_\-property\-\_\-(), fdt\-\_\-add\-\_\-subnode\-\_\-namelen(), fdt\-\_\-appendprop(), fdt\-\_\-del\-\_\-node(), fdt\-\_\-delprop(), fdt\-\_\-resize\-\_\-property\-\_\-(), and fdt\-\_\-set\-\_\-name().


\begin{DoxyCode}
85 \{
86     \textcolor{keywordtype}{int} delta = newlen - oldlen;
87     \textcolor{keywordtype}{int} err;
88 
89     \textcolor{keywordflow}{if} ((err = \hyperlink{fdt__rw_8c_a55836c2792fa4ba577260df5fad7aa1f}{fdt\_splice\_}(fdt, p, oldlen, newlen)))
90         \textcolor{keywordflow}{return} err;
91 
92     fdt\_set\_size\_dt\_struct(fdt, \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt) + delta);
93     fdt\_set\_off\_dt\_strings(fdt, \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) + delta);
94     \textcolor{keywordflow}{return} 0;
95 \}
\end{DoxyCode}
