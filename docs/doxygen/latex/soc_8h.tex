\hypertarget{soc_8h}{\section{/users/enseig/franck/ko6/src/soft/hal/soc/soc.h File Reference}
\label{soc_8h}\index{/users/enseig/franck/ko6/src/soft/hal/soc/soc.\-h@{/users/enseig/franck/ko6/src/soft/hal/soc/soc.\-h}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{soc_8h_a436517497969d33b08925565d4cca572}{soc\-\_\-init} (void $\ast$fdt, int tick)
\begin{DoxyCompactList}\small\item\em Request the initialization of all the architecture of the S\-O\-C This function configures each used devices and configures which I\-R\-Q are used and how they are connected to the C\-P\-U thanks to the I\-C\-U Mask. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{soc_8h_a436517497969d33b08925565d4cca572}{\index{soc.\-h@{soc.\-h}!soc\-\_\-init@{soc\-\_\-init}}
\index{soc\-\_\-init@{soc\-\_\-init}!soc.h@{soc.\-h}}
\subsubsection[{soc\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int soc\-\_\-init (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{tick}
\end{DoxyParamCaption}
)}}\label{soc_8h_a436517497969d33b08925565d4cca572}


Request the initialization of all the architecture of the S\-O\-C This function configures each used devices and configures which I\-R\-Q are used and how they are connected to the C\-P\-U thanks to the I\-C\-U Mask. 


\begin{DoxyParams}{Parameters}
{\em fdt} & is the pointer to the flattened device tree \\
\hline
{\em tick} & is the time in cycles between to I\-R\-Q for the timer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if initialization fails, else 0
\end{DoxyReturn}
Request the initialization of all the architecture of the S\-O\-C This function configures each used devices and configures which I\-R\-Q are used and how they are connected to the C\-P\-U thanks to the I\-C\-U Mask.

There are at most 14 I\-R\-Qs for almo1, but the real number depends of the prototype paramaters There are as many timers as C\-P\-U, thus N\-C\-P\-U\-S timers There are Nicus ttys There are also a D\-M\-A to perfom memcpy and optionnal Block Device (hard drive)

Device I\-R\-Qs are wired as following\-:
\begin{DoxyItemize}
\item I\-C\-U.\-P\-I\-N \mbox{[}0\mbox{]} \-: timer 0 \char`\"{}     \char`\"{} " depending on N\-C\-P\-U\-S (0 to 7)
\item I\-C\-U.\-P\-I\-N \mbox{[}7\mbox{]} \-: timer 7
\item I\-C\-U.\-P\-I\-N \mbox{[}8\mbox{]} \-: bd Bloc Device (Hard Drive)
\item I\-C\-U.\-P\-I\-N \mbox{[}9\mbox{]} \-: dma Direct Memory Access (Hard memcpy)
\item I\-C\-U.\-P\-I\-N \mbox{[}10\mbox{]} \-: T\-T\-Y0 T\-T\-Y n'0 \char`\"{}     \char`\"{} " depending on N\-T\-T\-Y\-S (0 to 3)
\item I\-C\-U.\-P\-I\-N \mbox{[}13\mbox{]} \-: T\-T\-Y3 
\begin{DoxyParams}{Parameters}
{\em tick} & number of ticks between two timer interrupts \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if the initialization failed, 0 if it succeeded
\end{DoxyReturn}
Request the initialization of all the architecture of the S\-O\-C This function configures each used devices and configures which I\-R\-Q are used and how they are connected to the C\-P\-U thanks to the I\-C\-U Mask.
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em tick} & number of ticks between two timer interrupts \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if the initialization failed, 0 if it succeeded 
\end{DoxyReturn}


References fdt\-\_\-magic, soc\-\_\-dma\-\_\-init(), soc\-\_\-icu\-\_\-init(), soc\-\_\-timer\-\_\-init(), and soc\-\_\-tty\-\_\-init().



Referenced by kinit().


\begin{DoxyCode}
193 \{
194     \textcolor{keywordflow}{if} (\hyperlink{libfdt_8h_a783c67f6971d10232c84ecd0aa76f461}{fdt\_magic}(fdt) != 0xd00dfeed)
195         \textcolor{keywordflow}{return} -1;
196 
197     \textcolor{comment}{// We MUST initialize the ICU first since every other device}
198     \textcolor{comment}{// initialization will rely on it for its interrupts}
199     \hyperlink{almo1-mips_2soc_8c_a4c268c213e6a62adfab96031629fa015}{soc\_icu\_init}(fdt);
200 
201     \textcolor{comment}{// Initialize TTY early so we can debug as soon as possible}
202     \textcolor{keywordflow}{if} (\hyperlink{almo1-mips_2soc_8c_a05f9476d07e118d280add6f5e3de365b}{soc\_tty\_init}(fdt) < 0)
203         \textcolor{keywordflow}{return} -1;
204 
205     \hyperlink{almo1-mips_2soc_8c_a5fb66f75ca9173a1a6dd99fc4be6706b}{soc\_dma\_init}(fdt);
206 
207     \textcolor{comment}{// Finish by the timer (we don't want to schedule anything until everything}
208     \textcolor{comment}{// is initialized)}
209     \textcolor{keywordflow}{if} (\hyperlink{almo1-mips_2soc_8c_aeb589179b71725cd918f71b4f23b21d2}{soc\_timer\_init}(fdt, tick) < 0)
210         \textcolor{keywordflow}{return} -1;
211 
212     \textcolor{keywordflow}{return} 0;
213 \}
\end{DoxyCode}
