\hypertarget{ksyscalls_8c}{\section{/users/enseig/franck/ko6/src/soft/kernel/ksyscalls.c File Reference}
\label{ksyscalls_8c}\index{/users/enseig/franck/ko6/src/soft/kernel/ksyscalls.\-c@{/users/enseig/franck/ko6/src/soft/kernel/ksyscalls.\-c}}
}
{\ttfamily \#include $<$hal/devices/dma.\-h$>$}\\*
{\ttfamily \#include $<$kernel/klibc.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{ksyscalls_8c_acc250850867ae5b7ad679ecbcbd85824}{unknown\-\_\-syscall} (int \hyperlink{riscv_2threada_8S_aaef62817c8f68f920ec8214f18b86a4c}{a0}, int \hyperlink{barrier_2main_8c_a877bbde9c70c0c406dc4750657939af6}{a1}, int \hyperlink{riscv_2kpanica_8S_aad0da287fb9a0e51b7226e5df3a8c56d}{a2}, int \hyperlink{riscv_2kpanica_8S_aef1c12591f59927336c38f63fabe8eca}{a3}, int syscall\-\_\-code)
\item 
static void $\ast$ \hyperlink{ksyscalls_8c_af3e1d79745fc92adae457ffd701fb4e1}{dma\-\_\-memcpy\-\_\-user} (int $\ast$dest, int $\ast$src, size\-\_\-t n)
\item 
static int \hyperlink{ksyscalls_8c_a88a7346c373739b293fc3c00462a8033}{dcache\-\_\-buf\-\_\-inval\-\_\-user} (void $\ast$buf, size\-\_\-t size)
\item 
static int \hyperlink{ksyscalls_8c_afba304a121f2232247cabf3ef6cb9cde}{dcache\-\_\-inval\-\_\-user} (void $\ast$addr)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{ksyscalls_8c_ac032bde1c16f368d24dbcde8d400a203}{Syscall\-Vector} \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{ksyscalls_8c_a88a7346c373739b293fc3c00462a8033}{\index{ksyscalls.\-c@{ksyscalls.\-c}!dcache\-\_\-buf\-\_\-inval\-\_\-user@{dcache\-\_\-buf\-\_\-inval\-\_\-user}}
\index{dcache\-\_\-buf\-\_\-inval\-\_\-user@{dcache\-\_\-buf\-\_\-inval\-\_\-user}!ksyscalls.c@{ksyscalls.\-c}}
\subsubsection[{dcache\-\_\-buf\-\_\-inval\-\_\-user}]{\setlength{\rightskip}{0pt plus 5cm}static int dcache\-\_\-buf\-\_\-inval\-\_\-user (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{buf, }
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{ksyscalls_8c_a88a7346c373739b293fc3c00462a8033}


References dcache\-\_\-buf\-\_\-invalidate, E\-P\-E\-R\-M, and S\-U\-C\-C\-E\-S\-S.


\begin{DoxyCode}
47 \{
48     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})buf >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{errno_8h_a447416ba79b4777e7accabf3a8163cb3a156dcc38d9ba0765c6150544963ed267}{EPERM};
49     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})buf+size >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{errno_8h_a447416ba79b4777e7accabf3a8163cb3a156dcc38d9ba0765c6150544963ed267}{EPERM};
50     \hyperlink{riscv_2cache_8S_a55e097eac5768a878728c55450b75595}{dcache\_buf\_invalidate} (buf, size);
51     \textcolor{keywordflow}{return} \hyperlink{errno_8h_a447416ba79b4777e7accabf3a8163cb3ac7f69f7c9e5aea9b8f54cf02870e2bf8}{SUCCESS};
52 \}
\end{DoxyCode}
\hypertarget{ksyscalls_8c_afba304a121f2232247cabf3ef6cb9cde}{\index{ksyscalls.\-c@{ksyscalls.\-c}!dcache\-\_\-inval\-\_\-user@{dcache\-\_\-inval\-\_\-user}}
\index{dcache\-\_\-inval\-\_\-user@{dcache\-\_\-inval\-\_\-user}!ksyscalls.c@{ksyscalls.\-c}}
\subsubsection[{dcache\-\_\-inval\-\_\-user}]{\setlength{\rightskip}{0pt plus 5cm}static int dcache\-\_\-inval\-\_\-user (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{addr}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{ksyscalls_8c_afba304a121f2232247cabf3ef6cb9cde}


References dcache\-\_\-invalidate, E\-P\-E\-R\-M, and S\-U\-C\-C\-E\-S\-S.


\begin{DoxyCode}
55 \{
56     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})addr >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{errno_8h_a447416ba79b4777e7accabf3a8163cb3a156dcc38d9ba0765c6150544963ed267}{EPERM};
57     \hyperlink{mips_2cache_8S_a6b1cee7dfcedefdfff3639527ddaca97}{dcache\_invalidate} (addr);
58     \textcolor{keywordflow}{return} \hyperlink{errno_8h_a447416ba79b4777e7accabf3a8163cb3ac7f69f7c9e5aea9b8f54cf02870e2bf8}{SUCCESS};
59 \}
\end{DoxyCode}
\hypertarget{ksyscalls_8c_af3e1d79745fc92adae457ffd701fb4e1}{\index{ksyscalls.\-c@{ksyscalls.\-c}!dma\-\_\-memcpy\-\_\-user@{dma\-\_\-memcpy\-\_\-user}}
\index{dma\-\_\-memcpy\-\_\-user@{dma\-\_\-memcpy\-\_\-user}!ksyscalls.c@{ksyscalls.\-c}}
\subsubsection[{dma\-\_\-memcpy\-\_\-user}]{\setlength{\rightskip}{0pt plus 5cm}static void$\ast$ dma\-\_\-memcpy\-\_\-user (
\begin{DoxyParamCaption}
\item[{int $\ast$}]{dest, }
\item[{int $\ast$}]{src, }
\item[{size\-\_\-t}]{n}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{ksyscalls_8c_af3e1d79745fc92adae457ffd701fb4e1}


References dma\-\_\-get, dma\-\_\-ops\-\_\-s\-::dma\-\_\-memcpy, memcpy(), N\-U\-L\-L, and dma\-\_\-s\-::ops.


\begin{DoxyCode}
29 \{
30     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})src >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
31     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})dest >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
32     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})src+n >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
33     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})dest+n >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
34     \textcolor{keywordflow}{if} (n >= 0x80000000) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
35 
36     \textcolor{comment}{// Get the DMA device}
37     \textcolor{keyword}{struct }\hyperlink{structdma__s}{dma\_s} *dma = \hyperlink{dma_8h_ab7b132ec5de4439a90137a52001a4801}{dma\_get}(0);
38     \textcolor{keywordflow}{if} (!dma)
39         \textcolor{comment}{// If no DMA is available, do a reguler memcpy}
40         \textcolor{comment}{// TODO: verify this isn't dangerous}
41         \textcolor{keywordflow}{return} \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}((\textcolor{keywordtype}{char}*) dest, (\textcolor{keywordtype}{char}*) src, n * 4);
42     \textcolor{keywordflow}{else}
43         \textcolor{keywordflow}{return} dma->\hyperlink{structdma__s_ac213f02a6ace026dfcd3de21f16347ba}{ops}->\hyperlink{structdma__ops__s_a4d6f4471ec92c929885e182d8efd1186}{dma\_memcpy} (dma, dest, src, n);
44 \}
\end{DoxyCode}
\hypertarget{ksyscalls_8c_acc250850867ae5b7ad679ecbcbd85824}{\index{ksyscalls.\-c@{ksyscalls.\-c}!unknown\-\_\-syscall@{unknown\-\_\-syscall}}
\index{unknown\-\_\-syscall@{unknown\-\_\-syscall}!ksyscalls.c@{ksyscalls.\-c}}
\subsubsection[{unknown\-\_\-syscall}]{\setlength{\rightskip}{0pt plus 5cm}static int unknown\-\_\-syscall (
\begin{DoxyParamCaption}
\item[{int}]{a0, }
\item[{int}]{a1, }
\item[{int}]{a2, }
\item[{int}]{a3, }
\item[{int}]{syscall\-\_\-code}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{ksyscalls_8c_acc250850867ae5b7ad679ecbcbd85824}


References E\-N\-O\-S\-Y\-S, and kprintf().


\begin{DoxyCode}
18 \{
19     \hyperlink{klibc_8c_ac4ae3bb8e59735d2b772e77186b52228}{kprintf} (\textcolor{stringliteral}{"Unknown Syscall : %d\(\backslash\)n"}, syscall\_code);
20     \hyperlink{klibc_8c_ac4ae3bb8e59735d2b772e77186b52228}{kprintf} (\textcolor{stringliteral}{"a0 : 0x%p (%d)\(\backslash\)n"}, \hyperlink{riscv_2atomic_8S_a3d9d4d3857e499e04ab8a29c34ab004d}{a0}, \hyperlink{riscv_2atomic_8S_a3d9d4d3857e499e04ab8a29c34ab004d}{a0});
21     \hyperlink{klibc_8c_ac4ae3bb8e59735d2b772e77186b52228}{kprintf} (\textcolor{stringliteral}{"a1 : 0x%p (%d)\(\backslash\)n"}, \hyperlink{riscv_2atomic_8S_a722b1add1d9781e2115fb2fcc9d5541a}{a1}, \hyperlink{riscv_2atomic_8S_a722b1add1d9781e2115fb2fcc9d5541a}{a1});
22     \hyperlink{klibc_8c_ac4ae3bb8e59735d2b772e77186b52228}{kprintf} (\textcolor{stringliteral}{"a2 : 0x%p (%d)\(\backslash\)n"}, \hyperlink{riscv_2kpanica_8S_aad0da287fb9a0e51b7226e5df3a8c56d}{a2}, \hyperlink{riscv_2kpanica_8S_aad0da287fb9a0e51b7226e5df3a8c56d}{a2});
23     \hyperlink{klibc_8c_ac4ae3bb8e59735d2b772e77186b52228}{kprintf} (\textcolor{stringliteral}{"a3 : 0x%p (%d)\(\backslash\)n"}, \hyperlink{riscv_2kpanica_8S_aef1c12591f59927336c38f63fabe8eca}{a3}, \hyperlink{riscv_2kpanica_8S_aef1c12591f59927336c38f63fabe8eca}{a3});
24     \textcolor{keywordflow}{return} \hyperlink{errno_8h_a447416ba79b4777e7accabf3a8163cb3abd287bcdb80bb2a0c41269b9adcb9d77}{ENOSYS};
25 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{ksyscalls_8c_ac032bde1c16f368d24dbcde8d400a203}{\index{ksyscalls.\-c@{ksyscalls.\-c}!Syscall\-Vector@{Syscall\-Vector}}
\index{Syscall\-Vector@{Syscall\-Vector}!ksyscalls.c@{ksyscalls.\-c}}
\subsubsection[{Syscall\-Vector}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ Syscall\-Vector\mbox{[}$\,$\mbox{]}}}\label{ksyscalls_8c_ac032bde1c16f368d24dbcde8d400a203}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
    [0 ... \hyperlink{syscalls_8h_ac2c7a2e51ade374764c90e27cca50a57}{SYSCALL\_NR} - 1   ] = \hyperlink{ksyscalls_8c_acc250850867ae5b7ad679ecbcbd85824}{unknown\_syscall},   
    [\hyperlink{syscalls_8h_a6afe19f22c590d7cced68927ad3e37b3}{SYSCALL\_EXIT}           ] = \hyperlink{klibc_8c_a55e99c539cf7723ec15e856b7e0a8cee}{exit},
    [\hyperlink{syscalls_8h_ae5be81f63639b2e6928bce18ccda6acc}{SYSCALL\_READ}           ] = \hyperlink{klibc_8c_a4e745df503033a3297f150e02f27fabb}{tty\_read},
    [\hyperlink{syscalls_8h_a7bf5d5477f99d0648e55674643559070}{SYSCALL\_WRITE}          ] = \hyperlink{klibc_8c_a528bdbe20981259789b7663d15278ba4}{tty\_write},
    [\hyperlink{syscalls_8h_a1b284030b6f72253c3e7546fd551020f}{SYSCALL\_CLOCK}          ] = \hyperlink{mips_2cpuregs_8S_af7e0f9f0eada9d28b46b4d1f7ae5b702}{clock},
    [\hyperlink{syscalls_8h_a7d2b3d482703584b6be5cf155648344a}{SYSCALL\_DMA\_MEMCPY}     ] = \hyperlink{ksyscalls_8c_af3e1d79745fc92adae457ffd701fb4e1}{dma\_memcpy\_user},
    [\hyperlink{syscalls_8h_aa01c11788b75eea69fa87959f6fac5b4}{SYSCALL\_CACHELINESIZE}  ] = \hyperlink{mips_2cache_8S_a2ffad5962fec472ce41e46451bcd8f02}{cachelinesize},
    [\hyperlink{syscalls_8h_a1fa616eba469314a5889d45524348a52}{SYSCALL\_DCACHEBUFINVAL} ] = \hyperlink{ksyscalls_8c_a88a7346c373739b293fc3c00462a8033}{dcache\_buf\_inval\_user},
    [\hyperlink{syscalls_8h_a28679dcec3d60a8716d3e2ce024dcacd}{SYSCALL\_DCACHEINVAL}    ] = \hyperlink{ksyscalls_8c_afba304a121f2232247cabf3ef6cb9cde}{dcache\_inval\_user},
    [\hyperlink{syscalls_8h_a9d26167e6c82729ced6b3437400fb0de}{SYSCALL\_SBRK}           ] = \hyperlink{kmemory_8c_ad3736b4c8c3376c224d8a70e39b1a017}{sbrk},
    
    [\hyperlink{syscalls_8h_a63de1298da2951a6a80a60ba2e81f3cc}{SYSCALL\_THREAD\_CREATE}  ] = \hyperlink{kthread_8c_a2525e99272c4db4198bcea374d717620}{thread\_create},
    [\hyperlink{syscalls_8h_a26a363c5f0ee06e0eec9cc16ed64a2fd}{SYSCALL\_THREAD\_YIELD}   ] = \hyperlink{kthread_8c_affe2eebf6749bc36765d45ff48c926b1}{thread\_yield},
    [\hyperlink{syscalls_8h_ab38bbbfadd5c56dcd1a4bf2f2f108f8b}{SYSCALL\_THREAD\_EXIT}    ] = \hyperlink{kthread_8c_a19b16adf05364471bae2840aa564329a}{thread\_exit},
    [\hyperlink{syscalls_8h_ac3d987610a2daf21c3e994f890feecab}{SYSCALL\_SCHED\_DUMP}     ] = \hyperlink{kthread_8c_a02cfe68dc8f379c88d448172f997b09e}{sched\_dump},
    [\hyperlink{syscalls_8h_ad4d7571cbeb659d57fd4d92ae1924082}{SYSCALL\_THREAD\_JOIN}    ] = \hyperlink{kthread_8c_a4e54fc344bbd735b027c03629927abb9}{thread\_join},
    [\hyperlink{syscalls_8h_aa7c4dd1815b9890594a76a9c23db75e3}{SYSCALL\_MUTEX\_INIT}     ] = \hyperlink{ksynchro_8c_a2fbf4c52b56586ce18013333c7a1d37e}{thread\_mutex\_init},
    [\hyperlink{syscalls_8h_ad83026e97bed8a463c5a955867011e8d}{SYSCALL\_MUTEX\_LOCK}     ] = \hyperlink{ksynchro_8c_aa5d516e2832e4c1f4d222a79fabe76a2}{thread\_mutex\_lock},
    [\hyperlink{syscalls_8h_a71247681fc657059e83f9bcf64068fe7}{SYSCALL\_MUTEX\_UNLOCK}   ] = \hyperlink{ksynchro_8c_ad515bf71cd806fc2d1a5c4143aca3988}{thread\_mutex\_unlock},
    [\hyperlink{syscalls_8h_ad87d7bb44b389a78ec06709fa5fbc23a}{SYSCALL\_MUTEX\_DESTROY}  ] = \hyperlink{ksynchro_8c_af85d5d2e4a36615955a7cfbae10eeec5}{thread\_mutex\_destroy},
    [\hyperlink{syscalls_8h_a026c84ef7c3e101d665208d89b369b6c}{SYSCALL\_BARRIER\_INIT}   ] = \hyperlink{ksynchro_8c_adea6885b17fdfc05ad0414fbaa41dd89}{thread\_barrier\_init},
    [\hyperlink{syscalls_8h_aa2c79dbb3d9d284094852336eead340a}{SYSCALL\_BARRIER\_WAIT}   ] = \hyperlink{ksynchro_8c_aea6f07b8093fabd5e248aae8b7e64abb}{thread\_barrier\_wait},
    [\hyperlink{syscalls_8h_a1381b417b795b6cd16ae37c078862a38}{SYSCALL\_BARRIER\_DESTROY}] = \hyperlink{ksynchro_8c_a384a3caafcd4e7c672a583fc4183f983}{thread\_barrier\_destroy},
\}
\end{DoxyCode}
