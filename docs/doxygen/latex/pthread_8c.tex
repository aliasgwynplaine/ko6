\hypertarget{pthread_8c}{\section{/users/enseig/franck/ko6/src/soft/ulib/pthread.c File Reference}
\label{pthread_8c}\index{/users/enseig/franck/ko6/src/soft/ulib/pthread.\-c@{/users/enseig/franck/ko6/src/soft/ulib/pthread.\-c}}
}
{\ttfamily \#include $<$libc.\-h$>$}\\*
{\ttfamily \#include $<$pthread.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{pthread_8c_a334f18a58e25ecc72e490c91cea67547}{thread\-\_\-start} (void $\ast$($\ast$fun)(void $\ast$), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em pthread\-\_\-start is the function called by the kernel at the true start of a thread \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_a57aa485fb15bd7f307777cef1a074d28}{pthread\-\_\-create} (\hyperlink{pthread_8h_af76921f9c4d382336c266fc967017636}{pthread\-\_\-t} $\ast$thread, \hyperlink{pthread_8h_aa1f53c172f469781ac957e8d01322c43}{pthread\-\_\-attr\-\_\-t} $\ast$attr, void $\ast$($\ast$fun)(void $\ast$), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em asks the kernel via a syscall to start a new thread by invoking fun(arg) fun() can stop the thread by calling thread\-\_\-exit(value) or if it returns a value, it is equivalent to call thread\-\_\-exit with this value The state of the new thread is T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-A\-D\-Y. \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_aeff2e6e14c407e3d02076ecae842bcca}{pthread\-\_\-yield} (void)
\begin{DoxyCompactList}\small\item\em Causes the current thread to give up the C\-P\-U in order to give it to another. \end{DoxyCompactList}\item 
void \hyperlink{pthread_8c_a23b28e0f8ac5af2b46a33cdab3a80e44}{pthread\-\_\-exit} (void $\ast$retval)
\begin{DoxyCompactList}\small\item\em terminates the current thread and returns retval \end{DoxyCompactList}\item 
void \hyperlink{pthread_8c_a02cfe68dc8f379c88d448172f997b09e}{sched\-\_\-dump} (void)
\begin{DoxyCompactList}\small\item\em Displays on the console (tty0) all active threads, it is for debugging. \end{DoxyCompactList}\item 
void \hyperlink{pthread_8c_a471c1323d7564c8a6244f105c0e3e8f1}{pthread\-\_\-join} (\hyperlink{pthread_8h_af76921f9c4d382336c266fc967017636}{pthread\-\_\-t} thread, void $\ast$$\ast$retval)
\begin{DoxyCompactList}\small\item\em wait for a thread termination \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_ae2d27287a87adaab0c6bbb23ec3e529e}{pthread\-\_\-mutex\-\_\-init} (\hyperlink{pthread_8h_aa13253d3ede7200917f21c685a49d256}{pthread\-\_\-mutex\-\_\-t} $\ast$mutex, \hyperlink{pthread_8h_ab7433c31c2d1fdefd1465dc2204de989}{pthread\-\_\-mutexattr\-\_\-t} $\ast$attr)
\begin{DoxyCompactList}\small\item\em creates a new mutex and initializes mutex variable with the new mutex (side effect) it is a mutex with error checking \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_a3cf620ff3a40af11d79cf28901dc55e2}{pthread\-\_\-mutex\-\_\-destroy} (\hyperlink{pthread_8h_aa13253d3ede7200917f21c685a49d256}{pthread\-\_\-mutex\-\_\-t} $\ast$mutex)
\begin{DoxyCompactList}\small\item\em destroy the referenced mutex If the mutex is locked the destruction is not done, this is an error \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_a12809c44718c21544ceb280dc1a53573}{pthread\-\_\-mutex\-\_\-lock} (\hyperlink{pthread_8h_aa13253d3ede7200917f21c685a49d256}{pthread\-\_\-mutex\-\_\-t} $\ast$mutex)
\begin{DoxyCompactList}\small\item\em lock the referenced mutex, it is a blocking operation. If the mutex is already locked, the calling thread blocks until the mutex becomes available. If the mutex does not exist or is already locked, this is an error \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_a96184290ffb60e04c53a52869cf960a2}{pthread\-\_\-mutex\-\_\-unlock} (\hyperlink{pthread_8h_aa13253d3ede7200917f21c685a49d256}{pthread\-\_\-mutex\-\_\-t} $\ast$mutex)
\begin{DoxyCompactList}\small\item\em unlock the referenced mutex If the mutex does not exist or is not locked or has been locked by another, this is an error that causes exit with error \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_ad99d3bb02ea2b98fbf98fdb24d32adb3}{pthread\-\_\-barrier\-\_\-init} (\hyperlink{pthread_8h_ac97967a2700653f458a949449411c7cb}{pthread\-\_\-barrier\-\_\-t} $\ast$\hyperlink{barrier_2main_8c_a779bfbbb688cf46720cfb65109ea4858}{barrier}, \hyperlink{pthread_8h_a7e975afcd4298de90c6ba1a236de12a9}{pthread\-\_\-barrierattr\-\_\-t} $\ast$attr, size\-\_\-t count)
\begin{DoxyCompactList}\small\item\em creates or initialize a barrier depending the value of barrier parameter \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_ae8ef9b4e2d7feaa1a28159991e7433ac}{pthread\-\_\-barrier\-\_\-destroy} (\hyperlink{pthread_8h_ac97967a2700653f458a949449411c7cb}{pthread\-\_\-barrier\-\_\-t} $\ast$\hyperlink{barrier_2main_8c_a779bfbbb688cf46720cfb65109ea4858}{barrier})
\begin{DoxyCompactList}\small\item\em destroy the referenced barrier If a thread is waiting at the barrier, then the destruction is not done, it is an error \end{DoxyCompactList}\item 
int \hyperlink{pthread_8c_a85f92053b4d12aa94927b364b5b757d9}{pthread\-\_\-barrier\-\_\-wait} (\hyperlink{pthread_8h_ac97967a2700653f458a949449411c7cb}{pthread\-\_\-barrier\-\_\-t} $\ast$\hyperlink{barrier_2main_8c_a779bfbbb688cf46720cfb65109ea4858}{barrier})
\begin{DoxyCompactList}\small\item\em wait to the referenced barrier, it is a blocking operation for all thread but the last the last arrived thread doesn't wait and notifies the other threads which becomes R\-E\-A\-D\-Y \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{pthread_8c_ae8ef9b4e2d7feaa1a28159991e7433ac}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-barrier\-\_\-destroy@{pthread\-\_\-barrier\-\_\-destroy}}
\index{pthread\-\_\-barrier\-\_\-destroy@{pthread\-\_\-barrier\-\_\-destroy}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-barrier\-\_\-destroy}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-barrier\-\_\-destroy (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-barrier\-\_\-t} $\ast$}]{barrier}
\end{DoxyParamCaption}
)}}\label{pthread_8c_ae8ef9b4e2d7feaa1a28159991e7433ac}


destroy the referenced barrier If a thread is waiting at the barrier, then the destruction is not done, it is an error 


\begin{DoxyParams}{Parameters}
{\em barrier} & a pointer referencing a barrier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\-U\-C\-C\-E\-S\-S if it all goes fine or E\-I\-N\-V\-A\-L wrong argument E\-B\-U\-S\-Y The implementation has detected an attempt to destroy a barrier while it is in use (for example, while being used in a \hyperlink{ksynchro_8c_aea6f07b8093fabd5e248aae8b7e64abb}{thread\-\_\-barrier\-\_\-wait()} call) by another thread. 
\end{DoxyReturn}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-B\-A\-R\-R\-I\-E\-R\-\_\-\-D\-E\-S\-T\-R\-O\-Y, and syscall\-\_\-fct.


\begin{DoxyCode}
98 \{
99     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})\hyperlink{barrier_2main_8c_a779bfbbb688cf46720cfb65109ea4858}{barrier}, 0, 0, 0, 
      \hyperlink{syscalls_8h_a1381b417b795b6cd16ae37c078862a38}{SYSCALL\_BARRIER\_DESTROY});
100 \}
\end{DoxyCode}
\hypertarget{pthread_8c_ad99d3bb02ea2b98fbf98fdb24d32adb3}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-barrier\-\_\-init@{pthread\-\_\-barrier\-\_\-init}}
\index{pthread\-\_\-barrier\-\_\-init@{pthread\-\_\-barrier\-\_\-init}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-barrier\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-barrier\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-barrier\-\_\-t} $\ast$}]{barrier, }
\item[{{\bf pthread\-\_\-barrierattr\-\_\-t} $\ast$}]{attr, }
\item[{size\-\_\-t}]{count}
\end{DoxyParamCaption}
)}}\label{pthread_8c_ad99d3bb02ea2b98fbf98fdb24d32adb3}


creates or initialize a barrier depending the value of barrier parameter 


\begin{DoxyParams}{Parameters}
{\em barrier} & a pointer referencing the barrier, there are two cases 1) if $\ast$barrier == N\-U\-L\-L then allocate a new barrier, then initialize count 2) if $\ast$barrier != N\-U\-L\-L it the barrier already exists, just initialize count \\
\hline
{\em attr} & a pointer to the attribute of the new barrier (N\-U\-L\-L for default) \\
\hline
{\em count} & number of expected threads for this barrier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\-U\-C\-C\-E\-S\-S if it all goes fine or E\-I\-N\-V\-A\-L The value specified by count is equal to zero. E\-N\-O\-M\-E\-M Insufficient memory exists to initialize the barrier E\-B\-U\-S\-Y The implementation has detected an attempt to reinitialize a barrier while it is in use (for example, while being used in a \hyperlink{ksynchro_8c_aea6f07b8093fabd5e248aae8b7e64abb}{thread\-\_\-barrier\-\_\-wait()} call) by another thread. 
\end{DoxyReturn}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-B\-A\-R\-R\-I\-E\-R\-\_\-\-I\-N\-I\-T, and syscall\-\_\-fct.



Referenced by main().


\begin{DoxyCode}
93 \{
94     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})\hyperlink{barrier_2main_8c_a779bfbbb688cf46720cfb65109ea4858}{barrier}, (\textcolor{keywordtype}{int}) count, (\textcolor{keywordtype}{int}) attr, 0, 
      \hyperlink{syscalls_8h_a026c84ef7c3e101d665208d89b369b6c}{SYSCALL\_BARRIER\_INIT});
95 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a85f92053b4d12aa94927b364b5b757d9}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-barrier\-\_\-wait@{pthread\-\_\-barrier\-\_\-wait}}
\index{pthread\-\_\-barrier\-\_\-wait@{pthread\-\_\-barrier\-\_\-wait}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-barrier\-\_\-wait}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-barrier\-\_\-wait (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-barrier\-\_\-t} $\ast$}]{barrier}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a85f92053b4d12aa94927b364b5b757d9}


wait to the referenced barrier, it is a blocking operation for all thread but the last the last arrived thread doesn't wait and notifies the other threads which becomes R\-E\-A\-D\-Y 


\begin{DoxyParams}{Parameters}
{\em barrier} & a pointer referencing a barrier \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
S\-U\-C\-C\-E\-S\-S or F\-E\-A\-L\-U\-R\-E 
\end{DoxyReturn}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-B\-A\-R\-R\-I\-E\-R\-\_\-\-W\-A\-I\-T, and syscall\-\_\-fct.


\begin{DoxyCode}
103 \{
104     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})\hyperlink{barrier_2main_8c_a779bfbbb688cf46720cfb65109ea4858}{barrier}, 0, 0, 0, 
      \hyperlink{syscalls_8h_aa2c79dbb3d9d284094852336eead340a}{SYSCALL\_BARRIER\_WAIT});
105 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a57aa485fb15bd7f307777cef1a074d28}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-create@{pthread\-\_\-create}}
\index{pthread\-\_\-create@{pthread\-\_\-create}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-create}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-create (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-t} $\ast$}]{thread, }
\item[{{\bf pthread\-\_\-attr\-\_\-t} $\ast$}]{attr, }
\item[{void $\ast$($\ast$)(void $\ast$)}]{fun, }
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a57aa485fb15bd7f307777cef1a074d28}


asks the kernel via a syscall to start a new thread by invoking fun(arg) fun() can stop the thread by calling thread\-\_\-exit(value) or if it returns a value, it is equivalent to call thread\-\_\-exit with this value The state of the new thread is T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-A\-D\-Y. 


\begin{DoxyParams}{Parameters}
{\em thread} & pointer to the thread structure \\
\hline
{\em attr} & pointer to the thread atribute structure (default if N\-U\-L\-L) \\
\hline
{\em fun} & pointer to the function of the thread \\
\hline
{\em arg} & the argument given to fun() \\
\hline
\end{DoxyParams}


References syscall\-\_\-fct, S\-Y\-S\-C\-A\-L\-L\-\_\-\-T\-H\-R\-E\-A\-D\-\_\-\-C\-R\-E\-A\-T\-E, and thread\-\_\-start().



Referenced by main().


\begin{DoxyCode}
36 \{
37     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})thread, (\textcolor{keywordtype}{int})fun, (\textcolor{keywordtype}{int})arg, (\textcolor{keywordtype}{int})
      \hyperlink{pthread_8c_a334f18a58e25ecc72e490c91cea67547}{thread\_start}, \hyperlink{syscalls_8h_a63de1298da2951a6a80a60ba2e81f3cc}{SYSCALL\_THREAD\_CREATE});
38 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a23b28e0f8ac5af2b46a33cdab3a80e44}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-exit@{pthread\-\_\-exit}}
\index{pthread\-\_\-exit@{pthread\-\_\-exit}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-exit}]{\setlength{\rightskip}{0pt plus 5cm}void pthread\-\_\-exit (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{retval}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a23b28e0f8ac5af2b46a33cdab3a80e44}


terminates the current thread and returns retval 


\begin{DoxyParams}{Parameters}
{\em retval} & the value can be retrieved by calling the thread\-\_\-join function of another thread \\
\hline
\end{DoxyParams}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-T\-H\-R\-E\-A\-D\-\_\-\-E\-X\-I\-T.



Referenced by thread\-\_\-start().


\begin{DoxyCode}
46 \{
47     \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})retval, 0, 0, 0, \hyperlink{syscalls_8h_ab38bbbfadd5c56dcd1a4bf2f2f108f8b}{SYSCALL\_THREAD\_EXIT});
48 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a471c1323d7564c8a6244f105c0e3e8f1}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-join@{pthread\-\_\-join}}
\index{pthread\-\_\-join@{pthread\-\_\-join}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-join}]{\setlength{\rightskip}{0pt plus 5cm}void pthread\-\_\-join (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-t}}]{thread, }
\item[{void $\ast$$\ast$}]{retval}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a471c1323d7564c8a6244f105c0e3e8f1}


wait for a thread termination 


\begin{DoxyParams}{Parameters}
{\em thread} & expected thread \\
\hline
{\em retval} & pointer to the return value of the expected thread \\
\hline
\end{DoxyParams}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-T\-H\-R\-E\-A\-D\-\_\-\-J\-O\-I\-N.



Referenced by main().


\begin{DoxyCode}
56 \{
57     \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})thread, (\textcolor{keywordtype}{int})retval, 0, 0, \hyperlink{syscalls_8h_ad4d7571cbeb659d57fd4d92ae1924082}{SYSCALL\_THREAD\_JOIN});
58 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a3cf620ff3a40af11d79cf28901dc55e2}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-mutex\-\_\-destroy@{pthread\-\_\-mutex\-\_\-destroy}}
\index{pthread\-\_\-mutex\-\_\-destroy@{pthread\-\_\-mutex\-\_\-destroy}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-mutex\-\_\-destroy}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-mutex\-\_\-destroy (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-mutex\-\_\-t} $\ast$}]{mutex}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a3cf620ff3a40af11d79cf28901dc55e2}


destroy the referenced mutex If the mutex is locked the destruction is not done, this is an error 


\begin{DoxyParams}{Parameters}
{\em mutex} & a pointer referencing a mutex \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, 1 on fealure 
\end{DoxyReturn}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-M\-U\-T\-E\-X\-\_\-\-D\-E\-S\-T\-R\-O\-Y.


\begin{DoxyCode}
72 \{
73     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})mutex, 0, 0, 0, \hyperlink{syscalls_8h_ad87d7bb44b389a78ec06709fa5fbc23a}{SYSCALL\_MUTEX\_DESTROY});
74 \}
\end{DoxyCode}
\hypertarget{pthread_8c_ae2d27287a87adaab0c6bbb23ec3e529e}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-mutex\-\_\-init@{pthread\-\_\-mutex\-\_\-init}}
\index{pthread\-\_\-mutex\-\_\-init@{pthread\-\_\-mutex\-\_\-init}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-mutex\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-mutex\-\_\-init (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-mutex\-\_\-t} $\ast$}]{mutex, }
\item[{{\bf pthread\-\_\-mutexattr\-\_\-t} $\ast$}]{attr}
\end{DoxyParamCaption}
)}}\label{pthread_8c_ae2d27287a87adaab0c6bbb23ec3e529e}


creates a new mutex and initializes mutex variable with the new mutex (side effect) it is a mutex with error checking 


\begin{DoxyParams}{Parameters}
{\em mutex} & a pointer referencing the new mutex \\
\hline
{\em attr} & a pointer to the attribute of the new mutex (N\-U\-L\-L for default) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, 1 on fealure 
\end{DoxyReturn}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-M\-U\-T\-E\-X\-\_\-\-I\-N\-I\-T.


\begin{DoxyCode}
67 \{
68     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})mutex, 0, 0, 0, \hyperlink{syscalls_8h_aa7c4dd1815b9890594a76a9c23db75e3}{SYSCALL\_MUTEX\_INIT});
69 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a12809c44718c21544ceb280dc1a53573}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-mutex\-\_\-lock@{pthread\-\_\-mutex\-\_\-lock}}
\index{pthread\-\_\-mutex\-\_\-lock@{pthread\-\_\-mutex\-\_\-lock}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-mutex\-\_\-lock}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-mutex\-\_\-lock (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-mutex\-\_\-t} $\ast$}]{mutex}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a12809c44718c21544ceb280dc1a53573}


lock the referenced mutex, it is a blocking operation. If the mutex is already locked, the calling thread blocks until the mutex becomes available. If the mutex does not exist or is already locked, this is an error 


\begin{DoxyParams}{Parameters}
{\em mutex} & a pointer referencing a mutex \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, 1 on fealure 
\end{DoxyReturn}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-M\-U\-T\-E\-X\-\_\-\-L\-O\-C\-K.


\begin{DoxyCode}
77 \{
78     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})mutex, 0, 0, 0, \hyperlink{syscalls_8h_ad83026e97bed8a463c5a955867011e8d}{SYSCALL\_MUTEX\_LOCK});
79 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a96184290ffb60e04c53a52869cf960a2}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-mutex\-\_\-unlock@{pthread\-\_\-mutex\-\_\-unlock}}
\index{pthread\-\_\-mutex\-\_\-unlock@{pthread\-\_\-mutex\-\_\-unlock}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-mutex\-\_\-unlock}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-mutex\-\_\-unlock (
\begin{DoxyParamCaption}
\item[{{\bf pthread\-\_\-mutex\-\_\-t} $\ast$}]{mutex}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a96184290ffb60e04c53a52869cf960a2}


unlock the referenced mutex If the mutex does not exist or is not locked or has been locked by another, this is an error that causes exit with error 


\begin{DoxyParams}{Parameters}
{\em mutex} & a pointer referencing a mutex \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success, 1 on fealure 
\end{DoxyReturn}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-M\-U\-T\-E\-X\-\_\-\-U\-N\-L\-O\-C\-K.


\begin{DoxyCode}
82 \{
83     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} ((\textcolor{keywordtype}{int})mutex, 0, 0, 0, \hyperlink{syscalls_8h_a71247681fc657059e83f9bcf64068fe7}{SYSCALL\_MUTEX\_UNLOCK});
84 \}
\end{DoxyCode}
\hypertarget{pthread_8c_aeff2e6e14c407e3d02076ecae842bcca}{\index{pthread.\-c@{pthread.\-c}!pthread\-\_\-yield@{pthread\-\_\-yield}}
\index{pthread\-\_\-yield@{pthread\-\_\-yield}!pthread.c@{pthread.\-c}}
\subsubsection[{pthread\-\_\-yield}]{\setlength{\rightskip}{0pt plus 5cm}int pthread\-\_\-yield (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{pthread_8c_aeff2e6e14c407e3d02076ecae842bcca}


Causes the current thread to give up the C\-P\-U in order to give it to another. 



References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-T\-H\-R\-E\-A\-D\-\_\-\-Y\-I\-E\-L\-D.


\begin{DoxyCode}
41 \{
42     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} (0, 0, 0, 0, \hyperlink{syscalls_8h_a26a363c5f0ee06e0eec9cc16ed64a2fd}{SYSCALL\_THREAD\_YIELD});
43 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a02cfe68dc8f379c88d448172f997b09e}{\index{pthread.\-c@{pthread.\-c}!sched\-\_\-dump@{sched\-\_\-dump}}
\index{sched\-\_\-dump@{sched\-\_\-dump}!pthread.c@{pthread.\-c}}
\subsubsection[{sched\-\_\-dump}]{\setlength{\rightskip}{0pt plus 5cm}void sched\-\_\-dump (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{pthread_8c_a02cfe68dc8f379c88d448172f997b09e}


Displays on the console (tty0) all active threads, it is for debugging. 



References thread\-\_\-s\-::arg, clock, D, errno\-\_\-mess, thread\-\_\-s\-::fun, thread\-\_\-s\-::join, kprintf(), thread\-\_\-s\-::kstack, thread\-\_\-s\-::kstack\-\_\-b, list\-\_\-s\-::next, P, list\-\_\-s\-::prev, thread\-\_\-s\-::ptls, thread\-\_\-s\-::retval, S, thread\-\_\-s\-::start, thread\-\_\-s\-::state, syscall\-\_\-fct, S\-Y\-S\-C\-A\-L\-L\-\_\-\-S\-C\-H\-E\-D\-\_\-\-D\-U\-M\-P, T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-D\-E\-A\-D, T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-E\-A\-D\-Y, T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-R\-U\-N\-N\-I\-N\-G, T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-W\-A\-I\-T, T\-H\-\_\-\-S\-T\-A\-T\-E\-\_\-\-Z\-O\-M\-B\-I\-E, T\-H\-\_\-\-T\-Y\-P\-E\-\_\-\-K\-E\-R\-N\-E\-L, T\-H\-\_\-\-T\-Y\-P\-E\-\_\-\-U\-S\-E\-R, T\-H\-R\-E\-A\-D\-\_\-\-M\-A\-X, Thread\-Current\-Idx, thread\-\_\-s\-::tid, \-\_\-tls\-\_\-s\-::tls\-\_\-errno, thread\-\_\-s\-::type, thread\-\_\-s\-::ustack\-\_\-b, thread\-\_\-s\-::ustack\-\_\-e, W, thread\-\_\-s\-::wait, and Y.


\begin{DoxyCode}
51 \{
52     \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} (0, 0, 0, 0, \hyperlink{syscalls_8h_ac3d987610a2daf21c3e994f890feecab}{SYSCALL\_SCHED\_DUMP});
53 \}
\end{DoxyCode}
\hypertarget{pthread_8c_a334f18a58e25ecc72e490c91cea67547}{\index{pthread.\-c@{pthread.\-c}!thread\-\_\-start@{thread\-\_\-start}}
\index{thread\-\_\-start@{thread\-\_\-start}!pthread.c@{pthread.\-c}}
\subsubsection[{thread\-\_\-start}]{\setlength{\rightskip}{0pt plus 5cm}static void thread\-\_\-start (
\begin{DoxyParamCaption}
\item[{void $\ast$($\ast$)(void $\ast$)}]{fun, }
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{pthread_8c_a334f18a58e25ecc72e490c91cea67547}


pthread\-\_\-start is the function called by the kernel at the true start of a thread 


\begin{DoxyParams}{Parameters}
{\em fun} & is the thread's function (the one defined in the user application) \\
\hline
{\em arg} & is the thread argument, which will be given to the function fun \\
\hline
\end{DoxyParams}


References pthread\-\_\-exit().



Referenced by pthread\-\_\-create().


\begin{DoxyCode}
29 \{
30 \textcolor{comment}{//    urandseed = 1;             // initialise the user random seed (present in the tls) }
31     \textcolor{keywordtype}{void} * retval = fun (arg); \textcolor{comment}{// call the function with its arg (maybe, it will call thread\_exit())}
32     \hyperlink{pthread_8c_a23b28e0f8ac5af2b46a33cdab3a80e44}{pthread\_exit}(retval);      \textcolor{comment}{// otherwise, if fun ends, ask the kernel to exit the thread}
33 \}
\end{DoxyCode}
