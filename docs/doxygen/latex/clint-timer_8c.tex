\hypertarget{clint-timer_8c}{\section{/users/enseig/franck/ko6/src/soft/hal/devices/timer/clint-\/timer.c File Reference}
\label{clint-timer_8c}\index{/users/enseig/franck/ko6/src/soft/hal/devices/timer/clint-\/timer.\-c@{/users/enseig/franck/ko6/src/soft/hal/devices/timer/clint-\/timer.\-c}}
}
{\ttfamily \#include $<$hal/devices/timer/clint-\/timer.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{clint-timer_8c_ab787b81c06c064352fdba1152ef5efcb}{clint\-\_\-timer\-\_\-set\-\_\-tick} (struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer, unsigned tick)
\begin{DoxyCompactList}\small\item\em Set the number of ticks between two C\-L\-I\-N\-T timer interrupts. \end{DoxyCompactList}\item 
static void \hyperlink{clint-timer_8c_ac30a676af29cbb246c9108869470323c}{clint\-\_\-timer\-\_\-init} (struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer, unsigned address, unsigned tick)
\begin{DoxyCompactList}\small\item\em C\-L\-I\-N\-T timer initialization. \end{DoxyCompactList}\item 
static void \hyperlink{clint-timer_8c_a249a319ccbd6471ab60e1a40f1423321}{clint\-\_\-timer\-\_\-set\-\_\-event} (struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer, void($\ast$f)(void $\ast$arg), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Set the event that will triggered by a C\-L\-I\-N\-T interrupt. \end{DoxyCompactList}\item 
void \hyperlink{clint-timer_8c_ac4e214b8457c4aa41856f050aa3144e5}{clint\-\_\-timer\-\_\-isr} (unsigned irq, struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer)
\begin{DoxyCompactList}\small\item\em I\-S\-R of the C\-L\-I\-N\-T device. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structtimer__ops__s}{timer\-\_\-ops\-\_\-s} \hyperlink{clint-timer_8c_ac6de9c7f0557ed4f63e96d7b02123a00}{Clint\-Timer\-Ops}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{clint-timer_8c_ac30a676af29cbb246c9108869470323c}{\index{clint-\/timer.\-c@{clint-\/timer.\-c}!clint\-\_\-timer\-\_\-init@{clint\-\_\-timer\-\_\-init}}
\index{clint\-\_\-timer\-\_\-init@{clint\-\_\-timer\-\_\-init}!clint-timer.c@{clint-\/timer.\-c}}
\subsubsection[{clint\-\_\-timer\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}static void clint\-\_\-timer\-\_\-init (
\begin{DoxyParamCaption}
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer, }
\item[{unsigned}]{address, }
\item[{unsigned}]{tick}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{clint-timer_8c_ac30a676af29cbb246c9108869470323c}


C\-L\-I\-N\-T timer initialization. 


\begin{DoxyParams}{Parameters}
{\em timer} & timer device to initialize \\
\hline
{\em address} & address of the device \\
\hline
{\em tick} & number of ticks between two interrupts \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-s\-::address, clint\-\_\-timer\-\_\-set\-\_\-tick(), Clint\-Timer\-Ops, and timer\-\_\-s\-::ops.


\begin{DoxyCode}
37 \{
38     timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address}  = address;
39     timer->\hyperlink{structtimer__s_a859db5220e0605eabaa9100121940b5e}{ops}      = &\hyperlink{clint-timer_8c_ac6de9c7f0557ed4f63e96d7b02123a00}{ClintTimerOps};
40 
41     \hyperlink{clint-timer_8c_ab787b81c06c064352fdba1152ef5efcb}{clint\_timer\_set\_tick}(timer, tick); \textcolor{comment}{// next period}
42 \}
\end{DoxyCode}
\hypertarget{clint-timer_8c_ac4e214b8457c4aa41856f050aa3144e5}{\index{clint-\/timer.\-c@{clint-\/timer.\-c}!clint\-\_\-timer\-\_\-isr@{clint\-\_\-timer\-\_\-isr}}
\index{clint\-\_\-timer\-\_\-isr@{clint\-\_\-timer\-\_\-isr}!clint-timer.c@{clint-\/timer.\-c}}
\subsubsection[{clint\-\_\-timer\-\_\-isr}]{\setlength{\rightskip}{0pt plus 5cm}void clint\-\_\-timer\-\_\-isr (
\begin{DoxyParamCaption}
\item[{unsigned}]{irq, }
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer}
\end{DoxyParamCaption}
)}}\label{clint-timer_8c_ac4e214b8457c4aa41856f050aa3144e5}


I\-S\-R of the C\-L\-I\-N\-T device. 


\begin{DoxyParams}{Parameters}
{\em irq} & irq linked to the I\-S\-R \\
\hline
{\em timer} & device linked to the I\-S\-R \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-event\-\_\-s\-::arg, timer\-\_\-s\-::event, timer\-\_\-event\-\_\-s\-::f, timer\-\_\-s\-::ops, timer\-\_\-s\-::period, and timer\-\_\-ops\-\_\-s\-::timer\-\_\-set\-\_\-tick.



Referenced by isrcall().


\begin{DoxyCode}
64 \{
65     \textcolor{comment}{/* Reset timer */}
66     timer->\hyperlink{structtimer__s_a859db5220e0605eabaa9100121940b5e}{ops}->\hyperlink{structtimer__ops__s_a4c7be27a967a8aa56bfb785e80afb254}{timer\_set\_tick}(timer, timer->\hyperlink{structtimer__s_a9174e40ce5a0ea4f7072968f377d27b5}{period});
67 
68     \textcolor{comment}{/* If a function is available, trigger the event */}
69     \textcolor{keywordflow}{if} (timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a894a5ffd0c1b40b31fd3b124f22a9ffa}{f})
70         timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a894a5ffd0c1b40b31fd3b124f22a9ffa}{f}(timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a0c8f6673a1d1e2ae4a8598f72a8e7576}{arg});
71 \}
\end{DoxyCode}
\hypertarget{clint-timer_8c_a249a319ccbd6471ab60e1a40f1423321}{\index{clint-\/timer.\-c@{clint-\/timer.\-c}!clint\-\_\-timer\-\_\-set\-\_\-event@{clint\-\_\-timer\-\_\-set\-\_\-event}}
\index{clint\-\_\-timer\-\_\-set\-\_\-event@{clint\-\_\-timer\-\_\-set\-\_\-event}!clint-timer.c@{clint-\/timer.\-c}}
\subsubsection[{clint\-\_\-timer\-\_\-set\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}static void clint\-\_\-timer\-\_\-set\-\_\-event (
\begin{DoxyParamCaption}
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer, }
\item[{void($\ast$)(void $\ast$arg)}]{f, }
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{clint-timer_8c_a249a319ccbd6471ab60e1a40f1423321}


Set the event that will triggered by a C\-L\-I\-N\-T interrupt. 


\begin{DoxyParams}{Parameters}
{\em timer} & the timer device \\
\hline
{\em f} & the function corresponding to the event \\
\hline
{\em arg} & argument that will be passed to the function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-event\-\_\-s\-::arg, timer\-\_\-s\-::event, and timer\-\_\-event\-\_\-s\-::f.


\begin{DoxyCode}
52 \{
53     timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a894a5ffd0c1b40b31fd3b124f22a9ffa}{f} = f;
54     timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a0c8f6673a1d1e2ae4a8598f72a8e7576}{arg} = arg;
55 \}
\end{DoxyCode}
\hypertarget{clint-timer_8c_ab787b81c06c064352fdba1152ef5efcb}{\index{clint-\/timer.\-c@{clint-\/timer.\-c}!clint\-\_\-timer\-\_\-set\-\_\-tick@{clint\-\_\-timer\-\_\-set\-\_\-tick}}
\index{clint\-\_\-timer\-\_\-set\-\_\-tick@{clint\-\_\-timer\-\_\-set\-\_\-tick}!clint-timer.c@{clint-\/timer.\-c}}
\subsubsection[{clint\-\_\-timer\-\_\-set\-\_\-tick}]{\setlength{\rightskip}{0pt plus 5cm}static void clint\-\_\-timer\-\_\-set\-\_\-tick (
\begin{DoxyParamCaption}
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer, }
\item[{unsigned}]{tick}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{clint-timer_8c_ab787b81c06c064352fdba1152ef5efcb}


Set the number of ticks between two C\-L\-I\-N\-T timer interrupts. 


\begin{DoxyParams}{Parameters}
{\em timer} & timer device \\
\hline
{\em tick} & number of ticks \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-s\-::address, C\-L\-I\-N\-T\-\_\-\-M\-T\-I\-M\-E\-\_\-\-O\-F\-F\-S\-E\-T, C\-L\-I\-N\-T\-\_\-\-M\-T\-I\-M\-E\-C\-M\-P\-\_\-\-O\-F\-F\-S\-E\-T, and timer\-\_\-s\-::period.



Referenced by clint\-\_\-timer\-\_\-init().


\begin{DoxyCode}
22 \{
23     \textcolor{comment}{// We have to options: either set mtimecmp, or reset mtime}
24     *(\textcolor{keywordtype}{unsigned}*) (timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address} + \hyperlink{clint-timer_8h_a2cd657f152580d1130d82d11d7289537}{CLINT\_MTIMECMP\_OFFSET}) =
25         (*(\textcolor{keywordtype}{unsigned}*) (timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address} + \hyperlink{clint-timer_8h_a7f71328bbc38b520ced165900a5f1c1f}{CLINT\_MTIME\_OFFSET})) + tick;
26     timer->\hyperlink{structtimer__s_a9174e40ce5a0ea4f7072968f377d27b5}{period} = tick;
27 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{clint-timer_8c_ac6de9c7f0557ed4f63e96d7b02123a00}{\index{clint-\/timer.\-c@{clint-\/timer.\-c}!Clint\-Timer\-Ops@{Clint\-Timer\-Ops}}
\index{Clint\-Timer\-Ops@{Clint\-Timer\-Ops}!clint-timer.c@{clint-\/timer.\-c}}
\subsubsection[{Clint\-Timer\-Ops}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf timer\-\_\-ops\-\_\-s} Clint\-Timer\-Ops}}\label{clint-timer_8c_ac6de9c7f0557ed4f63e96d7b02123a00}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
    .timer\_init = \hyperlink{clint-timer_8c_ac30a676af29cbb246c9108869470323c}{clint\_timer\_init},
    .timer\_set\_event = \hyperlink{clint-timer_8c_a249a319ccbd6471ab60e1a40f1423321}{clint\_timer\_set\_event},
    .timer\_set\_tick = \hyperlink{clint-timer_8c_ab787b81c06c064352fdba1152ef5efcb}{clint\_timer\_set\_tick}
\}
\end{DoxyCode}


Referenced by clint\-\_\-timer\-\_\-init(), and soc\-\_\-timer\-\_\-init().

