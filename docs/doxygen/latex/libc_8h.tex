\hypertarget{libc_8h}{\section{/users/enseig/franck/ko6/src/soft/ulib/libc.h File Reference}
\label{libc_8h}\index{/users/enseig/franck/ko6/src/soft/ulib/libc.\-h@{/users/enseig/franck/ko6/src/soft/ulib/libc.\-h}}
}
{\ttfamily \#include $<$debug\-\_\-off.\-h$>$}\\*
{\ttfamily \#include $<$stdarg.\-h$>$}\\*
{\ttfamily \#include $<$stddef.\-h$>$}\\*
{\ttfamily \#include $<$cstd.\-h$>$}\\*
{\ttfamily \#include $<$list.\-h$>$}\\*
{\ttfamily \#include $<$syscalls.\-h$>$}\\*
{\ttfamily \#include $<$memory.\-h$>$}\\*
{\ttfamily \#include $<$usermem.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$esc\-\_\-code.\-h$>$}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{libc_8h_a42f8c497a1968074f38bf5055c650dca}{V\-E\-R\-B\-O\-S\-E}~0
\item 
\#define \hyperlink{libc_8h_a690f251553b39fd4f31894826141b61a}{R\-A\-N\-D\-\_\-\-M\-A\-X}~32767  /$\ast$ maximum random value by default, must be $<$ 0x7\-F\-F\-F\-F\-F\-F\-E $\ast$/
\item 
\#define \hyperlink{libc_8h_a75e4f21c7f6c3c00a8595ef83fdc1569}{P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X}~256  /$\ast$ largest printed message $\ast$/
\item 
\#define \hyperlink{libc_8h_afa6921cfca101af04b9dcc8d29bc7b16}{C\-E\-I\-L}(a, b)~((int)(b)$\ast$(((int)(a)+(int)(b)-\/1)/(int)(b))) /$\ast$ round up a aligned on b $\ast$/
\item 
\#define \hyperlink{libc_8h_af76aa89c75eec80890c7a792f1fadda7}{F\-L\-O\-O\-R}(a, b)~((int)(b)$\ast$((int)(a)/(int)(b)))              /$\ast$ round down a aligned on b $\ast$/
\item 
\#define \hyperlink{libc_8h_a70928ac722fa556b729a98eab5d3e06f}{E\-X\-I\-T}(n)~$\ast$(char$\ast$)(0x\-F\-F\-F\-F0000+0x\#\#n$\ast$16)=0 /$\ast$ cause a panic with B\-A\-R = 0x\-F\-F\-F\-F-\/n-\/0 $\ast$/
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{libc_8h_a01a54ddbbc6ab18e4853ba0427329aca}{perror} (char $\ast$s)
\begin{DoxyCompactList}\small\item\em finds the error message corresponding to the current value of the global variable errno and writes it, followed by a newline (errno is thread safe) \end{DoxyCompactList}\item 
void \hyperlink{libc_8h_a55e99c539cf7723ec15e856b7e0a8cee}{exit} (int status)
\begin{DoxyCompactList}\small\item\em exit the application, thus never returns \end{DoxyCompactList}\item 
void \hyperlink{libc_8h_a3643d04c418455ae56f321c6d12f8da8}{delay} (unsigned nbcycles)
\begin{DoxyCompactList}\small\item\em stop until a delay mesured in cycles \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_aec19a0626d6167a834fa9f5b25214f7f}{read} (int fd, void $\ast$buf, int count)
\begin{DoxyCompactList}\small\item\em reads in at most count characters from fd and stores them into buf. \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write} (int fd, void $\ast$buf, int count)
\begin{DoxyCompactList}\small\item\em write in at most count characters from buf to fd. \end{DoxyCompactList}\item 
unsigned \hyperlink{libc_8h_a6f8d66e44afa86c6e39901b0dbbf709e}{clock} (void)
\begin{DoxyCompactList}\small\item\em clock cycle counter \end{DoxyCompactList}\item 
size\-\_\-t \hyperlink{libc_8h_a7737fc4bdea8d6ab04f67ef74c3f1b9d}{cachelinesize} (void)
\begin{DoxyCompactList}\small\item\em ask the processor what is the L1-\/cache line size \end{DoxyCompactList}\item 
void \hyperlink{libc_8h_acc1ac6ae43f562b1a98eb7c441d41cdd}{dcache\-\_\-buf\-\_\-inval} (void $\ast$buf, size\-\_\-t size)
\begin{DoxyCompactList}\small\item\em invalidate all lines from data L1 cache belonging to buffer buf \end{DoxyCompactList}\item 
void \hyperlink{libc_8h_a8ae9e105498cc9733eb44c8a99bf4d20}{dcache\-\_\-inval} (void $\ast$addr)
\begin{DoxyCompactList}\small\item\em invalidate the line from data L1 cache where the addr is located \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_ae23144bcbb8e3742b00eb687c36654d1}{rand} (void)
\begin{DoxyCompactList}\small\item\em random int generator \end{DoxyCompactList}\item 
void \hyperlink{libc_8h_a210f1bb7dc29a87394a25027e4231004}{srand} (unsigned seed)
\begin{DoxyCompactList}\small\item\em allow to define a specific random suite \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_aacbddfdb9f59c18324dd896a86c429fd}{fputc} (int tty, int c)
\begin{DoxyCompactList}\small\item\em write un single char on tty \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_aec7371e70ca6c02f9f85073dddb4d0c3}{fgetc} (int tty)
\begin{DoxyCompactList}\small\item\em reads the next character from tty and returns it cast to an int \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_abe9722f092069e1f5b86dc89b770c44d}{fgets} (char $\ast$s, int size, int tty)
\begin{DoxyCompactList}\small\item\em reads in at most size-\/1 characters from tty and stores them into the buffer s. Reading stops after a newline. If a newline is read, it is stored into the buffer. A terminating null byte (0) is stored after the last character in the buffer. \end{DoxyCompactList}\item 
int \hyperlink{libc_8h_a4e7edf0e8df09b47566d572e19dad429}{fprintf} (int tty, char $\ast$fmt,...)
\begin{DoxyCompactList}\small\item\em this a simplified version which handles only\-: c, s, \$d, x and p \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{libc_8h_afa6921cfca101af04b9dcc8d29bc7b16}{\index{libc.\-h@{libc.\-h}!C\-E\-I\-L@{C\-E\-I\-L}}
\index{C\-E\-I\-L@{C\-E\-I\-L}!libc.h@{libc.\-h}}
\subsubsection[{C\-E\-I\-L}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\-E\-I\-L(
\begin{DoxyParamCaption}
\item[{}]{a, }
\item[{}]{b}
\end{DoxyParamCaption}
)~((int)(b)$\ast$(((int)(a)+(int)(b)-\/1)/(int)(b))) /$\ast$ round up a aligned on b $\ast$/}}\label{libc_8h_afa6921cfca101af04b9dcc8d29bc7b16}
\hypertarget{libc_8h_a70928ac722fa556b729a98eab5d3e06f}{\index{libc.\-h@{libc.\-h}!E\-X\-I\-T@{E\-X\-I\-T}}
\index{E\-X\-I\-T@{E\-X\-I\-T}!libc.h@{libc.\-h}}
\subsubsection[{E\-X\-I\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define E\-X\-I\-T(
\begin{DoxyParamCaption}
\item[{}]{n}
\end{DoxyParamCaption}
)~$\ast$(char$\ast$)(0x\-F\-F\-F\-F0000+0x\#\#n$\ast$16)=0 /$\ast$ cause a panic with B\-A\-R = 0x\-F\-F\-F\-F-\/n-\/0 $\ast$/}}\label{libc_8h_a70928ac722fa556b729a98eab5d3e06f}
\hypertarget{libc_8h_af76aa89c75eec80890c7a792f1fadda7}{\index{libc.\-h@{libc.\-h}!F\-L\-O\-O\-R@{F\-L\-O\-O\-R}}
\index{F\-L\-O\-O\-R@{F\-L\-O\-O\-R}!libc.h@{libc.\-h}}
\subsubsection[{F\-L\-O\-O\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-L\-O\-O\-R(
\begin{DoxyParamCaption}
\item[{}]{a, }
\item[{}]{b}
\end{DoxyParamCaption}
)~((int)(b)$\ast$((int)(a)/(int)(b)))              /$\ast$ round down a aligned on b $\ast$/}}\label{libc_8h_af76aa89c75eec80890c7a792f1fadda7}
\hypertarget{libc_8h_a75e4f21c7f6c3c00a8595ef83fdc1569}{\index{libc.\-h@{libc.\-h}!P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X@{P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X}}
\index{P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X@{P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X}!libc.h@{libc.\-h}}
\subsubsection[{P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X~256  /$\ast$ largest printed message $\ast$/}}\label{libc_8h_a75e4f21c7f6c3c00a8595ef83fdc1569}
\hypertarget{libc_8h_a690f251553b39fd4f31894826141b61a}{\index{libc.\-h@{libc.\-h}!R\-A\-N\-D\-\_\-\-M\-A\-X@{R\-A\-N\-D\-\_\-\-M\-A\-X}}
\index{R\-A\-N\-D\-\_\-\-M\-A\-X@{R\-A\-N\-D\-\_\-\-M\-A\-X}!libc.h@{libc.\-h}}
\subsubsection[{R\-A\-N\-D\-\_\-\-M\-A\-X}]{\setlength{\rightskip}{0pt plus 5cm}\#define R\-A\-N\-D\-\_\-\-M\-A\-X~32767  /$\ast$ maximum random value by default, must be $<$ 0x7\-F\-F\-F\-F\-F\-F\-E $\ast$/}}\label{libc_8h_a690f251553b39fd4f31894826141b61a}
\hypertarget{libc_8h_a42f8c497a1968074f38bf5055c650dca}{\index{libc.\-h@{libc.\-h}!V\-E\-R\-B\-O\-S\-E@{V\-E\-R\-B\-O\-S\-E}}
\index{V\-E\-R\-B\-O\-S\-E@{V\-E\-R\-B\-O\-S\-E}!libc.h@{libc.\-h}}
\subsubsection[{V\-E\-R\-B\-O\-S\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\-E\-R\-B\-O\-S\-E~0}}\label{libc_8h_a42f8c497a1968074f38bf5055c650dca}


\subsection{Function Documentation}
\hypertarget{libc_8h_a7737fc4bdea8d6ab04f67ef74c3f1b9d}{\index{libc.\-h@{libc.\-h}!cachelinesize@{cachelinesize}}
\index{cachelinesize@{cachelinesize}!libc.h@{libc.\-h}}
\subsubsection[{cachelinesize}]{\setlength{\rightskip}{0pt plus 5cm}size\-\_\-t cachelinesize (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{libc_8h_a7737fc4bdea8d6ab04f67ef74c3f1b9d}


ask the processor what is the L1-\/cache line size 

\begin{DoxyReturn}{Returns}
the cache line size in bytes
\end{DoxyReturn}
ask the processor what is the L1-\/cache line size

\begin{DoxyReturn}{Returns}
the size 
\end{DoxyReturn}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-C\-A\-C\-H\-E\-L\-I\-N\-E\-S\-I\-Z\-E, and syscall\-\_\-fct.


\begin{DoxyCode}
63 \{
64     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} (0, 0, 0, 0, \hyperlink{syscalls_8h_aa01c11788b75eea69fa87959f6fac5b4}{SYSCALL\_CACHELINESIZE});
65 \}
\end{DoxyCode}
\hypertarget{libc_8h_a6f8d66e44afa86c6e39901b0dbbf709e}{\index{libc.\-h@{libc.\-h}!clock@{clock}}
\index{clock@{clock}!libc.h@{libc.\-h}}
\subsubsection[{clock}]{\setlength{\rightskip}{0pt plus 5cm}unsigned clock (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{libc_8h_a6f8d66e44afa86c6e39901b0dbbf709e}


clock cycle counter 

\begin{DoxyReturn}{Returns}
the number of cycles from the reset 
\end{DoxyReturn}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-C\-L\-O\-C\-K, and syscall\-\_\-fct.


\begin{DoxyCode}
48 \{
49     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} (0, 0, 0, 0, \hyperlink{syscalls_8h_a1b284030b6f72253c3e7546fd551020f}{SYSCALL\_CLOCK});
50 \}
\end{DoxyCode}
\hypertarget{libc_8h_acc1ac6ae43f562b1a98eb7c441d41cdd}{\index{libc.\-h@{libc.\-h}!dcache\-\_\-buf\-\_\-inval@{dcache\-\_\-buf\-\_\-inval}}
\index{dcache\-\_\-buf\-\_\-inval@{dcache\-\_\-buf\-\_\-inval}!libc.h@{libc.\-h}}
\subsubsection[{dcache\-\_\-buf\-\_\-inval}]{\setlength{\rightskip}{0pt plus 5cm}void dcache\-\_\-buf\-\_\-inval (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{buf, }
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)}}\label{libc_8h_acc1ac6ae43f562b1a98eb7c441d41cdd}


invalidate all lines from data L1 cache belonging to buffer buf 


\begin{DoxyParams}{Parameters}
{\em buf} & user buffer address \\
\hline
{\em size} & buffer size in bytes \\
\hline
\end{DoxyParams}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-D\-C\-A\-C\-H\-E\-B\-U\-F\-I\-N\-V\-A\-L, and syscall\-\_\-fct.


\begin{DoxyCode}
53 \{
54     \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} (0, 0, 0, 0, \hyperlink{syscalls_8h_a1fa616eba469314a5889d45524348a52}{SYSCALL\_DCACHEBUFINVAL});
55 \}
\end{DoxyCode}
\hypertarget{libc_8h_a8ae9e105498cc9733eb44c8a99bf4d20}{\index{libc.\-h@{libc.\-h}!dcache\-\_\-inval@{dcache\-\_\-inval}}
\index{dcache\-\_\-inval@{dcache\-\_\-inval}!libc.h@{libc.\-h}}
\subsubsection[{dcache\-\_\-inval}]{\setlength{\rightskip}{0pt plus 5cm}void dcache\-\_\-inval (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{addr}
\end{DoxyParamCaption}
)}}\label{libc_8h_a8ae9e105498cc9733eb44c8a99bf4d20}


invalidate the line from data L1 cache where the addr is located 


\begin{DoxyParams}{Parameters}
{\em addr} & address into the line to invalidate \\
\hline
\end{DoxyParams}


References S\-Y\-S\-C\-A\-L\-L\-\_\-\-D\-C\-A\-C\-H\-E\-I\-N\-V\-A\-L, and syscall\-\_\-fct.


\begin{DoxyCode}
58 \{
59     \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct} (0, 0, 0, 0, \hyperlink{syscalls_8h_a28679dcec3d60a8716d3e2ce024dcacd}{SYSCALL\_DCACHEINVAL});
60 \}
\end{DoxyCode}
\hypertarget{libc_8h_a3643d04c418455ae56f321c6d12f8da8}{\index{libc.\-h@{libc.\-h}!delay@{delay}}
\index{delay@{delay}!libc.h@{libc.\-h}}
\subsubsection[{delay}]{\setlength{\rightskip}{0pt plus 5cm}void delay (
\begin{DoxyParamCaption}
\item[{unsigned}]{nbcycles}
\end{DoxyParamCaption}
)}}\label{libc_8h_a3643d04c418455ae56f321c6d12f8da8}


stop until a delay mesured in cycles 


\begin{DoxyParams}{Parameters}
{\em nbcycles} & number of cycle to wait \\
\hline
\end{DoxyParams}


References clock.



Referenced by soclib\-\_\-dma\-\_\-memcpy(), and soclib\-\_\-tty\-\_\-write().


\begin{DoxyCode}
29 \{
30     \textcolor{keywordtype}{unsigned} old\_time, expected\_time;
31 
32     old\_time = \hyperlink{mips_2cpuregs_8S_af7e0f9f0eada9d28b46b4d1f7ae5b702}{clock} ();                        \textcolor{comment}{// get the number od cycles at first}
33     expected\_time = old\_time + nbcycles;        \textcolor{comment}{// compute the number of cycles to reach}
34     \textcolor{keywordflow}{while} (\hyperlink{mips_2cpuregs_8S_af7e0f9f0eada9d28b46b4d1f7ae5b702}{clock} () < expected\_time);           \textcolor{comment}{// wait for expected time}
35 \}
\end{DoxyCode}
\hypertarget{libc_8h_a55e99c539cf7723ec15e856b7e0a8cee}{\index{libc.\-h@{libc.\-h}!exit@{exit}}
\index{exit@{exit}!libc.h@{libc.\-h}}
\subsubsection[{exit}]{\setlength{\rightskip}{0pt plus 5cm}void exit (
\begin{DoxyParamCaption}
\item[{int}]{status}
\end{DoxyParamCaption}
)}}\label{libc_8h_a55e99c539cf7723ec15e856b7e0a8cee}


exit the application, thus never returns 


\begin{DoxyParams}{Parameters}
{\em status} & return value of the application \\
\hline
\end{DoxyParams}


References P\-A\-N\-I\-C\-\_\-\-I\-F, S\-Y\-S\-C\-A\-L\-L\-\_\-\-E\-X\-I\-T, and syscall\-\_\-fct.



Referenced by \-\_\-start(), free(), main(), malloc\-\_\-init(), sched\-\_\-insert(), and usage().


\begin{DoxyCode}
49 \{
50     \hyperlink{debug__on_8h_a9dea4233af3c516959b7255fbea5c79b}{PANIC\_IF}(\textcolor{keyword}{true},\textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)nEXIT status = %d\(\backslash\)n"}, status); 
51 \}
\end{DoxyCode}
\hypertarget{libc_8h_aec7371e70ca6c02f9f85073dddb4d0c3}{\index{libc.\-h@{libc.\-h}!fgetc@{fgetc}}
\index{fgetc@{fgetc}!libc.h@{libc.\-h}}
\subsubsection[{fgetc}]{\setlength{\rightskip}{0pt plus 5cm}int fgetc (
\begin{DoxyParamCaption}
\item[{int}]{tty}
\end{DoxyParamCaption}
)}}\label{libc_8h_aec7371e70ca6c02f9f85073dddb4d0c3}


reads the next character from tty and returns it cast to an int 


\begin{DoxyParams}{Parameters}
{\em tty} & tty number (between 0 and T\-T\-Y\-\_\-\-M\-A\-X-\/1) \\
\hline
\end{DoxyParams}


References read(), and write().


\begin{DoxyCode}
91 \{
92     \textcolor{keywordtype}{char} buf[1];                                \textcolor{comment}{// create a buffer for the read char}
93     \textcolor{keywordtype}{int} res = \hyperlink{libc_8c_aec19a0626d6167a834fa9f5b25214f7f}{read} (tty, buf, 1);               \textcolor{comment}{// ask for one char from TTY}
94     \textcolor{keywordflow}{if} (res != 1) \textcolor{keywordflow}{return} 0;                     \textcolor{comment}{// if no char read, should return EOF}
95     res = \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write} (tty, buf, 1);                  \textcolor{comment}{// send it back to the TTY}
96     \textcolor{keywordflow}{if} (res != 1) \textcolor{keywordflow}{return} 0;                     \textcolor{comment}{// if no char written, should return EOF}
97     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{int}) buf[0];                        \textcolor{comment}{// return char read}
98 \}
\end{DoxyCode}
\hypertarget{libc_8h_abe9722f092069e1f5b86dc89b770c44d}{\index{libc.\-h@{libc.\-h}!fgets@{fgets}}
\index{fgets@{fgets}!libc.h@{libc.\-h}}
\subsubsection[{fgets}]{\setlength{\rightskip}{0pt plus 5cm}int fgets (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{s, }
\item[{int}]{size, }
\item[{int}]{tty}
\end{DoxyParamCaption}
)}}\label{libc_8h_abe9722f092069e1f5b86dc89b770c44d}


reads in at most size-\/1 characters from tty and stores them into the buffer s. Reading stops after a newline. If a newline is read, it is stored into the buffer. A terminating null byte (0) is stored after the last character in the buffer. 


\begin{DoxyParams}{Parameters}
{\em s} & pointer to the buffer where the characters read will be written \\
\hline
{\em size} & number of places in bytes in the buffer s. \\
\hline
{\em tty} & tty number (between 0 and T\-T\-Y\-\_\-\-M\-A\-X-\/1) should be a F\-I\-L\-E $\ast$ \\
\hline
\end{DoxyParams}


References read(), and write().



Referenced by main().


\begin{DoxyCode}
101 \{
102     \textcolor{comment}{// to make the backspace, we use ANSI codes : https://www.wikiwand.com/en/ANSI\_escape\_code}
103     \textcolor{keywordtype}{char} *DEL = \textcolor{stringliteral}{"\(\backslash\)033[D \(\backslash\)033[D"};                \textcolor{comment}{// move left, then write ' ' and move left}
104     \textcolor{keywordtype}{int} res = 0;
105     count--;                                    \textcolor{comment}{// we need to add a NUL (0) char at the end}
106     \textcolor{keywordtype}{char} c=0;
107 
108     \textcolor{keywordflow}{while} ((count != 0) && (c != \textcolor{charliteral}{'\(\backslash\)n'})) \{       \textcolor{comment}{// as long as we can or need to get a char}
109 
110         \hyperlink{libc_8c_aec19a0626d6167a834fa9f5b25214f7f}{read} (tty, &c, 1);                      \textcolor{comment}{// read only 1 char}
111         \textcolor{keywordflow}{if} (c == \textcolor{charliteral}{'\(\backslash\)n'})                          \textcolor{comment}{// if c is the line feed (10)}
112             \hyperlink{libc_8c_aec19a0626d6167a834fa9f5b25214f7f}{read} (tty, &c, 1);                  \textcolor{comment}{// drop it and read the next one}
113         \textcolor{keywordflow}{if} (c == \textcolor{charliteral}{'\(\backslash\)r'})                          \textcolor{comment}{// if c is the carriage return (13)}
114                 c = \textcolor{charliteral}{'\(\backslash\)n'};                       \textcolor{comment}{// change it for '\(\backslash\)n', that is what fgets waits for}
115 
116         \textcolor{keywordflow}{if} ((c == 8)||(c == 127)) \{             \textcolor{comment}{// 8 = backspace, 127 = delete}
117             \textcolor{keywordflow}{if} (res) \{                          \textcolor{comment}{// go back in the buffer if possible}
118                 \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write} (tty, DEL, 7);            \textcolor{comment}{// erase current char}
119                 count++;                        \textcolor{comment}{// count is the remaining place}
120                 buf--;                          \textcolor{comment}{// but is the next address in buffer}
121                 res--;
122             \}
123             \textcolor{keywordflow}{continue};                           \textcolor{comment}{// ask for another key}
124         \} \textcolor{keywordflow}{else} \{
125             \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write} (tty, &c, 1);                 \textcolor{comment}{// loop back to the tty}
126         \}
127         *buf = c;                               \textcolor{comment}{// write the char into the buffer}
128         buf++;                                  \textcolor{comment}{// increments the writing pointer}
129         count--;                                \textcolor{comment}{// decrements the remaining space}
130         res++;                                  \textcolor{comment}{// increments the read char}
131     \}
132     *buf = 0;                                   \textcolor{comment}{// add a last 0 to end the string}
133 
134     \textcolor{keywordflow}{return} res;                                 \textcolor{comment}{// returns the number of char read}
135 \}
\end{DoxyCode}
\hypertarget{libc_8h_a4e7edf0e8df09b47566d572e19dad429}{\index{libc.\-h@{libc.\-h}!fprintf@{fprintf}}
\index{fprintf@{fprintf}!libc.h@{libc.\-h}}
\subsubsection[{fprintf}]{\setlength{\rightskip}{0pt plus 5cm}int fprintf (
\begin{DoxyParamCaption}
\item[{int}]{tty, }
\item[{char $\ast$}]{fmt, }
\item[{}]{...}
\end{DoxyParamCaption}
)}}\label{libc_8h_a4e7edf0e8df09b47566d572e19dad429}


this a simplified version which handles only\-: c, s, \$d, x and p 


\begin{DoxyParams}{Parameters}
{\em tty} & tty number (between 0 and T\-T\-Y\-\_\-\-M\-A\-X-\/1) \\
\hline
{\em fmt} & formated string \\
\hline
{\em ...} & variadic arguments, i.\-e. variable number of arguments \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
number of printed char 
\end{DoxyReturn}


References buffer, P\-R\-I\-N\-T\-F\-\_\-\-M\-A\-X, vsnprintf(), and write().



Referenced by main(), malloc\-\_\-print(), perror(), and t0\-\_\-fun().


\begin{DoxyCode}
138 \{
139     \textcolor{keyword}{static} \textcolor{keywordtype}{char} \hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer}[\hyperlink{klibc_8h_a75e4f21c7f6c3c00a8595ef83fdc1569}{PRINTF\_MAX}];
140     \textcolor{keywordtype}{int} res;
141     va\_list ap;
142     va\_start (ap, fmt);
143     res = \hyperlink{cstd_8c_ab56fe2f857808faedb93ce52c7010181}{vsnprintf}(buffer, \textcolor{keyword}{sizeof}(buffer), fmt, ap);
144     res = \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write}( tty, buffer, res);
145     va\_end(ap);
146     \textcolor{keywordflow}{return} res;
147 \}
\end{DoxyCode}
\hypertarget{libc_8h_aacbddfdb9f59c18324dd896a86c429fd}{\index{libc.\-h@{libc.\-h}!fputc@{fputc}}
\index{fputc@{fputc}!libc.h@{libc.\-h}}
\subsubsection[{fputc}]{\setlength{\rightskip}{0pt plus 5cm}int fputc (
\begin{DoxyParamCaption}
\item[{int}]{tty, }
\item[{int}]{c}
\end{DoxyParamCaption}
)}}\label{libc_8h_aacbddfdb9f59c18324dd896a86c429fd}


write un single char on tty 


\begin{DoxyParams}{Parameters}
{\em tty} & tty number (between 0 and T\-T\-Y\-\_\-\-M\-A\-X-\/1) \\
\hline
{\em c} & char to print \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the written char 
\end{DoxyReturn}


References write().


\begin{DoxyCode}
85 \{
86     \hyperlink{libc_8c_a18e0c7fef99a23c9dcf7269da9e6bfc7}{write} (tty, &c, 1);                         \textcolor{comment}{// the char is in the least significant byte}
87     \textcolor{keywordflow}{return} c;
88 \}
\end{DoxyCode}
\hypertarget{libc_8h_a01a54ddbbc6ab18e4853ba0427329aca}{\index{libc.\-h@{libc.\-h}!perror@{perror}}
\index{perror@{perror}!libc.h@{libc.\-h}}
\subsubsection[{perror}]{\setlength{\rightskip}{0pt plus 5cm}void perror (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{s}
\end{DoxyParamCaption}
)}}\label{libc_8h_a01a54ddbbc6ab18e4853ba0427329aca}


finds the error message corresponding to the current value of the global variable errno and writes it, followed by a newline (errno is thread safe) 


\begin{DoxyParams}{Parameters}
{\em s} & is a string written if not N\-U\-L\-L and not empty just before the system error \\
\hline
\end{DoxyParams}


References errno, errno\-\_\-mess, and fprintf().


\begin{DoxyCode}
16 \{
17     \textcolor{keywordflow}{if} (s && *s)
18         \hyperlink{libc_8c_a4e7edf0e8df09b47566d572e19dad429}{fprintf} (0, \textcolor{stringliteral}{"%s: %s\(\backslash\)n"}, s, \hyperlink{errno_8c_a752b191220a1b00e3d70f9359a660f0f}{errno\_mess}[\hyperlink{usermem_8h_ab03f640d90fbc5bcb75285d08a0f25ed}{errno} + 1]); \textcolor{comment}{// first number of errno
       is -1}
19     \textcolor{keywordflow}{else}
20         \hyperlink{libc_8c_a4e7edf0e8df09b47566d572e19dad429}{fprintf} (0, \textcolor{stringliteral}{"%s\(\backslash\)n"}, \hyperlink{errno_8c_a752b191220a1b00e3d70f9359a660f0f}{errno\_mess}[\hyperlink{usermem_8h_ab03f640d90fbc5bcb75285d08a0f25ed}{errno} + 1]);
21 \}
\end{DoxyCode}
\hypertarget{libc_8h_ae23144bcbb8e3742b00eb687c36654d1}{\index{libc.\-h@{libc.\-h}!rand@{rand}}
\index{rand@{rand}!libc.h@{libc.\-h}}
\subsubsection[{rand}]{\setlength{\rightskip}{0pt plus 5cm}int rand (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{libc_8h_ae23144bcbb8e3742b00eb687c36654d1}


random int generator 

\begin{DoxyReturn}{Returns}
a random int between 0 and R\-A\-N\-D\-\_\-\-M\-A\-X
\end{DoxyReturn}
\href{https://en.wikipedia.org/wiki/Linear_congruential_generator}{\tt https\-://en.\-wikipedia.\-org/wiki/\-Linear\-\_\-congruential\-\_\-generator} (glibc generator)

random int generator

\begin{DoxyReturn}{Returns}
a random int between 0 and R\-A\-N\-D\-\_\-\-M\-A\-X 
\end{DoxyReturn}


References R\-A\-N\-D\-\_\-\-M\-A\-X, randnext, and randseed.



Referenced by kmalloc\-\_\-test(), t0\-\_\-fun(), and test\-\_\-ustack().


\begin{DoxyCode}
18 \{
19     \hyperlink{klibc_8c_a61a6808df75b050d8f8966eb68c10f2a}{randseed} = \hyperlink{klibc_8c_a61a6808df75b050d8f8966eb68c10f2a}{randseed} * 1664525 + 1013904223; \textcolor{comment}{// Numerical Recipes}
20     \textcolor{keywordflow}{return} (\hyperlink{klibc_8c_a61a6808df75b050d8f8966eb68c10f2a}{randseed}>>1);
21 \}
\end{DoxyCode}
\hypertarget{libc_8h_aec19a0626d6167a834fa9f5b25214f7f}{\index{libc.\-h@{libc.\-h}!read@{read}}
\index{read@{read}!libc.h@{libc.\-h}}
\subsubsection[{read}]{\setlength{\rightskip}{0pt plus 5cm}int read (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{void $\ast$}]{buf, }
\item[{int}]{count}
\end{DoxyParamCaption}
)}}\label{libc_8h_aec19a0626d6167a834fa9f5b25214f7f}


reads in at most count characters from fd and stores them into buf. 


\begin{DoxyParams}{Parameters}
{\em fd} & normally it is the file descriptor, but now it is just the tty number \\
\hline
{\em buf} & pointer to the buffer \\
\hline
{\em count} & number of bytes to read, must be lower than buf size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
on success, the number of char read, else -\/1 
\end{DoxyReturn}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-R\-E\-A\-D.



Referenced by add\-\_\-new\-\_\-file(), fgetc(), and fgets().


\begin{DoxyCode}
38 \{
39     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct}( fd, (\textcolor{keywordtype}{int})buf, count, 0, \hyperlink{syscalls_8h_ae5be81f63639b2e6928bce18ccda6acc}{SYSCALL\_READ});
40 \}
\end{DoxyCode}
\hypertarget{libc_8h_a210f1bb7dc29a87394a25027e4231004}{\index{libc.\-h@{libc.\-h}!srand@{srand}}
\index{srand@{srand}!libc.h@{libc.\-h}}
\subsubsection[{srand}]{\setlength{\rightskip}{0pt plus 5cm}void srand (
\begin{DoxyParamCaption}
\item[{unsigned}]{seed}
\end{DoxyParamCaption}
)}}\label{libc_8h_a210f1bb7dc29a87394a25027e4231004}


allow to define a specific random suite 


\begin{DoxyParams}{Parameters}
{\em seed} & any integer \\
\hline
\end{DoxyParams}


References randnext, and randseed.


\begin{DoxyCode}
24 \{
25     \hyperlink{klibc_8c_a61a6808df75b050d8f8966eb68c10f2a}{randseed} = seed;
26 \}
\end{DoxyCode}
\hypertarget{libc_8h_a18e0c7fef99a23c9dcf7269da9e6bfc7}{\index{libc.\-h@{libc.\-h}!write@{write}}
\index{write@{write}!libc.h@{libc.\-h}}
\subsubsection[{write}]{\setlength{\rightskip}{0pt plus 5cm}int write (
\begin{DoxyParamCaption}
\item[{int}]{fd, }
\item[{void $\ast$}]{buf, }
\item[{int}]{count}
\end{DoxyParamCaption}
)}}\label{libc_8h_a18e0c7fef99a23c9dcf7269da9e6bfc7}


write in at most count characters from buf to fd. 


\begin{DoxyParams}{Parameters}
{\em fd} & normally it is the file descriptor, but now it is just the tty number \\
\hline
{\em buf} & pointer to the buffer \\
\hline
{\em count} & number of bytes to write, must be lower than buf size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
on success, the number of written char, else -\/1 
\end{DoxyReturn}


References syscall\-\_\-fct, and S\-Y\-S\-C\-A\-L\-L\-\_\-\-W\-R\-I\-T\-E.



Referenced by fgetc(), fgets(), fprintf(), fputc(), kfs\-\_\-print\-\_\-files(), and split().


\begin{DoxyCode}
43 \{
44     \textcolor{keywordflow}{return} \hyperlink{mips_2cpu__user_8S_a2824a7b580dd3afd46068b42af360fa6}{syscall\_fct}( fd, (\textcolor{keywordtype}{int})buf, count, 0, \hyperlink{syscalls_8h_a7bf5d5477f99d0648e55674643559070}{SYSCALL\_WRITE});
45 \}
\end{DoxyCode}
