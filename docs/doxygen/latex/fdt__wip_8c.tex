\hypertarget{fdt__wip_8c}{\section{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-wip.c File Reference}
\label{fdt__wip_8c}\index{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-wip.\-c@{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-wip.\-c}}
}
{\ttfamily \#include \char`\"{}libfdt\-\_\-env.\-h\char`\"{}}\\*
{\ttfamily \#include $<$external/libfdt/fdt.\-h$>$}\\*
{\ttfamily \#include $<$external/libfdt/libfdt.\-h$>$}\\*
{\ttfamily \#include \char`\"{}libfdt\-\_\-internal.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{fdt__wip_8c_ad2d3b0ed8c78b7ca920550656dca6cf9}{fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial} (void $\ast$fdt, int nodeoffset, const char $\ast$name, int namelen, \hyperlink{libfdt__env_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} idx, const void $\ast$val, int len)
\item 
int \hyperlink{fdt__wip_8c_a6943ff251ae8c4ffea474788215965a1}{fdt\-\_\-setprop\-\_\-inplace} (void $\ast$fdt, int nodeoffset, const char $\ast$name, const void $\ast$val, int len)
\item 
static void \hyperlink{fdt__wip_8c_a2553eaad74cf73ff56d5f6bf5da1b04b}{fdt\-\_\-nop\-\_\-region\-\_\-} (void $\ast$start, int len)
\item 
int \hyperlink{fdt__wip_8c_acf3ba20475e7b94a8d31eac14ea7228d}{fdt\-\_\-nop\-\_\-property} (void $\ast$fdt, int nodeoffset, const char $\ast$name)
\item 
int \hyperlink{fdt__wip_8c_a45210c5c83d2fc1bed7cb7161e471fad}{fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-} (void $\ast$fdt, int offset)
\item 
int \hyperlink{fdt__wip_8c_ac1b08e2054997c7e9814fc0b04acb305}{fdt\-\_\-nop\-\_\-node} (void $\ast$fdt, int nodeoffset)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{fdt__wip_8c_a45210c5c83d2fc1bed7cb7161e471fad}{\index{fdt\-\_\-wip.\-c@{fdt\-\_\-wip.\-c}!fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-@{fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-}}
\index{fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-@{fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-}!fdt_wip.c@{fdt\-\_\-wip.\-c}}
\subsubsection[{fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{offset}
\end{DoxyParamCaption}
)}}\label{fdt__wip_8c_a45210c5c83d2fc1bed7cb7161e471fad}


References fdt\-\_\-next\-\_\-node().



Referenced by fdt\-\_\-del\-\_\-node(), and fdt\-\_\-nop\-\_\-node().


\begin{DoxyCode}
74 \{
75     \textcolor{keywordtype}{int} depth = 0;
76 
77     \textcolor{keywordflow}{while} ((offset >= 0) && (depth >= 0))
78         offset = \hyperlink{fdt_8c_a6603ac8041afcc7fde5c0b25de765103}{fdt\_next\_node}(fdt, offset, &depth);
79 
80     \textcolor{keywordflow}{return} offset;
81 \}
\end{DoxyCode}
\hypertarget{fdt__wip_8c_ac1b08e2054997c7e9814fc0b04acb305}{\index{fdt\-\_\-wip.\-c@{fdt\-\_\-wip.\-c}!fdt\-\_\-nop\-\_\-node@{fdt\-\_\-nop\-\_\-node}}
\index{fdt\-\_\-nop\-\_\-node@{fdt\-\_\-nop\-\_\-node}!fdt_wip.c@{fdt\-\_\-wip.\-c}}
\subsubsection[{fdt\-\_\-nop\-\_\-node}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-nop\-\_\-node (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset}
\end{DoxyParamCaption}
)}}\label{fdt__wip_8c_ac1b08e2054997c7e9814fc0b04acb305}
fdt\-\_\-nop\-\_\-node -\/ replace a node (subtree) with nop tags \-: pointer to the device tree blob \-: offset of the node to nop

\hyperlink{fdt__wip_8c_ac1b08e2054997c7e9814fc0b04acb305}{fdt\-\_\-nop\-\_\-node()} will replace a given node's representation in the blob, including all its subnodes, if any, with F\-D\-T\-\_\-\-N\-O\-P tags, effectively removing it from the tree.

This function will alter only the bytes in the blob which contain the node and its properties and subnodes, and will not alter or move any other part of the tree.

returns\-: 0, on success -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-O\-F\-F\-S\-E\-T, nodeoffset did not point to F\-D\-T\-\_\-\-B\-E\-G\-I\-N\-\_\-\-N\-O\-D\-E tag -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-M\-A\-G\-I\-C, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-V\-E\-R\-S\-I\-O\-N, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-R\-U\-C\-T\-U\-R\-E, -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-T\-R\-U\-N\-C\-A\-T\-E\-D, standard meanings 

References fdt\-\_\-node\-\_\-end\-\_\-offset\-\_\-(), fdt\-\_\-nop\-\_\-region\-\_\-(), and fdt\-\_\-offset\-\_\-ptr\-\_\-w().


\begin{DoxyCode}
84 \{
85     \textcolor{keywordtype}{int} endoffset;
86 
87     endoffset = \hyperlink{fdt__wip_8c_a45210c5c83d2fc1bed7cb7161e471fad}{fdt\_node\_end\_offset\_}(fdt, nodeoffset);
88     \textcolor{keywordflow}{if} (endoffset < 0)
89         \textcolor{keywordflow}{return} endoffset;
90 
91     \hyperlink{fdt__wip_8c_a2553eaad74cf73ff56d5f6bf5da1b04b}{fdt\_nop\_region\_}(\hyperlink{libfdt_8h_ab5fff326afde3a9b05b6327aa6e5a7bc}{fdt\_offset\_ptr\_w}(fdt, nodeoffset, 0),
92             endoffset - nodeoffset);
93     \textcolor{keywordflow}{return} 0;
94 \}
\end{DoxyCode}
\hypertarget{fdt__wip_8c_acf3ba20475e7b94a8d31eac14ea7228d}{\index{fdt\-\_\-wip.\-c@{fdt\-\_\-wip.\-c}!fdt\-\_\-nop\-\_\-property@{fdt\-\_\-nop\-\_\-property}}
\index{fdt\-\_\-nop\-\_\-property@{fdt\-\_\-nop\-\_\-property}!fdt_wip.c@{fdt\-\_\-wip.\-c}}
\subsubsection[{fdt\-\_\-nop\-\_\-property}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-nop\-\_\-property (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fdt__wip_8c_acf3ba20475e7b94a8d31eac14ea7228d}


References fdt\-\_\-get\-\_\-property\-\_\-w(), fdt\-\_\-nop\-\_\-region\-\_\-(), and fdt\-\_\-property\-::len.


\begin{DoxyCode}
60 \{
61     \textcolor{keyword}{struct }\hyperlink{structfdt__property}{fdt\_property} *prop;
62     \textcolor{keywordtype}{int} \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len};
63 
64     prop = \hyperlink{libfdt_8h_a3ef3cd199863ded58e473a71ebdd478c}{fdt\_get\_property\_w}(fdt, nodeoffset, name, &len);
65     \textcolor{keywordflow}{if} (!prop)
66         \textcolor{keywordflow}{return} \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len};
67 
68     \hyperlink{fdt__wip_8c_a2553eaad74cf73ff56d5f6bf5da1b04b}{fdt\_nop\_region\_}(prop, len + \textcolor{keyword}{sizeof}(*prop));
69 
70     \textcolor{keywordflow}{return} 0;
71 \}
\end{DoxyCode}
\hypertarget{fdt__wip_8c_a2553eaad74cf73ff56d5f6bf5da1b04b}{\index{fdt\-\_\-wip.\-c@{fdt\-\_\-wip.\-c}!fdt\-\_\-nop\-\_\-region\-\_\-@{fdt\-\_\-nop\-\_\-region\-\_\-}}
\index{fdt\-\_\-nop\-\_\-region\-\_\-@{fdt\-\_\-nop\-\_\-region\-\_\-}!fdt_wip.c@{fdt\-\_\-wip.\-c}}
\subsubsection[{fdt\-\_\-nop\-\_\-region\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static void fdt\-\_\-nop\-\_\-region\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{start, }
\item[{int}]{len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__wip_8c_a2553eaad74cf73ff56d5f6bf5da1b04b}


References cpu\-\_\-to\-\_\-fdt32(), and F\-D\-T\-\_\-\-N\-O\-P.



Referenced by fdt\-\_\-nop\-\_\-node(), and fdt\-\_\-nop\-\_\-property().


\begin{DoxyCode}
52 \{
53     \hyperlink{libfdt__env_8h_a76887ac8786252752fb3f9a39b21f3af}{fdt32\_t} *p;
54 
55     \textcolor{keywordflow}{for} (p = start; (\textcolor{keywordtype}{char} *)p < ((\textcolor{keywordtype}{char} *)start + \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}); p++)
56         *p = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a95f6ec2ae047c13339f80ca6adeafc21}{FDT\_NOP});
57 \}
\end{DoxyCode}
\hypertarget{fdt__wip_8c_a6943ff251ae8c4ffea474788215965a1}{\index{fdt\-\_\-wip.\-c@{fdt\-\_\-wip.\-c}!fdt\-\_\-setprop\-\_\-inplace@{fdt\-\_\-setprop\-\_\-inplace}}
\index{fdt\-\_\-setprop\-\_\-inplace@{fdt\-\_\-setprop\-\_\-inplace}!fdt_wip.c@{fdt\-\_\-wip.\-c}}
\subsubsection[{fdt\-\_\-setprop\-\_\-inplace}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-setprop\-\_\-inplace (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{const void $\ast$}]{val, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fdt__wip_8c_a6943ff251ae8c4ffea474788215965a1}


References F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-getprop(), fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial(), and strlen().



Referenced by fdt\-\_\-setprop\-\_\-inplace\-\_\-u32(), and fdt\-\_\-setprop\-\_\-inplace\-\_\-u64().


\begin{DoxyCode}
35 \{
36     \textcolor{keyword}{const} \textcolor{keywordtype}{void} *propval;
37     \textcolor{keywordtype}{int} proplen;
38 
39     propval = \hyperlink{fdt__ro_8c_a0a72997fe1eb5a57885bbb988256d08f}{fdt\_getprop}(fdt, nodeoffset, name, &proplen);
40     \textcolor{keywordflow}{if} (!propval)
41         \textcolor{keywordflow}{return} proplen;
42 
43     \textcolor{keywordflow}{if} (proplen != \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len})
44         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
45 
46     \textcolor{keywordflow}{return} \hyperlink{fdt__wip_8c_ad2d3b0ed8c78b7ca920550656dca6cf9}{fdt\_setprop\_inplace\_namelen\_partial}(fdt, nodeoffset, name,
47                            \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(name), 0,
48                            val, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
49 \}
\end{DoxyCode}
\hypertarget{fdt__wip_8c_ad2d3b0ed8c78b7ca920550656dca6cf9}{\index{fdt\-\_\-wip.\-c@{fdt\-\_\-wip.\-c}!fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial@{fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial}}
\index{fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial@{fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial}!fdt_wip.c@{fdt\-\_\-wip.\-c}}
\subsubsection[{fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-setprop\-\_\-inplace\-\_\-namelen\-\_\-partial (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{int}]{nodeoffset, }
\item[{const char $\ast$}]{name, }
\item[{int}]{namelen, }
\item[{{\bf uint32\-\_\-t}}]{idx, }
\item[{const void $\ast$}]{val, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fdt__wip_8c_ad2d3b0ed8c78b7ca920550656dca6cf9}


References F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-getprop\-\_\-namelen\-\_\-w(), and memcpy().



Referenced by fdt\-\_\-setprop\-\_\-inplace(), overlay\-\_\-fixup\-\_\-one\-\_\-phandle(), and overlay\-\_\-update\-\_\-local\-\_\-node\-\_\-references().


\begin{DoxyCode}
17 \{
18     \textcolor{keywordtype}{void} *propval;
19     \textcolor{keywordtype}{int} proplen;
20 
21     propval = \hyperlink{libfdt_8h_a2d633fbf4ecff743e2a869a80e330ed6}{fdt\_getprop\_namelen\_w}(fdt, nodeoffset, name, namelen,
22                     &proplen);
23     \textcolor{keywordflow}{if} (!propval)
24         \textcolor{keywordflow}{return} proplen;
25 
26     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned})proplen < (\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} + idx))
27         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
28 
29     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}((\textcolor{keywordtype}{char} *)propval + idx, val, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
30     \textcolor{keywordflow}{return} 0;
31 \}
\end{DoxyCode}
