\hypertarget{fdt__sw_8c}{\section{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-sw.c File Reference}
\label{fdt__sw_8c}\index{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-sw.\-c@{/users/enseig/franck/ko6/src/soft/external/libfdt/fdt\-\_\-sw.\-c}}
}
{\ttfamily \#include \char`\"{}libfdt\-\_\-env.\-h\char`\"{}}\\*
{\ttfamily \#include $<$external/libfdt/fdt.\-h$>$}\\*
{\ttfamily \#include $<$external/libfdt/libfdt.\-h$>$}\\*
{\ttfamily \#include \char`\"{}libfdt\-\_\-internal.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{fdt__sw_8c_a384db2e3b5cbf95ce0d8271806332424}{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E}(fdt)
\item 
\#define \hyperlink{fdt__sw_8c_a9924ae9c09a00ab2b426fa2c730a34a9}{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V}(fdt)
\item 
\#define \hyperlink{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T}(fdt)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{fdt__sw_8c_a589d8a305419fd5969399f27b882fa31}{fdt\-\_\-sw\-\_\-probe\-\_\-} (void $\ast$fdt)
\item 
static int \hyperlink{fdt__sw_8c_a4f59ad463210914100e441cf988c794c}{fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-} (void $\ast$fdt)
\item 
static int \hyperlink{fdt__sw_8c_a019f53bedefb756f83065e83b52e479a}{fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-} (void $\ast$fdt)
\item 
static \hyperlink{libfdt__env_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} \hyperlink{fdt__sw_8c_a7ef7626d844124362e5ad3eff9848f66}{sw\-\_\-flags} (void $\ast$fdt)
\item 
static void $\ast$ \hyperlink{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}{fdt\-\_\-grab\-\_\-space\-\_\-} (void $\ast$fdt, size\-\_\-t len)
\item 
int \hyperlink{fdt__sw_8c_a0c1636150835ef9be70997465df6d6e7}{fdt\-\_\-create\-\_\-with\-\_\-flags} (void $\ast$buf, int bufsize, \hyperlink{libfdt__env_8h_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} flags)
\item 
int \hyperlink{fdt__sw_8c_a4dc7458fd1035524255f34a9281f6531}{fdt\-\_\-create} (void $\ast$buf, int bufsize)
\item 
int \hyperlink{fdt__sw_8c_ac0274b125d712e01d9022bad43756c3c}{fdt\-\_\-resize} (void $\ast$fdt, void $\ast$buf, int bufsize)
\item 
int \hyperlink{fdt__sw_8c_aa19f8fdf0e1719f5f5f45d5301dba4d8}{fdt\-\_\-add\-\_\-reservemap\-\_\-entry} (void $\ast$fdt, \hyperlink{libfdt__env_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\-\_\-t} addr, \hyperlink{libfdt__env_8h_aaa5d1cd013383c889537491c3cfd9aad}{uint64\-\_\-t} size)
\item 
int \hyperlink{fdt__sw_8c_a05d900f8144f846f0ccafbcf97c46078}{fdt\-\_\-finish\-\_\-reservemap} (void $\ast$fdt)
\item 
int \hyperlink{fdt__sw_8c_a70390d95f50f22e8c5c175c0922e5f56}{fdt\-\_\-begin\-\_\-node} (void $\ast$fdt, const char $\ast$name)
\item 
int \hyperlink{fdt__sw_8c_ac806fe57ee0d47d0a8621fa82aa5414b}{fdt\-\_\-end\-\_\-node} (void $\ast$fdt)
\item 
static int \hyperlink{fdt__sw_8c_a5fb58af6d8c627999573486ebdb28bfe}{fdt\-\_\-add\-\_\-string\-\_\-} (void $\ast$fdt, const char $\ast$s)
\item 
static void \hyperlink{fdt__sw_8c_ae0c4748fe7902285d3151c1860bcc22e}{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-} (void $\ast$fdt, const char $\ast$s)
\item 
static int \hyperlink{fdt__sw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-} (void $\ast$fdt, const char $\ast$s, int $\ast$allocated)
\item 
int \hyperlink{fdt__sw_8c_a9015fb704ccb78395d5995db76978821}{fdt\-\_\-property\-\_\-placeholder} (void $\ast$fdt, const char $\ast$name, int len, void $\ast$$\ast$valp)
\item 
int \hyperlink{fdt__sw_8c_a525f92c0978941a45a4c3a32793266e4}{fdt\-\_\-property} (void $\ast$fdt, const char $\ast$name, const void $\ast$val, int len)
\item 
int \hyperlink{fdt__sw_8c_a64e71b32a23ad494306c69b3cd4ba159}{fdt\-\_\-finish} (void $\ast$fdt)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{fdt__sw_8c_a384db2e3b5cbf95ce0d8271806332424}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E@{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E}}
\index{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E@{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E(
\begin{DoxyParamCaption}
\item[{}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a384db2e3b5cbf95ce0d8271806332424}
{\bfseries Value\-:}
\begin{DoxyCode}
\{ \(\backslash\)
        int err; \(\backslash\)
        if ((err = \hyperlink{fdt__sw_8c_a589d8a305419fd5969399f27b882fa31}{fdt\_sw\_probe\_}(fdt)) != 0) \(\backslash\)
            return err; \(\backslash\)
    \}
\end{DoxyCode}


Referenced by fdt\-\_\-resize().

\hypertarget{fdt__sw_8c_a9924ae9c09a00ab2b426fa2c730a34a9}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V@{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V}}
\index{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V@{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V(
\begin{DoxyParamCaption}
\item[{}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a9924ae9c09a00ab2b426fa2c730a34a9}
{\bfseries Value\-:}
\begin{DoxyCode}
\{ \(\backslash\)
        int err; \(\backslash\)
        if ((err = \hyperlink{fdt__sw_8c_a4f59ad463210914100e441cf988c794c}{fdt\_sw\_probe\_memrsv\_}(fdt)) != 0) \(\backslash\)
            return err; \(\backslash\)
    \}
\end{DoxyCode}


Referenced by fdt\-\_\-add\-\_\-reservemap\-\_\-entry().

\hypertarget{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T@{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T}}
\index{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T@{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T(
\begin{DoxyParamCaption}
\item[{}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}
{\bfseries Value\-:}
\begin{DoxyCode}
\{ \(\backslash\)
        int err; \(\backslash\)
        if ((err = \hyperlink{fdt__sw_8c_a019f53bedefb756f83065e83b52e479a}{fdt\_sw\_probe\_struct\_}(fdt)) != 0) \(\backslash\)
            return err; \(\backslash\)
    \}
\end{DoxyCode}


Referenced by fdt\-\_\-begin\-\_\-node(), fdt\-\_\-end\-\_\-node(), fdt\-\_\-finish(), and fdt\-\_\-property\-\_\-placeholder().



\subsection{Function Documentation}
\hypertarget{fdt__sw_8c_aa19f8fdf0e1719f5f5f45d5301dba4d8}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-add\-\_\-reservemap\-\_\-entry@{fdt\-\_\-add\-\_\-reservemap\-\_\-entry}}
\index{fdt\-\_\-add\-\_\-reservemap\-\_\-entry@{fdt\-\_\-add\-\_\-reservemap\-\_\-entry}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-add\-\_\-reservemap\-\_\-entry}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-add\-\_\-reservemap\-\_\-entry (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{{\bf uint64\-\_\-t}}]{addr, }
\item[{{\bf uint64\-\_\-t}}]{size}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_aa19f8fdf0e1719f5f5f45d5301dba4d8}


References fdt\-\_\-reserve\-\_\-entry\-::address, cpu\-\_\-to\-\_\-fdt64(), F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-off\-\_\-dt\-\_\-struct, F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-M\-E\-M\-R\-S\-V, fdt\-\_\-totalsize, and fdt\-\_\-reserve\-\_\-entry\-::size.



Referenced by fdt\-\_\-finish\-\_\-reservemap().


\begin{DoxyCode}
189 \{
190     \textcolor{keyword}{struct }\hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry} *re;
191     \textcolor{keywordtype}{int} offset;
192 
193     \hyperlink{fdt__sw_8c_a9924ae9c09a00ab2b426fa2c730a34a9}{FDT\_SW\_PROBE\_MEMRSV}(fdt);
194 
195     offset = \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt);
196     \textcolor{keywordflow}{if} ((offset + \textcolor{keyword}{sizeof}(*re)) > \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt))
197         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
198 
199     re = (\textcolor{keyword}{struct }\hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry} *)((\textcolor{keywordtype}{char} *)fdt + offset);
200     re->\hyperlink{structfdt__reserve__entry_a1453319ff97e2d7c2ec0762cee56e98e}{address} = \hyperlink{libfdt__env_8h_a516d5270419a4000d9617b3df5e6f665}{cpu\_to\_fdt64}(addr);
201     re->\hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size} = \hyperlink{libfdt__env_8h_a516d5270419a4000d9617b3df5e6f665}{cpu\_to\_fdt64}(\hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size});
202 
203     fdt\_set\_off\_dt\_struct(fdt, offset + \textcolor{keyword}{sizeof}(*re));
204 
205     \textcolor{keywordflow}{return} 0;
206 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a5fb58af6d8c627999573486ebdb28bfe}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-add\-\_\-string\-\_\-@{fdt\-\_\-add\-\_\-string\-\_\-}}
\index{fdt\-\_\-add\-\_\-string\-\_\-@{fdt\-\_\-add\-\_\-string\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-add\-\_\-string\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-add\-\_\-string\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{s}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_a5fb58af6d8c627999573486ebdb28bfe}


References fdt\-\_\-off\-\_\-dt\-\_\-struct, fdt\-\_\-size\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-struct, fdt\-\_\-totalsize, memcpy(), and strlen().



Referenced by fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-(), and fdt\-\_\-property\-\_\-placeholder().


\begin{DoxyCode}
251 \{
252     \textcolor{keywordtype}{char} *strtab = (\textcolor{keywordtype}{char} *)fdt + \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt);
253     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} strtabsize = \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
254     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} len = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(s) + 1;
255     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} struct\_top, offset;
256 
257     offset = strtabsize + len;
258     struct\_top = \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt) + \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt);
259     \textcolor{keywordflow}{if} (\hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt) - offset < struct\_top)
260         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* no more room :( */}
261 
262     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(strtab - offset, s, len);
263     fdt\_set\_size\_dt\_strings(fdt, strtabsize + len);
264     \textcolor{keywordflow}{return} -offset;
265 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a70390d95f50f22e8c5c175c0922e5f56}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-begin\-\_\-node@{fdt\-\_\-begin\-\_\-node}}
\index{fdt\-\_\-begin\-\_\-node@{fdt\-\_\-begin\-\_\-node}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-begin\-\_\-node}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-begin\-\_\-node (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a70390d95f50f22e8c5c175c0922e5f56}


References cpu\-\_\-to\-\_\-fdt32(), F\-D\-T\-\_\-\-B\-E\-G\-I\-N\-\_\-\-N\-O\-D\-E, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-grab\-\_\-space\-\_\-(), F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T, F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N, memcpy(), fdt\-\_\-node\-\_\-header\-::name, strlen(), and fdt\-\_\-node\-\_\-header\-::tag.



Referenced by fdt\-\_\-create\-\_\-empty\-\_\-tree().


\begin{DoxyCode}
220 \{
221     \textcolor{keyword}{struct }\hyperlink{structfdt__node__header}{fdt\_node\_header} *nh;
222     \textcolor{keywordtype}{int} namelen;
223 
224     \hyperlink{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}{FDT\_SW\_PROBE\_STRUCT}(fdt);
225 
226     namelen = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(\hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}) + 1;
227     nh = \hyperlink{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}{fdt\_grab\_space\_}(fdt, \textcolor{keyword}{sizeof}(*nh) + \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(namelen));
228     \textcolor{keywordflow}{if} (! nh)
229         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
230 
231     nh->\hyperlink{structfdt__node__header_a073164a8ce430c15d2147ccba6bc7340}{tag} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a84974b092f97d4f2588c8efb4f6fdd67}{FDT\_BEGIN\_NODE});
232     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(nh->\hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}, \hyperlink{structfdt__node__header_a7b13eaf331db0c09640dc3d208c7efcd}{name}, namelen);
233     \textcolor{keywordflow}{return} 0;
234 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a4dc7458fd1035524255f34a9281f6531}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-create@{fdt\-\_\-create}}
\index{fdt\-\_\-create@{fdt\-\_\-create}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-create}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-create (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{buf, }
\item[{int}]{bufsize}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a4dc7458fd1035524255f34a9281f6531}
fdt\-\_\-create -\/ begin creation of a new fdt \-: pointer to memory allocated where fdt will be created \-: size of the memory space at fdt

\hyperlink{fdt__sw_8c_a4dc7458fd1035524255f34a9281f6531}{fdt\-\_\-create()} is equivalent to \hyperlink{fdt__sw_8c_a0c1636150835ef9be70997465df6d6e7}{fdt\-\_\-create\-\_\-with\-\_\-flags()} with flags=0.

returns\-: 0, on success -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, bufsize is insufficient for a minimal fdt 

References fdt\-\_\-create\-\_\-with\-\_\-flags().



Referenced by fdt\-\_\-create\-\_\-empty\-\_\-tree().


\begin{DoxyCode}
144 \{
145     \textcolor{keywordflow}{return} \hyperlink{fdt__sw_8c_a0c1636150835ef9be70997465df6d6e7}{fdt\_create\_with\_flags}(buf, bufsize, 0);
146 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a0c1636150835ef9be70997465df6d6e7}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-create\-\_\-with\-\_\-flags@{fdt\-\_\-create\-\_\-with\-\_\-flags}}
\index{fdt\-\_\-create\-\_\-with\-\_\-flags@{fdt\-\_\-create\-\_\-with\-\_\-flags}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-create\-\_\-with\-\_\-flags}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-create\-\_\-with\-\_\-flags (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{buf, }
\item[{int}]{bufsize, }
\item[{{\bf uint32\-\_\-t}}]{flags}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a0c1636150835ef9be70997465df6d6e7}
fdt\-\_\-create\-\_\-with\-\_\-flags -\/ begin creation of a new fdt \-: pointer to memory allocated where fdt will be created \-: size of the memory space at fdt \-: a valid combination of F\-D\-T\-\_\-\-C\-R\-E\-A\-T\-E\-\_\-\-F\-L\-A\-G\-\_\- flags, or 0.

\hyperlink{fdt__sw_8c_a0c1636150835ef9be70997465df6d6e7}{fdt\-\_\-create\-\_\-with\-\_\-flags()} begins the process of creating a new fdt with the sequential write interface.

fdt creation process must end with \hyperlink{fdt__sw_8c_a64e71b32a23ad494306c69b3cd4ba159}{fdt\-\_\-finish()} to produce a valid fdt.

returns\-: 0, on success -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, bufsize is insufficient for a minimal fdt -\/\-F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-F\-L\-A\-G\-S, flags is not valid 

References F\-D\-T\-\_\-\-A\-L\-I\-G\-N, F\-D\-T\-\_\-\-C\-R\-E\-A\-T\-E\-\_\-\-F\-L\-A\-G\-S\-\_\-\-A\-L\-L, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-F\-L\-A\-G\-S, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, F\-D\-T\-\_\-\-L\-A\-S\-T\-\_\-\-S\-U\-P\-P\-O\-R\-T\-E\-D\-\_\-\-V\-E\-R\-S\-I\-O\-N, fdt\-\_\-off\-\_\-mem\-\_\-rsvmap, F\-D\-T\-\_\-\-S\-W\-\_\-\-M\-A\-G\-I\-C, and memset().



Referenced by fdt\-\_\-create().


\begin{DoxyCode}
110 \{
111     \textcolor{keyword}{const} \textcolor{keywordtype}{int} hdrsize = \hyperlink{libfdt__internal_8h_a47d522a4cadae635e3549c08f4032c3b}{FDT\_ALIGN}(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structfdt__header}{fdt\_header}),
112                       \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structfdt__reserve__entry}{fdt\_reserve\_entry}));
113     \textcolor{keywordtype}{void} *fdt = buf;
114 
115     \textcolor{keywordflow}{if} (bufsize < hdrsize)
116         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
117 
118     \textcolor{keywordflow}{if} (flags & ~\hyperlink{libfdt_8h_a3060ad51979d47143dd5390940c08474}{FDT\_CREATE\_FLAGS\_ALL})
119         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_acdbe061469db63aa50b51afa59be2fcf}{FDT\_ERR\_BADFLAGS};
120 
121     \hyperlink{cstd_8c_a3459ebf29bb6519d0160ff500d7c997f}{memset}(buf, 0, bufsize);
122 
123     \textcolor{comment}{/*}
124 \textcolor{comment}{     * magic and last\_comp\_version keep intermediate state during the fdt}
125 \textcolor{comment}{     * creation process, which is replaced with the proper FDT format by}
126 \textcolor{comment}{     * fdt\_finish().}
127 \textcolor{comment}{     *}
128 \textcolor{comment}{     * flags should be accessed with sw\_flags().}
129 \textcolor{comment}{     */}
130     fdt\_set\_magic(fdt, \hyperlink{libfdt__internal_8h_a8beb41f034bfe7967b246bbad463a575}{FDT\_SW\_MAGIC});
131     fdt\_set\_version(fdt, \hyperlink{libfdt_8h_a3d13a6bfa946b38c95d1c327d4139c22}{FDT\_LAST\_SUPPORTED\_VERSION});
132     fdt\_set\_last\_comp\_version(fdt, flags);
133 
134     fdt\_set\_totalsize(fdt,  bufsize);
135 
136     fdt\_set\_off\_mem\_rsvmap(fdt, hdrsize);
137     fdt\_set\_off\_dt\_struct(fdt, \hyperlink{libfdt_8h_ad34e2939365df0a17061d177356b4e39}{fdt\_off\_mem\_rsvmap}(fdt));
138     fdt\_set\_off\_dt\_strings(fdt, 0);
139 
140     \textcolor{keywordflow}{return} 0;
141 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_ae0c4748fe7902285d3151c1860bcc22e}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-@{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-}}
\index{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-@{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static void fdt\-\_\-del\-\_\-last\-\_\-string\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{s}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_ae0c4748fe7902285d3151c1860bcc22e}


References fdt\-\_\-size\-\_\-dt\-\_\-strings, and strlen().



Referenced by fdt\-\_\-property\-\_\-placeholder().


\begin{DoxyCode}
269 \{
270     \textcolor{keywordtype}{int} strtabsize = \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
271     \textcolor{keywordtype}{int} len = \hyperlink{cstd_8c_a54684bded3e61e2d78d490650f9b706a}{strlen}(s) + 1;
272 
273     fdt\_set\_size\_dt\_strings(fdt, strtabsize - len);
274 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_ac806fe57ee0d47d0a8621fa82aa5414b}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-end\-\_\-node@{fdt\-\_\-end\-\_\-node}}
\index{fdt\-\_\-end\-\_\-node@{fdt\-\_\-end\-\_\-node}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-end\-\_\-node}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-end\-\_\-node (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_ac806fe57ee0d47d0a8621fa82aa5414b}


References cpu\-\_\-to\-\_\-fdt32(), F\-D\-T\-\_\-\-E\-N\-D\-\_\-\-N\-O\-D\-E, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-grab\-\_\-space\-\_\-(), F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T, and F\-D\-T\-\_\-\-T\-A\-G\-S\-I\-Z\-E.



Referenced by fdt\-\_\-create\-\_\-empty\-\_\-tree().


\begin{DoxyCode}
237 \{
238     \hyperlink{libfdt__env_8h_a76887ac8786252752fb3f9a39b21f3af}{fdt32\_t} *en;
239 
240     \hyperlink{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}{FDT\_SW\_PROBE\_STRUCT}(fdt);
241 
242     en = \hyperlink{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}{fdt\_grab\_space\_}(fdt, \hyperlink{fdt_8h_ada36dac7d767aceec040a00307dba77b}{FDT\_TAGSIZE});
243     \textcolor{keywordflow}{if} (! en)
244         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
245 
246     *en = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a97c9b3b1971681a8183442ddd0a8009c}{FDT\_END\_NODE});
247     \textcolor{keywordflow}{return} 0;
248 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-@{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-}}
\index{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-@{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-find\-\_\-add\-\_\-string\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{s, }
\item[{int $\ast$}]{allocated}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_a39cb8b1f38cfd53050f7089314f23c7f}


References fdt\-\_\-add\-\_\-string\-\_\-(), fdt\-\_\-find\-\_\-string\-\_\-(), fdt\-\_\-size\-\_\-dt\-\_\-strings, and fdt\-\_\-totalsize.



Referenced by fdt\-\_\-property\-\_\-placeholder().


\begin{DoxyCode}
277 \{
278     \textcolor{keywordtype}{char} *strtab = (\textcolor{keywordtype}{char} *)fdt + \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt);
279     \textcolor{keywordtype}{int} strtabsize = \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
280     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *p;
281 
282     *allocated = 0;
283 
284     p = \hyperlink{fdt_8c_af68faaab7e7f2c691bfb1679da262bf5}{fdt\_find\_string\_}(strtab - strtabsize, strtabsize, s);
285     \textcolor{keywordflow}{if} (p)
286         \textcolor{keywordflow}{return} p - strtab;
287 
288     *allocated = 1;
289 
290     \textcolor{keywordflow}{return} \hyperlink{fdt__sw_8c_a5fb58af6d8c627999573486ebdb28bfe}{fdt\_add\_string\_}(fdt, s);
291 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a64e71b32a23ad494306c69b3cd4ba159}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-finish@{fdt\-\_\-finish}}
\index{fdt\-\_\-finish@{fdt\-\_\-finish}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-finish}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-finish (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a64e71b32a23ad494306c69b3cd4ba159}


References cpu\-\_\-to\-\_\-fdt32(), fdt32\-\_\-to\-\_\-cpu(), F\-D\-T\-\_\-\-E\-N\-D, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-grab\-\_\-space\-\_\-(), F\-D\-T\-\_\-\-L\-A\-S\-T\-\_\-\-C\-O\-M\-P\-A\-T\-I\-B\-L\-E\-\_\-\-V\-E\-R\-S\-I\-O\-N, F\-D\-T\-\_\-\-M\-A\-G\-I\-C, fdt\-\_\-next\-\_\-tag(), fdt\-\_\-off\-\_\-dt\-\_\-struct, fdt\-\_\-offset\-\_\-ptr\-\_\-w\-\_\-(), F\-D\-T\-\_\-\-P\-R\-O\-P, fdt\-\_\-size\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-struct, F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T, fdt\-\_\-totalsize, memmove(), fdt\-\_\-property\-::nameoff, and fdt\-\_\-property\-::tag.



Referenced by fdt\-\_\-create\-\_\-empty\-\_\-tree().


\begin{DoxyCode}
338 \{
339     \textcolor{keywordtype}{char} *p = (\textcolor{keywordtype}{char} *)fdt;
340     \hyperlink{libfdt__env_8h_a76887ac8786252752fb3f9a39b21f3af}{fdt32\_t} *end;
341     \textcolor{keywordtype}{int} oldstroffset, newstroffset;
342     \hyperlink{libfdt__env_8h_a435d1572bf3f880d55459d9805097f62}{uint32\_t} \hyperlink{structfdt__node__header_a073164a8ce430c15d2147ccba6bc7340}{tag};
343     \textcolor{keywordtype}{int} offset, nextoffset;
344 
345     \hyperlink{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}{FDT\_SW\_PROBE\_STRUCT}(fdt);
346 
347     \textcolor{comment}{/* Add terminator */}
348     end = \hyperlink{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}{fdt\_grab\_space\_}(fdt, \textcolor{keyword}{sizeof}(*end));
349     \textcolor{keywordflow}{if} (! end)
350         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
351     *end = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a53275b16340fb458df4782462f283d8c}{FDT\_END});
352 
353     \textcolor{comment}{/* Relocate the string table */}
354     oldstroffset = \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt) - \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
355     newstroffset = \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt) + \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt);
356     \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(p + newstroffset, p + oldstroffset, \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt));
357     fdt\_set\_off\_dt\_strings(fdt, newstroffset);
358 
359     \textcolor{comment}{/* Walk the structure, correcting string offsets */}
360     offset = 0;
361     \textcolor{keywordflow}{while} ((tag = \hyperlink{fdt_8c_ae1b4b34a1b1fa1230d3ccacf14446b61}{fdt\_next\_tag}(fdt, offset, &nextoffset)) != \hyperlink{fdt_8h_a53275b16340fb458df4782462f283d8c}{FDT\_END}) \{
362         \textcolor{keywordflow}{if} (tag == \hyperlink{fdt_8h_a3304a9313cbf7ecced77f89ff5f25dde}{FDT\_PROP}) \{
363             \textcolor{keyword}{struct }\hyperlink{structfdt__property}{fdt\_property} *prop =
364                 \hyperlink{libfdt__internal_8h_ae42dc2243a1db6dc0c0eee8771367315}{fdt\_offset\_ptr\_w\_}(fdt, offset);
365             \textcolor{keywordtype}{int} \hyperlink{structfdt__property_ad5753794266beffe67b79b6e5b3ab352}{nameoff};
366 
367             nameoff = \hyperlink{libfdt__env_8h_a6485ea7225a1927cc5ab1a34dabe298f}{fdt32\_to\_cpu}(prop->\hyperlink{structfdt__property_ad5753794266beffe67b79b6e5b3ab352}{nameoff});
368             nameoff += \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
369             prop->\hyperlink{structfdt__property_ad5753794266beffe67b79b6e5b3ab352}{nameoff} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(nameoff);
370         \}
371         offset = nextoffset;
372     \}
373     \textcolor{keywordflow}{if} (nextoffset < 0)
374         \textcolor{keywordflow}{return} nextoffset;
375 
376     \textcolor{comment}{/* Finally, adjust the header */}
377     fdt\_set\_totalsize(fdt, newstroffset + \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt));
378 
379     \textcolor{comment}{/* And fix up fields that were keeping intermediate state. */}
380     fdt\_set\_last\_comp\_version(fdt, \hyperlink{libfdt_8h_a92dfcdf28c0695fc365661c3b3f2ce6a}{FDT\_LAST\_COMPATIBLE\_VERSION});
381     fdt\_set\_magic(fdt, \hyperlink{fdt_8h_a5d5b14eccb44e809abddd8a946ddc8a3}{FDT\_MAGIC});
382 
383     \textcolor{keywordflow}{return} 0;
384 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a05d900f8144f846f0ccafbcf97c46078}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-finish\-\_\-reservemap@{fdt\-\_\-finish\-\_\-reservemap}}
\index{fdt\-\_\-finish\-\_\-reservemap@{fdt\-\_\-finish\-\_\-reservemap}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-finish\-\_\-reservemap}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-finish\-\_\-reservemap (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a05d900f8144f846f0ccafbcf97c46078}


References fdt\-\_\-add\-\_\-reservemap\-\_\-entry(), and fdt\-\_\-totalsize.



Referenced by fdt\-\_\-create\-\_\-empty\-\_\-tree().


\begin{DoxyCode}
209 \{
210     \textcolor{keywordtype}{int} err = \hyperlink{fdt__sw_8c_aa19f8fdf0e1719f5f5f45d5301dba4d8}{fdt\_add\_reservemap\_entry}(fdt, 0, 0);
211 
212     \textcolor{keywordflow}{if} (err)
213         \textcolor{keywordflow}{return} err;
214 
215     fdt\_set\_off\_dt\_strings(fdt, \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt));
216     \textcolor{keywordflow}{return} 0;
217 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-grab\-\_\-space\-\_\-@{fdt\-\_\-grab\-\_\-space\-\_\-}}
\index{fdt\-\_\-grab\-\_\-space\-\_\-@{fdt\-\_\-grab\-\_\-space\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-grab\-\_\-space\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static void$\ast$ fdt\-\_\-grab\-\_\-space\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{size\-\_\-t}]{len}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}


References fdt\-\_\-off\-\_\-dt\-\_\-struct, fdt\-\_\-offset\-\_\-ptr\-\_\-w\-\_\-(), fdt\-\_\-size\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-struct, fdt\-\_\-totalsize, and N\-U\-L\-L.



Referenced by fdt\-\_\-begin\-\_\-node(), fdt\-\_\-end\-\_\-node(), fdt\-\_\-finish(), and fdt\-\_\-property\-\_\-placeholder().


\begin{DoxyCode}
95 \{
96     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} offset = \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt);
97     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} spaceleft;
98 
99     spaceleft = \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt) - \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt)
100         - \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
101 
102     \textcolor{keywordflow}{if} ((offset + \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} < offset) || (offset + \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} > spaceleft))
103         \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
104 
105     fdt\_set\_size\_dt\_struct(fdt, offset + \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
106     \textcolor{keywordflow}{return} \hyperlink{libfdt__internal_8h_ae42dc2243a1db6dc0c0eee8771367315}{fdt\_offset\_ptr\_w\_}(fdt, offset);
107 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a525f92c0978941a45a4c3a32793266e4}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-property@{fdt\-\_\-property}}
\index{fdt\-\_\-property@{fdt\-\_\-property}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-property}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf fdt\-\_\-property} (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{name, }
\item[{const void $\ast$}]{val, }
\item[{int}]{len}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a525f92c0978941a45a4c3a32793266e4}


References fdt\-\_\-property\-\_\-placeholder(), and memcpy().



Referenced by fdt\-\_\-property\-\_\-u32(), and fdt\-\_\-property\-\_\-u64().


\begin{DoxyCode}
326 \{
327     \textcolor{keywordtype}{void} *ptr;
328     \textcolor{keywordtype}{int} ret;
329 
330     ret = \hyperlink{fdt__sw_8c_a9015fb704ccb78395d5995db76978821}{fdt\_property\_placeholder}(fdt, name, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}, &ptr);
331     \textcolor{keywordflow}{if} (ret)
332         \textcolor{keywordflow}{return} ret;
333     \hyperlink{cstd_8c_a40deeb5b928964e60d97b3b8fd8a9b33}{memcpy}(ptr, val, \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
334     \textcolor{keywordflow}{return} 0;
335 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a9015fb704ccb78395d5995db76978821}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-property\-\_\-placeholder@{fdt\-\_\-property\-\_\-placeholder}}
\index{fdt\-\_\-property\-\_\-placeholder@{fdt\-\_\-property\-\_\-placeholder}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-property\-\_\-placeholder}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-property\-\_\-placeholder (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{const char $\ast$}]{name, }
\item[{int}]{len, }
\item[{void $\ast$$\ast$}]{valp}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_a9015fb704ccb78395d5995db76978821}


References cpu\-\_\-to\-\_\-fdt32(), fdt\-\_\-property\-::data, fdt\-\_\-add\-\_\-string\-\_\-(), F\-D\-T\-\_\-\-C\-R\-E\-A\-T\-E\-\_\-\-F\-L\-A\-G\-\_\-\-N\-O\-\_\-\-N\-A\-M\-E\-\_\-\-D\-E\-D\-U\-P, fdt\-\_\-del\-\_\-last\-\_\-string\-\_\-(), F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-find\-\_\-add\-\_\-string\-\_\-(), fdt\-\_\-grab\-\_\-space\-\_\-(), F\-D\-T\-\_\-\-P\-R\-O\-P, F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E\-\_\-\-S\-T\-R\-U\-C\-T, F\-D\-T\-\_\-\-T\-A\-G\-A\-L\-I\-G\-N, fdt\-\_\-property\-::len, fdt\-\_\-property\-::nameoff, sw\-\_\-flags(), and fdt\-\_\-property\-::tag.



Referenced by fdt\-\_\-property().


\begin{DoxyCode}
294 \{
295     \textcolor{keyword}{struct }\hyperlink{structfdt__property}{fdt\_property} *prop;
296     \textcolor{keywordtype}{int} \hyperlink{structfdt__property_ad5753794266beffe67b79b6e5b3ab352}{nameoff};
297     \textcolor{keywordtype}{int} allocated;
298 
299     \hyperlink{fdt__sw_8c_a71f41b9df0134e4b8e4bc2cf023741d2}{FDT\_SW\_PROBE\_STRUCT}(fdt);
300 
301     \textcolor{comment}{/* String de-duplication can be slow, \_NO\_NAME\_DEDUP skips it */}
302     \textcolor{keywordflow}{if} (\hyperlink{fdt__sw_8c_a7ef7626d844124362e5ad3eff9848f66}{sw\_flags}(fdt) & \hyperlink{libfdt_8h_a439fad457c41818aa238dff416f284aa}{FDT\_CREATE\_FLAG\_NO\_NAME\_DEDUP}) \{
303         allocated = 1;
304         nameoff = \hyperlink{fdt__sw_8c_a5fb58af6d8c627999573486ebdb28bfe}{fdt\_add\_string\_}(fdt, name);
305     \} \textcolor{keywordflow}{else} \{
306         nameoff = \hyperlink{fdt__sw_8c_a39cb8b1f38cfd53050f7089314f23c7f}{fdt\_find\_add\_string\_}(fdt, name, &allocated);
307     \}
308     \textcolor{keywordflow}{if} (nameoff == 0)
309         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
310 
311     prop = \hyperlink{fdt__sw_8c_a2b84719929e321e90fce03acaf600413}{fdt\_grab\_space\_}(fdt, \textcolor{keyword}{sizeof}(*prop) + \hyperlink{libfdt__internal_8h_a8955518b67338925d939fe2389b41796}{FDT\_TAGALIGN}(
      \hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len}));
312     \textcolor{keywordflow}{if} (! prop) \{
313         \textcolor{keywordflow}{if} (allocated)
314             \hyperlink{fdt__sw_8c_ae0c4748fe7902285d3151c1860bcc22e}{fdt\_del\_last\_string\_}(fdt, name);
315         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
316     \}
317 
318     prop->\hyperlink{structfdt__property_a6c0d0fd0e741c931f7b3ca1482193740}{tag} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{fdt_8h_a3304a9313cbf7ecced77f89ff5f25dde}{FDT\_PROP});
319     prop->\hyperlink{structfdt__property_ad5753794266beffe67b79b6e5b3ab352}{nameoff} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(nameoff);
320     prop->\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len} = \hyperlink{libfdt__env_8h_a06ce41f441b8a56710000af3c3e516e5}{cpu\_to\_fdt32}(\hyperlink{structfdt__property_a48e6236319453578c3ca7c106b382a2f}{len});
321     *valp = prop->\hyperlink{structfdt__property_abb52f21622f86ed9b268f49b76f23aef}{data};
322     \textcolor{keywordflow}{return} 0;
323 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_ac0274b125d712e01d9022bad43756c3c}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-resize@{fdt\-\_\-resize}}
\index{fdt\-\_\-resize@{fdt\-\_\-resize}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-resize}]{\setlength{\rightskip}{0pt plus 5cm}int fdt\-\_\-resize (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt, }
\item[{void $\ast$}]{buf, }
\item[{int}]{bufsize}
\end{DoxyParamCaption}
)}}\label{fdt__sw_8c_ac0274b125d712e01d9022bad43756c3c}


References can\-\_\-assume, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-I\-N\-T\-E\-R\-N\-A\-L, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-N\-O\-S\-P\-A\-C\-E, fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-off\-\_\-dt\-\_\-struct, fdt\-\_\-size\-\_\-dt\-\_\-strings, fdt\-\_\-size\-\_\-dt\-\_\-struct, F\-D\-T\-\_\-\-S\-W\-\_\-\-P\-R\-O\-B\-E, fdt\-\_\-totalsize, and memmove().


\begin{DoxyCode}
149 \{
150     \textcolor{keywordtype}{size\_t} headsize, tailsize;
151     \textcolor{keywordtype}{char} *oldtail, *newtail;
152 
153     \hyperlink{fdt__sw_8c_a384db2e3b5cbf95ce0d8271806332424}{FDT\_SW\_PROBE}(fdt);
154 
155     \textcolor{keywordflow}{if} (bufsize < 0)
156         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
157 
158     headsize = \hyperlink{libfdt_8h_ae2ef3611d83ac29bb6de09594ead9969}{fdt\_off\_dt\_struct}(fdt) + \hyperlink{libfdt_8h_a73b5fa0a791f02805b93ea70c6cb30ab}{fdt\_size\_dt\_struct}(fdt);
159     tailsize = \hyperlink{libfdt_8h_aa0748803d707f2be7d15ebfb815d31b4}{fdt\_size\_dt\_strings}(fdt);
160 
161     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(VALID\_DTB) &&
162         headsize + tailsize > \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt))
163         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a02625761a47e8012c53fb389dd25fadd}{FDT\_ERR\_INTERNAL};
164 
165     \textcolor{keywordflow}{if} ((headsize + tailsize) > (\textcolor{keywordtype}{unsigned})bufsize)
166         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a149fb54f14ba915a78319a9570e4eae3}{FDT\_ERR\_NOSPACE};
167 
168     oldtail = (\textcolor{keywordtype}{char} *)fdt + \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt) - tailsize;
169     newtail = (\textcolor{keywordtype}{char} *)buf + bufsize - tailsize;
170 
171     \textcolor{comment}{/* Two cases to avoid clobbering data if the old and new}
172 \textcolor{comment}{     * buffers partially overlap */}
173     \textcolor{keywordflow}{if} (buf <= fdt) \{
174         \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(buf, fdt, headsize);
175         \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(newtail, oldtail, tailsize);
176     \} \textcolor{keywordflow}{else} \{
177         \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(newtail, oldtail, tailsize);
178         \hyperlink{cstd_8c_a802c986820d3866639922b6bc9484f90}{memmove}(buf, fdt, headsize);
179     \}
180 
181     fdt\_set\_totalsize(buf, bufsize);
182     \textcolor{keywordflow}{if} (\hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(buf))
183         fdt\_set\_off\_dt\_strings(buf, bufsize);
184 
185     \textcolor{keywordflow}{return} 0;
186 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a589d8a305419fd5969399f27b882fa31}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-sw\-\_\-probe\-\_\-@{fdt\-\_\-sw\-\_\-probe\-\_\-}}
\index{fdt\-\_\-sw\-\_\-probe\-\_\-@{fdt\-\_\-sw\-\_\-probe\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-sw\-\_\-probe\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-sw\-\_\-probe\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_a589d8a305419fd5969399f27b882fa31}


References can\-\_\-assume, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-M\-A\-G\-I\-C, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, F\-D\-T\-\_\-\-M\-A\-G\-I\-C, fdt\-\_\-magic, and F\-D\-T\-\_\-\-S\-W\-\_\-\-M\-A\-G\-I\-C.



Referenced by fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-(), and fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-().


\begin{DoxyCode}
14 \{
15     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(VALID\_INPUT)) \{
16         \textcolor{keywordflow}{if} (\hyperlink{libfdt_8h_a783c67f6971d10232c84ecd0aa76f461}{fdt\_magic}(fdt) == \hyperlink{fdt_8h_a5d5b14eccb44e809abddd8a946ddc8a3}{FDT\_MAGIC})
17             \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a87f75249bba66fc5e21110e00a990a81}{FDT\_ERR\_BADSTATE};
18         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{libfdt_8h_a783c67f6971d10232c84ecd0aa76f461}{fdt\_magic}(fdt) != \hyperlink{libfdt__internal_8h_a8beb41f034bfe7967b246bbad463a575}{FDT\_SW\_MAGIC})
19             \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_abb777d59bc55628f8736b2b6c799213b}{FDT\_ERR\_BADMAGIC};
20     \}
21 
22     \textcolor{keywordflow}{return} 0;
23 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a4f59ad463210914100e441cf988c794c}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-@{fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-}}
\index{fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-@{fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-sw\-\_\-probe\-\_\-memrsv\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_a4f59ad463210914100e441cf988c794c}


References can\-\_\-assume, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, fdt\-\_\-off\-\_\-dt\-\_\-strings, and fdt\-\_\-sw\-\_\-probe\-\_\-().


\begin{DoxyCode}
39 \{
40     \textcolor{keywordtype}{int} err = \hyperlink{fdt__sw_8c_a589d8a305419fd5969399f27b882fa31}{fdt\_sw\_probe\_}(fdt);
41     \textcolor{keywordflow}{if} (err)
42         \textcolor{keywordflow}{return} err;
43 
44     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(VALID\_INPUT) && \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) != 0)
45         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a87f75249bba66fc5e21110e00a990a81}{FDT\_ERR\_BADSTATE};
46     \textcolor{keywordflow}{return} 0;
47 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a019f53bedefb756f83065e83b52e479a}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-@{fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-}}
\index{fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-@{fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\-}]{\setlength{\rightskip}{0pt plus 5cm}static int fdt\-\_\-sw\-\_\-probe\-\_\-struct\-\_\- (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{fdt__sw_8c_a019f53bedefb756f83065e83b52e479a}


References can\-\_\-assume, F\-D\-T\-\_\-\-E\-R\-R\-\_\-\-B\-A\-D\-S\-T\-A\-T\-E, fdt\-\_\-off\-\_\-dt\-\_\-strings, fdt\-\_\-sw\-\_\-probe\-\_\-(), and fdt\-\_\-totalsize.


\begin{DoxyCode}
65 \{
66     \textcolor{keywordtype}{int} err = \hyperlink{fdt__sw_8c_a589d8a305419fd5969399f27b882fa31}{fdt\_sw\_probe\_}(fdt);
67     \textcolor{keywordflow}{if} (err)
68         \textcolor{keywordflow}{return} err;
69 
70     \textcolor{keywordflow}{if} (!\hyperlink{libfdt__internal_8h_ae26d08ffdd441f73ecf7de7ca35176b9}{can\_assume}(VALID\_INPUT) &&
71         \hyperlink{libfdt_8h_a80994b6320a372f47942ac65f55c0d6c}{fdt\_off\_dt\_strings}(fdt) != \hyperlink{libfdt_8h_a2acbb1f436008e0830f7e329bbb13cd0}{fdt\_totalsize}(fdt))
72         \textcolor{keywordflow}{return} -\hyperlink{libfdt_8h_a87f75249bba66fc5e21110e00a990a81}{FDT\_ERR\_BADSTATE};
73     \textcolor{keywordflow}{return} 0;
74 \}
\end{DoxyCode}
\hypertarget{fdt__sw_8c_a7ef7626d844124362e5ad3eff9848f66}{\index{fdt\-\_\-sw.\-c@{fdt\-\_\-sw.\-c}!sw\-\_\-flags@{sw\-\_\-flags}}
\index{sw\-\_\-flags@{sw\-\_\-flags}!fdt_sw.c@{fdt\-\_\-sw.\-c}}
\subsubsection[{sw\-\_\-flags}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf uint32\-\_\-t} sw\-\_\-flags (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{fdt}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}}\label{fdt__sw_8c_a7ef7626d844124362e5ad3eff9848f66}


References fdt\-\_\-last\-\_\-comp\-\_\-version.



Referenced by fdt\-\_\-property\-\_\-placeholder().


\begin{DoxyCode}
84 \{
85     \textcolor{comment}{/* assert: (fdt\_magic(fdt) == FDT\_SW\_MAGIC) */}
86     \textcolor{keywordflow}{return} \hyperlink{libfdt_8h_a6b64d727951727aa9464061496abc1e9}{fdt\_last\_comp\_version}(fdt);
87 \}
\end{DoxyCode}
