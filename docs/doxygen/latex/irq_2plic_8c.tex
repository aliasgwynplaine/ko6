\hypertarget{irq_2plic_8c}{\section{/users/enseig/franck/ko6/src/soft/hal/devices/irq/plic.c File Reference}
\label{irq_2plic_8c}\index{/users/enseig/franck/ko6/src/soft/hal/devices/irq/plic.\-c@{/users/enseig/franck/ko6/src/soft/hal/devices/irq/plic.\-c}}
}
{\ttfamily \#include $<$hal/devices/irq/plic.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{irq_2plic_8c_a8b947c8e4ea70cbdbaef2b8e297ebec0}{plic\-\_\-init} (struct \hyperlink{structirq__s}{irq\-\_\-s} $\ast$irq, unsigned address)
\begin{DoxyCompactList}\small\item\em Initialize P\-L\-I\-C device. \end{DoxyCompactList}\item 
static unsigned \hyperlink{irq_2plic_8c_a4abadf7c7708a4e82653244b0f8a3076}{plic\-\_\-get\-\_\-highest} (struct \hyperlink{structirq__s}{irq\-\_\-s} $\ast$irq)
\begin{DoxyCompactList}\small\item\em Get the highest priority I\-R\-Q triggered (mclaim register of the P\-L\-I\-C)$\ast$. \end{DoxyCompactList}\item 
static void \hyperlink{irq_2plic_8c_a6cd7405ef7737934039c45b9f6632aec}{plic\-\_\-set\-\_\-priority} (struct \hyperlink{structirq__s}{irq\-\_\-s} $\ast$irq, unsigned irq, unsigned pri)
\begin{DoxyCompactList}\small\item\em Set I\-R\-Q priority. \end{DoxyCompactList}\item 
static void \hyperlink{irq_2plic_8c_aff888c00792ab01ba3930cdabdce8111}{plic\-\_\-acknowledge} (struct \hyperlink{structirq__s}{irq\-\_\-s} $\ast$irq, unsigned irq)
\begin{DoxyCompactList}\small\item\em Acknowledge the I\-R\-Q (write the I\-R\-Q no in the M\-C\-L\-A\-I\-M register) \end{DoxyCompactList}\item 
static void \hyperlink{irq_2plic_8c_a4c3d2b9040324d127a74b7ec117a4848}{plic\-\_\-unmask} (struct \hyperlink{structirq__s}{irq\-\_\-s} $\ast$irq, unsigned irq)
\begin{DoxyCompactList}\small\item\em Unmask the I\-R\-Q (enable it), (write 1 in the corresponding M\-E\-N\-A\-B\-L\-E bit) \end{DoxyCompactList}\item 
static void \hyperlink{irq_2plic_8c_af09dd821ff5fb645e381417ed41dd8b4}{plic\-\_\-mask} (struct \hyperlink{structirq__s}{irq\-\_\-s} $\ast$irq, unsigned irq)
\begin{DoxyCompactList}\small\item\em Mask the I\-R\-Q (disable it), (write 0 in the corresponding M\-E\-N\-A\-B\-L\-E bit) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structirq__ops__s}{irq\-\_\-ops\-\_\-s} \hyperlink{irq_2plic_8c_a17675820560c7cae735796612c324b47}{Plic\-Ops}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{irq_2plic_8c_aff888c00792ab01ba3930cdabdce8111}{\index{irq/plic.\-c@{irq/plic.\-c}!plic\-\_\-acknowledge@{plic\-\_\-acknowledge}}
\index{plic\-\_\-acknowledge@{plic\-\_\-acknowledge}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{plic\-\_\-acknowledge}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-acknowledge (
\begin{DoxyParamCaption}
\item[{struct {\bf irq\-\_\-s} $\ast$}]{irq, }
\item[{unsigned}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{irq_2plic_8c_aff888c00792ab01ba3930cdabdce8111}


Acknowledge the I\-R\-Q (write the I\-R\-Q no in the M\-C\-L\-A\-I\-M register) 


\begin{DoxyParams}{Parameters}
{\em irq} & irq device \\
\hline
{\em irq} & target irq \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References cpuid, and P\-L\-I\-C\-\_\-\-M\-C\-L\-A\-I\-M.


\begin{DoxyCode}
55 \{
56     *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a0cf3ff3184233bd489b4c55de020b169}{PLIC\_MCLAIM}(irq->\hyperlink{structirq__s_a2e80a67e94ae94f89353f9e01f72aa6f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}()) = irq;
57 \}
\end{DoxyCode}
\hypertarget{irq_2plic_8c_a4abadf7c7708a4e82653244b0f8a3076}{\index{irq/plic.\-c@{irq/plic.\-c}!plic\-\_\-get\-\_\-highest@{plic\-\_\-get\-\_\-highest}}
\index{plic\-\_\-get\-\_\-highest@{plic\-\_\-get\-\_\-highest}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{plic\-\_\-get\-\_\-highest}]{\setlength{\rightskip}{0pt plus 5cm}static unsigned plic\-\_\-get\-\_\-highest (
\begin{DoxyParamCaption}
\item[{struct {\bf irq\-\_\-s} $\ast$}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{irq_2plic_8c_a4abadf7c7708a4e82653244b0f8a3076}


Get the highest priority I\-R\-Q triggered (mclaim register of the P\-L\-I\-C)$\ast$. 


\begin{DoxyParams}{Parameters}
{\em irq} & irq device \\
\hline
\end{DoxyParams}


References irq\-\_\-s\-::address, cpuid, and P\-L\-I\-C\-\_\-\-M\-C\-L\-A\-I\-M.


\begin{DoxyCode}
32 \{
33     \textcolor{keywordflow}{return} *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a0cf3ff3184233bd489b4c55de020b169}{PLIC\_MCLAIM}(irq->\hyperlink{structirq__s_a2e80a67e94ae94f89353f9e01f72aa6f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}());
34 \}
\end{DoxyCode}
\hypertarget{irq_2plic_8c_a8b947c8e4ea70cbdbaef2b8e297ebec0}{\index{irq/plic.\-c@{irq/plic.\-c}!plic\-\_\-init@{plic\-\_\-init}}
\index{plic\-\_\-init@{plic\-\_\-init}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{plic\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-init (
\begin{DoxyParamCaption}
\item[{struct {\bf irq\-\_\-s} $\ast$}]{irq, }
\item[{unsigned}]{address}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{irq_2plic_8c_a8b947c8e4ea70cbdbaef2b8e297ebec0}


Initialize P\-L\-I\-C device. 


\begin{DoxyParams}{Parameters}
{\em irq} & irq device to initialize \\
\hline
{\em address} & address of the physical device \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References irq\-\_\-s\-::address, irq\-\_\-s\-::ops, and Plic\-Ops.


\begin{DoxyCode}
22 \{
23     irq->\hyperlink{structirq__s_a0a694b7988310de18555fda236162d59}{ops}        = &\hyperlink{icu_2plic_8c_a0daeb7589a4979ebe7c0ff070de2fafe}{PlicOps};
24     irq->\hyperlink{structirq__s_a2e80a67e94ae94f89353f9e01f72aa6f}{address}    = address;
25 \}
\end{DoxyCode}
\hypertarget{irq_2plic_8c_af09dd821ff5fb645e381417ed41dd8b4}{\index{irq/plic.\-c@{irq/plic.\-c}!plic\-\_\-mask@{plic\-\_\-mask}}
\index{plic\-\_\-mask@{plic\-\_\-mask}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{plic\-\_\-mask}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-mask (
\begin{DoxyParamCaption}
\item[{struct {\bf irq\-\_\-s} $\ast$}]{irq, }
\item[{unsigned}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{irq_2plic_8c_af09dd821ff5fb645e381417ed41dd8b4}


Mask the I\-R\-Q (disable it), (write 0 in the corresponding M\-E\-N\-A\-B\-L\-E bit) 


\begin{DoxyParams}{Parameters}
{\em irq} & irq device \\
\hline
{\em irq} & target irq \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References cpuid, and P\-L\-I\-C\-\_\-\-M\-E\-N\-A\-B\-L\-E.


\begin{DoxyCode}
78 \{
79     \textcolor{keywordtype}{unsigned} j = irq % 32;
80     *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a8212cf7e47e4480422b7b2e5f749690e}{PLIC\_MENABLE}(irq->\hyperlink{structirq__s_a2e80a67e94ae94f89353f9e01f72aa6f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}(), irq) &= ~(1 << j);
81 \}
\end{DoxyCode}
\hypertarget{irq_2plic_8c_a6cd7405ef7737934039c45b9f6632aec}{\index{irq/plic.\-c@{irq/plic.\-c}!plic\-\_\-set\-\_\-priority@{plic\-\_\-set\-\_\-priority}}
\index{plic\-\_\-set\-\_\-priority@{plic\-\_\-set\-\_\-priority}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{plic\-\_\-set\-\_\-priority}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-set\-\_\-priority (
\begin{DoxyParamCaption}
\item[{struct {\bf irq\-\_\-s} $\ast$}]{irq, }
\item[{unsigned}]{irq, }
\item[{unsigned}]{pri}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{irq_2plic_8c_a6cd7405ef7737934039c45b9f6632aec}


Set I\-R\-Q priority. 


\begin{DoxyParams}{Parameters}
{\em irq} & irq device \\
\hline
{\em irq} & target irq \\
\hline
{\em pri} & the new irq priority \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References P\-L\-I\-C\-\_\-\-P\-R\-I\-\_\-\-O\-F\-F\-S\-E\-T.


\begin{DoxyCode}
44 \{
45     ((\textcolor{keywordtype}{unsigned}*)irq->\hyperlink{structirq__s_a2e80a67e94ae94f89353f9e01f72aa6f}{address} + \hyperlink{icu_2plic_8h_a5fe86b468659fd6dd675104312618a0d}{PLIC\_PRI\_OFFSET})[irq] = pri;
46 \}
\end{DoxyCode}
\hypertarget{irq_2plic_8c_a4c3d2b9040324d127a74b7ec117a4848}{\index{irq/plic.\-c@{irq/plic.\-c}!plic\-\_\-unmask@{plic\-\_\-unmask}}
\index{plic\-\_\-unmask@{plic\-\_\-unmask}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{plic\-\_\-unmask}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-unmask (
\begin{DoxyParamCaption}
\item[{struct {\bf irq\-\_\-s} $\ast$}]{irq, }
\item[{unsigned}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{irq_2plic_8c_a4c3d2b9040324d127a74b7ec117a4848}


Unmask the I\-R\-Q (enable it), (write 1 in the corresponding M\-E\-N\-A\-B\-L\-E bit) 


\begin{DoxyParams}{Parameters}
{\em irq} & irq device \\
\hline
{\em irq} & target irq \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References cpuid, and P\-L\-I\-C\-\_\-\-M\-E\-N\-A\-B\-L\-E.


\begin{DoxyCode}
66 \{
67     \textcolor{keywordtype}{unsigned} j = irq % 32;
68     *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a8212cf7e47e4480422b7b2e5f749690e}{PLIC\_MENABLE}(irq->\hyperlink{structirq__s_a2e80a67e94ae94f89353f9e01f72aa6f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}(), irq) |= (1 << j);
69 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{irq_2plic_8c_a17675820560c7cae735796612c324b47}{\index{irq/plic.\-c@{irq/plic.\-c}!Plic\-Ops@{Plic\-Ops}}
\index{Plic\-Ops@{Plic\-Ops}!irq/plic.c@{irq/plic.\-c}}
\subsubsection[{Plic\-Ops}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf irq\-\_\-ops\-\_\-s} Plic\-Ops}}\label{irq_2plic_8c_a17675820560c7cae735796612c324b47}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
    .irq\_acknowledge = \hyperlink{irq_2plic_8c_aff888c00792ab01ba3930cdabdce8111}{plic\_acknowledge},
    .irq\_get\_highest = \hyperlink{irq_2plic_8c_a4abadf7c7708a4e82653244b0f8a3076}{plic\_get\_highest},
    .irq\_init = \hyperlink{irq_2plic_8c_a8b947c8e4ea70cbdbaef2b8e297ebec0}{plic\_init},
    .irq\_mask = \hyperlink{irq_2plic_8c_af09dd821ff5fb645e381417ed41dd8b4}{plic\_mask},
    .irq\_set\_priority = \hyperlink{irq_2plic_8c_a6cd7405ef7737934039c45b9f6632aec}{plic\_set\_priority},
    .irq\_unmask = \hyperlink{irq_2plic_8c_a4c3d2b9040324d127a74b7ec117a4848}{plic\_unmask}
\}
\end{DoxyCode}
