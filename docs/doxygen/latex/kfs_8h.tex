\hypertarget{kfs_8h}{\section{/users/enseig/franck/ko6/src/soft/fs/kfs/kfs.h File Reference}
\label{kfs_8h}\index{/users/enseig/franck/ko6/src/soft/fs/kfs/kfs.\-h@{/users/enseig/franck/ko6/src/soft/fs/kfs/kfs.\-h}}
}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{kfs_8h_a7c0f2945d18d92bc9b2e754b377335b3}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K}~0x2000  /$\ast$ number of pages in the whole disk $\ast$/
\item 
\#define \hyperlink{kfs_8h_ab547fa38768be432271323a0e509df32}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R}~1       /$\ast$ number of pages in M\-B\-R $\ast$/
\item 
\#define \hyperlink{kfs_8h_ada947412302e76983f1eea2cb524ec2d}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R}~3       /$\ast$ number of pages in V\-B\-R (bootloader) $\ast$/
\item 
\#define \hyperlink{kfs_8h_a82f61eaff20e7015c52261a2423ab0af}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K}~2       /$\ast$ number of pages in S\-B\-L\-O\-C\-K (contains all bitmaps) $\ast$/
\item 
\#define \hyperlink{kfs_8h_a012e85f2bb85ec2d5bdff1d298929018}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y}~2       /$\ast$ number of pages for all dentries $\ast$/
\item 
\#define \hyperlink{kfs_8h_a93b1915cf843dbd16b8d274ee4751acb}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E}~2       /$\ast$ number of pages for all inodes $\ast$/
\item 
\#define \hyperlink{kfs_8h_ae070eb53d573680911159a7cbb4b90e2}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P}~16      /$\ast$ number of pages for all file maps (inode extensions) $\ast$/
\item 
\#define \hyperlink{kfs_8h_a75d29f6159278cfe6da1ae6fefb40c46}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T}~(\hyperlink{kfs_8h_ab547fa38768be432271323a0e509df32}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R}+\hyperlink{kfs_8h_ada947412302e76983f1eea2cb524ec2d}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R})
\item 
\#define \hyperlink{kfs_8h_a2fc604f5c0a4a2971369642c96f07abf}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A}~(\hyperlink{kfs_8h_a82f61eaff20e7015c52261a2423ab0af}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K}+\hyperlink{kfs_8h_a012e85f2bb85ec2d5bdff1d298929018}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y}+\hyperlink{kfs_8h_a93b1915cf843dbd16b8d274ee4751acb}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E}+\hyperlink{kfs_8h_ae070eb53d573680911159a7cbb4b90e2}{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P})
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15}{kfs\-\_\-type\-\_\-e} \{ \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{K\-F\-S\-\_\-\-D\-I\-R}, 
\hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}{K\-F\-S\-\_\-\-F\-I\-L\-E}, 
\hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed}{K\-F\-S\-\_\-\-P\-I\-P\-E}, 
\hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1}{K\-F\-S\-\_\-\-S\-L\-I\-N\-K}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{kfs_8h_ade5bf93265bc86a9ecd5019cc6e3d277}{kfs\-\_\-root} (int dentry)
\begin{DoxyCompactList}\small\item\em read access functions to dentries \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a3be0d586ff3044979a3c381137d77d47}{kfs\-\_\-next} (int dentry)
\item 
int \hyperlink{kfs_8h_a135f3848117282c89e3be09b930eb9de}{kfs\-\_\-leaf} (int dentry)
\item 
int \hyperlink{kfs_8h_aae206d59d8bc4514d34dafdff1198ede}{kfs\-\_\-inode} (int dentry)
\item 
char $\ast$ \hyperlink{kfs_8h_a9d837cb422897570c876a655c0b762be}{kfs\-\_\-name} (int dentry)
\item 
int \hyperlink{kfs_8h_ac2308b1a426032672fbacdde9ee5ac81}{kfs\-\_\-isdir} (int dentry)
\begin{DoxyCompactList}\small\item\em boolean functions for dentries or inode \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_aaa0d81604e0d3d23f31b3beb7dcb163c}{kfs\-\_\-count} (int inode)
\begin{DoxyCompactList}\small\item\em read access functions to inodes \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a8d546cf291d26ab01a150b74cc206ae1}{kfs\-\_\-type} (int inode)
\item 
int \hyperlink{kfs_8h_ac9581ae711d5f79aff1ed39c9739e80c}{kfs\-\_\-mode} (int inode)
\item 
int \hyperlink{kfs_8h_a2e7cb7a15052f57bdff8a2c1146bc072}{kfs\-\_\-size} (int inode)
\item 
int \hyperlink{kfs_8h_a2f522cb4edeecd6cbcebcca31d90bc75}{kfs\-\_\-owner} (int inode)
\item 
int \hyperlink{kfs_8h_a9b41dd15430924703df46a579ff05b2e}{kfs\-\_\-mtime} (int inode)
\item 
int \hyperlink{kfs_8h_afdc75626536d311fb2fe47baef24ef55}{kfs\-\_\-page} (int inode, int pg\-\_\-offset)
\item 
int \hyperlink{kfs_8h_a30d4e1ffe8c1ea75120811fcf3055c05}{kfs\-\_\-chmode} (int inode, int mode)
\begin{DoxyCompactList}\small\item\em write access functions to inode's properties \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a3e380775665de4ff6cbc01555444cb64}{kfs\-\_\-chowner} (int inode, int owner)
\item 
int \hyperlink{kfs_8h_a68786a19dcb587fe18b45ae76effa1c5}{kfs\-\_\-chmtime} (int inode, int mtime)
\item 
int \hyperlink{kfs_8h_a5959448d399641d50a3b1324eed8fbd9}{kfs\-\_\-open} (char $\ast$full\-\_\-pathname)
\begin{DoxyCompactList}\small\item\em opens a file or directory, if file or directory not found, all the pathname is created \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a527debce004a38c7cc8dc0b3c3623814}{kfs\-\_\-openat} (int root, char $\ast$dentry\-\_\-name)
\begin{DoxyCompactList}\small\item\em looks for name in the directory root, if the name is not found, it is created \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_ab4ddfac90903634778ced7fb2105c50d}{kfs\-\_\-readdir} (int dentry, int leaf, void $\ast$\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer})
\begin{DoxyCompactList}\small\item\em Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading, buffer will contain the name of the directory or item. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a4170ece7c39eacb7c0ce15c891d2515f}{kfs\-\_\-read} (int dentry, int pg\-\_\-offset, int $\ast$\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer})
\begin{DoxyCompactList}\small\item\em Reads a file, it reads one page from the file dentry to memory buffer. After reading, buffer will contain the entire page of which the offset belongs. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a491e452cdf42853498249aadc91eb74b}{kfs\-\_\-set\-\_\-size} (int dentry, int newsize)
\begin{DoxyCompactList}\small\item\em Sets the size field of the inode associated with the dentry to newsize. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a4ed044e75ea35d5cffd2ee5426e1db38}{kfs\-\_\-write} (int dentry, int pg\-\_\-offset, void $\ast$\hyperlink{ktools_8c_a527b76b33fb8beec7f2df7e0c032aef6}{buffer})
\begin{DoxyCompactList}\small\item\em Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of which the offset belongs. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a75c287df9bc137651846c3766c294fb5}{kfs\-\_\-remove} (char $\ast$full\-\_\-pathname)
\begin{DoxyCompactList}\small\item\em removes a file or a directory \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a46783800e799435356d388150e2a5cec}{kfs\-\_\-unlink} (char $\ast$name)
\item 
int \hyperlink{kfs_8h_a36778e4753ea52a29dd2bcde44341446}{kfs\-\_\-link} (char $\ast$old\-\_\-name, char $\ast$new\-\_\-name)
\begin{DoxyCompactList}\small\item\em creates a new link (also called hard link) on an existing file. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a6c6336c1d084cc8a1dbc78c792099c4c}{kfs\-\_\-tree\-\_\-cb} (int root, void($\ast$callback)(int dentry, int depth, int position))
\begin{DoxyCompactList}\small\item\em calls the callback function on each entry from root dentry \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_af88c339569eb51ffc1d94ee2324202f5}{kfs\-\_\-add\-\_\-mbr} (char $\ast$pathname)
\begin{DoxyCompactList}\small\item\em Loads a 512 bytes sized M\-B\-R in kfs. Meant to be used exclusively on Linux. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a13b2ba4b6ae24b6b49ce962a44e4e5fa}{kfs\-\_\-add\-\_\-vbr} (char $\ast$pathname)
\begin{DoxyCompactList}\small\item\em Loads a V\-B\-R in kfs. Meant to be used exclusively on Linux. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{kfs\-\_\-disk\-\_\-load} (char $\ast$pathname)
\begin{DoxyCompactList}\small\item\em Loads the disk from an external support. On H\-O\-S\-T It means from the host disk in file whose name is given in parameter. After load, the whole content of the disk is present in memory in tables Kfs\-Mbr, Kfs\-Vbr, Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap \& Kfs\-Disk. On ko6 It means from the virtual disk connected to the Block Device controller. After load, only M\-E\-T\-A\-D\-A\-T\-A content of the disk is present in memory in tables Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap. \end{DoxyCompactList}\item 
int \hyperlink{kfs_8h_a3037ba33f12f2c2c99e099f9cc4a71e6}{kfs\-\_\-disk\-\_\-save} (char $\ast$pathname)
\begin{DoxyCompactList}\small\item\em Saves the disk to an external support. On H\-O\-S\-T It means to the host disk in a file whose name is given in parameter. After save, the whole content of the disk is written in file on host. That is Kfs\-Mbr, Kfs\-Vbr, Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap \& Kfs\-Disk. On ko6 It means to file connected to the Block Device controller. After save only M\-E\-T\-A\-D\-A\-T\-A content of the disk is written to the virtual disk. That is Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{kfs_8h_a75d29f6159278cfe6da1ae6fefb40c46}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-B\-O\-O\-T~({\bf K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R}+{\bf K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R})}}\label{kfs_8h_a75d29f6159278cfe6da1ae6fefb40c46}
\hypertarget{kfs_8h_a012e85f2bb85ec2d5bdff1d298929018}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y~2       /$\ast$ number of pages for all dentries $\ast$/}}\label{kfs_8h_a012e85f2bb85ec2d5bdff1d298929018}
\hypertarget{kfs_8h_a7c0f2945d18d92bc9b2e754b377335b3}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-I\-S\-K~0x2000  /$\ast$ number of pages in the whole disk $\ast$/}}\label{kfs_8h_a7c0f2945d18d92bc9b2e754b377335b3}


Referenced by kfs\-\_\-write\-\_\-page().

\hypertarget{kfs_8h_ae070eb53d573680911159a7cbb4b90e2}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P~16      /$\ast$ number of pages for all file maps (inode extensions) $\ast$/}}\label{kfs_8h_ae070eb53d573680911159a7cbb4b90e2}
\hypertarget{kfs_8h_a93b1915cf843dbd16b8d274ee4751acb}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E~2       /$\ast$ number of pages for all inodes $\ast$/}}\label{kfs_8h_a93b1915cf843dbd16b8d274ee4751acb}
\hypertarget{kfs_8h_ab547fa38768be432271323a0e509df32}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-B\-R~1       /$\ast$ number of pages in M\-B\-R $\ast$/}}\label{kfs_8h_ab547fa38768be432271323a0e509df32}
\hypertarget{kfs_8h_a2fc604f5c0a4a2971369642c96f07abf}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-M\-E\-T\-A~({\bf K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K}+{\bf K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-D\-E\-N\-T\-R\-Y}+{\bf K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-I\-N\-O\-D\-E}+{\bf K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-F\-M\-A\-P})}}\label{kfs_8h_a2fc604f5c0a4a2971369642c96f07abf}
\hypertarget{kfs_8h_a82f61eaff20e7015c52261a2423ab0af}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-S\-B\-L\-O\-C\-K~2       /$\ast$ number of pages in S\-B\-L\-O\-C\-K (contains all bitmaps) $\ast$/}}\label{kfs_8h_a82f61eaff20e7015c52261a2423ab0af}
\hypertarget{kfs_8h_ada947412302e76983f1eea2cb524ec2d}{\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R}}
\index{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R@{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R}!kfs.h@{kfs.\-h}}
\subsubsection[{K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\-F\-S\-\_\-\-N\-P\-G\-\_\-\-V\-B\-R~3       /$\ast$ number of pages in V\-B\-R (bootloader) $\ast$/}}\label{kfs_8h_ada947412302e76983f1eea2cb524ec2d}


\subsection{Enumeration Type Documentation}
\hypertarget{kfs_8h_a60283510d9cdbdb54a244958b0938e15}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-type\-\_\-e@{kfs\-\_\-type\-\_\-e}}
\index{kfs\-\_\-type\-\_\-e@{kfs\-\_\-type\-\_\-e}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-type\-\_\-e}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf kfs\-\_\-type\-\_\-e}}}\label{kfs_8h_a60283510d9cdbdb54a244958b0938e15}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{K\-F\-S\-\_\-\-D\-I\-R@{K\-F\-S\-\_\-\-D\-I\-R}!kfs.\-h@{kfs.\-h}}\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-D\-I\-R@{K\-F\-S\-\_\-\-D\-I\-R}}\item[{\em 
\hypertarget{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{K\-F\-S\-\_\-\-D\-I\-R}\label{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}
}]type of files for the real disk (less than vfs) directory \index{K\-F\-S\-\_\-\-F\-I\-L\-E@{K\-F\-S\-\_\-\-F\-I\-L\-E}!kfs.\-h@{kfs.\-h}}\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-F\-I\-L\-E@{K\-F\-S\-\_\-\-F\-I\-L\-E}}\item[{\em 
\hypertarget{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}{K\-F\-S\-\_\-\-F\-I\-L\-E}\label{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}
}]regular file \index{K\-F\-S\-\_\-\-P\-I\-P\-E@{K\-F\-S\-\_\-\-P\-I\-P\-E}!kfs.\-h@{kfs.\-h}}\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-P\-I\-P\-E@{K\-F\-S\-\_\-\-P\-I\-P\-E}}\item[{\em 
\hypertarget{kfs_8h_a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed}{K\-F\-S\-\_\-\-P\-I\-P\-E}\label{kfs_8h_a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed}
}]named fifo not yet handled \#fixme \index{K\-F\-S\-\_\-\-S\-L\-I\-N\-K@{K\-F\-S\-\_\-\-S\-L\-I\-N\-K}!kfs.\-h@{kfs.\-h}}\index{kfs.\-h@{kfs.\-h}!K\-F\-S\-\_\-\-S\-L\-I\-N\-K@{K\-F\-S\-\_\-\-S\-L\-I\-N\-K}}\item[{\em 
\hypertarget{kfs_8h_a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1}{K\-F\-S\-\_\-\-S\-L\-I\-N\-K}\label{kfs_8h_a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1}
}]symbolic link not yet handled \#fixme \end{description}
\end{Desc}

\begin{DoxyCode}
45                 \{               
46     \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{KFS\_DIR},                    
47     \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}{KFS\_FILE},                   
48     \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed}{KFS\_PIPE},                   
49     \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1}{KFS\_SLINK}                   
50 \};
\end{DoxyCode}


\subsection{Function Documentation}
\hypertarget{kfs_8h_af88c339569eb51ffc1d94ee2324202f5}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-add\-\_\-mbr@{kfs\-\_\-add\-\_\-mbr}}
\index{kfs\-\_\-add\-\_\-mbr@{kfs\-\_\-add\-\_\-mbr}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-add\-\_\-mbr}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-add\-\_\-mbr (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{pathname}
\end{DoxyParamCaption}
)}}\label{kfs_8h_af88c339569eb51ffc1d94ee2324202f5}


Loads a 512 bytes sized M\-B\-R in kfs. Meant to be used exclusively on Linux. 


\begin{DoxyParams}{Parameters}
{\em pathname} & the pathname on host to the mbr \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read 
\end{DoxyReturn}


Referenced by main().

\hypertarget{kfs_8h_a13b2ba4b6ae24b6b49ce962a44e4e5fa}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-add\-\_\-vbr@{kfs\-\_\-add\-\_\-vbr}}
\index{kfs\-\_\-add\-\_\-vbr@{kfs\-\_\-add\-\_\-vbr}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-add\-\_\-vbr}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-add\-\_\-vbr (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{pathname}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a13b2ba4b6ae24b6b49ce962a44e4e5fa}


Loads a V\-B\-R in kfs. Meant to be used exclusively on Linux. 


\begin{DoxyParams}{Parameters}
{\em pathname} & the pathname on host to the vbr \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of bytes read 
\end{DoxyReturn}


Referenced by main().

\hypertarget{kfs_8h_a30d4e1ffe8c1ea75120811fcf3055c05}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-chmode@{kfs\-\_\-chmode}}
\index{kfs\-\_\-chmode@{kfs\-\_\-chmode}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-chmode}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-chmode (
\begin{DoxyParamCaption}
\item[{int}]{inode, }
\item[{int}]{mode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a30d4e1ffe8c1ea75120811fcf3055c05}


write access functions to inode's properties 


\begin{DoxyParams}{Parameters}
{\em index} & of an inode \\
\hline
{\em mode,owner} & \& mtime are the new property value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the new property or -\/1 if failure 
\end{DoxyReturn}


References kfs\-\_\-inode\-\_\-s\-::mode.


\begin{DoxyCode}
153 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_af0dd6151a1aba841d36f2d005e77aef4}{mode} = mode; \}
\end{DoxyCode}
\hypertarget{kfs_8h_a68786a19dcb587fe18b45ae76effa1c5}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-chmtime@{kfs\-\_\-chmtime}}
\index{kfs\-\_\-chmtime@{kfs\-\_\-chmtime}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-chmtime}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-chmtime (
\begin{DoxyParamCaption}
\item[{int}]{inode, }
\item[{int}]{mtime}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a68786a19dcb587fe18b45ae76effa1c5}


References kfs\-\_\-inode\-\_\-s\-::mtime.


\begin{DoxyCode}
155 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_a575e296191f8d2444a26f90d58e155e6}{mtime}= mtime;\}
\end{DoxyCode}
\hypertarget{kfs_8h_a3e380775665de4ff6cbc01555444cb64}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-chowner@{kfs\-\_\-chowner}}
\index{kfs\-\_\-chowner@{kfs\-\_\-chowner}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-chowner}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-chowner (
\begin{DoxyParamCaption}
\item[{int}]{inode, }
\item[{int}]{owner}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a3e380775665de4ff6cbc01555444cb64}


References kfs\-\_\-inode\-\_\-s\-::owner.


\begin{DoxyCode}
154 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_adecb12117172ae213c9d659ffbcd809b}{owner}= owner;\}
\end{DoxyCode}
\hypertarget{kfs_8h_aaa0d81604e0d3d23f31b3beb7dcb163c}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-count@{kfs\-\_\-count}}
\index{kfs\-\_\-count@{kfs\-\_\-count}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-count}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-count (
\begin{DoxyParamCaption}
\item[{int}]{inode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_aaa0d81604e0d3d23f31b3beb7dcb163c}


read access functions to inodes 


\begin{DoxyParams}{Parameters}
{\em index} & of an inode \\
\hline
{\em offset} & is the page number in the file (start at 0 to filesize / sizeof(page)) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ kfs\-\_\-count \-: number of dentry pointing to this inode
\begin{DoxyItemize}
\item kfs\-\_\-type \-: type defined in kfs\-\_\-enum\-\_\-e
\item kfs\-\_\-mode \-: permission modes rwxrwx for the owner and others (there are no groups)
\item kfs\-\_\-size \-: file size
\item kfs\-\_\-owner \-: file or directory owner
\item kfs\-\_\-mtime \-: modification / creation relative time
\item kfs\-\_\-page \-: index of page of data on the disk 
\end{DoxyItemize}
\end{DoxyReturn}


References kfs\-\_\-inode\-\_\-s\-::count.



Referenced by kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
144 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_ae5ea15e9504973dc519f2ceca209a3d8}{count};\}
\end{DoxyCode}
\hypertarget{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-disk\-\_\-load@{kfs\-\_\-disk\-\_\-load}}
\index{kfs\-\_\-disk\-\_\-load@{kfs\-\_\-disk\-\_\-load}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-disk\-\_\-load}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-disk\-\_\-load (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{pathname}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a10f5dc158b1a0b3d2971a045df73aba4}


Loads the disk from an external support. On H\-O\-S\-T It means from the host disk in file whose name is given in parameter. After load, the whole content of the disk is present in memory in tables Kfs\-Mbr, Kfs\-Vbr, Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap \& Kfs\-Disk. On ko6 It means from the virtual disk connected to the Block Device controller. After load, only M\-E\-T\-A\-D\-A\-T\-A content of the disk is present in memory in tables Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap. 


\begin{DoxyParams}{Parameters}
{\em filename} & parameter only used by the H\-O\-S\-T \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
a number $>$ 0 on success, and $<$= 0 on failure 
\end{DoxyReturn}


Referenced by main().

\hypertarget{kfs_8h_a3037ba33f12f2c2c99e099f9cc4a71e6}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-disk\-\_\-save@{kfs\-\_\-disk\-\_\-save}}
\index{kfs\-\_\-disk\-\_\-save@{kfs\-\_\-disk\-\_\-save}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-disk\-\_\-save}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-disk\-\_\-save (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{pathname}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a3037ba33f12f2c2c99e099f9cc4a71e6}


Saves the disk to an external support. On H\-O\-S\-T It means to the host disk in a file whose name is given in parameter. After save, the whole content of the disk is written in file on host. That is Kfs\-Mbr, Kfs\-Vbr, Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap \& Kfs\-Disk. On ko6 It means to file connected to the Block Device controller. After save only M\-E\-T\-A\-D\-A\-T\-A content of the disk is written to the virtual disk. That is Kfs\-Sblock, Kfs\-Dentry, Kfs\-Inode, Kfs\-Fmap. 


\begin{DoxyParams}{Parameters}
{\em filename} & parameter only used by the H\-O\-S\-T \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
a number $>$ 0 on success, and $<$= 0 on fealure 
\end{DoxyReturn}


Referenced by main().

\hypertarget{kfs_8h_aae206d59d8bc4514d34dafdff1198ede}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-inode@{kfs\-\_\-inode}}
\index{kfs\-\_\-inode@{kfs\-\_\-inode}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-inode}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-inode (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{kfs_8h_aae206d59d8bc4514d34dafdff1198ede}


References kfs\-\_\-dentry\-\_\-s\-::inode.



Referenced by kfs\-\_\-print\-\_\-dentry(), kfs\-\_\-print\-\_\-files(), kfs\-\_\-read(), kfs\-\_\-set\-\_\-size(), kfs\-\_\-write(), and split().


\begin{DoxyCode}
139 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode};\}
\end{DoxyCode}
\hypertarget{kfs_8h_ac2308b1a426032672fbacdde9ee5ac81}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-isdir@{kfs\-\_\-isdir}}
\index{kfs\-\_\-isdir@{kfs\-\_\-isdir}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-isdir}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-isdir (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{kfs_8h_ac2308b1a426032672fbacdde9ee5ac81}


boolean functions for dentries or inode 


\begin{DoxyParams}{Parameters}
{\em index} & of a dentry \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ 0 if false, not 0 if true 
\end{DoxyReturn}


References kfs\-\_\-dentry\-\_\-s\-::inode, K\-F\-S\-\_\-\-D\-I\-R, and kfs\-\_\-inode\-\_\-s\-::type.



Referenced by kfs\-\_\-readdir(), kfs\-\_\-tree\-\_\-cb(), and kfs\-\_\-tree\-\_\-cb\-\_\-r().


\begin{DoxyCode}
142 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[\hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode}].\hyperlink{structkfs__inode__s_ac894cd2c4c9d7e6409c3302d1edec307}{type} == 
      \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{KFS\_DIR};\}
\end{DoxyCode}
\hypertarget{kfs_8h_a135f3848117282c89e3be09b930eb9de}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-leaf@{kfs\-\_\-leaf}}
\index{kfs\-\_\-leaf@{kfs\-\_\-leaf}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-leaf}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-leaf (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a135f3848117282c89e3be09b930eb9de}


References kfs\-\_\-dentry\-\_\-s\-::leaf.



Referenced by kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
138 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a79fd3c8764d633fdb895b77856f61d61}{leaf} ;\}
\end{DoxyCode}
\hypertarget{kfs_8h_a36778e4753ea52a29dd2bcde44341446}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-link@{kfs\-\_\-link}}
\index{kfs\-\_\-link@{kfs\-\_\-link}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-link}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-link (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{old\-\_\-name, }
\item[{char $\ast$}]{new\-\_\-name}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a36778e4753ea52a29dd2bcde44341446}


creates a new link (also called hard link) on an existing file. 


\begin{DoxyParams}{Parameters}
{\em old\-\_\-name} & is an existing file name \\
\hline
{\em new\-\_\-name} & is the new name of the same file as old\-\_\-name if new\-\_\-name already exists it is not created, and it's a failure \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if success, -\/1 if failure 
\end{DoxyReturn}


References kfs\-\_\-inode\-\_\-s\-::count, kfs\-\_\-dentry\-\_\-s\-::inode, kfs\-\_\-free\-\_\-inode(), and kfs\-\_\-open().



Referenced by dummy\-\_\-disk().


\begin{DoxyCode}
633 \{
634     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} src\_dentry = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open} (src\_name);
635     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} dst\_dentry = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open} (dst\_name);
636     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} src\_inode  = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[src\_dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode};
637     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} dst\_inode  = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dst\_dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode};
638     \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dst\_dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode} = src\_inode;
639     \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[src\_inode].\hyperlink{structkfs__inode__s_ae5ea15e9504973dc519f2ceca209a3d8}{count}++;
640     \hyperlink{kfs_8c_aadbe9ab58b58e9826dd4da1384c80798}{kfs\_free\_inode} (dst\_inode);
641     \textcolor{keywordflow}{return} dst\_dentry;
642 \}
\end{DoxyCode}
\hypertarget{kfs_8h_ac9581ae711d5f79aff1ed39c9739e80c}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-mode@{kfs\-\_\-mode}}
\index{kfs\-\_\-mode@{kfs\-\_\-mode}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-mode}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-mode (
\begin{DoxyParamCaption}
\item[{int}]{inode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_ac9581ae711d5f79aff1ed39c9739e80c}


References kfs\-\_\-inode\-\_\-s\-::mode.



Referenced by kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
146 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_af0dd6151a1aba841d36f2d005e77aef4}{mode}; \}
\end{DoxyCode}
\hypertarget{kfs_8h_a9b41dd15430924703df46a579ff05b2e}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-mtime@{kfs\-\_\-mtime}}
\index{kfs\-\_\-mtime@{kfs\-\_\-mtime}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-mtime}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-mtime (
\begin{DoxyParamCaption}
\item[{int}]{inode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a9b41dd15430924703df46a579ff05b2e}


References kfs\-\_\-inode\-\_\-s\-::mtime.



Referenced by kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
149 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_a575e296191f8d2444a26f90d58e155e6}{mtime};\}
\end{DoxyCode}
\hypertarget{kfs_8h_a9d837cb422897570c876a655c0b762be}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-name@{kfs\-\_\-name}}
\index{kfs\-\_\-name@{kfs\-\_\-name}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-name}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ kfs\-\_\-name (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a9d837cb422897570c876a655c0b762be}


References kfs\-\_\-dentry\-\_\-s\-::name.



Referenced by kfs\-\_\-absolute\-\_\-pathname(), and kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
140 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a9e5a536f0b9b95dc094c58c66c61ddcc}{name} ;\}
\end{DoxyCode}
\hypertarget{kfs_8h_a3be0d586ff3044979a3c381137d77d47}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-next@{kfs\-\_\-next}}
\index{kfs\-\_\-next@{kfs\-\_\-next}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-next}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-next (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a3be0d586ff3044979a3c381137d77d47}


References kfs\-\_\-dentry\-\_\-s\-::next.



Referenced by kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
137 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a17c6495def8c6564de45ab64cbc49066}{next} ;\}
\end{DoxyCode}
\hypertarget{kfs_8h_a5959448d399641d50a3b1324eed8fbd9}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-open@{kfs\-\_\-open}}
\index{kfs\-\_\-open@{kfs\-\_\-open}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-open}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-open (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{pathname}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a5959448d399641d50a3b1324eed8fbd9}


opens a file or directory, if file or directory not found, all the pathname is created 


\begin{DoxyParams}{Parameters}
{\em pathname} & is the absolute name of the file or directory to find in root \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
dentry index of the file or directory, that is the file descriptor or -\/1 on failure
\end{DoxyReturn}
\char`\"{}deep-\/first walk\char`\"{} of the name tree to find or create the file defined by its absolute name 

References kfs\-\_\-dentry\-\_\-s\-::inode, kfs\-\_\-getname(), kfs\-\_\-openat(), Kfs\-Offset, and N\-U\-L\-L.



Referenced by build(), dummy\-\_\-disk(), kfs\-\_\-files(), kfs\-\_\-link(), kfs\-\_\-tree(), kfs\-\_\-unlink(), and main().


\begin{DoxyCode}
526 \{
527     \textcolor{keywordtype}{char} * name = \hyperlink{kfs_8c_a02d307133891efa932b3766568eb738e}{kfs\_getname} (pathname);                   \textcolor{comment}{// get first name up to character
       '/'}
528     \textcolor{keywordflow}{if} (name == \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) \textcolor{keywordflow}{return} -1;                            \textcolor{comment}{// pathname not correct, failure}
529 
530     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} dentry = 0;                                       \textcolor{comment}{// search from root fs}
531     \textcolor{keywordflow}{while} ((name = \hyperlink{kfs_8c_a02d307133891efa932b3766568eb738e}{kfs\_getname} (\hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})))                     \textcolor{comment}{// get the next name in pathname}
532         dentry = \hyperlink{kfs_8c_a5bf1c4cc42e02a99529eefc02cf53c4b}{kfs\_openat} (dentry, name);                 \textcolor{comment}{// look for it in current directory}
533 
534     \hyperlink{kfs_8c_a4418baf5eb3028d32758a1ccd600be44}{KfsOffset}[\hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode}] = 0;                 \textcolor{comment}{// by defaut, set offset
       to firstpage}
535     \textcolor{keywordflow}{return} dentry;                                          \textcolor{comment}{// finally, the last dentry found}
536 \}
\end{DoxyCode}
\hypertarget{kfs_8h_a527debce004a38c7cc8dc0b3c3623814}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-openat@{kfs\-\_\-openat}}
\index{kfs\-\_\-openat@{kfs\-\_\-openat}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-openat}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-openat (
\begin{DoxyParamCaption}
\item[{int}]{root, }
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a527debce004a38c7cc8dc0b3c3623814}


looks for name in the directory root, if the name is not found, it is created 


\begin{DoxyParams}{Parameters}
{\em root} & is a dentry index \\
\hline
{\em dentry\-\_\-name} & is the name of the file or directory to find in root \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
dentry index of the file, that is the file descriptor
\end{DoxyReturn}
find or create the file defined by its relative name into the directory defined by its dentry 

References kfs\-\_\-dentry\-\_\-s\-::inode, kfs\-\_\-alloc\-\_\-dentry(), kfs\-\_\-alloc\-\_\-inode(), K\-F\-S\-\_\-\-D\-I\-R, K\-F\-S\-\_\-\-F\-I\-L\-E, kfs\-\_\-strcmp(), kfs\-\_\-dentry\-\_\-s\-::leaf, kfs\-\_\-dentry\-\_\-s\-::next, kfs\-\_\-dentry\-\_\-s\-::root, and kfs\-\_\-inode\-\_\-s\-::type.



Referenced by dummy\-\_\-disk(), and kfs\-\_\-open().


\begin{DoxyCode}
542 \{
543     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} leaf = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[root].\hyperlink{structkfs__dentry__s_a79fd3c8764d633fdb895b77856f61d61}{leaf};                      \textcolor{comment}{// get first leaf of current
       root}
544     \textcolor{keywordtype}{int} notfound = 1;                                       \textcolor{comment}{// by default, suppose name not found}
545 
546     \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[\hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[root].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode}].\hyperlink{structkfs__inode__s_ac894cd2c4c9d7e6409c3302d1edec307}{type} = \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3}{KFS\_DIR};         \textcolor{comment}{// root is
       necessarily a directory}
547 
548     \textcolor{keywordflow}{if} (leaf) \{                                             \textcolor{comment}{// if there are leafs}
549         \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} leaf\_next = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_a17c6495def8c6564de45ab64cbc49066}{next};             \textcolor{comment}{// get next leaf}
550         notfound = \hyperlink{kfs_8c_a09fba9a0bb78a0f1f159c01046c7e006}{kfs\_strcmp}(\hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].name, name);  \textcolor{comment}{// !=0 if different}
551 
552         \textcolor{keywordflow}{while} (notfound && leaf\_next) \{                     \textcolor{comment}{// while not good leaf and there is more}
553             leaf = leaf\_next;                               \textcolor{comment}{// change the leaf to the next leaf}
554             leaf\_next = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_a17c6495def8c6564de45ab64cbc49066}{next};               \textcolor{comment}{// get next leaf}
555             notfound= \hyperlink{kfs_8c_a09fba9a0bb78a0f1f159c01046c7e006}{kfs\_strcmp}(\hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].name,name);\textcolor{comment}{// compare current leaf}
556         \}
557     \}
558 
559     \textcolor{keywordflow}{if} (notfound) \{
560         leaf = \hyperlink{kfs_8c_a66ffc964d30c5258826714ac181af25a}{kfs\_alloc\_dentry} (name);                     \textcolor{comment}{// create a new dentry for the
       file}
561         \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode} = \hyperlink{kfs_8c_ad7d3799e6e7b1822350af7f957f63db1}{kfs\_alloc\_inode} (
      \hyperlink{kfs_8h_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf}{KFS\_FILE}); \textcolor{comment}{// create an empty inode (default FILE)}
562         \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_a79fd3c8764d633fdb895b77856f61d61}{leaf} = 0;                           \textcolor{comment}{// if new leaf is FILE, thus no
       leaf}
563         \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_aed21f3f5ab2de70ab3416afe6dd9e4d4}{root} = root;                        \textcolor{comment}{// set the root of the new leaf}
564         \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_a17c6495def8c6564de45ab64cbc49066}{next} = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[root].\hyperlink{structkfs__dentry__s_a79fd3c8764d633fdb895b77856f61d61}{leaf};        \textcolor{comment}{// put new leaf in
       same level nodes list}
565         \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[root].\hyperlink{structkfs__dentry__s_a79fd3c8764d633fdb895b77856f61d61}{leaf} = leaf;                        \textcolor{comment}{// the beginning of the list of
       leafs}
566     \}
567 
568     \textcolor{keywordflow}{return} leaf;                                            \textcolor{comment}{// return the found or created leaf}
569 \}
\end{DoxyCode}
\hypertarget{kfs_8h_a2f522cb4edeecd6cbcebcca31d90bc75}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-owner@{kfs\-\_\-owner}}
\index{kfs\-\_\-owner@{kfs\-\_\-owner}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-owner}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-owner (
\begin{DoxyParamCaption}
\item[{int}]{inode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a2f522cb4edeecd6cbcebcca31d90bc75}


References kfs\-\_\-inode\-\_\-s\-::owner.



Referenced by kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
148 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_adecb12117172ae213c9d659ffbcd809b}{owner};\}
\end{DoxyCode}
\hypertarget{kfs_8h_afdc75626536d311fb2fe47baef24ef55}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-page@{kfs\-\_\-page}}
\index{kfs\-\_\-page@{kfs\-\_\-page}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-page}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-page (
\begin{DoxyParamCaption}
\item[{int}]{inode, }
\item[{int}]{pg\-\_\-offset}
\end{DoxyParamCaption}
)}}\label{kfs_8h_afdc75626536d311fb2fe47baef24ef55}


References kfs\-\_\-fmap(), kfs\-\_\-size(), Kfs\-Fmap, and kfs\-\_\-inode\-\_\-s\-::page.



Referenced by kfs\-\_\-print\-\_\-dentry(), and kfs\-\_\-read().


\begin{DoxyCode}
377 \{
378     \textcolor{keywordtype}{int} \hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size} = \hyperlink{kfs_8c_a2e7cb7a15052f57bdff8a2c1146bc072}{kfs\_size}(inode);                             \textcolor{comment}{// real size of file}
379     \textcolor{keywordflow}{if} ((size==0) || (pg\_offset > size>>12)) \textcolor{keywordflow}{return} -1;     \textcolor{comment}{// if pg\_offset is > than the nb of page}
380     \textcolor{keywordflow}{if} (pg\_offset < 12) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_aea74f0e1495f40cf25e36f8963b84e8b}{page}[pg\_offset];\textcolor{comment}{// page is referenced by inode}
381     pg\_offset -= 12;                                        \textcolor{comment}{// all others are in fmaps}
382     \textcolor{keywordtype}{int} map1 = \hyperlink{kfs_8c_af148b22d686f5b43341249ba9d03eb54}{kfs\_fmap}(inode);                             \textcolor{comment}{// get the first level}
383     \textcolor{keywordflow}{if} (size <= 28<<12) \textcolor{keywordflow}{return} \hyperlink{kfs_8c_adfe2302bd3dfd42413c478b8a32174cb}{KfsFmap}[map1][pg\_offset];    \textcolor{comment}{// if size is <= 28 pages, then 1 level}
384     \textcolor{keywordtype}{int} map2 = \hyperlink{kfs_8c_adfe2302bd3dfd42413c478b8a32174cb}{KfsFmap}[map1][pg\_offset/16];                 \textcolor{comment}{// else get the second  level}
385     \textcolor{keywordflow}{return} \hyperlink{kfs_8c_adfe2302bd3dfd42413c478b8a32174cb}{KfsFmap}[map2][pg\_offset%16];                     \textcolor{comment}{// then get the page}
386 \}
\end{DoxyCode}
\hypertarget{kfs_8h_a4170ece7c39eacb7c0ce15c891d2515f}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-read@{kfs\-\_\-read}}
\index{kfs\-\_\-read@{kfs\-\_\-read}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-read (
\begin{DoxyParamCaption}
\item[{int}]{dentry, }
\item[{int}]{pg\-\_\-offset, }
\item[{int $\ast$}]{buf}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a4170ece7c39eacb7c0ce15c891d2515f}


Reads a file, it reads one page from the file dentry to memory buffer. After reading, buffer will contain the entire page of which the offset belongs. 


\begin{DoxyParams}{Parameters}
{\em dentry} & given by open or openat \\
\hline
{\em pg\-\_\-offset} & is the page of the file to be read, if offset == -\/1 then the item or page placed just after the previous one read \\
\hline
{\em buffer} & to put the read page or filename (at least one page length) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
for a file the number of pages read \-: 1 if success with page in buffer as a side effect, 0 if file smaller than offset, -\/1 if something is wrong
\end{DoxyReturn}
Try to read an entire page (4ki\-B) from file dentry 

References kfs\-\_\-inode(), kfs\-\_\-page(), and kfs\-\_\-read\-\_\-page().



Referenced by dummy\-\_\-disk(), kfs\-\_\-print\-\_\-files(), and split().


\begin{DoxyCode}
590 \{
591     \textcolor{keywordtype}{int} page = \hyperlink{kfs_8c_afdc75626536d311fb2fe47baef24ef55}{kfs\_page} (\hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\_inode} (dentry), pg\_offset);     \textcolor{comment}{// get the page number in the
       disk}
592     \textcolor{keywordflow}{if} (page == -1) \textcolor{keywordflow}{return} 0;                               \textcolor{comment}{// if outside of the file}
593     \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a23a78b350153b3b7ae5ca00a1de7484a}{kfs\_read\_page} (buf, page);                       \textcolor{comment}{// at last read disk page to buf}
594 \}
\end{DoxyCode}
\hypertarget{kfs_8h_ab4ddfac90903634778ced7fb2105c50d}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-readdir@{kfs\-\_\-readdir}}
\index{kfs\-\_\-readdir@{kfs\-\_\-readdir}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-readdir}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-readdir (
\begin{DoxyParamCaption}
\item[{int}]{root, }
\item[{int}]{leaf, }
\item[{void $\ast$}]{buf}
\end{DoxyParamCaption}
)}}\label{kfs_8h_ab4ddfac90903634778ced7fb2105c50d}


Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading, buffer will contain the name of the directory or item. 


\begin{DoxyParams}{Parameters}
{\em dentry} & given by open or openat \\
\hline
{\em leaf} & is a dentry of an item present in the directory if leaf == -\/1 then the item is the one placed just after the previous one read \\
\hline
{\em buffer} & to put the filename \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
next dentry to read or -\/1 if something is wrong
\end{DoxyReturn}
readdir reads all entries in a directory 

References kfs\-\_\-isdir(), kfs\-\_\-strcpy(), kfs\-\_\-dentry\-\_\-s\-::leaf, and kfs\-\_\-dentry\-\_\-s\-::next.



Referenced by kfs\-\_\-tree\-\_\-cb\-\_\-r().


\begin{DoxyCode}
575 \{
576     \textcolor{keywordflow}{if} (!\hyperlink{kfs_8c_ac2308b1a426032672fbacdde9ee5ac81}{kfs\_isdir}(root)) \textcolor{keywordflow}{return} -1;                        \textcolor{comment}{// root dentry must be a directory}
577 
578     \textcolor{keywordflow}{if} (buf) \hyperlink{kfs_8c_aceb626dd864e7f2ccd7901d0506dbaf4}{kfs\_strcpy} (buf, \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].name);        \textcolor{comment}{// if asked, get this leaf
       dentry name}
579     \textcolor{keywordflow}{if} (leaf == root)                                       \textcolor{comment}{// at first, leaf is the root}
580         \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[root].\hyperlink{structkfs__dentry__s_a79fd3c8764d633fdb895b77856f61d61}{leaf};                        \textcolor{comment}{// get the first leaf thus 0 if
       empty}
581 
582     \textcolor{keywordflow}{if} (\hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].root != root) \textcolor{keywordflow}{return} -1;            \textcolor{comment}{// leaf must be in root directory}
583     \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[leaf].\hyperlink{structkfs__dentry__s_a17c6495def8c6564de45ab64cbc49066}{next};                            \textcolor{comment}{// find and return next leaf (0 if
       last)}
584 \}
\end{DoxyCode}
\hypertarget{kfs_8h_a75c287df9bc137651846c3766c294fb5}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-remove@{kfs\-\_\-remove}}
\index{kfs\-\_\-remove@{kfs\-\_\-remove}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-remove}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-remove (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{full\-\_\-pathname}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a75c287df9bc137651846c3766c294fb5}


removes a file or a directory 


\begin{DoxyParams}{Parameters}
{\em pathname} & is the absolute name of the file or directory to find in root \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
dentry index of the file or directory, that is the file descriptor or -\/1 on failure 
\end{DoxyReturn}
\hypertarget{kfs_8h_ade5bf93265bc86a9ecd5019cc6e3d277}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-root@{kfs\-\_\-root}}
\index{kfs\-\_\-root@{kfs\-\_\-root}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-root}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-root (
\begin{DoxyParamCaption}
\item[{int}]{dentry}
\end{DoxyParamCaption}
)}}\label{kfs_8h_ade5bf93265bc86a9ecd5019cc6e3d277}


read access functions to dentries 


\begin{DoxyParams}{Parameters}
{\em index} & of a dentry \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/ a dentry number for \hyperlink{kfs_8c_ade5bf93265bc86a9ecd5019cc6e3d277}{kfs\-\_\-root()}, \hyperlink{kfs_8c_a3be0d586ff3044979a3c381137d77d47}{kfs\-\_\-next()}, \hyperlink{kfs_8c_a135f3848117282c89e3be09b930eb9de}{kfs\-\_\-leaf()}. For these three functions, 0 means either file system root '/' or last leaf
\begin{DoxyItemize}
\item the inode number for \hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\-\_\-inode()}, there is always one
\item the pointer to the entry name for \hyperlink{kfs_8c_a9d837cb422897570c876a655c0b762be}{kfs\-\_\-name()} 
\end{DoxyItemize}
\end{DoxyReturn}


References kfs\-\_\-dentry\-\_\-s\-::root.



Referenced by kfs\-\_\-absolute\-\_\-pathname(), and kfs\-\_\-print\-\_\-dentry().


\begin{DoxyCode}
136 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_aed21f3f5ab2de70ab3416afe6dd9e4d4}{root} ;\}
\end{DoxyCode}
\hypertarget{kfs_8h_a491e452cdf42853498249aadc91eb74b}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-set\-\_\-size@{kfs\-\_\-set\-\_\-size}}
\index{kfs\-\_\-set\-\_\-size@{kfs\-\_\-set\-\_\-size}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-set\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-set\-\_\-size (
\begin{DoxyParamCaption}
\item[{int}]{dentry, }
\item[{int}]{newsize}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a491e452cdf42853498249aadc91eb74b}


Sets the size field of the inode associated with the dentry to newsize. 


\begin{DoxyParams}{Parameters}
{\em dentry} & given by open or openat \\
\hline
{\em newsize} & new size of the file \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
int \-: the size of the file after modification 
\end{DoxyReturn}


References kfs\-\_\-inode(), kfs\-\_\-size(), and kfs\-\_\-inode\-\_\-s\-::size.



Referenced by add\-\_\-new\-\_\-file(), and dummy\-\_\-disk().


\begin{DoxyCode}
601 \{
602     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} inode = \hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\_inode}(dentry);                \textcolor{comment}{// get inode associated with the dentry}
603     \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_ae4c3aa6d76cc8e92a9b29c2b3707f473}{size} = newsize;                 \textcolor{comment}{// set the new size}
604 
605     \textcolor{keywordflow}{return} \hyperlink{kfs_8c_a2e7cb7a15052f57bdff8a2c1146bc072}{kfs\_size}(inode);
606 \}
\end{DoxyCode}
\hypertarget{kfs_8h_a2e7cb7a15052f57bdff8a2c1146bc072}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-size@{kfs\-\_\-size}}
\index{kfs\-\_\-size@{kfs\-\_\-size}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-size (
\begin{DoxyParamCaption}
\item[{int}]{inode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a2e7cb7a15052f57bdff8a2c1146bc072}


References kfs\-\_\-inode\-\_\-s\-::size.



Referenced by kfs\-\_\-page(), kfs\-\_\-print\-\_\-dentry(), kfs\-\_\-print\-\_\-files(), kfs\-\_\-set\-\_\-size(), and split().


\begin{DoxyCode}
147 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_ae4c3aa6d76cc8e92a9b29c2b3707f473}{size}; \}
\end{DoxyCode}
\hypertarget{kfs_8h_a6c6336c1d084cc8a1dbc78c792099c4c}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-tree\-\_\-cb@{kfs\-\_\-tree\-\_\-cb}}
\index{kfs\-\_\-tree\-\_\-cb@{kfs\-\_\-tree\-\_\-cb}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-tree\-\_\-cb}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-tree\-\_\-cb (
\begin{DoxyParamCaption}
\item[{int}]{root, }
\item[{void($\ast$)(int dentry, int depth, int position)}]{callback}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a6c6336c1d084cc8a1dbc78c792099c4c}


calls the callback function on each entry from root dentry 


\begin{DoxyParams}{Parameters}
{\em root} & is the dentry for which the recursion begins \\
\hline
{\em callback} & is a provided function which will be called on each dentry
\begin{DoxyItemize}
\item dentry is the current entry in this directory which can be of any type
\item depth gives the callback() function information about the depth of the recursion. the depth of the root is 0, then the first level is 1, etc.
\item position is the current position in the current directory (0, 1, etc.) 
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of calls of the callback function 
\end{DoxyReturn}
\hypertarget{kfs_8h_a8d546cf291d26ab01a150b74cc206ae1}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-type@{kfs\-\_\-type}}
\index{kfs\-\_\-type@{kfs\-\_\-type}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-type}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-type (
\begin{DoxyParamCaption}
\item[{int}]{inode}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a8d546cf291d26ab01a150b74cc206ae1}


References kfs\-\_\-inode\-\_\-s\-::type.



Referenced by kfs\-\_\-print\-\_\-dentry(), kfs\-\_\-print\-\_\-files(), and split().


\begin{DoxyCode}
145 \{\textcolor{keywordflow}{return} \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_ac894cd2c4c9d7e6409c3302d1edec307}{type}; \}
\end{DoxyCode}
\hypertarget{kfs_8h_a46783800e799435356d388150e2a5cec}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-unlink@{kfs\-\_\-unlink}}
\index{kfs\-\_\-unlink@{kfs\-\_\-unlink}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-unlink}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-unlink (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{name}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a46783800e799435356d388150e2a5cec}


References kfs\-\_\-inode\-\_\-s\-::fmap, kfs\-\_\-dentry\-\_\-s\-::inode, kfs\-\_\-free\-\_\-dentry(), kfs\-\_\-free\-\_\-fmap(), kfs\-\_\-free\-\_\-inode(), kfs\-\_\-free\-\_\-page(), kfs\-\_\-open(), Kfs\-Fmap, kfs\-\_\-inode\-\_\-s\-::page, and kfs\-\_\-inode\-\_\-s\-::size.


\begin{DoxyCode}
648 \{
649     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} dentry = \hyperlink{kfs_8c_ac7986c65e8710a8b55857582e62ccc78}{kfs\_open} (name);
650     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} inode = \hyperlink{kfs_8c_a4c9c9ecc30db3a783a700f4e79f9561e}{KfsDentry}[dentry].\hyperlink{structkfs__dentry__s_a4e87e5375dfccc972eae6a05bfa2a086}{inode};
651     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} \hyperlink{structfdt__reserve__entry_ace12399f157bc46877fbcddec98da67e}{size} = \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_ae4c3aa6d76cc8e92a9b29c2b3707f473}{size};
652     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} fmap1 = \hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_a6a491f8ad9c0ea78d30421be44931e9b}{fmap};
653     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} fmap2 = 0;
654     \hyperlink{kfs_8c_a0c0a490ab7fa397be6c764a935cc5ea4}{u32\_t} freemap=0;
655     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} * ppage;
656 
657     \hyperlink{kfs_8c_a5d172bef33b255bfe7ec0375abac988e}{kfs\_free\_dentry} (dentry);
658 
659     \textcolor{keywordflow}{if} (\hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].count-- == 0) \{
660         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} s = size, p = 0; s > 0; s -= 1<<12, p++)\{
661             \textcolor{keywordflow}{if} (p < 12) \{
662                 ppage = &(\hyperlink{kfs_8c_ace1088077311b5b6a4d2fa6d330f4ccf}{KfsInode}[inode].\hyperlink{structkfs__inode__s_aea74f0e1495f40cf25e36f8963b84e8b}{page}[p]);
663             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (size <= (28<<12)) \{
664                 ppage = &(\hyperlink{kfs_8c_adfe2302bd3dfd42413c478b8a32174cb}{KfsFmap}[fmap1][p-12]);
665                 \textcolor{keywordflow}{if} (p == size>>12) freemap=1;
666             \} \textcolor{keywordflow}{else} \{
667                 fmap2 = \hyperlink{kfs_8c_adfe2302bd3dfd42413c478b8a32174cb}{KfsFmap}[fmap1][(p-12)/16];
668                 ppage = &(\hyperlink{kfs_8c_adfe2302bd3dfd42413c478b8a32174cb}{KfsFmap}[fmap2][(p-12)%16]);
669                 \textcolor{keywordflow}{if} ((p-12)%16 == 15) freemap=2;
670                 \textcolor{keywordflow}{if} (p == size>>12) freemap=3;
671             \}
672             \hyperlink{kfs_8c_ac364ca8f5189a2eaf2f7cbeef0a27698}{kfs\_free\_page} (*ppage);
673             \textcolor{keywordflow}{if} (freemap & 1) \hyperlink{kfs_8c_a2b773f0350f13077e1479fe36941da52}{kfs\_free\_fmap}(fmap1);
674             \textcolor{keywordflow}{if} (freemap & 2) \hyperlink{kfs_8c_a2b773f0350f13077e1479fe36941da52}{kfs\_free\_fmap}(fmap2);
675         \}
676         \hyperlink{kfs_8c_aadbe9ab58b58e9826dd4da1384c80798}{kfs\_free\_inode} (inode);
677     \}
678     \textcolor{keywordflow}{return} 0;
679 \}
\end{DoxyCode}
\hypertarget{kfs_8h_a4ed044e75ea35d5cffd2ee5426e1db38}{\index{kfs.\-h@{kfs.\-h}!kfs\-\_\-write@{kfs\-\_\-write}}
\index{kfs\-\_\-write@{kfs\-\_\-write}!kfs.h@{kfs.\-h}}
\subsubsection[{kfs\-\_\-write}]{\setlength{\rightskip}{0pt plus 5cm}int kfs\-\_\-write (
\begin{DoxyParamCaption}
\item[{int}]{dentry, }
\item[{int}]{pg\-\_\-offset, }
\item[{void $\ast$}]{buffer}
\end{DoxyParamCaption}
)}}\label{kfs_8h_a4ed044e75ea35d5cffd2ee5426e1db38}


Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of which the offset belongs. 


\begin{DoxyParams}{Parameters}
{\em dentry} & given by open or openat \\
\hline
{\em pg\-\_\-offset} & is the number of the page that will be written \\
\hline
{\em buffer} & contains the page to write (at least one page length) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the number of pages written 1 if success with page in disk as a side effect, 0 if success but buffer was full of 0, thus no page needs to be allocated -\/1 if something is wrong 
\end{DoxyReturn}


References kfs\-\_\-alloc\-\_\-page(), kfs\-\_\-free\-\_\-page(), kfs\-\_\-inode(), kfs\-\_\-ppage(), kfs\-\_\-write\-\_\-page(), and N\-U\-L\-L.



Referenced by add\-\_\-new\-\_\-file(), and dummy\-\_\-disk().


\begin{DoxyCode}
618 \{
619     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} inode = \hyperlink{kfs_8c_aae206d59d8bc4514d34dafdff1198ede}{kfs\_inode}(dentry);                \textcolor{comment}{// get inode associated with the dentry}
620     \hyperlink{kfs_8c_afc6499c1f28697aa3bfc2804d496fd11}{u16\_t} *ppage = \hyperlink{kfs_8c_a200e5373e6e2968ecc37495280d658c7}{kfs\_ppage} (inode, pg\_offset);    \textcolor{comment}{// get addr in fmaps of page number
       (alloc fmap)}
621     \textcolor{keywordflow}{if} (ppage == \hyperlink{kfs_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) \textcolor{keywordflow}{return} -1;                   \textcolor{comment}{// NULL means no more space in fmaps}
622     \textcolor{keywordflow}{if} (*ppage == 0) *ppage = \hyperlink{kfs_8c_a53fd0386d2feed317c9d6bdc536e4540}{kfs\_alloc\_page}();     \textcolor{comment}{// if page absent, allocate a new page}
623     \textcolor{keywordflow}{if} (*ppage == 0) \textcolor{keywordflow}{return} -1;                     \textcolor{comment}{// 0 means no more space on the disk}
624     \textcolor{keywordflow}{if} (\hyperlink{kfs_8c_a82cd5257064f4d5b995d6951b9f054b3}{kfs\_write\_page} (buf, *ppage)) \textcolor{keywordflow}{return} 1;     \textcolor{comment}{// at last write disk page from buf}
625     \hyperlink{kfs_8c_ac364ca8f5189a2eaf2f7cbeef0a27698}{kfs\_free\_page} (*ppage);                         \textcolor{comment}{// if returns 0, it means page full of 0}
626     \textcolor{keywordflow}{return} *ppage = 0;                              \textcolor{comment}{// erase page number in fmap;}
627 \}
\end{DoxyCode}
