\hypertarget{icu_2plic_8c}{\section{/users/enseig/franck/ko6/src/soft/hal/devices/icu/plic.c File Reference}
\label{icu_2plic_8c}\index{/users/enseig/franck/ko6/src/soft/hal/devices/icu/plic.\-c@{/users/enseig/franck/ko6/src/soft/hal/devices/icu/plic.\-c}}
}
{\ttfamily \#include $<$hal/devices/icu/plic.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{icu_2plic_8c_aefabcdd14d84e1f63af7148dfa52b71d}{plic\-\_\-init} (struct \hyperlink{structicu__s}{icu\-\_\-s} $\ast$icu, unsigned address)
\begin{DoxyCompactList}\small\item\em Initialize P\-L\-I\-C device. \end{DoxyCompactList}\item 
static unsigned \hyperlink{icu_2plic_8c_a89c6ae0cdbceef55cbc56f9316a0bafd}{plic\-\_\-get\-\_\-highest} (struct \hyperlink{structicu__s}{icu\-\_\-s} $\ast$icu)
\begin{DoxyCompactList}\small\item\em Get the highest priority I\-R\-Q triggered (mclaim register of the P\-L\-I\-C)$\ast$. \end{DoxyCompactList}\item 
static void \hyperlink{icu_2plic_8c_a26373ab6357519cd3e96d2e767b18545}{plic\-\_\-set\-\_\-priority} (struct \hyperlink{structicu__s}{icu\-\_\-s} $\ast$icu, unsigned irq, unsigned pri)
\begin{DoxyCompactList}\small\item\em Set I\-R\-Q priority. \end{DoxyCompactList}\item 
static void \hyperlink{icu_2plic_8c_a41aa32cb7394b1f5287c731ffedeff07}{plic\-\_\-acknowledge} (struct \hyperlink{structicu__s}{icu\-\_\-s} $\ast$icu, unsigned irq)
\begin{DoxyCompactList}\small\item\em Acknowledge the I\-R\-Q (write the I\-R\-Q no in the M\-C\-L\-A\-I\-M register) \end{DoxyCompactList}\item 
static void \hyperlink{icu_2plic_8c_a02dfa101bcea2e86f47f586b109edea1}{plic\-\_\-unmask} (struct \hyperlink{structicu__s}{icu\-\_\-s} $\ast$icu, unsigned irq)
\begin{DoxyCompactList}\small\item\em Unmask the I\-R\-Q (enable it), (write 1 in the corresponding M\-E\-N\-A\-B\-L\-E bit) \end{DoxyCompactList}\item 
static void \hyperlink{icu_2plic_8c_abd52b5fa6d62cd75f89d1634950c7afa}{plic\-\_\-mask} (struct \hyperlink{structicu__s}{icu\-\_\-s} $\ast$icu, unsigned irq)
\begin{DoxyCompactList}\small\item\em Mask the I\-R\-Q (disable it), (write 0 in the corresponding M\-E\-N\-A\-B\-L\-E bit) \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structicu__ops__s}{icu\-\_\-ops\-\_\-s} \hyperlink{icu_2plic_8c_a0daeb7589a4979ebe7c0ff070de2fafe}{Plic\-Ops}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{icu_2plic_8c_a41aa32cb7394b1f5287c731ffedeff07}{\index{icu/plic.\-c@{icu/plic.\-c}!plic\-\_\-acknowledge@{plic\-\_\-acknowledge}}
\index{plic\-\_\-acknowledge@{plic\-\_\-acknowledge}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{plic\-\_\-acknowledge}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-acknowledge (
\begin{DoxyParamCaption}
\item[{struct {\bf icu\-\_\-s} $\ast$}]{icu, }
\item[{unsigned}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{icu_2plic_8c_a41aa32cb7394b1f5287c731ffedeff07}


Acknowledge the I\-R\-Q (write the I\-R\-Q no in the M\-C\-L\-A\-I\-M register) 


\begin{DoxyParams}{Parameters}
{\em icu} & icu device \\
\hline
{\em irq} & target irq \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References icu\-\_\-s\-::address, cpuid, and P\-L\-I\-C\-\_\-\-M\-C\-L\-A\-I\-M.


\begin{DoxyCode}
55 \{
56     *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a0cf3ff3184233bd489b4c55de020b169}{PLIC\_MCLAIM}(icu->\hyperlink{structicu__s_a4ad14d6fcd630faa41a55ed2037bcf8f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}()) = irq;
57 \}
\end{DoxyCode}
\hypertarget{icu_2plic_8c_a89c6ae0cdbceef55cbc56f9316a0bafd}{\index{icu/plic.\-c@{icu/plic.\-c}!plic\-\_\-get\-\_\-highest@{plic\-\_\-get\-\_\-highest}}
\index{plic\-\_\-get\-\_\-highest@{plic\-\_\-get\-\_\-highest}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{plic\-\_\-get\-\_\-highest}]{\setlength{\rightskip}{0pt plus 5cm}static unsigned plic\-\_\-get\-\_\-highest (
\begin{DoxyParamCaption}
\item[{struct {\bf icu\-\_\-s} $\ast$}]{icu}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{icu_2plic_8c_a89c6ae0cdbceef55cbc56f9316a0bafd}


Get the highest priority I\-R\-Q triggered (mclaim register of the P\-L\-I\-C)$\ast$. 


\begin{DoxyParams}{Parameters}
{\em icu} & icu device \\
\hline
\end{DoxyParams}


References icu\-\_\-s\-::address, cpuid, and P\-L\-I\-C\-\_\-\-M\-C\-L\-A\-I\-M.


\begin{DoxyCode}
32 \{
33     \textcolor{keywordflow}{return} *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a0cf3ff3184233bd489b4c55de020b169}{PLIC\_MCLAIM}(icu->\hyperlink{structicu__s_a4ad14d6fcd630faa41a55ed2037bcf8f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}());
34 \}
\end{DoxyCode}
\hypertarget{icu_2plic_8c_aefabcdd14d84e1f63af7148dfa52b71d}{\index{icu/plic.\-c@{icu/plic.\-c}!plic\-\_\-init@{plic\-\_\-init}}
\index{plic\-\_\-init@{plic\-\_\-init}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{plic\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-init (
\begin{DoxyParamCaption}
\item[{struct {\bf icu\-\_\-s} $\ast$}]{icu, }
\item[{unsigned}]{address}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{icu_2plic_8c_aefabcdd14d84e1f63af7148dfa52b71d}


Initialize P\-L\-I\-C device. 


\begin{DoxyParams}{Parameters}
{\em icu} & icu device to initialize \\
\hline
{\em address} & address of the physical device \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References icu\-\_\-s\-::address, icu\-\_\-s\-::ops, and Plic\-Ops.


\begin{DoxyCode}
22 \{
23     icu->\hyperlink{structicu__s_a7f989a94a922fa1c782cfcf7547bd8c5}{ops}        = &\hyperlink{icu_2plic_8c_a0daeb7589a4979ebe7c0ff070de2fafe}{PlicOps};
24     icu->\hyperlink{structicu__s_a4ad14d6fcd630faa41a55ed2037bcf8f}{address}    = address;
25 \}
\end{DoxyCode}
\hypertarget{icu_2plic_8c_abd52b5fa6d62cd75f89d1634950c7afa}{\index{icu/plic.\-c@{icu/plic.\-c}!plic\-\_\-mask@{plic\-\_\-mask}}
\index{plic\-\_\-mask@{plic\-\_\-mask}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{plic\-\_\-mask}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-mask (
\begin{DoxyParamCaption}
\item[{struct {\bf icu\-\_\-s} $\ast$}]{icu, }
\item[{unsigned}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{icu_2plic_8c_abd52b5fa6d62cd75f89d1634950c7afa}


Mask the I\-R\-Q (disable it), (write 0 in the corresponding M\-E\-N\-A\-B\-L\-E bit) 


\begin{DoxyParams}{Parameters}
{\em icu} & icu device \\
\hline
{\em irq} & target irq \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References icu\-\_\-s\-::address, cpuid, and P\-L\-I\-C\-\_\-\-M\-E\-N\-A\-B\-L\-E.


\begin{DoxyCode}
78 \{
79     \textcolor{keywordtype}{unsigned} j = irq % 32;
80     *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a8212cf7e47e4480422b7b2e5f749690e}{PLIC\_MENABLE}(icu->\hyperlink{structicu__s_a4ad14d6fcd630faa41a55ed2037bcf8f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}(), irq) &= ~(1 << j);
81 \}
\end{DoxyCode}
\hypertarget{icu_2plic_8c_a26373ab6357519cd3e96d2e767b18545}{\index{icu/plic.\-c@{icu/plic.\-c}!plic\-\_\-set\-\_\-priority@{plic\-\_\-set\-\_\-priority}}
\index{plic\-\_\-set\-\_\-priority@{plic\-\_\-set\-\_\-priority}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{plic\-\_\-set\-\_\-priority}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-set\-\_\-priority (
\begin{DoxyParamCaption}
\item[{struct {\bf icu\-\_\-s} $\ast$}]{icu, }
\item[{unsigned}]{irq, }
\item[{unsigned}]{pri}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{icu_2plic_8c_a26373ab6357519cd3e96d2e767b18545}


Set I\-R\-Q priority. 


\begin{DoxyParams}{Parameters}
{\em icu} & icu device \\
\hline
{\em irq} & target irq \\
\hline
{\em pri} & the new irq priority \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References icu\-\_\-s\-::address, and P\-L\-I\-C\-\_\-\-P\-R\-I\-\_\-\-O\-F\-F\-S\-E\-T.


\begin{DoxyCode}
44 \{
45     ((\textcolor{keywordtype}{unsigned}*)icu->\hyperlink{structicu__s_a4ad14d6fcd630faa41a55ed2037bcf8f}{address} + \hyperlink{icu_2plic_8h_a5fe86b468659fd6dd675104312618a0d}{PLIC\_PRI\_OFFSET})[irq] = pri;
46 \}
\end{DoxyCode}
\hypertarget{icu_2plic_8c_a02dfa101bcea2e86f47f586b109edea1}{\index{icu/plic.\-c@{icu/plic.\-c}!plic\-\_\-unmask@{plic\-\_\-unmask}}
\index{plic\-\_\-unmask@{plic\-\_\-unmask}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{plic\-\_\-unmask}]{\setlength{\rightskip}{0pt plus 5cm}static void plic\-\_\-unmask (
\begin{DoxyParamCaption}
\item[{struct {\bf icu\-\_\-s} $\ast$}]{icu, }
\item[{unsigned}]{irq}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{icu_2plic_8c_a02dfa101bcea2e86f47f586b109edea1}


Unmask the I\-R\-Q (enable it), (write 1 in the corresponding M\-E\-N\-A\-B\-L\-E bit) 


\begin{DoxyParams}{Parameters}
{\em icu} & icu device \\
\hline
{\em irq} & target irq \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References icu\-\_\-s\-::address, cpuid, and P\-L\-I\-C\-\_\-\-M\-E\-N\-A\-B\-L\-E.


\begin{DoxyCode}
66 \{
67     \textcolor{keywordtype}{unsigned} j = irq % 32;
68     *(\textcolor{keywordtype}{unsigned}*) \hyperlink{icu_2plic_8h_a8212cf7e47e4480422b7b2e5f749690e}{PLIC\_MENABLE}(icu->\hyperlink{structicu__s_a4ad14d6fcd630faa41a55ed2037bcf8f}{address}, \hyperlink{mips_2cpuregs_8S_a78a056c2e0d1097b3c4d7e569b8cdc0a}{cpuid}(), irq) |= (1 << j);
69 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{icu_2plic_8c_a0daeb7589a4979ebe7c0ff070de2fafe}{\index{icu/plic.\-c@{icu/plic.\-c}!Plic\-Ops@{Plic\-Ops}}
\index{Plic\-Ops@{Plic\-Ops}!icu/plic.c@{icu/plic.\-c}}
\subsubsection[{Plic\-Ops}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf icu\-\_\-ops\-\_\-s} Plic\-Ops}}\label{icu_2plic_8c_a0daeb7589a4979ebe7c0ff070de2fafe}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
    .icu\_acknowledge = \hyperlink{icu_2plic_8c_a41aa32cb7394b1f5287c731ffedeff07}{plic\_acknowledge},
    .icu\_get\_highest = \hyperlink{icu_2plic_8c_a89c6ae0cdbceef55cbc56f9316a0bafd}{plic\_get\_highest},
    .icu\_init = \hyperlink{icu_2plic_8c_aefabcdd14d84e1f63af7148dfa52b71d}{plic\_init},
    .icu\_mask = \hyperlink{icu_2plic_8c_abd52b5fa6d62cd75f89d1634950c7afa}{plic\_mask},
    .icu\_set\_priority = \hyperlink{icu_2plic_8c_a26373ab6357519cd3e96d2e767b18545}{plic\_set\_priority},
    .icu\_unmask = \hyperlink{icu_2plic_8c_a02dfa101bcea2e86f47f586b109edea1}{plic\_unmask}
\}
\end{DoxyCode}


Referenced by plic\-\_\-init(), and soc\-\_\-icu\-\_\-init().

