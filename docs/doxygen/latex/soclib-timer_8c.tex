\hypertarget{soclib-timer_8c}{\section{/users/enseig/franck/ko6/src/soft/hal/devices/timer/soclib-\/timer.c File Reference}
\label{soclib-timer_8c}\index{/users/enseig/franck/ko6/src/soft/hal/devices/timer/soclib-\/timer.\-c@{/users/enseig/franck/ko6/src/soft/hal/devices/timer/soclib-\/timer.\-c}}
}
{\ttfamily \#include $<$hal/devices/timer/soclib-\/timer.\-h$>$}\\*
{\ttfamily \#include $<$kernel/klibc.\-h$>$}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{soclib-timer_8c_ac2c8f389a9bd0b9ea95d53a94678a673}{soclib\-\_\-timer\-\_\-set\-\_\-tick} (struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer, unsigned tick)
\begin{DoxyCompactList}\small\item\em Set the number of ticks between two soclib timer interrupts. \end{DoxyCompactList}\item 
static void \hyperlink{soclib-timer_8c_a1405d0312746c5a3b462b789940cdfcf}{soclib\-\_\-timer\-\_\-init} (struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer, unsigned address, unsigned tick)
\begin{DoxyCompactList}\small\item\em soclib timer initialization \end{DoxyCompactList}\item 
static void \hyperlink{soclib-timer_8c_a7559ec7d6e01dd48142d752e543fc689}{soclib\-\_\-timer\-\_\-set\-\_\-event} (struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer, void($\ast$f)(void $\ast$arg), void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Set the event that will triggered by a soclib timer interrupt. \end{DoxyCompactList}\item 
void \hyperlink{soclib-timer_8c_ad4d0316e8dbbe5427118ba5a8a03f12d}{soclib\-\_\-timer\-\_\-isr} (unsigned irq, struct \hyperlink{structtimer__s}{timer\-\_\-s} $\ast$timer)
\begin{DoxyCompactList}\small\item\em I\-S\-R of the soclib timer device. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structtimer__ops__s}{timer\-\_\-ops\-\_\-s} \hyperlink{soclib-timer_8c_aa3f96a0578c32ac8fd0d3b2526182084}{Soclib\-Timer\-Ops}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{soclib-timer_8c_a1405d0312746c5a3b462b789940cdfcf}{\index{soclib-\/timer.\-c@{soclib-\/timer.\-c}!soclib\-\_\-timer\-\_\-init@{soclib\-\_\-timer\-\_\-init}}
\index{soclib\-\_\-timer\-\_\-init@{soclib\-\_\-timer\-\_\-init}!soclib-timer.c@{soclib-\/timer.\-c}}
\subsubsection[{soclib\-\_\-timer\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}static void soclib\-\_\-timer\-\_\-init (
\begin{DoxyParamCaption}
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer, }
\item[{unsigned}]{address, }
\item[{unsigned}]{tick}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{soclib-timer_8c_a1405d0312746c5a3b462b789940cdfcf}


soclib timer initialization 


\begin{DoxyParams}{Parameters}
{\em timer} & timer device to initialize \\
\hline
{\em address} & address of the device \\
\hline
{\em tick} & number of ticks between two interrupts \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-s\-::address, soclib\-\_\-timer\-\_\-regs\-\_\-s\-::mode, timer\-\_\-s\-::ops, soclib\-\_\-timer\-\_\-regs\-\_\-s\-::resetirq, soclib\-\_\-timer\-\_\-set\-\_\-tick(), and Soclib\-Timer\-Ops.


\begin{DoxyCode}
37 \{
38     timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address}  = address;
39     timer->\hyperlink{structtimer__s_a859db5220e0605eabaa9100121940b5e}{ops}      = &\hyperlink{soclib-timer_8c_aa3f96a0578c32ac8fd0d3b2526182084}{SoclibTimerOps};
40 
41     \textcolor{keyword}{struct }\hyperlink{structsoclib__timer__regs__s}{soclib\_timer\_regs\_s} *regs = 
42         (\textcolor{keyword}{struct }\hyperlink{structsoclib__timer__regs__s}{soclib\_timer\_regs\_s} *) timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address};
43     regs->\hyperlink{structsoclib__timer__regs__s_a63084f461aed6b427e0fcf6028e70ce0}{resetirq} = 1;                                 \textcolor{comment}{// to be sure there won't be a IRQ when
       timer start}
44     \hyperlink{soclib-timer_8c_ac2c8f389a9bd0b9ea95d53a94678a673}{soclib\_timer\_set\_tick}(timer, tick);                 \textcolor{comment}{// next period}
45 
46     regs->\hyperlink{structsoclib__timer__regs__s_a8f8b1e300fcf7423f473ace9fb4fff38}{mode} = (tick) ? 3 : 0;                        \textcolor{comment}{// timer ON with IRQ only if (tick != 0)}
47 \}
\end{DoxyCode}
\hypertarget{soclib-timer_8c_ad4d0316e8dbbe5427118ba5a8a03f12d}{\index{soclib-\/timer.\-c@{soclib-\/timer.\-c}!soclib\-\_\-timer\-\_\-isr@{soclib\-\_\-timer\-\_\-isr}}
\index{soclib\-\_\-timer\-\_\-isr@{soclib\-\_\-timer\-\_\-isr}!soclib-timer.c@{soclib-\/timer.\-c}}
\subsubsection[{soclib\-\_\-timer\-\_\-isr}]{\setlength{\rightskip}{0pt plus 5cm}void soclib\-\_\-timer\-\_\-isr (
\begin{DoxyParamCaption}
\item[{unsigned}]{irq, }
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer}
\end{DoxyParamCaption}
)}}\label{soclib-timer_8c_ad4d0316e8dbbe5427118ba5a8a03f12d}


I\-S\-R of the soclib timer device. 


\begin{DoxyParams}{Parameters}
{\em irq} & irq linked to the I\-S\-R \\
\hline
{\em timer} & device linked to the I\-S\-R \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-s\-::address, timer\-\_\-event\-\_\-s\-::arg, timer\-\_\-s\-::event, timer\-\_\-event\-\_\-s\-::f, and soclib\-\_\-timer\-\_\-regs\-\_\-s\-::resetirq.



Referenced by soc\-\_\-timer\-\_\-init().


\begin{DoxyCode}
69 \{
70     \textcolor{keyword}{struct }\hyperlink{structsoclib__timer__regs__s}{soclib\_timer\_regs\_s} *regs = 
71         (\textcolor{keyword}{struct }\hyperlink{structsoclib__timer__regs__s}{soclib\_timer\_regs\_s} *) timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address};
72     \textcolor{comment}{/* IRQ acknoledgement to lower the interrupt signal */}
73     regs->\hyperlink{structsoclib__timer__regs__s_a63084f461aed6b427e0fcf6028e70ce0}{resetirq} = 1;
74     
75     if (timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a894a5ffd0c1b40b31fd3b124f22a9ffa}{f})
76         timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a894a5ffd0c1b40b31fd3b124f22a9ffa}{f}(timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a0c8f6673a1d1e2ae4a8598f72a8e7576}{arg});
77 \}
\end{DoxyCode}
\hypertarget{soclib-timer_8c_a7559ec7d6e01dd48142d752e543fc689}{\index{soclib-\/timer.\-c@{soclib-\/timer.\-c}!soclib\-\_\-timer\-\_\-set\-\_\-event@{soclib\-\_\-timer\-\_\-set\-\_\-event}}
\index{soclib\-\_\-timer\-\_\-set\-\_\-event@{soclib\-\_\-timer\-\_\-set\-\_\-event}!soclib-timer.c@{soclib-\/timer.\-c}}
\subsubsection[{soclib\-\_\-timer\-\_\-set\-\_\-event}]{\setlength{\rightskip}{0pt plus 5cm}static void soclib\-\_\-timer\-\_\-set\-\_\-event (
\begin{DoxyParamCaption}
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer, }
\item[{void($\ast$)(void $\ast$arg)}]{f, }
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{soclib-timer_8c_a7559ec7d6e01dd48142d752e543fc689}


Set the event that will triggered by a soclib timer interrupt. 


\begin{DoxyParams}{Parameters}
{\em timer} & the timer device \\
\hline
{\em f} & the function corresponding to the event \\
\hline
{\em arg} & argument that will be passed to the function \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-event\-\_\-s\-::arg, timer\-\_\-s\-::event, and timer\-\_\-event\-\_\-s\-::f.


\begin{DoxyCode}
57 \{
58     timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a894a5ffd0c1b40b31fd3b124f22a9ffa}{f} = f;
59     timer->\hyperlink{structtimer__s_ad65ea18f2fc79735a86d6ba118933f5b}{event}.\hyperlink{structtimer__event__s_a0c8f6673a1d1e2ae4a8598f72a8e7576}{arg} = arg;
60 \}
\end{DoxyCode}
\hypertarget{soclib-timer_8c_ac2c8f389a9bd0b9ea95d53a94678a673}{\index{soclib-\/timer.\-c@{soclib-\/timer.\-c}!soclib\-\_\-timer\-\_\-set\-\_\-tick@{soclib\-\_\-timer\-\_\-set\-\_\-tick}}
\index{soclib\-\_\-timer\-\_\-set\-\_\-tick@{soclib\-\_\-timer\-\_\-set\-\_\-tick}!soclib-timer.c@{soclib-\/timer.\-c}}
\subsubsection[{soclib\-\_\-timer\-\_\-set\-\_\-tick}]{\setlength{\rightskip}{0pt plus 5cm}static void soclib\-\_\-timer\-\_\-set\-\_\-tick (
\begin{DoxyParamCaption}
\item[{struct {\bf timer\-\_\-s} $\ast$}]{timer, }
\item[{unsigned}]{tick}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{soclib-timer_8c_ac2c8f389a9bd0b9ea95d53a94678a673}


Set the number of ticks between two soclib timer interrupts. 


\begin{DoxyParams}{Parameters}
{\em timer} & timer device \\
\hline
{\em tick} & number of ticks \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


References timer\-\_\-s\-::address, and soclib\-\_\-timer\-\_\-regs\-\_\-s\-::period.



Referenced by soclib\-\_\-timer\-\_\-init().


\begin{DoxyCode}
23 \{
24     \textcolor{keyword}{struct }\hyperlink{structsoclib__timer__regs__s}{soclib\_timer\_regs\_s} *regs = 
25         (\textcolor{keyword}{struct }\hyperlink{structsoclib__timer__regs__s}{soclib\_timer\_regs\_s} *) timer->\hyperlink{structtimer__s_a269237a7467e8d2423d548750a772631}{address};
26     regs->\hyperlink{structsoclib__timer__regs__s_ad9bb0a6b31bd61f2fc040498f6358af6}{period} = tick;
27 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{soclib-timer_8c_aa3f96a0578c32ac8fd0d3b2526182084}{\index{soclib-\/timer.\-c@{soclib-\/timer.\-c}!Soclib\-Timer\-Ops@{Soclib\-Timer\-Ops}}
\index{Soclib\-Timer\-Ops@{Soclib\-Timer\-Ops}!soclib-timer.c@{soclib-\/timer.\-c}}
\subsubsection[{Soclib\-Timer\-Ops}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf timer\-\_\-ops\-\_\-s} Soclib\-Timer\-Ops}}\label{soclib-timer_8c_aa3f96a0578c32ac8fd0d3b2526182084}
{\bfseries Initial value\-:}
\begin{DoxyCode}
= \{
    .timer\_init = \hyperlink{soclib-timer_8c_a1405d0312746c5a3b462b789940cdfcf}{soclib\_timer\_init},
    .timer\_set\_event = \hyperlink{soclib-timer_8c_a7559ec7d6e01dd48142d752e543fc689}{soclib\_timer\_set\_event},
    .timer\_set\_tick = \hyperlink{soclib-timer_8c_ac2c8f389a9bd0b9ea95d53a94678a673}{soclib\_timer\_set\_tick}
\}
\end{DoxyCode}


Referenced by soc\-\_\-timer\-\_\-init(), and soclib\-\_\-timer\-\_\-init().

