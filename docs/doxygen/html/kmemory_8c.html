<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ko6: /users/enseig/franck/ko6/src/soft/kernel/kmemory.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo55.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ko6
   </div>
   <div id="projectbrief">ko6 (prononce it &#39;kit-O-sys&#39; O is  the letter not the number) is a small operating system for educationnal purpose</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8785740846211ac34fd04c61a1fdd888.html">soft</a></li><li class="navelem"><a class="el" href="dir_f1add7e60d3117fa5e9acdff1c3c9be3.html">kernel</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">kmemory.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="klibc_8h_source.html">kernel/klibc.h</a>&gt;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpage__s.html">page_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5ca59e07ccac5f97fd636413b47818e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>&#160;&#160;&#160;(char*)&amp;<a class="el" href="crt0_8c.html#ac56d62881d5ef8cb3152d3e4a697e46a">__bss_end</a>           /* kernel memory begin */</td></tr>
<tr class="separator:a5ca59e07ccac5f97fd636413b47818e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac8be82d7bffa1ad691b1bd5d24492ea"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#aac8be82d7bffa1ad691b1bd5d24492ea">kme</a>&#160;&#160;&#160;(char*)&amp;<a class="el" href="kmemory_8c.html#a869ed24619b20d01d0f6c457c069ec96">__kdata_end</a>         /* kernel memory end */</td></tr>
<tr class="separator:aac8be82d7bffa1ad691b1bd5d24492ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85a54e9787a16befde04a79fb6b83d96"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>(n)&#160;&#160;&#160;(((n)+<a class="el" href="memory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>-1)/<a class="el" href="memory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>)</td></tr>
<tr class="separator:a85a54e9787a16befde04a79fb6b83d96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87be89cfdd7a7fa303a8f146373124bc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a87be89cfdd7a7fa303a8f146373124bc">NBSTACK</a>&#160;&#160;&#160;10</td></tr>
<tr class="separator:a87be89cfdd7a7fa303a8f146373124bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac7c0e9f07b4717ffca845d3a530e7530"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structpage__s.html">page_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#ac7c0e9f07b4717ffca845d3a530e7530">page_t</a></td></tr>
<tr class="separator:ac7c0e9f07b4717ffca845d3a530e7530"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a34f25b1ca1556d0890274a971d46af10"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a34f25b1ca1556d0890274a971d46af10">memory_init</a> (void)</td></tr>
<tr class="memdesc:a34f25b1ca1556d0890274a971d46af10"><td class="mdescLeft">&#160;</td><td class="mdescRight">initialize all the kernel memory allocators  <a href="#a34f25b1ca1556d0890274a971d46af10">More...</a><br/></td></tr>
<tr class="separator:a34f25b1ca1556d0890274a971d46af10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f52d7c56b7d67dc2f96b2e93dfdc7be"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a> (size_t size)</td></tr>
<tr class="memdesc:a5f52d7c56b7d67dc2f96b2e93dfdc7be"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocate an object in the kernel address space  <a href="#a5f52d7c56b7d67dc2f96b2e93dfdc7be">More...</a><br/></td></tr>
<tr class="separator:a5f52d7c56b7d67dc2f96b2e93dfdc7be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64c1f767a18f26f8c8cabd0f82f3e04d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree</a> (void *obj, size_t size)</td></tr>
<tr class="memdesc:a64c1f767a18f26f8c8cabd0f82f3e04d"><td class="mdescLeft">&#160;</td><td class="mdescRight">free an allocated object with <a class="el" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be" title="allocate an object in the kernel address space ">kmalloc()</a>  <a href="#a64c1f767a18f26f8c8cabd0f82f3e04d">More...</a><br/></td></tr>
<tr class="separator:a64c1f767a18f26f8c8cabd0f82f3e04d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71239547b3491efafadee92180ba2b02"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a71239547b3491efafadee92180ba2b02">kmalloc_print</a> (void)</td></tr>
<tr class="memdesc:a71239547b3491efafadee92180ba2b02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print data about slab allocator usage.  <a href="#a71239547b3491efafadee92180ba2b02">More...</a><br/></td></tr>
<tr class="separator:a71239547b3491efafadee92180ba2b02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cfd6b96caef4efda19f082f3ef8cd2d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test</a> (size_t turn, size_t size)</td></tr>
<tr class="memdesc:a6cfd6b96caef4efda19f082f3ef8cd2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test Slab alocator, allocates and frees as many values as 'turn' then free all test.  <a href="#a6cfd6b96caef4efda19f082f3ef8cd2d">More...</a><br/></td></tr>
<tr class="separator:a6cfd6b96caef4efda19f082f3ef8cd2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3736b4c8c3376c224d8a70e39b1a017"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#ad3736b4c8c3376c224d8a70e39b1a017">sbrk</a> (int increment)</td></tr>
<tr class="memdesc:ad3736b4c8c3376c224d8a70e39b1a017"><td class="mdescLeft">&#160;</td><td class="mdescRight">change the boundary of the heap  <a href="#ad3736b4c8c3376c224d8a70e39b1a017">More...</a><br/></td></tr>
<tr class="separator:ad3736b4c8c3376c224d8a70e39b1a017"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ce77af8c704a7d3f2204f94750daedb"><td class="memItemLeft" align="right" valign="top">int *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a2ce77af8c704a7d3f2204f94750daedb">malloc_ustack</a> (void)</td></tr>
<tr class="memdesc:a2ce77af8c704a7d3f2204f94750daedb"><td class="mdescLeft">&#160;</td><td class="mdescRight">allocate a new user stack  <a href="#a2ce77af8c704a7d3f2204f94750daedb">More...</a><br/></td></tr>
<tr class="separator:a2ce77af8c704a7d3f2204f94750daedb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad548883c204308dc00349b98f839181b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#ad548883c204308dc00349b98f839181b">cmp_addr</a> (<a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> *curr, <a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> *new)</td></tr>
<tr class="memdesc:ad548883c204308dc00349b98f839181b"><td class="mdescLeft">&#160;</td><td class="mdescRight">compare two item address, used by list_addsort in <a class="el" href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902" title="free a use stack ">free_ustack()</a>  <a href="#ad548883c204308dc00349b98f839181b">More...</a><br/></td></tr>
<tr class="separator:ad548883c204308dc00349b98f839181b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77191559ef009fa20ada65a52b5e9902"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902">free_ustack</a> (int *top)</td></tr>
<tr class="memdesc:a77191559ef009fa20ada65a52b5e9902"><td class="mdescLeft">&#160;</td><td class="mdescRight">free a use stack  <a href="#a77191559ef009fa20ada65a52b5e9902">More...</a><br/></td></tr>
<tr class="separator:a77191559ef009fa20ada65a52b5e9902"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab85de89de0e4aa840b3d48ffe4f4d5e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#ab85de89de0e4aa840b3d48ffe4f4d5e3">print_ustack</a> (void)</td></tr>
<tr class="memdesc:ab85de89de0e4aa840b3d48ffe4f4d5e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">print ustack state  <a href="#ab85de89de0e4aa840b3d48ffe4f4d5e3">More...</a><br/></td></tr>
<tr class="separator:ab85de89de0e4aa840b3d48ffe4f4d5e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad59a095064fc46b540321c14b65dab06"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#ad59a095064fc46b540321c14b65dab06">test_ustack</a> (size_t turn)</td></tr>
<tr class="separator:ad59a095064fc46b540321c14b65dab06"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:adbad17f740c2d7f2bc4833681c93c932"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#adbad17f740c2d7f2bc4833681c93c932">__bss_end</a></td></tr>
<tr class="separator:adbad17f740c2d7f2bc4833681c93c932"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a869ed24619b20d01d0f6c457c069ec96"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a869ed24619b20d01d0f6c457c069ec96">__kdata_end</a></td></tr>
<tr class="separator:a869ed24619b20d01d0f6c457c069ec96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0893d9ddd9d1a491788e16024697251e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a></td></tr>
<tr class="separator:a0893d9ddd9d1a491788e16024697251e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a2da4d001f5945106528b32581206e2"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a></td></tr>
<tr class="separator:a7a2da4d001f5945106528b32581206e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af470e8520ef12288ba5f72c899bd4799"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a></td></tr>
<tr class="separator:af470e8520ef12288ba5f72c899bd4799"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af76c5bf598586d0024d1e53b108c868c"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a> [256]</td></tr>
<tr class="separator:af76c5bf598586d0024d1e53b108c868c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2258d5c2be05af348af68e9e588a06a"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a> [256]</td></tr>
<tr class="separator:af2258d5c2be05af348af68e9e588a06a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8289aec0c28713b9bf8c8040374673b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kmemory_8c.html#ac7c0e9f07b4717ffca845d3a530e7530">page_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#af8289aec0c28713b9bf8c8040374673b">DummyPage</a></td></tr>
<tr class="separator:af8289aec0c28713b9bf8c8040374673b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3e3a67efeec7e5535c5f05360111d34"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="kmemory_8c.html#ac7c0e9f07b4717ffca845d3a530e7530">page_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a> = &amp;<a class="el" href="kmemory_8c.html#af8289aec0c28713b9bf8c8040374673b">DummyPage</a></td></tr>
<tr class="separator:ad3e3a67efeec7e5535c5f05360111d34"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c7f2ce6c58dbea9f3f45c967f370a4a"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a></td></tr>
<tr class="separator:a4c7f2ce6c58dbea9f3f45c967f370a4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb163f59e8b9324e1de98021ca40ff92"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmemory_8c.html#adb163f59e8b9324e1de98021ca40ff92">KMallocTest</a> [256]</td></tr>
<tr class="separator:adb163f59e8b9324e1de98021ca40ff92"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a5ca59e07ccac5f97fd636413b47818e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define kmb&#160;&#160;&#160;(char*)&amp;<a class="el" href="crt0_8c.html#ac56d62881d5ef8cb3152d3e4a697e46a">__bss_end</a>           /* kernel memory begin */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree()</a>, <a class="el" href="kmemory_8h.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, and <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>.</p>

</div>
</div>
<a class="anchor" id="aac8be82d7bffa1ad691b1bd5d24492ea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define kme&#160;&#160;&#160;(char*)&amp;<a class="el" href="kmemory_8c.html#a869ed24619b20d01d0f6c457c069ec96">__kdata_end</a>         /* kernel memory end */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a85a54e9787a16befde04a79fb6b83d96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NBLINE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">n</td><td>)</td>
          <td>&#160;&#160;&#160;(((n)+<a class="el" href="memory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>-1)/<a class="el" href="memory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree()</a>, <a class="el" href="kmemory_8h.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, and <a class="el" href="kmemory_8h.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>.</p>

</div>
</div>
<a class="anchor" id="a87be89cfdd7a7fa303a8f146373124bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NBSTACK&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#ad59a095064fc46b540321c14b65dab06">test_ustack()</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ac7c0e9f07b4717ffca845d3a530e7530"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structpage__s.html">page_s</a>  <a class="el" href="kmemory_8c.html#ac7c0e9f07b4717ffca845d3a530e7530">page_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ad548883c204308dc00349b98f839181b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int cmp_addr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> *&#160;</td>
          <td class="paramname"><em>curr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> *&#160;</td>
          <td class="paramname"><em>new</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>compare two item address, used by list_addsort in <a class="el" href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902" title="free a use stack ">free_ustack()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">curr</td><td>is the current item in the list </td></tr>
    <tr><td class="paramname">new</td><td>is the new item to insert </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a positive if current &gt; new </dd></dl>

<p>Referenced by <a class="el" href="kmemory_8h.html#afb66690ffe244c8c1901f4877b51a3c9">free_ustack()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                                  {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(curr - <span class="keyword">new</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a77191559ef009fa20ada65a52b5e9902"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_ustack </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>stack</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>free a use stack </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stack</td><td>is a pointer returned by kmalloc_ustack </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>, <a class="el" href="kmemory_8c.html#ad548883c204308dc00349b98f839181b">cmp_addr()</a>, <a class="el" href="list_8h.html#a275c693c553662ccb0736089f2159b7d">list_addsort()</a>, <a class="el" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a>, <a class="el" href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst()</a>, <a class="el" href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a>, <a class="el" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a>, <a class="el" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a>, and <a class="el" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>.</p>

<p>Referenced by <a class="el" href="kmemory_8h.html#ad59a095064fc46b540321c14b65dab06">test_ustack()</a>.</p>
<div class="fragment"><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordtype">int</span> * end = 1 + top - <a class="code" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>/<span class="keyword">sizeof</span>(int);          <span class="comment">// last int of ustack (+1 because MAGIC)</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> (*top != <a class="code" href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a>, <span class="stringliteral">&quot;Corrupted top Stack&quot;</span>);  <span class="comment">// if no magic number then panic</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> (*end != <a class="code" href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a>, <span class="stringliteral">&quot;Corrupted end Stack&quot;</span>);  <span class="comment">// if no magic number then panic</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (end ==<a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a>) {                        <span class="comment">// if it is the lowest stack</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a> += <a class="code" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>/<span class="keyword">sizeof</span>(int);     <span class="comment">// shrink the stacks&#39; region</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <a class="code" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a> (&amp;<a class="code" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a>, stack) {              <span class="comment">// foreach free stack</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="keywordflow">if</span> ((<span class="keywordtype">int</span> *)stack != <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a>)        <span class="comment">// if it isn&#39;t the end of stack region</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                <span class="keywordflow">break</span>;                                      <span class="comment">// then stop trying to shrink</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            end = (<span class="keywordtype">int</span> *)<a class="code" href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst</a> (&amp;<a class="code" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a>);    <span class="comment">// extract the stack</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            end += <a class="code" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>/<span class="keyword">sizeof</span>(int);                 <span class="comment">// new end of stacks&#39;region</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a> = end;                      <span class="comment">// save this new end</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    } <span class="keywordflow">else</span>                                                  <span class="comment">// else the freed stack isn&#39;t at the end</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <a class="code" href="list_8h.html#a275c693c553662ccb0736089f2159b7d">list_addsort</a> (&amp;<a class="code" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a>,(<a class="code" href="structlist__s.html">list_t</a>*)end,<a class="code" href="kmemory_8c.html#ad548883c204308dc00349b98f839181b">cmp_addr</a>);<span class="comment">// add it in free list in order</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div>
<div class="ttc" id="usermem_8h_html_a34ef3ea96595898f1452b49d29a1722a"><div class="ttname"><a href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a></div><div class="ttdeci">#define MAGIC_STACK</div><div class="ttdef"><b>Definition:</b> usermem.h:21</div></div>
<div class="ttc" id="kmemory_8c_html_a0893d9ddd9d1a491788e16024697251e"><div class="ttname"><a href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a></div><div class="ttdeci">static list_t FreeUserStack</div><div class="ttdef"><b>Definition:</b> kmemory.c:68</div></div>
<div class="ttc" id="debug__on_8h_html_a9dea4233af3c516959b7255fbea5c79b"><div class="ttname"><a href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a></div><div class="ttdeci">#define PANIC_IF(cond, fmt, arg...)</div><div class="ttdoc">Check a condition and write a formated message on console if false and stop execution. </div><div class="ttdef"><b>Definition:</b> debug_on.h:38</div></div>
<div class="ttc" id="list_8h_html_ad759a32561623ec6b31549db8276e8b6"><div class="ttname"><a href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a></div><div class="ttdeci">#define list_foreach(ROOT, ITEM)</div><div class="ttdoc">C instruction to iterate through a list of items from first to last. list_foreach will iterate as man...</div><div class="ttdef"><b>Definition:</b> list.h:153</div></div>
<div class="ttc" id="usermem_8h_html_af044184d28c9a8b78f17bd1d8e1059b4"><div class="ttname"><a href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a></div><div class="ttdeci">_usermem_t _usermem</div></div>
<div class="ttc" id="usermem_8h_html_ad77d03e18a9477ef16ff8c4ae3c8b43d"><div class="ttname"><a href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a></div><div class="ttdeci">#define USTACK_SIZE</div><div class="ttdef"><b>Definition:</b> usermem.h:20</div></div>
<div class="ttc" id="structlist__s_html"><div class="ttname"><a href="structlist__s.html">list_s</a></div><div class="ttdoc">The 2-pointers structure to embed in the root of a list and in each of its items. ...</div><div class="ttdef"><b>Definition:</b> list.h:81</div></div>
<div class="ttc" id="list_8h_html_a60162e4580a37bddf823ca73567011d8"><div class="ttname"><a href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst</a></div><div class="ttdeci">static list_t * list_getfirst(list_t *root)</div><div class="ttdoc">Unlink (i.e. detach) the first item of list. </div><div class="ttdef"><b>Definition:</b> list.h:242</div></div>
<div class="ttc" id="kmemory_8c_html_ad548883c204308dc00349b98f839181b"><div class="ttname"><a href="kmemory_8c.html#ad548883c204308dc00349b98f839181b">cmp_addr</a></div><div class="ttdeci">static int cmp_addr(list_t *curr, list_t *new)</div><div class="ttdoc">compare two item address, used by list_addsort in free_ustack() </div><div class="ttdef"><b>Definition:</b> kmemory.c:260</div></div>
<div class="ttc" id="list_8h_html_a275c693c553662ccb0736089f2159b7d"><div class="ttname"><a href="list_8h.html#a275c693c553662ccb0736089f2159b7d">list_addsort</a></div><div class="ttdeci">static void list_addsort(list_t *root, list_t *added_item, int(*cmp)(list_t *A, list_t *B))</div><div class="ttdoc">Add a new added item in a sorted list after root element. </div><div class="ttdef"><b>Definition:</b> list.h:289</div></div>
<div class="ttc" id="struct__usermem__s_html_a2ff86fc41cdbe6063962b5be6aef49fc"><div class="ttname"><a href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a></div><div class="ttdeci">int * ustack_end</div><div class="ttdoc">lowest address of the user stack segment </div><div class="ttdef"><b>Definition:</b> usermem.h:52</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a64c1f767a18f26f8c8cabd0f82f3e04d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfree </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>free an allocated object with <a class="el" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be" title="allocate an object in the kernel address space ">kmalloc()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>pointer to the allocated object </td></tr>
    <tr><td class="paramname">size</td><td>in bytes used for allocation </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>, <a class="el" href="list_8h.html#ae9cb164fa78a37279635deb1a926a092">list_addfirst()</a>, <a class="el" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a>, <a class="el" href="list_8h.html#ac68d25438cd5f3cc2e5b04dbf174bf27">list_unlink()</a>, <a class="el" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>, <a class="el" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>, <a class="el" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>, <a class="el" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>, <a class="el" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>, <a class="el" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a>, and <a class="el" href="structpage__s.html#a32a24096972b27d87a55051df616ae99">page_s::slab</a>.</p>

<p>Referenced by <a class="el" href="kdev_8h.html#a4503a518622297c8360c8eeb7e30a895">dev_free()</a>, <a class="el" href="kmemory_8h.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>, <a class="el" href="ksynchro_8h.html#a384a3caafcd4e7c672a583fc4183f983">thread_barrier_destroy()</a>, and <a class="el" href="ksynchro_8h.html#af85d5d2e4a36615955a7cfbae10eeec5">thread_mutex_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;{</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">size_t</span> nbline= <a class="code" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>(size) % <a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>;              <span class="comment">// which slab to use</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">size_t</span> npage = (size_t)(obj - (<span class="keywordtype">void</span> *)<a class="code" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>)&gt;&gt;12;         <span class="comment">// relative page number from kmb</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> ((nbline&gt;255)||(npage &gt;= <a class="code" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>),             <span class="comment">// too big or outside of the region</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="stringliteral">&quot;\ncan&#39;t free object not allocated by kmalloc()&quot;</span>);  <span class="comment">// write a message then panic</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="list_8h.html#ae9cb164fa78a37279635deb1a926a092">list_addfirst</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[nbline], (<a class="code" href="structlist__s.html">list_t</a> *)obj);           <span class="comment">// add it to the right free list</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>[nbline]--;                              <span class="comment">// decr the number of obj of size nbline</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span> (size == <a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (--<a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[npage].alloc==0) {                           <span class="comment">// splitted page and no more object left</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="structlist__s.html">list_t</a> *page = (<a class="code" href="structlist__s.html">list_t</a> *)((<span class="keywordtype">size_t</span>)obj &amp; ~0xFFF);    <span class="comment">// address of the page containing obj</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <a class="code" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[nbline], item) {                <span class="comment">// browse all item in free list</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            <span class="keywordtype">size_t</span> np_item = (size_t)((<span class="keywordtype">char</span>*)item-<a class="code" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>)&gt;&gt;12; <span class="comment">// page number Page[] table</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="keywordflow">if</span> (np_item == npage) {                         <span class="comment">// if current item is in the page</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <a class="code" href="list_8h.html#ac68d25438cd5f3cc2e5b04dbf174bf27">list_unlink</a> (item);                         <span class="comment">// unlink it</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[npage].<a class="code" href="structpage__s.html#a32a24096972b27d87a55051df616ae99">slab</a> = 0;                               <span class="comment">// since the page is empty, thus slab 0</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="list_8h.html#ae9cb164fa78a37279635deb1a926a092">list_addfirst</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[0], (<a class="code" href="structlist__s.html">list_t</a> *)page);           <span class="comment">// add the free page in slab[O]</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>[0]--;                               <span class="comment">// decr the number of pages used</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div>
<div class="ttc" id="usermem_8h_html_a7d467c1d283fdfa1f2081ba1e0d01b6e"><div class="ttname"><a href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a></div><div class="ttdeci">#define PAGE_SIZE</div><div class="ttdef"><b>Definition:</b> usermem.h:19</div></div>
<div class="ttc" id="kmemory_8c_html_a4c7f2ce6c58dbea9f3f45c967f370a4a"><div class="ttname"><a href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a></div><div class="ttdeci">static size_t NbPages</div><div class="ttdef"><b>Definition:</b> kmemory.c:80</div></div>
<div class="ttc" id="kmemory_8c_html_af2258d5c2be05af348af68e9e588a06a"><div class="ttname"><a href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a></div><div class="ttdeci">static size_t ObjectsThisSize[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:72</div></div>
<div class="ttc" id="kmemory_8c_html_a5ca59e07ccac5f97fd636413b47818e9"><div class="ttname"><a href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a></div><div class="ttdeci">#define kmb</div><div class="ttdef"><b>Definition:</b> kmemory.c:66</div></div>
<div class="ttc" id="kmemory_8c_html_af470e8520ef12288ba5f72c899bd4799"><div class="ttname"><a href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a></div><div class="ttdeci">static size_t MaxLinePage</div><div class="ttdef"><b>Definition:</b> kmemory.c:70</div></div>
<div class="ttc" id="kmemory_8c_html_a85a54e9787a16befde04a79fb6b83d96"><div class="ttname"><a href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a></div><div class="ttdeci">#define NBLINE(n)</div><div class="ttdef"><b>Definition:</b> kmemory.c:82</div></div>
<div class="ttc" id="debug__on_8h_html_a9dea4233af3c516959b7255fbea5c79b"><div class="ttname"><a href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a></div><div class="ttdeci">#define PANIC_IF(cond, fmt, arg...)</div><div class="ttdoc">Check a condition and write a formated message on console if false and stop execution. </div><div class="ttdef"><b>Definition:</b> debug_on.h:38</div></div>
<div class="ttc" id="list_8h_html_ac68d25438cd5f3cc2e5b04dbf174bf27"><div class="ttname"><a href="list_8h.html#ac68d25438cd5f3cc2e5b04dbf174bf27">list_unlink</a></div><div class="ttdeci">static list_t * list_unlink(list_t *item)</div><div class="ttdoc">Unlink (i.e. detach) an item of list. </div><div class="ttdef"><b>Definition:</b> list.h:231</div></div>
<div class="ttc" id="list_8h_html_ad759a32561623ec6b31549db8276e8b6"><div class="ttname"><a href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a></div><div class="ttdeci">#define list_foreach(ROOT, ITEM)</div><div class="ttdoc">C instruction to iterate through a list of items from first to last. list_foreach will iterate as man...</div><div class="ttdef"><b>Definition:</b> list.h:153</div></div>
<div class="ttc" id="list_8h_html_ae9cb164fa78a37279635deb1a926a092"><div class="ttname"><a href="list_8h.html#ae9cb164fa78a37279635deb1a926a092">list_addfirst</a></div><div class="ttdeci">static void list_addfirst(list_t *root, list_t *added_item)</div><div class="ttdoc">Add a new added item after the current item which is root the most often. then the added item is plac...</div><div class="ttdef"><b>Definition:</b> list.h:204</div></div>
<div class="ttc" id="kmemory_8c_html_ad3e3a67efeec7e5535c5f05360111d34"><div class="ttname"><a href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a></div><div class="ttdeci">static page_t * Page</div><div class="ttdef"><b>Definition:</b> kmemory.c:79</div></div>
<div class="ttc" id="kmemory_8c_html_af76c5bf598586d0024d1e53b108c868c"><div class="ttname"><a href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a></div><div class="ttdeci">static list_t Slab[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:71</div></div>
<div class="ttc" id="structlist__s_html"><div class="ttname"><a href="structlist__s.html">list_s</a></div><div class="ttdoc">The 2-pointers structure to embed in the root of a list and in each of its items. ...</div><div class="ttdef"><b>Definition:</b> list.h:81</div></div>
<div class="ttc" id="structpage__s_html_a32a24096972b27d87a55051df616ae99"><div class="ttname"><a href="structpage__s.html#a32a24096972b27d87a55051df616ae99">page_s::slab</a></div><div class="ttdeci">char slab</div><div class="ttdef"><b>Definition:</b> kmemory.c:74</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5f52d7c56b7d67dc2f96b2e93dfdc7be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* kmalloc </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>allocate an object in the kernel address space </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>in bytes (must be at most a PAGE SIZE) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a pointer to an object with at least "size" byte size It is rounded up to a whole number of cache lines. </dd></dl>

<p>References <a class="el" href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">page_s::alloc</a>, <a class="el" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>, <a class="el" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, <a class="el" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>, <a class="el" href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast()</a>, <a class="el" href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst()</a>, <a class="el" href="list_8h.html#a7c9c3af38594b844dac34c6656bdd7a0">list_isempty()</a>, <a class="el" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>, <a class="el" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>, <a class="el" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>, <a class="el" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>, <a class="el" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a>, <a class="el" href="structpage__s.html#a32a24096972b27d87a55051df616ae99">page_s::slab</a>, and <a class="el" href="cstd_8c.html#a00da14b6dfa98f18494ef149ce63457f">wzero()</a>.</p>

<p>Referenced by <a class="el" href="kdev_8h.html#aebc03eb0791b35f8c76bacae806c694d">dev_alloc()</a>, <a class="el" href="kmemory_8h.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, <a class="el" href="kmemory_8h.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>, <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>, <a class="el" href="ns16550_8c.html#a1101518cb0dd45f0ab1e9fe8937b587f">ns16550_init()</a>, <a class="el" href="soclib-tty_8c.html#a00359850c297b2f0c2cf249274763e04">soclib_tty_init()</a>, <a class="el" href="ksynchro_8h.html#adea6885b17fdfc05ad0414fbaa41dd89">thread_barrier_init()</a>, <a class="el" href="kthread_8h.html#a227d30321d9dddb518fe5d116aa7d90b">thread_create()</a>, and <a class="el" href="ksynchro_8h.html#a2fbf4c52b56586ce18013333c7a1d37e">thread_mutex_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;{</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> (size &gt; <a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>,                             <span class="comment">// kmalloc is for small object</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="stringliteral">&quot;%d is too big, more than a single page&quot;</span>, size);    <span class="comment">// write a message then panic</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> ((size==<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>) &amp;&amp; <a class="code" href="list_8h.html#a7c9c3af38594b844dac34c6656bdd7a0">list_isempty</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[0]), <span class="comment">// free page are listed in Slab[0]</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="stringliteral">&quot;No more kernel data space&quot;</span>);                       <span class="comment">// write a message then panic</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">size_t</span> nbline = <a class="code" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>(size);                           <span class="comment">// required lines for size</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    size = nbline * <a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>;                          <span class="comment">// actual size asked</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <span class="keywordflow">if</span> ((size!=<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>) &amp;&amp; <a class="code" href="list_8h.html#a7c9c3af38594b844dac34c6656bdd7a0">list_isempty</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[nbline])) {<span class="comment">// if no more object in the slab</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordtype">char</span> *page = <a class="code" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a> (<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>);                   <span class="comment">// ask for a free page (i.e. slab)</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordtype">size_t</span> npage = (size_t)(page - (<span class="keywordtype">char</span> *)<a class="code" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>)&gt;&gt;12;    <span class="comment">// relative page number from kmb</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[npage].<a class="code" href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">alloc</a> = 0;                              <span class="comment">// reset the allocated counter</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *p=page; p+size&lt;=page+<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>; p+=size) <span class="comment">// cut the slab into objects</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[nbline], (<a class="code" href="structlist__s.html">list_t</a> *)p);      <span class="comment">// and chain them together</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">void</span> * res = <a class="code" href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[nbline%<a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>]); <span class="comment">// res is the first object in list</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">size_t</span> npage = (size_t)(res - (<span class="keywordtype">void</span> *)<a class="code" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>)&gt;&gt;12;         <span class="comment">// relative page number from kmb</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>[nbline%<a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>]++;                  <span class="comment">// increment the number of objects</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[npage].<a class="code" href="structpage__s.html#a32a24096972b27d87a55051df616ae99">slab</a> = nbline%<a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>;                  <span class="comment">// this page is used of slab of nbline</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[npage].<a class="code" href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">alloc</a>++;                                    <span class="comment">// one more times</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <a class="code" href="cstd_8c.html#a00da14b6dfa98f18494ef149ce63457f">wzero</a> (res, size);                                      <span class="comment">// clear allocated memory</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span> res;                                             <span class="comment">// finally returns res</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
<div class="ttc" id="kmemory_8c_html_a5f52d7c56b7d67dc2f96b2e93dfdc7be"><div class="ttname"><a href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a></div><div class="ttdeci">void * kmalloc(size_t size)</div><div class="ttdoc">allocate an object in the kernel address space </div><div class="ttdef"><b>Definition:</b> kmemory.c:105</div></div>
<div class="ttc" id="usermem_8h_html_a7d467c1d283fdfa1f2081ba1e0d01b6e"><div class="ttname"><a href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a></div><div class="ttdeci">#define PAGE_SIZE</div><div class="ttdef"><b>Definition:</b> usermem.h:19</div></div>
<div class="ttc" id="kmemory_8c_html_af2258d5c2be05af348af68e9e588a06a"><div class="ttname"><a href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a></div><div class="ttdeci">static size_t ObjectsThisSize[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:72</div></div>
<div class="ttc" id="kmemory_8c_html_a5ca59e07ccac5f97fd636413b47818e9"><div class="ttname"><a href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a></div><div class="ttdeci">#define kmb</div><div class="ttdef"><b>Definition:</b> kmemory.c:66</div></div>
<div class="ttc" id="kmemory_8c_html_af470e8520ef12288ba5f72c899bd4799"><div class="ttname"><a href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a></div><div class="ttdeci">static size_t MaxLinePage</div><div class="ttdef"><b>Definition:</b> kmemory.c:70</div></div>
<div class="ttc" id="kmemory_8c_html_a85a54e9787a16befde04a79fb6b83d96"><div class="ttname"><a href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a></div><div class="ttdeci">#define NBLINE(n)</div><div class="ttdef"><b>Definition:</b> kmemory.c:82</div></div>
<div class="ttc" id="debug__on_8h_html_a9dea4233af3c516959b7255fbea5c79b"><div class="ttname"><a href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a></div><div class="ttdeci">#define PANIC_IF(cond, fmt, arg...)</div><div class="ttdoc">Check a condition and write a formated message on console if false and stop execution. </div><div class="ttdef"><b>Definition:</b> debug_on.h:38</div></div>
<div class="ttc" id="structpage__s_html_a1b4a61989804f75b7d857636e35c9c2f"><div class="ttname"><a href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">page_s::alloc</a></div><div class="ttdeci">char alloc</div><div class="ttdef"><b>Definition:</b> kmemory.c:75</div></div>
<div class="ttc" id="kmemory_8c_html_a7a2da4d001f5945106528b32581206e2"><div class="ttname"><a href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a></div><div class="ttdeci">static size_t CacheLineSize</div><div class="ttdef"><b>Definition:</b> kmemory.c:69</div></div>
<div class="ttc" id="kmemory_8c_html_ad3e3a67efeec7e5535c5f05360111d34"><div class="ttname"><a href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a></div><div class="ttdeci">static page_t * Page</div><div class="ttdef"><b>Definition:</b> kmemory.c:79</div></div>
<div class="ttc" id="kmemory_8c_html_af76c5bf598586d0024d1e53b108c868c"><div class="ttname"><a href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a></div><div class="ttdeci">static list_t Slab[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:71</div></div>
<div class="ttc" id="list_8h_html_a7c9c3af38594b844dac34c6656bdd7a0"><div class="ttname"><a href="list_8h.html#a7c9c3af38594b844dac34c6656bdd7a0">list_isempty</a></div><div class="ttdeci">static unsigned list_isempty(list_t *root)</div><div class="ttdoc">Tests if a list don&amp;#39;t have any item. </div><div class="ttdef"><b>Definition:</b> list.h:95</div></div>
<div class="ttc" id="structlist__s_html"><div class="ttname"><a href="structlist__s.html">list_s</a></div><div class="ttdoc">The 2-pointers structure to embed in the root of a list and in each of its items. ...</div><div class="ttdef"><b>Definition:</b> list.h:81</div></div>
<div class="ttc" id="list_8h_html_a60162e4580a37bddf823ca73567011d8"><div class="ttname"><a href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst</a></div><div class="ttdeci">static list_t * list_getfirst(list_t *root)</div><div class="ttdoc">Unlink (i.e. detach) the first item of list. </div><div class="ttdef"><b>Definition:</b> list.h:242</div></div>
<div class="ttc" id="cstd_8c_html_a00da14b6dfa98f18494ef149ce63457f"><div class="ttname"><a href="cstd_8c.html#a00da14b6dfa98f18494ef149ce63457f">wzero</a></div><div class="ttdeci">void wzero(void *addr, size_t n)</div><div class="ttdoc">write 0 in a buffer </div><div class="ttdef"><b>Definition:</b> cstd.c:15</div></div>
<div class="ttc" id="structpage__s_html_a32a24096972b27d87a55051df616ae99"><div class="ttname"><a href="structpage__s.html#a32a24096972b27d87a55051df616ae99">page_s::slab</a></div><div class="ttdeci">char slab</div><div class="ttdef"><b>Definition:</b> kmemory.c:74</div></div>
<div class="ttc" id="list_8h_html_a116cfa18214dd2f855cff842bb14ca8f"><div class="ttname"><a href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast</a></div><div class="ttdeci">static void list_addlast(list_t *root, list_t *added_item)</div><div class="ttdoc">Add a new added item before the current item which is root the most often. then the added item is pla...</div><div class="ttdef"><b>Definition:</b> list.h:221</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a71239547b3491efafadee92180ba2b02"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kmalloc_print </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Print data about slab allocator usage. </p>
<ul>
<li>for each open slab, tells the object size and how many free and allocated objects</li>
<li>for each page used, tells to which stab it belongs and how many objects are allocated in </li>
</ul>

<p>References <a class="el" href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">page_s::alloc</a>, <a class="el" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>, <a class="el" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf()</a>, <a class="el" href="list_8h.html#a70e2ae6a0a122175e967b0cd6b2affce">list_nbobj()</a>, <a class="el" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>, <a class="el" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>, <a class="el" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>, and <a class="el" href="structpage__s.html#a32a24096972b27d87a55051df616ae99">page_s::slab</a>.</p>

<p>Referenced by <a class="el" href="kmemory_8h.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>.</p>
<div class="fragment"><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;{</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordtype">size_t</span> cr = 0, pr = 1;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;\nOpen Slab[] : Object Size ; Free Objects ; Allocated Objects\n&quot;</span>);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> nbline=0 ; nbline&lt;<a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a> ; nbline++) { <span class="comment">// for all slabs</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordtype">size_t</span> sz = (nbline)?nbline*<a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>:4096;     <span class="comment">// size really allocated</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordtype">size_t</span> nf = <a class="code" href="list_8h.html#a70e2ae6a0a122175e967b0cd6b2affce">list_nbobj</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[nbline]);             <span class="comment">// number of free obj of size nline</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordtype">size_t</span> na = <a class="code" href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a>[nbline];                <span class="comment">// number of allocated obj of size nline</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">if</span> (nf+na) {                                        <span class="comment">// if there is something to print</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;|s %d\t f %d\t a %d&quot;</span>, sz, nf, na);    <span class="comment">// print data</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> ((++cr%3)?<span class="stringliteral">&quot;\t&quot;</span>:<span class="stringliteral">&quot;\t|\n&quot;</span>);                <span class="comment">// adds a \n all three print</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            pr=0;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> ((cr+pr)?<span class="stringliteral">&quot;\n&quot;</span>:<span class="stringliteral">&quot;&quot;</span>);                              <span class="comment">// adds a \n if not just added it</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    cr = 0; pr = 1;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;\nUsed Memory Pages  : Slab Type (nb cache lines) ; Allocated Objects\n&quot;</span>);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> p = 0; p &lt; <a class="code" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>; p++) {                  <span class="comment">// for all pages</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordtype">size_t</span> ps = <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[p].<a class="code" href="structpage__s.html#a32a24096972b27d87a55051df616ae99">slab</a>;                           <span class="comment">// for what slab[] it is used</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordtype">size_t</span> pa = <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a>[p].<a class="code" href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">alloc</a>;                          <span class="comment">// how many alloc objects there are in</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> (pa) {                                           <span class="comment">// if the page contain allocated object</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;|p %d\t s %d\t a %d&quot;</span>,p,ps,pa);        <span class="comment">// print data</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> ((++cr%3)?<span class="stringliteral">&quot;\t&quot;</span>:<span class="stringliteral">&quot;\t|\n&quot;</span>);                <span class="comment">// adds a \n all three print</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            pr=0;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> ((cr+pr)?<span class="stringliteral">&quot;\n&quot;</span>:<span class="stringliteral">&quot;&quot;</span>);                              <span class="comment">// adds a \n if not just added it</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="ttc" id="list_8h_html_a70e2ae6a0a122175e967b0cd6b2affce"><div class="ttname"><a href="list_8h.html#a70e2ae6a0a122175e967b0cd6b2affce">list_nbobj</a></div><div class="ttdeci">static unsigned list_nbobj(list_t *root)</div><div class="ttdoc">calculate the number of object of a list </div><div class="ttdef"><b>Definition:</b> list.h:276</div></div>
<div class="ttc" id="kmemory_8c_html_a4c7f2ce6c58dbea9f3f45c967f370a4a"><div class="ttname"><a href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a></div><div class="ttdeci">static size_t NbPages</div><div class="ttdef"><b>Definition:</b> kmemory.c:80</div></div>
<div class="ttc" id="kmemory_8c_html_af2258d5c2be05af348af68e9e588a06a"><div class="ttname"><a href="kmemory_8c.html#af2258d5c2be05af348af68e9e588a06a">ObjectsThisSize</a></div><div class="ttdeci">static size_t ObjectsThisSize[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:72</div></div>
<div class="ttc" id="kmemory_8c_html_af470e8520ef12288ba5f72c899bd4799"><div class="ttname"><a href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a></div><div class="ttdeci">static size_t MaxLinePage</div><div class="ttdef"><b>Definition:</b> kmemory.c:70</div></div>
<div class="ttc" id="structpage__s_html_a1b4a61989804f75b7d857636e35c9c2f"><div class="ttname"><a href="structpage__s.html#a1b4a61989804f75b7d857636e35c9c2f">page_s::alloc</a></div><div class="ttdeci">char alloc</div><div class="ttdef"><b>Definition:</b> kmemory.c:75</div></div>
<div class="ttc" id="klibc_8c_html_ac4ae3bb8e59735d2b772e77186b52228"><div class="ttname"><a href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a></div><div class="ttdeci">int kprintf(char *fmt,...)</div><div class="ttdoc">print a formated string to the TTY0 this a simplified version which handles only: c...</div><div class="ttdef"><b>Definition:</b> klibc.c:37</div></div>
<div class="ttc" id="kmemory_8c_html_a7a2da4d001f5945106528b32581206e2"><div class="ttname"><a href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a></div><div class="ttdeci">static size_t CacheLineSize</div><div class="ttdef"><b>Definition:</b> kmemory.c:69</div></div>
<div class="ttc" id="kmemory_8c_html_ad3e3a67efeec7e5535c5f05360111d34"><div class="ttname"><a href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a></div><div class="ttdeci">static page_t * Page</div><div class="ttdef"><b>Definition:</b> kmemory.c:79</div></div>
<div class="ttc" id="kmemory_8c_html_af76c5bf598586d0024d1e53b108c868c"><div class="ttname"><a href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a></div><div class="ttdeci">static list_t Slab[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:71</div></div>
<div class="ttc" id="structpage__s_html_a32a24096972b27d87a55051df616ae99"><div class="ttname"><a href="structpage__s.html#a32a24096972b27d87a55051df616ae99">page_s::slab</a></div><div class="ttdeci">char slab</div><div class="ttdef"><b>Definition:</b> kmemory.c:74</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6cfd6b96caef4efda19f082f3ef8cd2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kmalloc_test </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>turn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test Slab alocator, allocates and frees as many values as 'turn' then free all test. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">turn</td><td>is the number of allocation or release are performed </td></tr>
    <tr><td class="paramname">size</td><td>is the maximum objects size (from 1 to PAGE_SIZE) </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>, <a class="el" href="kmemory_8c.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree()</a>, <a class="el" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, <a class="el" href="kmemory_8c.html#a71239547b3491efafadee92180ba2b02">kmalloc_print()</a>, <a class="el" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf()</a>, <a class="el" href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast()</a>, <a class="el" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a>, <a class="el" href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst()</a>, <a class="el" href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init()</a>, <a class="el" href="list_8h.html#ac68d25438cd5f3cc2e5b04dbf174bf27">list_unlink()</a>, <a class="el" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>, <a class="el" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>, and <a class="el" href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand()</a>.</p>

<p>Referenced by <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="structlist__s.html">list_t</a> *obj;                                            <span class="comment">// object allocated or freed</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (turn == 0) <span class="keywordflow">return</span>;                                  <span class="comment">// if no turn forgive now</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;kmalloc test %s turn %d size max %d\n&quot;</span>,       <span class="comment">// a small message</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;             __func__,turn,size);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0 ; i &lt; <a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a> ; i++)                 <span class="comment">// nitialize KMallocTest</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init</a> (&amp;<a class="code" href="kmemory_8c.html#adb163f59e8b9324e1de98021ca40ff92">KMallocTest</a>[i]);                        <span class="comment">// KMallocTest[i] -&gt; i*cachelinesize</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">while</span> (turn--) {                                        <span class="comment">// the number of turn is configurable</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordtype">int</span> sz = 1+(<a class="code" href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a>()+<a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>/2) % size;         <span class="comment">// choose a size</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordtype">size_t</span> nbline = <a class="code" href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a>(sz);                         <span class="comment">// required lines for size</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        nbline %= <a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>;                              <span class="comment">// if sz==PAGE_SIZE use Slab[0]</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a>()%2) {                                     <span class="comment">// alloc or free</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            obj = <a class="code" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a> (sz);                             <span class="comment">// allocate a new object</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <a class="code" href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast</a> (&amp;<a class="code" href="kmemory_8c.html#adb163f59e8b9324e1de98021ca40ff92">KMallocTest</a>[nbline], obj);       <span class="comment">// add it in allocated object</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        } <span class="keywordflow">else</span> {                                            <span class="comment">// else</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            obj = <a class="code" href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst</a> (&amp;<a class="code" href="kmemory_8c.html#adb163f59e8b9324e1de98021ca40ff92">KMallocTest</a>[nbline]);     <span class="comment">// try to get a previously allocated obj</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">if</span> (obj) <a class="code" href="kmemory_8c.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree</a> (obj, nbline*<a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>);     <span class="comment">// on success, free it</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="kmemory_8c.html#a71239547b3491efafadee92180ba2b02">kmalloc_print</a>();                                        <span class="comment">// Slab status after alloc/free series</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0 ; i &lt; <a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a> ; i++) {               <span class="comment">// for all list</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a> (&amp;<a class="code" href="kmemory_8c.html#adb163f59e8b9324e1de98021ca40ff92">KMallocTest</a>[i], item) {              <span class="comment">// browse allocated objects</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="list_8h.html#ac68d25438cd5f3cc2e5b04dbf174bf27">list_unlink</a> (item);                             <span class="comment">// if found it, unlinked it</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            <a class="code" href="kmemory_8c.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree</a> (item,i*<a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>);                   <span class="comment">// then free it</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="kmemory_8c.html#a71239547b3491efafadee92180ba2b02">kmalloc_print</a>();                                        <span class="comment">// Slab status after total clean od test</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;}</div>
<div class="ttc" id="kmemory_8c_html_a5f52d7c56b7d67dc2f96b2e93dfdc7be"><div class="ttname"><a href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a></div><div class="ttdeci">void * kmalloc(size_t size)</div><div class="ttdoc">allocate an object in the kernel address space </div><div class="ttdef"><b>Definition:</b> kmemory.c:105</div></div>
<div class="ttc" id="kmemory_8c_html_adb163f59e8b9324e1de98021ca40ff92"><div class="ttname"><a href="kmemory_8c.html#adb163f59e8b9324e1de98021ca40ff92">KMallocTest</a></div><div class="ttdeci">static list_t KMallocTest[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:189</div></div>
<div class="ttc" id="klibc_8c_html_ae23144bcbb8e3742b00eb687c36654d1"><div class="ttname"><a href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a></div><div class="ttdeci">int rand(void)</div><div class="ttdoc">random int generator FIXME must be replaced by /dev/urandom https://en.wikipedia.org/wiki/Linear_cong...</div><div class="ttdef"><b>Definition:</b> klibc.c:17</div></div>
<div class="ttc" id="kmemory_8c_html_a64c1f767a18f26f8c8cabd0f82f3e04d"><div class="ttname"><a href="kmemory_8c.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree</a></div><div class="ttdeci">void kfree(void *obj, size_t size)</div><div class="ttdoc">free an allocated object with kmalloc() </div><div class="ttdef"><b>Definition:</b> kmemory.c:132</div></div>
<div class="ttc" id="list_8h_html_a4988c174e6ecc55436d5f0e3dbbb3980"><div class="ttname"><a href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init</a></div><div class="ttdeci">static void list_init(list_t *root)</div><div class="ttdoc">Initialize of the list root. </div><div class="ttdef"><b>Definition:</b> list.h:191</div></div>
<div class="ttc" id="kmemory_8c_html_af470e8520ef12288ba5f72c899bd4799"><div class="ttname"><a href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a></div><div class="ttdeci">static size_t MaxLinePage</div><div class="ttdef"><b>Definition:</b> kmemory.c:70</div></div>
<div class="ttc" id="kmemory_8c_html_a85a54e9787a16befde04a79fb6b83d96"><div class="ttname"><a href="kmemory_8c.html#a85a54e9787a16befde04a79fb6b83d96">NBLINE</a></div><div class="ttdeci">#define NBLINE(n)</div><div class="ttdef"><b>Definition:</b> kmemory.c:82</div></div>
<div class="ttc" id="list_8h_html_ac68d25438cd5f3cc2e5b04dbf174bf27"><div class="ttname"><a href="list_8h.html#ac68d25438cd5f3cc2e5b04dbf174bf27">list_unlink</a></div><div class="ttdeci">static list_t * list_unlink(list_t *item)</div><div class="ttdoc">Unlink (i.e. detach) an item of list. </div><div class="ttdef"><b>Definition:</b> list.h:231</div></div>
<div class="ttc" id="list_8h_html_ad759a32561623ec6b31549db8276e8b6"><div class="ttname"><a href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a></div><div class="ttdeci">#define list_foreach(ROOT, ITEM)</div><div class="ttdoc">C instruction to iterate through a list of items from first to last. list_foreach will iterate as man...</div><div class="ttdef"><b>Definition:</b> list.h:153</div></div>
<div class="ttc" id="klibc_8c_html_ac4ae3bb8e59735d2b772e77186b52228"><div class="ttname"><a href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a></div><div class="ttdeci">int kprintf(char *fmt,...)</div><div class="ttdoc">print a formated string to the TTY0 this a simplified version which handles only: c...</div><div class="ttdef"><b>Definition:</b> klibc.c:37</div></div>
<div class="ttc" id="kmemory_8c_html_a71239547b3491efafadee92180ba2b02"><div class="ttname"><a href="kmemory_8c.html#a71239547b3491efafadee92180ba2b02">kmalloc_print</a></div><div class="ttdeci">void kmalloc_print(void)</div><div class="ttdoc">Print data about slab allocator usage. </div><div class="ttdef"><b>Definition:</b> kmemory.c:159</div></div>
<div class="ttc" id="kmemory_8c_html_a7a2da4d001f5945106528b32581206e2"><div class="ttname"><a href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a></div><div class="ttdeci">static size_t CacheLineSize</div><div class="ttdef"><b>Definition:</b> kmemory.c:69</div></div>
<div class="ttc" id="structlist__s_html"><div class="ttname"><a href="structlist__s.html">list_s</a></div><div class="ttdoc">The 2-pointers structure to embed in the root of a list and in each of its items. ...</div><div class="ttdef"><b>Definition:</b> list.h:81</div></div>
<div class="ttc" id="list_8h_html_a60162e4580a37bddf823ca73567011d8"><div class="ttname"><a href="list_8h.html#a60162e4580a37bddf823ca73567011d8">list_getfirst</a></div><div class="ttdeci">static list_t * list_getfirst(list_t *root)</div><div class="ttdoc">Unlink (i.e. detach) the first item of list. </div><div class="ttdef"><b>Definition:</b> list.h:242</div></div>
<div class="ttc" id="list_8h_html_a116cfa18214dd2f855cff842bb14ca8f"><div class="ttname"><a href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast</a></div><div class="ttdeci">static void list_addlast(list_t *root, list_t *added_item)</div><div class="ttdoc">Add a new added item before the current item which is root the most often. then the added item is pla...</div><div class="ttdef"><b>Definition:</b> list.h:221</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2ce77af8c704a7d3f2204f94750daedb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int* malloc_ustack </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>allocate a new user stack </p>
<dl class="section return"><dt>Returns</dt><dd>a pointer to an empty stack (of STACK_SIZE bytes) The pointer is just above the new stack </dd></dl>

<p>References <a class="el" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>, <a class="el" href="list_8h.html#ab32a1c2580ccc334bb07c024d8e0a9c2">list_getlast()</a>, <a class="el" href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a>, <a class="el" href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">_usermem_s::uheap_end</a>, <a class="el" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a>, and <a class="el" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>.</p>

<p>Referenced by <a class="el" href="kmemory_8h.html#ad59a095064fc46b540321c14b65dab06">test_ustack()</a>, and <a class="el" href="kthread_8h.html#a227d30321d9dddb518fe5d116aa7d90b">thread_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordtype">int</span> * top;                                              <span class="comment">// top will be the new stack pointer</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordtype">int</span> * end = (<span class="keywordtype">int</span> *)<a class="code" href="list_8h.html#ab32a1c2580ccc334bb07c024d8e0a9c2">list_getlast</a> (&amp;<a class="code" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a>);       <span class="comment">// get last free stack (biggest addr)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <span class="keywordflow">if</span> (end == <a class="code" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {                                      <span class="comment">// if there is no more free stack</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        top = <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a>;                          <span class="comment">// try to get one</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        end = top - <a class="code" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>/<span class="keyword">sizeof</span>(int);                <span class="comment">// and compute the end of the stack</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> (end &lt; <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">uheap_end</a>,                 <span class="comment">// if the stack end is in the heap</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="stringliteral">&quot;no more space for user stack!\n&quot;</span>);             <span class="comment">// it is impossible to solve that</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a> = end;                          <span class="comment">// expand the stacks&#39; region</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        top = end + <a class="code" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>/<span class="keyword">sizeof</span>(int);                <span class="comment">// compute stack&#39;s top from stack&#39;s end</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    top--;                                                  <span class="comment">// get a word to put MAGIC</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    *top = *end = <a class="code" href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a>;                              <span class="comment">// to be able to check free</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">return</span> top;                                             <span class="comment">// finally return the top</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div>
<div class="ttc" id="usermem_8h_html_a34ef3ea96595898f1452b49d29a1722a"><div class="ttname"><a href="usermem_8h.html#a34ef3ea96595898f1452b49d29a1722a">MAGIC_STACK</a></div><div class="ttdeci">#define MAGIC_STACK</div><div class="ttdef"><b>Definition:</b> usermem.h:21</div></div>
<div class="ttc" id="kmemory_8c_html_a0893d9ddd9d1a491788e16024697251e"><div class="ttname"><a href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a></div><div class="ttdeci">static list_t FreeUserStack</div><div class="ttdef"><b>Definition:</b> kmemory.c:68</div></div>
<div class="ttc" id="list_8h_html_ab32a1c2580ccc334bb07c024d8e0a9c2"><div class="ttname"><a href="list_8h.html#ab32a1c2580ccc334bb07c024d8e0a9c2">list_getlast</a></div><div class="ttdeci">static list_t * list_getlast(list_t *root)</div><div class="ttdoc">Unlink (i.e. detach) the last item of list. </div><div class="ttdef"><b>Definition:</b> list.h:251</div></div>
<div class="ttc" id="debug__on_8h_html_a9dea4233af3c516959b7255fbea5c79b"><div class="ttname"><a href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a></div><div class="ttdeci">#define PANIC_IF(cond, fmt, arg...)</div><div class="ttdoc">Check a condition and write a formated message on console if false and stop execution. </div><div class="ttdef"><b>Definition:</b> debug_on.h:38</div></div>
<div class="ttc" id="usermem_8h_html_af044184d28c9a8b78f17bd1d8e1059b4"><div class="ttname"><a href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a></div><div class="ttdeci">_usermem_t _usermem</div></div>
<div class="ttc" id="struct__usermem__s_html_afc2d87db58cb56804172f98d124d3c05"><div class="ttname"><a href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">_usermem_s::uheap_end</a></div><div class="ttdeci">int * uheap_end</div><div class="ttdoc">highest address of the user heap segment (also named brk) </div><div class="ttdef"><b>Definition:</b> usermem.h:53</div></div>
<div class="ttc" id="usermem_8h_html_ad77d03e18a9477ef16ff8c4ae3c8b43d"><div class="ttname"><a href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a></div><div class="ttdeci">#define USTACK_SIZE</div><div class="ttdef"><b>Definition:</b> usermem.h:20</div></div>
<div class="ttc" id="kfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
<div class="ttc" id="struct__usermem__s_html_a2ff86fc41cdbe6063962b5be6aef49fc"><div class="ttname"><a href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a></div><div class="ttdeci">int * ustack_end</div><div class="ttdoc">lowest address of the user stack segment </div><div class="ttdef"><b>Definition:</b> usermem.h:52</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a34f25b1ca1556d0890274a971d46af10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void memory_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>initialize all the kernel memory allocators </p>

<p>References <a class="el" href="mips_2cache_8S.html#a2ffad5962fec472ce41e46451bcd8f02">cachelinesize</a>, <a class="el" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>, <a class="el" href="klibc_8h.html#afa6921cfca101af04b9dcc8d29bc7b16">CEIL</a>, <a class="el" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, <a class="el" href="kmemory_8c.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>, <a class="el" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>, <a class="el" href="kmemory_8c.html#aac8be82d7bffa1ad691b1bd5d24492ea">kme</a>, <a class="el" href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast()</a>, <a class="el" href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init()</a>, <a class="el" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a>, <a class="el" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>, <a class="el" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>, and <a class="el" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a>.</p>

<p>Referenced by <a class="el" href="kinit_8c.html#a7316311400d5b710f1b974a353b10d1c">kinit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a> = <a class="code" href="klibc_8h.html#afa6921cfca101af04b9dcc8d29bc7b16">CEIL</a>(<a class="code" href="mips_2cache_8S.html#a2ffad5962fec472ce41e46451bcd8f02">cachelinesize</a>(),16);               <span class="comment">// true line size, but expand to 16 min</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a> = (<a class="code" href="kmemory_8c.html#aac8be82d7bffa1ad691b1bd5d24492ea">kme</a>-<a class="code" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>)/<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;                          <span class="comment">// maximum number of pages</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a> = <a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> / <a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>;                <span class="comment">// 256 when line is 16, 128 for 32, etc.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a> (<a class="code" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>*<span class="keyword">sizeof</span>(<a class="code" href="structpage__s.html">page_t</a>) &gt; <a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>,           <span class="comment">// Not more than 2048 thus 8MB</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="stringliteral">&quot;kmalloc can&#39;t handled %d pages&quot;</span>, <a class="code" href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a>);         <span class="comment">// write a message then panic</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <a class="code" href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init</a> (&amp;<a class="code" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a>);                             <span class="comment">// initialize the free user stack list</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0 ; i &lt; <a class="code" href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a> ; i++)                 <span class="comment">// initialize each list is Slab table</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <a class="code" href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[i]);                               <span class="comment">// Slab[i] -&gt; i*cachelinesize objects</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *p = <a class="code" href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a>; p != <a class="code" href="kmemory_8c.html#aac8be82d7bffa1ad691b1bd5d24492ea">kme</a>; p += <a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>)           <span class="comment">// initialize the page (slab) list</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <a class="code" href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast</a> (&amp;<a class="code" href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a>[0], (<a class="code" href="structlist__s.html">list_t</a> *)p);               <span class="comment">// pointed by Slab[0]</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a> = <a class="code" href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a> (<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>);                             <span class="comment">// allocate the Page decritor table</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <a class="code" href="kmemory_8c.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test</a>(0,<a class="code" href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>/8);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="ttc" id="structpage__s_html"><div class="ttname"><a href="structpage__s.html">page_s</a></div><div class="ttdef"><b>Definition:</b> kmemory.c:73</div></div>
<div class="ttc" id="kmemory_8c_html_a5f52d7c56b7d67dc2f96b2e93dfdc7be"><div class="ttname"><a href="kmemory_8c.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc</a></div><div class="ttdeci">void * kmalloc(size_t size)</div><div class="ttdoc">allocate an object in the kernel address space </div><div class="ttdef"><b>Definition:</b> kmemory.c:105</div></div>
<div class="ttc" id="usermem_8h_html_a7d467c1d283fdfa1f2081ba1e0d01b6e"><div class="ttname"><a href="usermem_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a></div><div class="ttdeci">#define PAGE_SIZE</div><div class="ttdef"><b>Definition:</b> usermem.h:19</div></div>
<div class="ttc" id="kmemory_8c_html_a4c7f2ce6c58dbea9f3f45c967f370a4a"><div class="ttname"><a href="kmemory_8c.html#a4c7f2ce6c58dbea9f3f45c967f370a4a">NbPages</a></div><div class="ttdeci">static size_t NbPages</div><div class="ttdef"><b>Definition:</b> kmemory.c:80</div></div>
<div class="ttc" id="kmemory_8c_html_a0893d9ddd9d1a491788e16024697251e"><div class="ttname"><a href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a></div><div class="ttdeci">static list_t FreeUserStack</div><div class="ttdef"><b>Definition:</b> kmemory.c:68</div></div>
<div class="ttc" id="kmemory_8c_html_a5ca59e07ccac5f97fd636413b47818e9"><div class="ttname"><a href="kmemory_8c.html#a5ca59e07ccac5f97fd636413b47818e9">kmb</a></div><div class="ttdeci">#define kmb</div><div class="ttdef"><b>Definition:</b> kmemory.c:66</div></div>
<div class="ttc" id="kmemory_8c_html_a6cfd6b96caef4efda19f082f3ef8cd2d"><div class="ttname"><a href="kmemory_8c.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test</a></div><div class="ttdeci">void kmalloc_test(size_t turn, size_t size)</div><div class="ttdoc">Test Slab alocator, allocates and frees as many values as &amp;#39;turn&amp;#39; then free all test. </div><div class="ttdef"><b>Definition:</b> kmemory.c:190</div></div>
<div class="ttc" id="list_8h_html_a4988c174e6ecc55436d5f0e3dbbb3980"><div class="ttname"><a href="list_8h.html#a4988c174e6ecc55436d5f0e3dbbb3980">list_init</a></div><div class="ttdeci">static void list_init(list_t *root)</div><div class="ttdoc">Initialize of the list root. </div><div class="ttdef"><b>Definition:</b> list.h:191</div></div>
<div class="ttc" id="kmemory_8c_html_af470e8520ef12288ba5f72c899bd4799"><div class="ttname"><a href="kmemory_8c.html#af470e8520ef12288ba5f72c899bd4799">MaxLinePage</a></div><div class="ttdeci">static size_t MaxLinePage</div><div class="ttdef"><b>Definition:</b> kmemory.c:70</div></div>
<div class="ttc" id="klibc_8h_html_afa6921cfca101af04b9dcc8d29bc7b16"><div class="ttname"><a href="klibc_8h.html#afa6921cfca101af04b9dcc8d29bc7b16">CEIL</a></div><div class="ttdeci">#define CEIL(a, b)</div><div class="ttdef"><b>Definition:</b> klibc.h:60</div></div>
<div class="ttc" id="debug__on_8h_html_a9dea4233af3c516959b7255fbea5c79b"><div class="ttname"><a href="debug__on_8h.html#a9dea4233af3c516959b7255fbea5c79b">PANIC_IF</a></div><div class="ttdeci">#define PANIC_IF(cond, fmt, arg...)</div><div class="ttdoc">Check a condition and write a formated message on console if false and stop execution. </div><div class="ttdef"><b>Definition:</b> debug_on.h:38</div></div>
<div class="ttc" id="kmemory_8c_html_a7a2da4d001f5945106528b32581206e2"><div class="ttname"><a href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a></div><div class="ttdeci">static size_t CacheLineSize</div><div class="ttdef"><b>Definition:</b> kmemory.c:69</div></div>
<div class="ttc" id="kmemory_8c_html_ad3e3a67efeec7e5535c5f05360111d34"><div class="ttname"><a href="kmemory_8c.html#ad3e3a67efeec7e5535c5f05360111d34">Page</a></div><div class="ttdeci">static page_t * Page</div><div class="ttdef"><b>Definition:</b> kmemory.c:79</div></div>
<div class="ttc" id="kmemory_8c_html_af76c5bf598586d0024d1e53b108c868c"><div class="ttname"><a href="kmemory_8c.html#af76c5bf598586d0024d1e53b108c868c">Slab</a></div><div class="ttdeci">static list_t Slab[256]</div><div class="ttdef"><b>Definition:</b> kmemory.c:71</div></div>
<div class="ttc" id="kmemory_8c_html_aac8be82d7bffa1ad691b1bd5d24492ea"><div class="ttname"><a href="kmemory_8c.html#aac8be82d7bffa1ad691b1bd5d24492ea">kme</a></div><div class="ttdeci">#define kme</div><div class="ttdef"><b>Definition:</b> kmemory.c:67</div></div>
<div class="ttc" id="structlist__s_html"><div class="ttname"><a href="structlist__s.html">list_s</a></div><div class="ttdoc">The 2-pointers structure to embed in the root of a list and in each of its items. ...</div><div class="ttdef"><b>Definition:</b> list.h:81</div></div>
<div class="ttc" id="mips_2cache_8S_html_a2ffad5962fec472ce41e46451bcd8f02"><div class="ttname"><a href="mips_2cache_8S.html#a2ffad5962fec472ce41e46451bcd8f02">cachelinesize</a></div><div class="ttdeci">section text globl cachelinesize cachelinesize</div><div class="ttdef"><b>Definition:</b> cache.S:21</div></div>
<div class="ttc" id="list_8h_html_a116cfa18214dd2f855cff842bb14ca8f"><div class="ttname"><a href="list_8h.html#a116cfa18214dd2f855cff842bb14ca8f">list_addlast</a></div><div class="ttdeci">static void list_addlast(list_t *root, list_t *added_item)</div><div class="ttdoc">Add a new added item before the current item which is root the most often. then the added item is pla...</div><div class="ttdef"><b>Definition:</b> list.h:221</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab85de89de0e4aa840b3d48ffe4f4d5e3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_ustack </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>print ustack state </p>

<p>References <a class="el" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>, <a class="el" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf()</a>, <a class="el" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a>, <a class="el" href="struct__usermem__s.html#a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7">_usermem_s::uheap_beg</a>, <a class="el" href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">_usermem_s::uheap_end</a>, <a class="el" href="struct__usermem__s.html#a2fd1c0d0e8502f93210c3a30d3746d06">_usermem_s::ustack_beg</a>, <a class="el" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a>, and <a class="el" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>.</p>

<p>Referenced by <a class="el" href="kmemory_8h.html#ad59a095064fc46b540321c14b65dab06">test_ustack()</a>.</p>
<div class="fragment"><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;{</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;---------------\nNumber of stacks : %d\n&quot;</span>,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            ((<span class="keywordtype">char</span> *)(<a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2fd1c0d0e8502f93210c3a30d3746d06">ustack_beg</a>) -</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;             (<span class="keywordtype">char</span> *)(<a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a>) )/<a class="code" href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a>);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;_usermem.ustack_beg : %p\n&quot;</span>, <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2fd1c0d0e8502f93210c3a30d3746d06">ustack_beg</a>);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;_usermem.ustack_end : %p\n&quot;</span>, <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a>);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;_usermem.uheap_beg  : %p\n&quot;</span>, <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7">uheap_beg</a> );</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;_usermem.uheap_end  : %p\n&quot;</span>, <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">uheap_end</a> );</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;----\nFree stacks : \n&quot;</span>);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <a class="code" href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a> (&amp;<a class="code" href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a>, item) {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <a class="code" href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a> (<span class="stringliteral">&quot;Address %p\n&quot;</span>, item);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;}</div>
<div class="ttc" id="kmemory_8c_html_a0893d9ddd9d1a491788e16024697251e"><div class="ttname"><a href="kmemory_8c.html#a0893d9ddd9d1a491788e16024697251e">FreeUserStack</a></div><div class="ttdeci">static list_t FreeUserStack</div><div class="ttdef"><b>Definition:</b> kmemory.c:68</div></div>
<div class="ttc" id="struct__usermem__s_html_a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7"><div class="ttname"><a href="struct__usermem__s.html#a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7">_usermem_s::uheap_beg</a></div><div class="ttdeci">int * uheap_beg</div><div class="ttdoc">lowest highest address of the user heap segment </div><div class="ttdef"><b>Definition:</b> usermem.h:54</div></div>
<div class="ttc" id="struct__usermem__s_html_a2fd1c0d0e8502f93210c3a30d3746d06"><div class="ttname"><a href="struct__usermem__s.html#a2fd1c0d0e8502f93210c3a30d3746d06">_usermem_s::ustack_beg</a></div><div class="ttdeci">int * ustack_beg</div><div class="ttdoc">highest address of the user stack segment </div><div class="ttdef"><b>Definition:</b> usermem.h:51</div></div>
<div class="ttc" id="list_8h_html_ad759a32561623ec6b31549db8276e8b6"><div class="ttname"><a href="list_8h.html#ad759a32561623ec6b31549db8276e8b6">list_foreach</a></div><div class="ttdeci">#define list_foreach(ROOT, ITEM)</div><div class="ttdoc">C instruction to iterate through a list of items from first to last. list_foreach will iterate as man...</div><div class="ttdef"><b>Definition:</b> list.h:153</div></div>
<div class="ttc" id="usermem_8h_html_af044184d28c9a8b78f17bd1d8e1059b4"><div class="ttname"><a href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a></div><div class="ttdeci">_usermem_t _usermem</div></div>
<div class="ttc" id="klibc_8c_html_ac4ae3bb8e59735d2b772e77186b52228"><div class="ttname"><a href="klibc_8c.html#ac4ae3bb8e59735d2b772e77186b52228">kprintf</a></div><div class="ttdeci">int kprintf(char *fmt,...)</div><div class="ttdoc">print a formated string to the TTY0 this a simplified version which handles only: c...</div><div class="ttdef"><b>Definition:</b> klibc.c:37</div></div>
<div class="ttc" id="struct__usermem__s_html_afc2d87db58cb56804172f98d124d3c05"><div class="ttname"><a href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">_usermem_s::uheap_end</a></div><div class="ttdeci">int * uheap_end</div><div class="ttdoc">highest address of the user heap segment (also named brk) </div><div class="ttdef"><b>Definition:</b> usermem.h:53</div></div>
<div class="ttc" id="usermem_8h_html_ad77d03e18a9477ef16ff8c4ae3c8b43d"><div class="ttname"><a href="usermem_8h.html#ad77d03e18a9477ef16ff8c4ae3c8b43d">USTACK_SIZE</a></div><div class="ttdeci">#define USTACK_SIZE</div><div class="ttdef"><b>Definition:</b> usermem.h:20</div></div>
<div class="ttc" id="struct__usermem__s_html_a2ff86fc41cdbe6063962b5be6aef49fc"><div class="ttname"><a href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a></div><div class="ttdeci">int * ustack_end</div><div class="ttdoc">lowest address of the user stack segment </div><div class="ttdef"><b>Definition:</b> usermem.h:52</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3736b4c8c3376c224d8a70e39b1a017"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* sbrk </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>increment</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>change the boundary of the heap </p>
<p>change the boundary of heap</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">increment</td><td>integer added to the current heap boundary </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SUCCESS or FAILURE </dd></dl>

<p>Referenced by <a class="el" href="memory_8h.html#a552e72b11235cf8c6263b5d199e988ad">malloc_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="usermem_8h.html#ab03f640d90fbc5bcb75285d08a0f25ed">errno</a> = <a class="code" href="errno_8h.html#a447416ba79b4777e7accabf3a8163cb3ac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="keywordtype">int</span> * a = <a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">uheap_end</a> + increment/<span class="keyword">sizeof</span>(int);   <span class="comment">// sizeof() because uheap_end is int*</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    a = (<span class="keywordtype">int</span> *) <a class="code" href="klibc_8h.html#af76aa89c75eec80890c7a792f1fadda7">FLOOR</a> (a, <a class="code" href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a>);                   <span class="comment">// addr &#39;a&#39; could be the new uheap_end</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keywordflow">if</span> ((a&lt;<a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7">uheap_beg</a>)||(a&gt;<a class="code" href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a>.<a class="code" href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">ustack_end</a>)){  <span class="comment">// if it is outside the heap zone</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="usermem_8h.html#ab03f640d90fbc5bcb75285d08a0f25ed">errno</a> = <a class="code" href="errno_8h.html#a447416ba79b4777e7accabf3a8163cb3aec0aa1bb79e2e55ed6d8c165e0611eca">ENOMEM</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)-1;                                  <span class="comment">// -1 on failure</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">return</span> a;                                               <span class="comment">// else return a;</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div>
<div class="ttc" id="struct__usermem__s_html_a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7"><div class="ttname"><a href="struct__usermem__s.html#a0ada31d8a3c5cd0a5d82fe3b0ea7bbe7">_usermem_s::uheap_beg</a></div><div class="ttdeci">int * uheap_beg</div><div class="ttdoc">lowest highest address of the user heap segment </div><div class="ttdef"><b>Definition:</b> usermem.h:54</div></div>
<div class="ttc" id="errno_8h_html_a447416ba79b4777e7accabf3a8163cb3ac7f69f7c9e5aea9b8f54cf02870e2bf8"><div class="ttname"><a href="errno_8h.html#a447416ba79b4777e7accabf3a8163cb3ac7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a></div><div class="ttdef"><b>Definition:</b> errno.h:34</div></div>
<div class="ttc" id="usermem_8h_html_af044184d28c9a8b78f17bd1d8e1059b4"><div class="ttname"><a href="usermem_8h.html#af044184d28c9a8b78f17bd1d8e1059b4">_usermem</a></div><div class="ttdeci">_usermem_t _usermem</div></div>
<div class="ttc" id="errno_8h_html_a447416ba79b4777e7accabf3a8163cb3aec0aa1bb79e2e55ed6d8c165e0611eca"><div class="ttname"><a href="errno_8h.html#a447416ba79b4777e7accabf3a8163cb3aec0aa1bb79e2e55ed6d8c165e0611eca">ENOMEM</a></div><div class="ttdef"><b>Definition:</b> errno.h:47</div></div>
<div class="ttc" id="usermem_8h_html_ab03f640d90fbc5bcb75285d08a0f25ed"><div class="ttname"><a href="usermem_8h.html#ab03f640d90fbc5bcb75285d08a0f25ed">errno</a></div><div class="ttdeci">#define errno</div><div class="ttdef"><b>Definition:</b> usermem.h:78</div></div>
<div class="ttc" id="struct__usermem__s_html_afc2d87db58cb56804172f98d124d3c05"><div class="ttname"><a href="struct__usermem__s.html#afc2d87db58cb56804172f98d124d3c05">_usermem_s::uheap_end</a></div><div class="ttdeci">int * uheap_end</div><div class="ttdoc">highest address of the user heap segment (also named brk) </div><div class="ttdef"><b>Definition:</b> usermem.h:53</div></div>
<div class="ttc" id="kmemory_8c_html_a7a2da4d001f5945106528b32581206e2"><div class="ttname"><a href="kmemory_8c.html#a7a2da4d001f5945106528b32581206e2">CacheLineSize</a></div><div class="ttdeci">static size_t CacheLineSize</div><div class="ttdef"><b>Definition:</b> kmemory.c:69</div></div>
<div class="ttc" id="klibc_8h_html_af76aa89c75eec80890c7a792f1fadda7"><div class="ttname"><a href="klibc_8h.html#af76aa89c75eec80890c7a792f1fadda7">FLOOR</a></div><div class="ttdeci">#define FLOOR(a, b)</div><div class="ttdef"><b>Definition:</b> klibc.h:61</div></div>
<div class="ttc" id="struct__usermem__s_html_a2ff86fc41cdbe6063962b5be6aef49fc"><div class="ttname"><a href="struct__usermem__s.html#a2ff86fc41cdbe6063962b5be6aef49fc">_usermem_s::ustack_end</a></div><div class="ttdeci">int * ustack_end</div><div class="ttdoc">lowest address of the user stack segment </div><div class="ttdef"><b>Definition:</b> usermem.h:52</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad59a095064fc46b540321c14b65dab06"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test_ustack </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>turn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902">free_ustack()</a>, <a class="el" href="kmemory_8c.html#a2ce77af8c704a7d3f2204f94750daedb">malloc_ustack()</a>, <a class="el" href="kmemory_8c.html#a87be89cfdd7a7fa303a8f146373124bc">NBSTACK</a>, <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="kmemory_8c.html#ab85de89de0e4aa840b3d48ffe4f4d5e3">print_ustack()</a>, and <a class="el" href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand()</a>.</p>
<div class="fragment"><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;{</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="preprocessor">#   define NBSTACK    10</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="preprocessor"></span>    <span class="keywordtype">int</span> * stack [<a class="code" href="kmemory_8c.html#a87be89cfdd7a7fa303a8f146373124bc">NBSTACK</a>] = {<a class="code" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>};</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">while</span> (turn--) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordtype">int</span> place = (unsigned)<a class="code" href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a>() % <a class="code" href="kmemory_8c.html#a87be89cfdd7a7fa303a8f146373124bc">NBSTACK</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">if</span> (stack[place])</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <a class="code" href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902">free_ustack</a> (stack[place]);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        stack[place] = <a class="code" href="kmemory_8c.html#a2ce77af8c704a7d3f2204f94750daedb">malloc_ustack</a>();</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> place = 0; place &lt; <a class="code" href="kmemory_8c.html#a87be89cfdd7a7fa303a8f146373124bc">NBSTACK</a>; place++)</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> (stack[place])</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <a class="code" href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902">free_ustack</a> (stack[place]);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="kmemory_8c.html#ab85de89de0e4aa840b3d48ffe4f4d5e3">print_ustack</a>();</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div>
<div class="ttc" id="kmemory_8c_html_a2ce77af8c704a7d3f2204f94750daedb"><div class="ttname"><a href="kmemory_8c.html#a2ce77af8c704a7d3f2204f94750daedb">malloc_ustack</a></div><div class="ttdeci">int * malloc_ustack(void)</div><div class="ttdoc">allocate a new user stack </div><div class="ttdef"><b>Definition:</b> kmemory.c:236</div></div>
<div class="ttc" id="kmemory_8c_html_ab85de89de0e4aa840b3d48ffe4f4d5e3"><div class="ttname"><a href="kmemory_8c.html#ab85de89de0e4aa840b3d48ffe4f4d5e3">print_ustack</a></div><div class="ttdeci">void print_ustack(void)</div><div class="ttdoc">print ustack state </div><div class="ttdef"><b>Definition:</b> kmemory.c:283</div></div>
<div class="ttc" id="klibc_8c_html_ae23144bcbb8e3742b00eb687c36654d1"><div class="ttname"><a href="klibc_8c.html#ae23144bcbb8e3742b00eb687c36654d1">rand</a></div><div class="ttdeci">int rand(void)</div><div class="ttdoc">random int generator FIXME must be replaced by /dev/urandom https://en.wikipedia.org/wiki/Linear_cong...</div><div class="ttdef"><b>Definition:</b> klibc.c:17</div></div>
<div class="ttc" id="kmemory_8c_html_a77191559ef009fa20ada65a52b5e9902"><div class="ttname"><a href="kmemory_8c.html#a77191559ef009fa20ada65a52b5e9902">free_ustack</a></div><div class="ttdeci">void free_ustack(int *top)</div><div class="ttdoc">free a use stack </div><div class="ttdef"><b>Definition:</b> kmemory.c:264</div></div>
<div class="ttc" id="kmemory_8c_html_a87be89cfdd7a7fa303a8f146373124bc"><div class="ttname"><a href="kmemory_8c.html#a87be89cfdd7a7fa303a8f146373124bc">NBSTACK</a></div><div class="ttdeci">#define NBSTACK</div></div>
<div class="ttc" id="kfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="adbad17f740c2d7f2bc4833681c93c932"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char __bss_end</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="crt0_8c.html#aafc0986b658358bb5dd781735136ecdd">__attribute__()</a>, <a class="el" href="crt0_8c.html#a8b67a6ff3f33fae9b3f1b142005c0bc2">_start()</a>, and <a class="el" href="kinit_8c.html#a7316311400d5b710f1b974a353b10d1c">kinit()</a>.</p>

</div>
</div>
<a class="anchor" id="a869ed24619b20d01d0f6c457c069ec96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char __kdata_end</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7a2da4d001f5945106528b32581206e2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t CacheLineSize</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, <a class="el" href="kmemory_8h.html#a71239547b3491efafadee92180ba2b02">kmalloc_print()</a>, <a class="el" href="kmemory_8h.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>, <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>, and <a class="el" href="memory_8h.html#ad3736b4c8c3376c224d8a70e39b1a017">sbrk()</a>.</p>

</div>
</div>
<a class="anchor" id="af8289aec0c28713b9bf8c8040374673b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kmemory_8c.html#ac7c0e9f07b4717ffca845d3a530e7530">page_t</a> DummyPage</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a0893d9ddd9d1a491788e16024697251e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> FreeUserStack</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="adb163f59e8b9324e1de98021ca40ff92"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> KMallocTest[256]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="af470e8520ef12288ba5f72c899bd4799"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t MaxLinePage</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree()</a>, <a class="el" href="kmemory_8h.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, <a class="el" href="kmemory_8h.html#a71239547b3491efafadee92180ba2b02">kmalloc_print()</a>, <a class="el" href="kmemory_8h.html#a6cfd6b96caef4efda19f082f3ef8cd2d">kmalloc_test()</a>, and <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a4c7f2ce6c58dbea9f3f45c967f370a4a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t NbPages</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree()</a>, <a class="el" href="kmemory_8h.html#a71239547b3491efafadee92180ba2b02">kmalloc_print()</a>, and <a class="el" href="kmemory_8h.html#a34f25b1ca1556d0890274a971d46af10">memory_init()</a>.</p>

</div>
</div>
<a class="anchor" id="af2258d5c2be05af348af68e9e588a06a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t ObjectsThisSize[256]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kmemory_8h.html#a64c1f767a18f26f8c8cabd0f82f3e04d">kfree()</a>, <a class="el" href="kmemory_8h.html#a5f52d7c56b7d67dc2f96b2e93dfdc7be">kmalloc()</a>, and <a class="el" href="kmemory_8h.html#a71239547b3491efafadee92180ba2b02">kmalloc_print()</a>.</p>

</div>
</div>
<a class="anchor" id="ad3e3a67efeec7e5535c5f05360111d34"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kmemory_8c.html#ac7c0e9f07b4717ffca845d3a530e7530">page_t</a>* Page = &amp;<a class="el" href="kmemory_8c.html#af8289aec0c28713b9bf8c8040374673b">DummyPage</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="af76c5bf598586d0024d1e53b108c868c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="list_8h.html#ad3b2684139c847cd572cb7b9679ce227">list_t</a> Slab[256]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
