<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ko6: /users/enseig/franck/ko6/src/soft/fs/kfs/kfs.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo55.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ko6
   </div>
   <div id="projectbrief">ko6 (prononce it &#39;kit-O-sys&#39; O is  the letter not the number) is a small operating system for educationnal purpose</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_8785740846211ac34fd04c61a1fdd888.html">soft</a></li><li class="navelem"><a class="el" href="dir_c9f83417c2b3f935a5ca497b28346c08.html">fs</a></li><li class="navelem"><a class="el" href="dir_84ebf85154e4c8e3a85777d360bfb661.html">kfs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">kfs.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="kfs_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7c0f2945d18d92bc9b2e754b377335b3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a7c0f2945d18d92bc9b2e754b377335b3">KFS_NPG_DISK</a>&#160;&#160;&#160;0x2000  /* number of pages in the whole disk */</td></tr>
<tr class="separator:a7c0f2945d18d92bc9b2e754b377335b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab547fa38768be432271323a0e509df32"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ab547fa38768be432271323a0e509df32">KFS_NPG_MBR</a>&#160;&#160;&#160;1       /* number of pages in MBR */</td></tr>
<tr class="separator:ab547fa38768be432271323a0e509df32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada947412302e76983f1eea2cb524ec2d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ada947412302e76983f1eea2cb524ec2d">KFS_NPG_VBR</a>&#160;&#160;&#160;3       /* number of pages in VBR (bootloader) */</td></tr>
<tr class="separator:ada947412302e76983f1eea2cb524ec2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82f61eaff20e7015c52261a2423ab0af"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a82f61eaff20e7015c52261a2423ab0af">KFS_NPG_SBLOCK</a>&#160;&#160;&#160;2       /* number of pages in SBLOCK (contains all bitmaps) */</td></tr>
<tr class="separator:a82f61eaff20e7015c52261a2423ab0af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a012e85f2bb85ec2d5bdff1d298929018"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a012e85f2bb85ec2d5bdff1d298929018">KFS_NPG_DENTRY</a>&#160;&#160;&#160;2       /* number of pages for all dentries */</td></tr>
<tr class="separator:a012e85f2bb85ec2d5bdff1d298929018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93b1915cf843dbd16b8d274ee4751acb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a93b1915cf843dbd16b8d274ee4751acb">KFS_NPG_INODE</a>&#160;&#160;&#160;2       /* number of pages for all inodes */</td></tr>
<tr class="separator:a93b1915cf843dbd16b8d274ee4751acb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae070eb53d573680911159a7cbb4b90e2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ae070eb53d573680911159a7cbb4b90e2">KFS_NPG_FMAP</a>&#160;&#160;&#160;16      /* number of pages for all file maps (inode extensions) */</td></tr>
<tr class="separator:ae070eb53d573680911159a7cbb4b90e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d29f6159278cfe6da1ae6fefb40c46"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a75d29f6159278cfe6da1ae6fefb40c46">KFS_NPG_BOOT</a>&#160;&#160;&#160;(<a class="el" href="kfs_8h.html#ab547fa38768be432271323a0e509df32">KFS_NPG_MBR</a>+<a class="el" href="kfs_8h.html#ada947412302e76983f1eea2cb524ec2d">KFS_NPG_VBR</a>)</td></tr>
<tr class="separator:a75d29f6159278cfe6da1ae6fefb40c46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fc604f5c0a4a2971369642c96f07abf"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a2fc604f5c0a4a2971369642c96f07abf">KFS_NPG_META</a>&#160;&#160;&#160;(<a class="el" href="kfs_8h.html#a82f61eaff20e7015c52261a2423ab0af">KFS_NPG_SBLOCK</a>+<a class="el" href="kfs_8h.html#a012e85f2bb85ec2d5bdff1d298929018">KFS_NPG_DENTRY</a>+<a class="el" href="kfs_8h.html#a93b1915cf843dbd16b8d274ee4751acb">KFS_NPG_INODE</a>+<a class="el" href="kfs_8h.html#ae070eb53d573680911159a7cbb4b90e2">KFS_NPG_FMAP</a>)</td></tr>
<tr class="separator:a2fc604f5c0a4a2971369642c96f07abf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a60283510d9cdbdb54a244958b0938e15"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15">kfs_type_e</a> { <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, 
<a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>, 
<a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed">KFS_PIPE</a>, 
<a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1">KFS_SLINK</a>
 }</td></tr>
<tr class="separator:a60283510d9cdbdb54a244958b0938e15"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ade5bf93265bc86a9ecd5019cc6e3d277"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ade5bf93265bc86a9ecd5019cc6e3d277">kfs_root</a> (int dentry)</td></tr>
<tr class="memdesc:ade5bf93265bc86a9ecd5019cc6e3d277"><td class="mdescLeft">&#160;</td><td class="mdescRight">read access functions to dentries  <a href="#ade5bf93265bc86a9ecd5019cc6e3d277">More...</a><br/></td></tr>
<tr class="separator:ade5bf93265bc86a9ecd5019cc6e3d277"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3be0d586ff3044979a3c381137d77d47"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a3be0d586ff3044979a3c381137d77d47">kfs_next</a> (int dentry)</td></tr>
<tr class="separator:a3be0d586ff3044979a3c381137d77d47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a135f3848117282c89e3be09b930eb9de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf</a> (int dentry)</td></tr>
<tr class="separator:a135f3848117282c89e3be09b930eb9de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae206d59d8bc4514d34dafdff1198ede"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a> (int dentry)</td></tr>
<tr class="separator:aae206d59d8bc4514d34dafdff1198ede"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d837cb422897570c876a655c0b762be"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a9d837cb422897570c876a655c0b762be">kfs_name</a> (int dentry)</td></tr>
<tr class="separator:a9d837cb422897570c876a655c0b762be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2308b1a426032672fbacdde9ee5ac81"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a> (int dentry)</td></tr>
<tr class="memdesc:ac2308b1a426032672fbacdde9ee5ac81"><td class="mdescLeft">&#160;</td><td class="mdescRight">boolean functions for dentries or inode  <a href="#ac2308b1a426032672fbacdde9ee5ac81">More...</a><br/></td></tr>
<tr class="separator:ac2308b1a426032672fbacdde9ee5ac81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa0d81604e0d3d23f31b3beb7dcb163c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#aaa0d81604e0d3d23f31b3beb7dcb163c">kfs_count</a> (int inode)</td></tr>
<tr class="memdesc:aaa0d81604e0d3d23f31b3beb7dcb163c"><td class="mdescLeft">&#160;</td><td class="mdescRight">read access functions to inodes  <a href="#aaa0d81604e0d3d23f31b3beb7dcb163c">More...</a><br/></td></tr>
<tr class="separator:aaa0d81604e0d3d23f31b3beb7dcb163c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d546cf291d26ab01a150b74cc206ae1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a8d546cf291d26ab01a150b74cc206ae1">kfs_type</a> (int inode)</td></tr>
<tr class="separator:a8d546cf291d26ab01a150b74cc206ae1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9581ae711d5f79aff1ed39c9739e80c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ac9581ae711d5f79aff1ed39c9739e80c">kfs_mode</a> (int inode)</td></tr>
<tr class="separator:ac9581ae711d5f79aff1ed39c9739e80c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e7cb7a15052f57bdff8a2c1146bc072"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a> (int inode)</td></tr>
<tr class="separator:a2e7cb7a15052f57bdff8a2c1146bc072"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f522cb4edeecd6cbcebcca31d90bc75"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a2f522cb4edeecd6cbcebcca31d90bc75">kfs_owner</a> (int inode)</td></tr>
<tr class="separator:a2f522cb4edeecd6cbcebcca31d90bc75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b41dd15430924703df46a579ff05b2e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a9b41dd15430924703df46a579ff05b2e">kfs_mtime</a> (int inode)</td></tr>
<tr class="separator:a9b41dd15430924703df46a579ff05b2e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdc75626536d311fb2fe47baef24ef55"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a> (int inode, int pg_offset)</td></tr>
<tr class="separator:afdc75626536d311fb2fe47baef24ef55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30d4e1ffe8c1ea75120811fcf3055c05"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a30d4e1ffe8c1ea75120811fcf3055c05">kfs_chmode</a> (int inode, int mode)</td></tr>
<tr class="memdesc:a30d4e1ffe8c1ea75120811fcf3055c05"><td class="mdescLeft">&#160;</td><td class="mdescRight">write access functions to inode's properties  <a href="#a30d4e1ffe8c1ea75120811fcf3055c05">More...</a><br/></td></tr>
<tr class="separator:a30d4e1ffe8c1ea75120811fcf3055c05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e380775665de4ff6cbc01555444cb64"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a3e380775665de4ff6cbc01555444cb64">kfs_chowner</a> (int inode, int owner)</td></tr>
<tr class="separator:a3e380775665de4ff6cbc01555444cb64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68786a19dcb587fe18b45ae76effa1c5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a68786a19dcb587fe18b45ae76effa1c5">kfs_chmtime</a> (int inode, int mtime)</td></tr>
<tr class="separator:a68786a19dcb587fe18b45ae76effa1c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5959448d399641d50a3b1324eed8fbd9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a5959448d399641d50a3b1324eed8fbd9">kfs_open</a> (char *full_pathname)</td></tr>
<tr class="memdesc:a5959448d399641d50a3b1324eed8fbd9"><td class="mdescLeft">&#160;</td><td class="mdescRight">opens a file or directory, if file or directory not found, all the pathname is created  <a href="#a5959448d399641d50a3b1324eed8fbd9">More...</a><br/></td></tr>
<tr class="separator:a5959448d399641d50a3b1324eed8fbd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a527debce004a38c7cc8dc0b3c3623814"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a527debce004a38c7cc8dc0b3c3623814">kfs_openat</a> (int root, char *dentry_name)</td></tr>
<tr class="memdesc:a527debce004a38c7cc8dc0b3c3623814"><td class="mdescLeft">&#160;</td><td class="mdescRight">looks for name in the directory root, if the name is not found, it is created  <a href="#a527debce004a38c7cc8dc0b3c3623814">More...</a><br/></td></tr>
<tr class="separator:a527debce004a38c7cc8dc0b3c3623814"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4ddfac90903634778ced7fb2105c50d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#ab4ddfac90903634778ced7fb2105c50d">kfs_readdir</a> (int dentry, int leaf, void *<a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>)</td></tr>
<tr class="memdesc:ab4ddfac90903634778ced7fb2105c50d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading, buffer will contain the name of the directory or item.  <a href="#ab4ddfac90903634778ced7fb2105c50d">More...</a><br/></td></tr>
<tr class="separator:ab4ddfac90903634778ced7fb2105c50d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4170ece7c39eacb7c0ce15c891d2515f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a4170ece7c39eacb7c0ce15c891d2515f">kfs_read</a> (int dentry, int pg_offset, int *<a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>)</td></tr>
<tr class="memdesc:a4170ece7c39eacb7c0ce15c891d2515f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads a file, it reads one page from the file dentry to memory buffer. After reading, buffer will contain the entire page of which the offset belongs.  <a href="#a4170ece7c39eacb7c0ce15c891d2515f">More...</a><br/></td></tr>
<tr class="separator:a4170ece7c39eacb7c0ce15c891d2515f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a491e452cdf42853498249aadc91eb74b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size</a> (int dentry, int newsize)</td></tr>
<tr class="memdesc:a491e452cdf42853498249aadc91eb74b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the size field of the inode associated with the dentry to newsize.  <a href="#a491e452cdf42853498249aadc91eb74b">More...</a><br/></td></tr>
<tr class="separator:a491e452cdf42853498249aadc91eb74b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ed044e75ea35d5cffd2ee5426e1db38"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a4ed044e75ea35d5cffd2ee5426e1db38">kfs_write</a> (int dentry, int pg_offset, void *<a class="el" href="ktools_8c.html#a527b76b33fb8beec7f2df7e0c032aef6">buffer</a>)</td></tr>
<tr class="memdesc:a4ed044e75ea35d5cffd2ee5426e1db38"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of which the offset belongs.  <a href="#a4ed044e75ea35d5cffd2ee5426e1db38">More...</a><br/></td></tr>
<tr class="separator:a4ed044e75ea35d5cffd2ee5426e1db38"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75c287df9bc137651846c3766c294fb5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a75c287df9bc137651846c3766c294fb5">kfs_remove</a> (char *full_pathname)</td></tr>
<tr class="memdesc:a75c287df9bc137651846c3766c294fb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">removes a file or a directory  <a href="#a75c287df9bc137651846c3766c294fb5">More...</a><br/></td></tr>
<tr class="separator:a75c287df9bc137651846c3766c294fb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46783800e799435356d388150e2a5cec"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a46783800e799435356d388150e2a5cec">kfs_unlink</a> (char *name)</td></tr>
<tr class="separator:a46783800e799435356d388150e2a5cec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36778e4753ea52a29dd2bcde44341446"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a36778e4753ea52a29dd2bcde44341446">kfs_link</a> (char *old_name, char *new_name)</td></tr>
<tr class="memdesc:a36778e4753ea52a29dd2bcde44341446"><td class="mdescLeft">&#160;</td><td class="mdescRight">creates a new link (also called hard link) on an existing file.  <a href="#a36778e4753ea52a29dd2bcde44341446">More...</a><br/></td></tr>
<tr class="separator:a36778e4753ea52a29dd2bcde44341446"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c6336c1d084cc8a1dbc78c792099c4c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a6c6336c1d084cc8a1dbc78c792099c4c">kfs_tree_cb</a> (int root, void(*callback)(int dentry, int depth, int position))</td></tr>
<tr class="memdesc:a6c6336c1d084cc8a1dbc78c792099c4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">calls the callback function on each entry from root dentry  <a href="#a6c6336c1d084cc8a1dbc78c792099c4c">More...</a><br/></td></tr>
<tr class="separator:a6c6336c1d084cc8a1dbc78c792099c4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af88c339569eb51ffc1d94ee2324202f5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#af88c339569eb51ffc1d94ee2324202f5">kfs_add_mbr</a> (char *pathname)</td></tr>
<tr class="memdesc:af88c339569eb51ffc1d94ee2324202f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads a 512 bytes sized MBR in kfs. Meant to be used exclusively on Linux.  <a href="#af88c339569eb51ffc1d94ee2324202f5">More...</a><br/></td></tr>
<tr class="separator:af88c339569eb51ffc1d94ee2324202f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13b2ba4b6ae24b6b49ce962a44e4e5fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a13b2ba4b6ae24b6b49ce962a44e4e5fa">kfs_add_vbr</a> (char *pathname)</td></tr>
<tr class="memdesc:a13b2ba4b6ae24b6b49ce962a44e4e5fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads a VBR in kfs. Meant to be used exclusively on Linux.  <a href="#a13b2ba4b6ae24b6b49ce962a44e4e5fa">More...</a><br/></td></tr>
<tr class="separator:a13b2ba4b6ae24b6b49ce962a44e4e5fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a10f5dc158b1a0b3d2971a045df73aba4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a10f5dc158b1a0b3d2971a045df73aba4">kfs_disk_load</a> (char *pathname)</td></tr>
<tr class="memdesc:a10f5dc158b1a0b3d2971a045df73aba4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads the disk from an external support. On HOST It means from the host disk in file whose name is given in parameter. After load, the whole content of the disk is present in memory in tables KfsMbr, KfsVbr, KfsSblock, KfsDentry, KfsInode, KfsFmap &amp; KfsDisk. On ko6 It means from the virtual disk connected to the Block Device controller. After load, only METADATA content of the disk is present in memory in tables KfsSblock, KfsDentry, KfsInode, KfsFmap.  <a href="#a10f5dc158b1a0b3d2971a045df73aba4">More...</a><br/></td></tr>
<tr class="separator:a10f5dc158b1a0b3d2971a045df73aba4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3037ba33f12f2c2c99e099f9cc4a71e6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kfs_8h.html#a3037ba33f12f2c2c99e099f9cc4a71e6">kfs_disk_save</a> (char *pathname)</td></tr>
<tr class="memdesc:a3037ba33f12f2c2c99e099f9cc4a71e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Saves the disk to an external support. On HOST It means to the host disk in a file whose name is given in parameter. After save, the whole content of the disk is written in file on host. That is KfsMbr, KfsVbr, KfsSblock, KfsDentry, KfsInode, KfsFmap &amp; KfsDisk. On ko6 It means to file connected to the Block Device controller. After save only METADATA content of the disk is written to the virtual disk. That is KfsSblock, KfsDentry, KfsInode, KfsFmap.  <a href="#a3037ba33f12f2c2c99e099f9cc4a71e6">More...</a><br/></td></tr>
<tr class="separator:a3037ba33f12f2c2c99e099f9cc4a71e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a75d29f6159278cfe6da1ae6fefb40c46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_BOOT&#160;&#160;&#160;(<a class="el" href="kfs_8h.html#ab547fa38768be432271323a0e509df32">KFS_NPG_MBR</a>+<a class="el" href="kfs_8h.html#ada947412302e76983f1eea2cb524ec2d">KFS_NPG_VBR</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a012e85f2bb85ec2d5bdff1d298929018"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_DENTRY&#160;&#160;&#160;2       /* number of pages for all dentries */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7c0f2945d18d92bc9b2e754b377335b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_DISK&#160;&#160;&#160;0x2000  /* number of pages in the whole disk */</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Referenced by <a class="el" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page()</a>.</p>

</div>
</div>
<a class="anchor" id="ae070eb53d573680911159a7cbb4b90e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_FMAP&#160;&#160;&#160;16      /* number of pages for all file maps (inode extensions) */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a93b1915cf843dbd16b8d274ee4751acb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_INODE&#160;&#160;&#160;2       /* number of pages for all inodes */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab547fa38768be432271323a0e509df32"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_MBR&#160;&#160;&#160;1       /* number of pages in MBR */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a2fc604f5c0a4a2971369642c96f07abf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_META&#160;&#160;&#160;(<a class="el" href="kfs_8h.html#a82f61eaff20e7015c52261a2423ab0af">KFS_NPG_SBLOCK</a>+<a class="el" href="kfs_8h.html#a012e85f2bb85ec2d5bdff1d298929018">KFS_NPG_DENTRY</a>+<a class="el" href="kfs_8h.html#a93b1915cf843dbd16b8d274ee4751acb">KFS_NPG_INODE</a>+<a class="el" href="kfs_8h.html#ae070eb53d573680911159a7cbb4b90e2">KFS_NPG_FMAP</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a82f61eaff20e7015c52261a2423ab0af"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_SBLOCK&#160;&#160;&#160;2       /* number of pages in SBLOCK (contains all bitmaps) */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ada947412302e76983f1eea2cb524ec2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define KFS_NPG_VBR&#160;&#160;&#160;3       /* number of pages in VBR (bootloader) */</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a60283510d9cdbdb54a244958b0938e15"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15">kfs_type_e</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><em><a class="anchor" id="a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3"></a>KFS_DIR</em>&nbsp;</td><td class="fielddoc">
<p>type of files for the real disk (less than vfs) </p>
<p>directory </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf"></a>KFS_FILE</em>&nbsp;</td><td class="fielddoc">
<p>regular file </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed"></a>KFS_PIPE</em>&nbsp;</td><td class="fielddoc">
<p>named fifo not yet handled #fixme </p>
</td></tr>
<tr><td class="fieldname"><em><a class="anchor" id="a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1"></a>KFS_SLINK</em>&nbsp;</td><td class="fielddoc">
<p>symbolic link not yet handled #fixme </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                {               </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>,                    </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>,                   </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed">KFS_PIPE</a>,                   </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1">KFS_SLINK</a>                   </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;};</div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a></div><div class="ttdoc">regular file </div><div class="ttdef"><b>Definition:</b> kfs.h:47</div></div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15aa253f9237cb1bc081fa30916df97dfed">KFS_PIPE</a></div><div class="ttdoc">named fifo not yet handled #fixme </div><div class="ttdef"><b>Definition:</b> kfs.h:48</div></div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a></div><div class="ttdoc">type of files for the real disk (less than vfs) </div><div class="ttdef"><b>Definition:</b> kfs.h:46</div></div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a684c20b92751305cb2c034fc9a8947f1">KFS_SLINK</a></div><div class="ttdoc">symbolic link not yet handled #fixme </div><div class="ttdef"><b>Definition:</b> kfs.h:49</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="af88c339569eb51ffc1d94ee2324202f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_add_mbr </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads a 512 bytes sized MBR in kfs. Meant to be used exclusively on Linux. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pathname</td><td>the pathname on host to the mbr </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of bytes read </dd></dl>

<p>Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a13b2ba4b6ae24b6b49ce962a44e4e5fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_add_vbr </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads a VBR in kfs. Meant to be used exclusively on Linux. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pathname</td><td>the pathname on host to the vbr </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of bytes read </dd></dl>

<p>Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a30d4e1ffe8c1ea75120811fcf3055c05"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_chmode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>write access functions to inode's properties </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of an inode </td></tr>
    <tr><td class="paramname">mode,owner</td><td>&amp; mtime are the new property value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the new property or -1 if failure </dd></dl>

<p>References <a class="el" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a>.</p>
<div class="fragment"><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">mode</a> = mode; }</div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="structkfs__inode__s_html_af0dd6151a1aba841d36f2d005e77aef4"><div class="ttname"><a href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a></div><div class="ttdeci">u32_t mode</div><div class="ttdoc">rwxrwx for owner and others </div><div class="ttdef"><b>Definition:</b> kfs.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a68786a19dcb587fe18b45ae76effa1c5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_chmtime </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mtime</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a>.</p>
<div class="fragment"><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">mtime</a>= mtime;}</div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="structkfs__inode__s_html_a575e296191f8d2444a26f90d58e155e6"><div class="ttname"><a href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a></div><div class="ttdeci">u16_t mtime</div><div class="ttdoc">relative modification/creation time </div><div class="ttdef"><b>Definition:</b> kfs.c:53</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3e380775665de4ff6cbc01555444cb64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_chowner </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>owner</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">owner</a>= owner;}</div>
<div class="ttc" id="structkfs__inode__s_html_adecb12117172ae213c9d659ffbcd809b"><div class="ttname"><a href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a></div><div class="ttdeci">u16_t owner</div><div class="ttdoc">owner : kernel, user1, user2, user3 </div><div class="ttdef"><b>Definition:</b> kfs.c:52</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaa0d81604e0d3d23f31b3beb7dcb163c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_count </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>read access functions to inodes </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of an inode </td></tr>
    <tr><td class="paramname">offset</td><td>is the page number in the file (start at 0 to filesize / sizeof(page)) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- kfs_count : number of dentry pointing to this inode<ul>
<li>kfs_type : type defined in kfs_enum_e</li>
<li>kfs_mode : permission modes rwxrwx for the owner and others (there are no groups)</li>
<li>kfs_size : file size</li>
<li>kfs_owner : file or directory owner</li>
<li>kfs_mtime : modification / creation relative time</li>
<li>kfs_page : index of page of data on the disk </li>
</ul>
</dd></dl>

<p>References <a class="el" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">count</a>;}</div>
<div class="ttc" id="structkfs__inode__s_html_ae5ea15e9504973dc519f2ceca209a3d8"><div class="ttname"><a href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a></div><div class="ttdeci">u16_t count</div><div class="ttdoc">nb of inode references </div><div class="ttdef"><b>Definition:</b> kfs.c:51</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a10f5dc158b1a0b3d2971a045df73aba4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_disk_load </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads the disk from an external support. On HOST It means from the host disk in file whose name is given in parameter. After load, the whole content of the disk is present in memory in tables KfsMbr, KfsVbr, KfsSblock, KfsDentry, KfsInode, KfsFmap &amp; KfsDisk. On ko6 It means from the virtual disk connected to the Block Device controller. After load, only METADATA content of the disk is present in memory in tables KfsSblock, KfsDentry, KfsInode, KfsFmap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>parameter only used by the HOST </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a number &gt; 0 on success, and &lt;= 0 on failure </dd></dl>

<p>Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a3037ba33f12f2c2c99e099f9cc4a71e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_disk_save </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Saves the disk to an external support. On HOST It means to the host disk in a file whose name is given in parameter. After save, the whole content of the disk is written in file on host. That is KfsMbr, KfsVbr, KfsSblock, KfsDentry, KfsInode, KfsFmap &amp; KfsDisk. On ko6 It means to file connected to the Block Device controller. After save only METADATA content of the disk is written to the virtual disk. That is KfsSblock, KfsDentry, KfsInode, KfsFmap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>parameter only used by the HOST </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a number &gt; 0 on success, and &lt;= 0 on fealure </dd></dl>

<p>Referenced by <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>

</div>
</div>
<a class="anchor" id="aae206d59d8bc4514d34dafdff1198ede"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_inode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, <a class="el" href="kfs_8h.html#a4170ece7c39eacb7c0ce15c891d2515f">kfs_read()</a>, <a class="el" href="kfs_8h.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, <a class="el" href="kfs_8h.html#a4ed044e75ea35d5cffd2ee5426e1db38">kfs_write()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;}</div>
<div class="ttc" id="structkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode </div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac2308b1a426032672fbacdde9ee5ac81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_isdir </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>boolean functions for dentries or inode </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of a dentry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- 0 if false, not 0 if true </dd></dl>

<p>References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, and <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p>Referenced by <a class="el" href="kfs_8h.html#ab4ddfac90903634778ced7fb2105c50d">kfs_readdir()</a>, <a class="el" href="kfs_8c.html#a0c8753d9a11f6570f9c56b587fa2c48c">kfs_tree_cb()</a>, and <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>.</p>
<div class="fragment"><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>].<a class="code" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a> == <a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>;}</div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a></div><div class="ttdoc">type of files for the real disk (less than vfs) </div><div class="ttdef"><b>Definition:</b> kfs.h:46</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode </div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
<div class="ttc" id="structkfs__inode__s_html_ac894cd2c4c9d7e6409c3302d1edec307"><div class="ttname"><a href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a></div><div class="ttdeci">u32_t type</div><div class="ttdoc">&amp;lt; 32 bytes long </div><div class="ttdef"><b>Definition:</b> kfs.c:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a135f3848117282c89e3be09b930eb9de"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_leaf </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> ;}</div>
<div class="ttc" id="structkfs__dentry__s_html_a79fd3c8764d633fdb895b77856f61d61"><div class="ttname"><a href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a></div><div class="ttdeci">u8_t leaf</div><div class="ttdoc">index of one of the leaf dentries (0 if no leaf) </div><div class="ttdef"><b>Definition:</b> kfs.c:42</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a36778e4753ea52a29dd2bcde44341446"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_link </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>old_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>new_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>creates a new link (also called hard link) on an existing file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">old_name</td><td>is an existing file name </td></tr>
    <tr><td class="paramname">new_name</td><td>is the new name of the same file as old_name if new_name already exists it is not created, and it's a failure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if success, -1 if failure </dd></dl>

<p>References <a class="el" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a>, <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, and <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>
<div class="fragment"><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;{</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> src_dentry = <a class="code" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (src_name);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dst_dentry = <a class="code" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (dst_name);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> src_inode  = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[src_dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dst_inode  = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dst_dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dst_dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a> = src_inode;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[src_inode].<a class="code" href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">count</a>++;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <a class="code" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a> (dst_inode);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">return</span> dst_dentry;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_aadbe9ab58b58e9826dd4da1384c80798"><div class="ttname"><a href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a></div><div class="ttdeci">static void kfs_free_inode(int inode)</div><div class="ttdoc">frees an inode (it is not necessary to erase it, it will be done in allocation) </div><div class="ttdef"><b>Definition:</b> kfs.c:317</div></div>
<div class="ttc" id="structkfs__inode__s_html_ae5ea15e9504973dc519f2ceca209a3d8"><div class="ttname"><a href="structkfs__inode__s.html#ae5ea15e9504973dc519f2ceca209a3d8">kfs_inode_s::count</a></div><div class="ttdeci">u16_t count</div><div class="ttdoc">nb of inode references </div><div class="ttdef"><b>Definition:</b> kfs.c:51</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="kfs_8c_html_afc6499c1f28697aa3bfc2804d496fd11"><div class="ttname"><a href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></div><div class="ttdeci">unsigned short u16_t</div><div class="ttdef"><b>Definition:</b> kfs.c:27</div></div>
<div class="ttc" id="kfs_8c_html_ac7986c65e8710a8b55857582e62ccc78"><div class="ttname"><a href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a></div><div class="ttdeci">int kfs_open(char *pathname)</div><div class="ttdoc">opens a file or directory, if file or directory not found, all the pathname is created ...</div><div class="ttdef"><b>Definition:</b> kfs.c:525</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode </div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac9581ae711d5f79aff1ed39c9739e80c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_mode </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">mode</a>; }</div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="structkfs__inode__s_html_af0dd6151a1aba841d36f2d005e77aef4"><div class="ttname"><a href="structkfs__inode__s.html#af0dd6151a1aba841d36f2d005e77aef4">kfs_inode_s::mode</a></div><div class="ttdeci">u32_t mode</div><div class="ttdoc">rwxrwx for owner and others </div><div class="ttdef"><b>Definition:</b> kfs.c:49</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9b41dd15430924703df46a579ff05b2e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_mtime </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">mtime</a>;}</div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="structkfs__inode__s_html_a575e296191f8d2444a26f90d58e155e6"><div class="ttname"><a href="structkfs__inode__s.html#a575e296191f8d2444a26f90d58e155e6">kfs_inode_s::mtime</a></div><div class="ttdeci">u16_t mtime</div><div class="ttdoc">relative modification/creation time </div><div class="ttdef"><b>Definition:</b> kfs.c:53</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9d837cb422897570c876a655c0b762be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* kfs_name </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__dentry__s.html#a9e5a536f0b9b95dc094c58c66c61ddcc">kfs_dentry_s::name</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a30830920b754d844291af7d136d6b5c1">kfs_absolute_pathname()</a>, and <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a9e5a536f0b9b95dc094c58c66c61ddcc">name</a> ;}</div>
<div class="ttc" id="structkfs__dentry__s_html_a9e5a536f0b9b95dc094c58c66c61ddcc"><div class="ttname"><a href="structkfs__dentry__s.html#a9e5a536f0b9b95dc094c58c66c61ddcc">kfs_dentry_s::name</a></div><div class="ttdeci">char name[KFS_MAX_NAME]</div><div class="ttdoc">max size of a file or folder name </div><div class="ttdef"><b>Definition:</b> kfs.c:44</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3be0d586ff3044979a3c381137d77d47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_next </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a> ;}</div>
<div class="ttc" id="structkfs__dentry__s_html_a17c6495def8c6564de45ab64cbc49066"><div class="ttname"><a href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a></div><div class="ttdeci">u8_t next</div><div class="ttdoc">index of one of the dentries at the same level </div><div class="ttdef"><b>Definition:</b> kfs.c:41</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5959448d399641d50a3b1324eed8fbd9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_open </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>opens a file or directory, if file or directory not found, all the pathname is created </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pathname</td><td>is the absolute name of the file or directory to find in root </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dentry index of the file or directory, that is the file descriptor or -1 on failure</dd></dl>
<p>"deep-first walk" of the name tree to find or create the file defined by its absolute name </p>

<p>References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#a02d307133891efa932b3766568eb738e">kfs_getname()</a>, <a class="el" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat()</a>, <a class="el" href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a>, and <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a521c1fd005bd6738b695d604843e880c">build()</a>, <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, <a class="el" href="ktools_8c.html#a2acd3e2ba6581eac5ff5e2a78ffa9bd8">kfs_files()</a>, <a class="el" href="kfs_8h.html#a36778e4753ea52a29dd2bcde44341446">kfs_link()</a>, <a class="el" href="ktools_8c.html#a54c8f883a16767e5c05750fc425c525c">kfs_tree()</a>, <a class="el" href="kfs_8h.html#a46783800e799435356d388150e2a5cec">kfs_unlink()</a>, and <a class="el" href="ktools_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;{</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordtype">char</span> * name = <a class="code" href="kfs_8c.html#a02d307133891efa932b3766568eb738e">kfs_getname</a> (pathname);                   <span class="comment">// get first name up to character &#39;/&#39;</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">if</span> (name == <a class="code" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> -1;                            <span class="comment">// pathname not correct, failure</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> dentry = 0;                                       <span class="comment">// search from root fs</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordflow">while</span> ((name = <a class="code" href="kfs_8c.html#a02d307133891efa932b3766568eb738e">kfs_getname</a> (<a class="code" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)))                     <span class="comment">// get the next name in pathname</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        dentry = <a class="code" href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a> (dentry, name);                 <span class="comment">// look for it in current directory</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a>[<a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>] = 0;                 <span class="comment">// by defaut, set offset to firstpage</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">return</span> dentry;                                          <span class="comment">// finally, the last dentry found</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_a0c0a490ab7fa397be6c764a935cc5ea4"><div class="ttname"><a href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a></div><div class="ttdeci">unsigned int u32_t</div><div class="ttdef"><b>Definition:</b> kfs.c:26</div></div>
<div class="ttc" id="kfs_8c_html_a5bf1c4cc42e02a99529eefc02cf53c4b"><div class="ttname"><a href="kfs_8c.html#a5bf1c4cc42e02a99529eefc02cf53c4b">kfs_openat</a></div><div class="ttdeci">int kfs_openat(int root, char *name)</div><div class="ttdoc">looks for name in the directory root, if the name is not found, it is created </div><div class="ttdef"><b>Definition:</b> kfs.c:541</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode </div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
<div class="ttc" id="kfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
<div class="ttc" id="kfs_8c_html_a4418baf5eb3028d32758a1ccd600be44"><div class="ttname"><a href="kfs_8c.html#a4418baf5eb3028d32758a1ccd600be44">KfsOffset</a></div><div class="ttdeci">static u16_t KfsOffset[KFS_MAX_INODE]</div><div class="ttdoc">last offset used for inode by read write </div><div class="ttdef"><b>Definition:</b> kfs.c:130</div></div>
<div class="ttc" id="kfs_8c_html_a02d307133891efa932b3766568eb738e"><div class="ttname"><a href="kfs_8c.html#a02d307133891efa932b3766568eb738e">kfs_getname</a></div><div class="ttdeci">static char * kfs_getname(char *pathname)</div><div class="ttdoc">get name from pathname up to character &amp;#39;/&amp;#39; pathname argument is not destroyed. Function NON-reentrant...</div><div class="ttdef"><b>Definition:</b> kfs.c:171</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a527debce004a38c7cc8dc0b3c3623814"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_openat </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>looks for name in the directory root, if the name is not found, it is created </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">root</td><td>is a dentry index </td></tr>
    <tr><td class="paramname">dentry_name</td><td>is the name of the file or directory to find in root </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dentry index of the file, that is the file descriptor</dd></dl>
<p>find or create the file defined by its relative name into the directory defined by its dentry </p>

<p>References <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry()</a>, <a class="el" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode()</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>, <a class="el" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>, <a class="el" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp()</a>, <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>, <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>, <a class="el" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a>, and <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, and <a class="el" href="kfs_8h.html#a5959448d399641d50a3b1324eed8fbd9">kfs_open()</a>.</p>
<div class="fragment"><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;{</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> leaf = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;                      <span class="comment">// get first leaf of current root</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordtype">int</span> notfound = 1;                                       <span class="comment">// by default, suppose name not found</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[<a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>].<a class="code" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a> = <a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a>;         <span class="comment">// root is necessarily a directory</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordflow">if</span> (leaf) {                                             <span class="comment">// if there are leafs</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> leaf_next = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;             <span class="comment">// get next leaf</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        notfound = <a class="code" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a>(<a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].name, name);  <span class="comment">// !=0 if different</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">while</span> (notfound &amp;&amp; leaf_next) {                     <span class="comment">// while not good leaf and there is more</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            leaf = leaf_next;                               <span class="comment">// change the leaf to the next leaf</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            leaf_next = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;               <span class="comment">// get next leaf</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            notfound= <a class="code" href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a>(<a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].name,name);<span class="comment">// compare current leaf</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">if</span> (notfound) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        leaf = <a class="code" href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry</a> (name);                     <span class="comment">// create a new dentry for the file</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a> = <a class="code" href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode</a> (<a class="code" href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a>); <span class="comment">// create an empty inode (default FILE)</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> = 0;                           <span class="comment">// if new leaf is FILE, thus no leaf</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">root</a> = root;                        <span class="comment">// set the root of the new leaf</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a> = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;        <span class="comment">// put new leaf in same level nodes list</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a> = leaf;                        <span class="comment">// the beginning of the list of leafs</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">return</span> leaf;                                            <span class="comment">// return the found or created leaf</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_a09fba9a0bb78a0f1f159c01046c7e006"><div class="ttname"><a href="kfs_8c.html#a09fba9a0bb78a0f1f159c01046c7e006">kfs_strcmp</a></div><div class="ttdeci">static int kfs_strcmp(const char *s1, const char *s2)</div><div class="ttdoc">compare two strings of characters </div><div class="ttdef"><b>Definition:</b> kfs.c:212</div></div>
<div class="ttc" id="kfs_8c_html_ad7d3799e6e7b1822350af7f957f63db1"><div class="ttname"><a href="kfs_8c.html#ad7d3799e6e7b1822350af7f957f63db1">kfs_alloc_inode</a></div><div class="ttdeci">static u16_t kfs_alloc_inode(u8_t type)</div><div class="ttdoc">allocates a new inode, inode 0 is for &amp;#39;/&amp;#39; thus it is never free </div><div class="ttdef"><b>Definition:</b> kfs.c:303</div></div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15ab6474350eaeb22a05c5e39fe9ccdd1cf">KFS_FILE</a></div><div class="ttdoc">regular file </div><div class="ttdef"><b>Definition:</b> kfs.h:47</div></div>
<div class="ttc" id="structkfs__dentry__s_html_aed21f3f5ab2de70ab3416afe6dd9e4d4"><div class="ttname"><a href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a></div><div class="ttdeci">u8_t root</div><div class="ttdoc">&amp;lt; 32 bytes long </div><div class="ttdef"><b>Definition:</b> kfs.c:40</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a79fd3c8764d633fdb895b77856f61d61"><div class="ttname"><a href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a></div><div class="ttdeci">u8_t leaf</div><div class="ttdoc">index of one of the leaf dentries (0 if no leaf) </div><div class="ttdef"><b>Definition:</b> kfs.c:42</div></div>
<div class="ttc" id="kfs_8c_html_a0c0a490ab7fa397be6c764a935cc5ea4"><div class="ttname"><a href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a></div><div class="ttdeci">unsigned int u32_t</div><div class="ttdef"><b>Definition:</b> kfs.c:26</div></div>
<div class="ttc" id="kfs_8h_html_a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3"><div class="ttname"><a href="kfs_8h.html#a60283510d9cdbdb54a244958b0938e15a606504f765ec48b73a81cee9e5063ad3">KFS_DIR</a></div><div class="ttdoc">type of files for the real disk (less than vfs) </div><div class="ttdef"><b>Definition:</b> kfs.h:46</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode </div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
<div class="ttc" id="kfs_8c_html_a66ffc964d30c5258826714ac181af25a"><div class="ttname"><a href="kfs_8c.html#a66ffc964d30c5258826714ac181af25a">kfs_alloc_dentry</a></div><div class="ttdeci">static u32_t kfs_alloc_dentry(char *name)</div><div class="ttdoc">allocates a new dentry, dentry 0 is for &amp;#39;/&amp;#39; thus it is never free </div><div class="ttdef"><b>Definition:</b> kfs.c:265</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a17c6495def8c6564de45ab64cbc49066"><div class="ttname"><a href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a></div><div class="ttdeci">u8_t next</div><div class="ttdoc">index of one of the dentries at the same level </div><div class="ttdef"><b>Definition:</b> kfs.c:41</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
<div class="ttc" id="structkfs__inode__s_html_ac894cd2c4c9d7e6409c3302d1edec307"><div class="ttname"><a href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a></div><div class="ttdeci">u32_t type</div><div class="ttdoc">&amp;lt; 32 bytes long </div><div class="ttdef"><b>Definition:</b> kfs.c:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2f522cb4edeecd6cbcebcca31d90bc75"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_owner </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">owner</a>;}</div>
<div class="ttc" id="structkfs__inode__s_html_adecb12117172ae213c9d659ffbcd809b"><div class="ttname"><a href="structkfs__inode__s.html#adecb12117172ae213c9d659ffbcd809b">kfs_inode_s::owner</a></div><div class="ttdeci">u16_t owner</div><div class="ttdoc">owner : kernel, user1, user2, user3 </div><div class="ttdef"><b>Definition:</b> kfs.c:52</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afdc75626536d311fb2fe47baef24ef55"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_page </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pg_offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, <a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>, and <a class="el" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, and <a class="el" href="kfs_8h.html#a4170ece7c39eacb7c0ce15c891d2515f">kfs_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;{</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structfdt__reserve__entry.html#ace12399f157bc46877fbcddec98da67e">size</a> = <a class="code" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode);                             <span class="comment">// real size of file</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span> ((size==0) || (pg_offset &gt; size&gt;&gt;12)) <span class="keywordflow">return</span> -1;     <span class="comment">// if pg_offset is &gt; than the nb of page</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (pg_offset &lt; 12) <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">page</a>[pg_offset];<span class="comment">// page is referenced by inode</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    pg_offset -= 12;                                        <span class="comment">// all others are in fmaps</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordtype">int</span> map1 = <a class="code" href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap</a>(inode);                             <span class="comment">// get the first level</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">if</span> (size &lt;= 28&lt;&lt;12) <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[map1][pg_offset];    <span class="comment">// if size is &lt;= 28 pages, then 1 level</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordtype">int</span> map2 = <a class="code" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[map1][pg_offset/16];                 <span class="comment">// else get the second  level</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[map2][pg_offset%16];                     <span class="comment">// then get the page</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_af148b22d686f5b43341249ba9d03eb54"><div class="ttname"><a href="kfs_8c.html#af148b22d686f5b43341249ba9d03eb54">kfs_fmap</a></div><div class="ttdeci">static int kfs_fmap(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:365</div></div>
<div class="ttc" id="structkfs__inode__s_html_aea74f0e1495f40cf25e36f8963b84e8b"><div class="ttname"><a href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a></div><div class="ttdeci">u16_t page[12]</div><div class="ttdoc">first 12 pages of a file (12*4kib=48kb) </div><div class="ttdef"><b>Definition:</b> kfs.c:55</div></div>
<div class="ttc" id="kfs_8c_html_adfe2302bd3dfd42413c478b8a32174cb"><div class="ttname"><a href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a></div><div class="ttdeci">static kfs_fmap_t KfsFmap[KFS_MAX_FMAP]</div><div class="ttdoc">up to MAX_FMAP inode extensions </div><div class="ttdef"><b>Definition:</b> kfs.c:124</div></div>
<div class="ttc" id="structfdt__reserve__entry_html_ace12399f157bc46877fbcddec98da67e"><div class="ttname"><a href="structfdt__reserve__entry.html#ace12399f157bc46877fbcddec98da67e">fdt_reserve_entry::size</a></div><div class="ttdeci">fdt64_t size</div><div class="ttdef"><b>Definition:</b> fdt.h:33</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="kfs_8c_html_a2e7cb7a15052f57bdff8a2c1146bc072"><div class="ttname"><a href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a></div><div class="ttdeci">int kfs_size(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:147</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4170ece7c39eacb7c0ce15c891d2515f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_read </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pg_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a file, it reads one page from the file dentry to memory buffer. After reading, buffer will contain the entire page of which the offset belongs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>given by open or openat </td></tr>
    <tr><td class="paramname">pg_offset</td><td>is the page of the file to be read, if offset == -1 then the item or page placed just after the previous one read </td></tr>
    <tr><td class="paramname">buffer</td><td>to put the read page or filename (at least one page length) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>for a file the number of pages read : 1 if success with page in buffer as a side effect, 0 if file smaller than offset, -1 if something is wrong</dd></dl>
<p>Try to read an entire page (4kiB) from file dentry </p>

<p>References <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, and <a class="el" href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page()</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>
<div class="fragment"><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">int</span> page = <a class="code" href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a> (<a class="code" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a> (dentry), pg_offset);     <span class="comment">// get the page number in the disk</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordflow">if</span> (page == -1) <span class="keywordflow">return</span> 0;                               <span class="comment">// if outside of the file</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page</a> (buf, page);                       <span class="comment">// at last read disk page to buf</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_aae206d59d8bc4514d34dafdff1198ede"><div class="ttname"><a href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a></div><div class="ttdeci">int kfs_inode(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:139</div></div>
<div class="ttc" id="kfs_8c_html_afdc75626536d311fb2fe47baef24ef55"><div class="ttname"><a href="kfs_8c.html#afdc75626536d311fb2fe47baef24ef55">kfs_page</a></div><div class="ttdeci">int kfs_page(int inode, int pg_offset)</div><div class="ttdef"><b>Definition:</b> kfs.c:376</div></div>
<div class="ttc" id="kfs_8c_html_a23a78b350153b3b7ae5ca00a1de7484a"><div class="ttname"><a href="kfs_8c.html#a23a78b350153b3b7ae5ca00a1de7484a">kfs_read_page</a></div><div class="ttdeci">static int kfs_read_page(int *buf, u16_t page)</div><div class="ttdoc">Reads from the disk to the memory buffer. There are two cases : 1) if kfs runs on Linux 2) if kfs run...</div><div class="ttdef"><b>Definition:</b> kfs.c:450</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab4ddfac90903634778ced7fb2105c50d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_readdir </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>leaf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads a directory, it reads one entry from the directory dentry to memory buffer. After reading, buffer will contain the name of the directory or item. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>given by open or openat </td></tr>
    <tr><td class="paramname">leaf</td><td>is a dentry of an item present in the directory if leaf == -1 then the item is the one placed just after the previous one read </td></tr>
    <tr><td class="paramname">buffer</td><td>to put the filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>next dentry to read or -1 if something is wrong</dd></dl>
<p>readdir reads all entries in a directory </p>

<p>References <a class="el" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir()</a>, <a class="el" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy()</a>, <a class="el" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a>, and <a class="el" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a>.</p>

<p>Referenced by <a class="el" href="kfs_8c.html#af01886bc6c6c809f5f46eda025ef5ec3">kfs_tree_cb_r()</a>.</p>
<div class="fragment"><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;{</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a>(root)) <span class="keywordflow">return</span> -1;                        <span class="comment">// root dentry must be a directory</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (buf) <a class="code" href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy</a> (buf, <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].name);        <span class="comment">// if asked, get this leaf dentry name</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (leaf == root)                                       <span class="comment">// at first, leaf is the root</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[root].<a class="code" href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">leaf</a>;                        <span class="comment">// get the first leaf thus 0 if empty</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].root != root) <span class="keywordflow">return</span> -1;            <span class="comment">// leaf must be in root directory</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[leaf].<a class="code" href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">next</a>;                            <span class="comment">// find and return next leaf (0 if last)</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_ac2308b1a426032672fbacdde9ee5ac81"><div class="ttname"><a href="kfs_8c.html#ac2308b1a426032672fbacdde9ee5ac81">kfs_isdir</a></div><div class="ttdeci">int kfs_isdir(int dentry)</div><div class="ttdoc">boolean functions for dentries or inode </div><div class="ttdef"><b>Definition:</b> kfs.c:142</div></div>
<div class="ttc" id="kfs_8c_html_aceb626dd864e7f2ccd7901d0506dbaf4"><div class="ttname"><a href="kfs_8c.html#aceb626dd864e7f2ccd7901d0506dbaf4">kfs_strcpy</a></div><div class="ttdeci">static void kfs_strcpy(char *dest, char *src)</div><div class="ttdoc">copy a string of characters </div><div class="ttdef"><b>Definition:</b> kfs.c:199</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a79fd3c8764d633fdb895b77856f61d61"><div class="ttname"><a href="structkfs__dentry__s.html#a79fd3c8764d633fdb895b77856f61d61">kfs_dentry_s::leaf</a></div><div class="ttdeci">u8_t leaf</div><div class="ttdoc">index of one of the leaf dentries (0 if no leaf) </div><div class="ttdef"><b>Definition:</b> kfs.c:42</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a17c6495def8c6564de45ab64cbc49066"><div class="ttname"><a href="structkfs__dentry__s.html#a17c6495def8c6564de45ab64cbc49066">kfs_dentry_s::next</a></div><div class="ttdeci">u8_t next</div><div class="ttdoc">index of one of the dentries at the same level </div><div class="ttdef"><b>Definition:</b> kfs.c:41</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a75c287df9bc137651846c3766c294fb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_remove </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>full_pathname</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>removes a file or a directory </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pathname</td><td>is the absolute name of the file or directory to find in root </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>dentry index of the file or directory, that is the file descriptor or -1 on failure </dd></dl>

</div>
</div>
<a class="anchor" id="ade5bf93265bc86a9ecd5019cc6e3d277"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_root </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>read access functions to dentries </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>of a dentry </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- a dentry number for <a class="el" href="kfs_8c.html#ade5bf93265bc86a9ecd5019cc6e3d277" title="read access functions to dentries ">kfs_root()</a>, <a class="el" href="kfs_8c.html#a3be0d586ff3044979a3c381137d77d47">kfs_next()</a>, <a class="el" href="kfs_8c.html#a135f3848117282c89e3be09b930eb9de">kfs_leaf()</a>. For these three functions, 0 means either file system root '/' or last leaf<ul>
<li>the inode number for <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, there is always one</li>
<li>the pointer to the entry name for <a class="el" href="kfs_8c.html#a9d837cb422897570c876a655c0b762be">kfs_name()</a> </li>
</ul>
</dd></dl>

<p>References <a class="el" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a30830920b754d844291af7d136d6b5c1">kfs_absolute_pathname()</a>, and <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">root</a> ;}</div>
<div class="ttc" id="structkfs__dentry__s_html_aed21f3f5ab2de70ab3416afe6dd9e4d4"><div class="ttname"><a href="structkfs__dentry__s.html#aed21f3f5ab2de70ab3416afe6dd9e4d4">kfs_dentry_s::root</a></div><div class="ttdeci">u8_t root</div><div class="ttdoc">&amp;lt; 32 bytes long </div><div class="ttdef"><b>Definition:</b> kfs.c:40</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a491e452cdf42853498249aadc91eb74b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_set_size </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>newsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the size field of the inode associated with the dentry to newsize. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>given by open or openat </td></tr>
    <tr><td class="paramname">newsize</td><td>new size of the file </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int : the size of the file after modification </dd></dl>

<p>References <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size()</a>, and <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, and <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>
<div class="fragment"><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;{</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> inode = <a class="code" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);                <span class="comment">// get inode associated with the dentry</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a> = newsize;                 <span class="comment">// set the new size</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a>(inode);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="ttc" id="structkfs__inode__s_html_ae4c3aa6d76cc8e92a9b29c2b3707f473"><div class="ttname"><a href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a></div><div class="ttdeci">u32_t size</div><div class="ttdoc">file size is 16mib max </div><div class="ttdef"><b>Definition:</b> kfs.c:50</div></div>
<div class="ttc" id="kfs_8c_html_aae206d59d8bc4514d34dafdff1198ede"><div class="ttname"><a href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a></div><div class="ttdeci">int kfs_inode(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:139</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="kfs_8c_html_afc6499c1f28697aa3bfc2804d496fd11"><div class="ttname"><a href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></div><div class="ttdeci">unsigned short u16_t</div><div class="ttdef"><b>Definition:</b> kfs.c:27</div></div>
<div class="ttc" id="kfs_8c_html_a2e7cb7a15052f57bdff8a2c1146bc072"><div class="ttname"><a href="kfs_8c.html#a2e7cb7a15052f57bdff8a2c1146bc072">kfs_size</a></div><div class="ttdeci">int kfs_size(int inode)</div><div class="ttdef"><b>Definition:</b> kfs.c:147</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2e7cb7a15052f57bdff8a2c1146bc072"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_size </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>

<p>Referenced by <a class="el" href="kfs_8h.html#afdc75626536d311fb2fe47baef24ef55">kfs_page()</a>, <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, <a class="el" href="kfs_8h.html#a491e452cdf42853498249aadc91eb74b">kfs_set_size()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>
<div class="fragment"><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a>; }</div>
<div class="ttc" id="structkfs__inode__s_html_ae4c3aa6d76cc8e92a9b29c2b3707f473"><div class="ttname"><a href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a></div><div class="ttdeci">u32_t size</div><div class="ttdoc">file size is 16mib max </div><div class="ttdef"><b>Definition:</b> kfs.c:50</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6c6336c1d084cc8a1dbc78c792099c4c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_tree_cb </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>root</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(int dentry, int depth, int position)&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calls the callback function on each entry from root dentry </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">root</td><td>is the dentry for which the recursion begins </td></tr>
    <tr><td class="paramname">callback</td><td>is a provided function which will be called on each dentry<ul>
<li>dentry is the current entry in this directory which can be of any type</li>
<li>depth gives the callback() function information about the depth of the recursion. the depth of the root is 0, then the first level is 1, etc.</li>
<li>position is the current position in the current directory (0, 1, etc.) </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of calls of the callback function </dd></dl>

</div>
</div>
<a class="anchor" id="a8d546cf291d26ab01a150b74cc206ae1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_type </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>inode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a248e1d9ae859f3b9f7933b506846c667">kfs_print_dentry()</a>, <a class="el" href="ktools_8c.html#a1ba276cff72866fb0ad856572a87ba35">kfs_print_files()</a>, and <a class="el" href="ktools_8c.html#a16c0ecb37b34e241fab9b9be0ebf7c6f">split()</a>.</p>
<div class="fragment"><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;{<span class="keywordflow">return</span> <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">type</a>; }</div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="structkfs__inode__s_html_ac894cd2c4c9d7e6409c3302d1edec307"><div class="ttname"><a href="structkfs__inode__s.html#ac894cd2c4c9d7e6409c3302d1edec307">kfs_inode_s::type</a></div><div class="ttdeci">u32_t type</div><div class="ttdoc">&amp;lt; 32 bytes long </div><div class="ttdef"><b>Definition:</b> kfs.c:48</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a46783800e799435356d388150e2a5cec"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_unlink </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>References <a class="el" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">kfs_inode_s::fmap</a>, <a class="el" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a>, <a class="el" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry()</a>, <a class="el" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap()</a>, <a class="el" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode()</a>, <a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page()</a>, <a class="el" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open()</a>, <a class="el" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>, <a class="el" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a>, and <a class="el" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a>.</p>
<div class="fragment"><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;{</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> dentry = <a class="code" href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a> (name);</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> inode = <a class="code" href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a>[dentry].<a class="code" href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">inode</a>;</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> <a class="code" href="structfdt__reserve__entry.html#ace12399f157bc46877fbcddec98da67e">size</a> = <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">size</a>;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> fmap1 = <a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">fmap</a>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> fmap2 = 0;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a> freemap=0;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> * ppage;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    <a class="code" href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry</a> (dentry);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].count-- == 0) {</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> s = size, p = 0; s &gt; 0; s -= 1&lt;&lt;12, p++){</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <span class="keywordflow">if</span> (p &lt; 12) {</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                ppage = &amp;(<a class="code" href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a>[inode].<a class="code" href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">page</a>[p]);</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (size &lt;= (28&lt;&lt;12)) {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                ppage = &amp;(<a class="code" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap1][p-12]);</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                <span class="keywordflow">if</span> (p == size&gt;&gt;12) freemap=1;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                fmap2 = <a class="code" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap1][(p-12)/16];</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                ppage = &amp;(<a class="code" href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a>[fmap2][(p-12)%16]);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keywordflow">if</span> ((p-12)%16 == 15) freemap=2;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                <span class="keywordflow">if</span> (p == size&gt;&gt;12) freemap=3;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <a class="code" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a> (*ppage);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <span class="keywordflow">if</span> (freemap &amp; 1) <a class="code" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a>(fmap1);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">if</span> (freemap &amp; 2) <a class="code" href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a>(fmap2);</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <a class="code" href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a> (inode);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    }</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_a5d172bef33b255bfe7ec0375abac988e"><div class="ttname"><a href="kfs_8c.html#a5d172bef33b255bfe7ec0375abac988e">kfs_free_dentry</a></div><div class="ttdeci">static void kfs_free_dentry(u16_t dentry)</div><div class="ttdoc">frees a dentry (it is not necessary to erase its content, it will be done in allocation) ...</div><div class="ttdef"><b>Definition:</b> kfs.c:277</div></div>
<div class="ttc" id="structkfs__inode__s_html_aea74f0e1495f40cf25e36f8963b84e8b"><div class="ttname"><a href="structkfs__inode__s.html#aea74f0e1495f40cf25e36f8963b84e8b">kfs_inode_s::page</a></div><div class="ttdeci">u16_t page[12]</div><div class="ttdoc">first 12 pages of a file (12*4kib=48kb) </div><div class="ttdef"><b>Definition:</b> kfs.c:55</div></div>
<div class="ttc" id="structkfs__inode__s_html_ae4c3aa6d76cc8e92a9b29c2b3707f473"><div class="ttname"><a href="structkfs__inode__s.html#ae4c3aa6d76cc8e92a9b29c2b3707f473">kfs_inode_s::size</a></div><div class="ttdeci">u32_t size</div><div class="ttdoc">file size is 16mib max </div><div class="ttdef"><b>Definition:</b> kfs.c:50</div></div>
<div class="ttc" id="kfs_8c_html_aadbe9ab58b58e9826dd4da1384c80798"><div class="ttname"><a href="kfs_8c.html#aadbe9ab58b58e9826dd4da1384c80798">kfs_free_inode</a></div><div class="ttdeci">static void kfs_free_inode(int inode)</div><div class="ttdoc">frees an inode (it is not necessary to erase it, it will be done in allocation) </div><div class="ttdef"><b>Definition:</b> kfs.c:317</div></div>
<div class="ttc" id="kfs_8c_html_adfe2302bd3dfd42413c478b8a32174cb"><div class="ttname"><a href="kfs_8c.html#adfe2302bd3dfd42413c478b8a32174cb">KfsFmap</a></div><div class="ttdeci">static kfs_fmap_t KfsFmap[KFS_MAX_FMAP]</div><div class="ttdoc">up to MAX_FMAP inode extensions </div><div class="ttdef"><b>Definition:</b> kfs.c:124</div></div>
<div class="ttc" id="structfdt__reserve__entry_html_ace12399f157bc46877fbcddec98da67e"><div class="ttname"><a href="structfdt__reserve__entry.html#ace12399f157bc46877fbcddec98da67e">fdt_reserve_entry::size</a></div><div class="ttdeci">fdt64_t size</div><div class="ttdef"><b>Definition:</b> fdt.h:33</div></div>
<div class="ttc" id="kfs_8c_html_ac364ca8f5189a2eaf2f7cbeef0a27698"><div class="ttname"><a href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a></div><div class="ttdeci">static void kfs_free_page(u16_t page)</div><div class="ttdoc">frees a page of the disk </div><div class="ttdef"><b>Definition:</b> kfs.c:358</div></div>
<div class="ttc" id="kfs_8c_html_ace1088077311b5b6a4d2fa6d330f4ccf"><div class="ttname"><a href="kfs_8c.html#ace1088077311b5b6a4d2fa6d330f4ccf">KfsInode</a></div><div class="ttdeci">static kfs_inode_t KfsInode[KFS_MAX_INODE]</div><div class="ttdef"><b>Definition:</b> kfs.c:121</div></div>
<div class="ttc" id="kfs_8c_html_a0c0a490ab7fa397be6c764a935cc5ea4"><div class="ttname"><a href="kfs_8c.html#a0c0a490ab7fa397be6c764a935cc5ea4">u32_t</a></div><div class="ttdeci">unsigned int u32_t</div><div class="ttdef"><b>Definition:</b> kfs.c:26</div></div>
<div class="ttc" id="kfs_8c_html_afc6499c1f28697aa3bfc2804d496fd11"><div class="ttname"><a href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></div><div class="ttdeci">unsigned short u16_t</div><div class="ttdef"><b>Definition:</b> kfs.c:27</div></div>
<div class="ttc" id="kfs_8c_html_ac7986c65e8710a8b55857582e62ccc78"><div class="ttname"><a href="kfs_8c.html#ac7986c65e8710a8b55857582e62ccc78">kfs_open</a></div><div class="ttdeci">int kfs_open(char *pathname)</div><div class="ttdoc">opens a file or directory, if file or directory not found, all the pathname is created ...</div><div class="ttdef"><b>Definition:</b> kfs.c:525</div></div>
<div class="ttc" id="structkfs__inode__s_html_a6a491f8ad9c0ea78d30421be44931e9b"><div class="ttname"><a href="structkfs__inode__s.html#a6a491f8ad9c0ea78d30421be44931e9b">kfs_inode_s::fmap</a></div><div class="ttdeci">u16_t fmap</div><div class="ttdoc">page above the first 12 pages </div><div class="ttdef"><b>Definition:</b> kfs.c:56</div></div>
<div class="ttc" id="structkfs__dentry__s_html_a4e87e5375dfccc972eae6a05bfa2a086"><div class="ttname"><a href="structkfs__dentry__s.html#a4e87e5375dfccc972eae6a05bfa2a086">kfs_dentry_s::inode</a></div><div class="ttdeci">u8_t inode</div><div class="ttdoc">index of the associated inode </div><div class="ttdef"><b>Definition:</b> kfs.c:43</div></div>
<div class="ttc" id="kfs_8c_html_a2b773f0350f13077e1479fe36941da52"><div class="ttname"><a href="kfs_8c.html#a2b773f0350f13077e1479fe36941da52">kfs_free_fmap</a></div><div class="ttdeci">static void kfs_free_fmap(u16_t fmap)</div><div class="ttdoc">frees a map </div><div class="ttdef"><b>Definition:</b> kfs.c:338</div></div>
<div class="ttc" id="kfs_8c_html_a4c9c9ecc30db3a783a700f4e79f9561e"><div class="ttname"><a href="kfs_8c.html#a4c9c9ecc30db3a783a700f4e79f9561e">KfsDentry</a></div><div class="ttdeci">static kfs_dentry_t KfsDentry[KFS_MAX_DENTRY]</div><div class="ttdoc">up to MAX_DENTRY files </div><div class="ttdef"><b>Definition:</b> kfs.c:120</div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4ed044e75ea35d5cffd2ee5426e1db38"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kfs_write </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>dentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pg_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes one page from memory buffer to file dentry. The buffer is written on the disk in file page of which the offset belongs. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dentry</td><td>given by open or openat </td></tr>
    <tr><td class="paramname">pg_offset</td><td>is the number of the page that will be written </td></tr>
    <tr><td class="paramname">buffer</td><td>contains the page to write (at least one page length) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of pages written 1 if success with page in disk as a side effect, 0 if success but buffer was full of 0, thus no page needs to be allocated -1 if something is wrong </dd></dl>

<p>References <a class="el" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page()</a>, <a class="el" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page()</a>, <a class="el" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode()</a>, <a class="el" href="kfs_8c.html#a200e5373e6e2968ecc37495280d658c7">kfs_ppage()</a>, <a class="el" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page()</a>, and <a class="el" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>.</p>

<p>Referenced by <a class="el" href="ktools_8c.html#a39f344acada2bd8574dfb5da41938905">add_new_file()</a>, and <a class="el" href="ktools_8c.html#a9b68125aeb10ab39a0981d0fa952d5f1">dummy_disk()</a>.</p>
<div class="fragment"><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;{</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> inode = <a class="code" href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a>(dentry);                <span class="comment">// get inode associated with the dentry</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <a class="code" href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a> *ppage = <a class="code" href="kfs_8c.html#a200e5373e6e2968ecc37495280d658c7">kfs_ppage</a> (inode, pg_offset);    <span class="comment">// get addr in fmaps of page number (alloc fmap)</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordflow">if</span> (ppage == <a class="code" href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="keywordflow">return</span> -1;                   <span class="comment">// NULL means no more space in fmaps</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span> (*ppage == 0) *ppage = <a class="code" href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page</a>();     <span class="comment">// if page absent, allocate a new page</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">if</span> (*ppage == 0) <span class="keywordflow">return</span> -1;                     <span class="comment">// 0 means no more space on the disk</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page</a> (buf, *ppage)) <span class="keywordflow">return</span> 1;     <span class="comment">// at last write disk page from buf</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <a class="code" href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a> (*ppage);                         <span class="comment">// if returns 0, it means page full of 0</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">return</span> *ppage = 0;                              <span class="comment">// erase page number in fmap;</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;}</div>
<div class="ttc" id="kfs_8c_html_a53fd0386d2feed317c9d6bdc536e4540"><div class="ttname"><a href="kfs_8c.html#a53fd0386d2feed317c9d6bdc536e4540">kfs_alloc_page</a></div><div class="ttdeci">static u16_t kfs_alloc_page(void)</div><div class="ttdoc">allocates a new page of the disk </div><div class="ttdef"><b>Definition:</b> kfs.c:349</div></div>
<div class="ttc" id="kfs_8c_html_a82cd5257064f4d5b995d6951b9f054b3"><div class="ttname"><a href="kfs_8c.html#a82cd5257064f4d5b995d6951b9f054b3">kfs_write_page</a></div><div class="ttdeci">static int kfs_write_page(void *buf, int page)</div><div class="ttdoc">writes to the disk from the memory buffer </div><div class="ttdef"><b>Definition:</b> kfs.c:473</div></div>
<div class="ttc" id="kfs_8c_html_aae206d59d8bc4514d34dafdff1198ede"><div class="ttname"><a href="kfs_8c.html#aae206d59d8bc4514d34dafdff1198ede">kfs_inode</a></div><div class="ttdeci">int kfs_inode(int dentry)</div><div class="ttdef"><b>Definition:</b> kfs.c:139</div></div>
<div class="ttc" id="kfs_8c_html_ac364ca8f5189a2eaf2f7cbeef0a27698"><div class="ttname"><a href="kfs_8c.html#ac364ca8f5189a2eaf2f7cbeef0a27698">kfs_free_page</a></div><div class="ttdeci">static void kfs_free_page(u16_t page)</div><div class="ttdoc">frees a page of the disk </div><div class="ttdef"><b>Definition:</b> kfs.c:358</div></div>
<div class="ttc" id="kfs_8c_html_a200e5373e6e2968ecc37495280d658c7"><div class="ttname"><a href="kfs_8c.html#a200e5373e6e2968ecc37495280d658c7">kfs_ppage</a></div><div class="ttdeci">static u16_t * kfs_ppage(u16_t inode, u16_t pg_offset)</div><div class="ttdef"><b>Definition:</b> kfs.c:401</div></div>
<div class="ttc" id="kfs_8c_html_afc6499c1f28697aa3bfc2804d496fd11"><div class="ttname"><a href="kfs_8c.html#afc6499c1f28697aa3bfc2804d496fd11">u16_t</a></div><div class="ttdeci">unsigned short u16_t</div><div class="ttdef"><b>Definition:</b> kfs.c:27</div></div>
<div class="ttc" id="kfs_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="kfs_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> kfs.c:24</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
